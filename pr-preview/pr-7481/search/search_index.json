{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"The Energy Exascale Earth System Model (E3SM)","text":"<p>E3SM is a state-of-the-art fully coupled model of the Earth's including important biogeochemical and cryospheric processes. It is intended to address the most challenging and demanding earth system research problems and Department of Energy mission needs while efficiently using DOE Leadership Computing Facilities.</p> <p>Note</p> <p>This is the future home for all documentation specific to E3SM and its components. Until complete, some documentation will be found at the project's Confluence wiki</p>"},{"location":"#e3sm-basics","title":"E3SM Basics","text":"<ul> <li>Installation</li> <li>User Guide</li> <li>Development</li> </ul>"},{"location":"#component-models","title":"Component Models","text":"<ul> <li>EAM</li> <li>EAMxx \u2014 not yet supported.</li> <li>ELM</li> <li>MOSART</li> <li>MPAS-Ocean</li> <li>MPAS-seaice</li> <li>Omega \u2014 not yet supported.</li> <li>Data Models</li> </ul>"},{"location":"#tools","title":"Tools","text":"<ul> <li>generate_domain_files</li> </ul> <p>Please see Developing Docs to learn about how to contribute to the documentation.</p>"},{"location":"installation/","title":"Installation Guide","text":"<p>E3SM is not available as a pre-compiled binary.  You install E3SM by cloning the source code using git and building the executable on your local platform after making some choices on model configuration (addressed in the User Guide).</p> <p>It is recommended that you install E3SM on a supported platform. (See Hardware/Software Configuration)</p> <p>The E3SM Project can not assist with installation on an un-supported platform but can point you in the right direction. If you wish to port E3SM to your machine, first check that the target machine has the software prerequisites detailed in Hardware/Software Configuration.</p> <p>E3SM uses the CIME Case Control System (CCS) and a machine must be described to the CCS in order to build and run E3SM.  See the CIME Porting Guide.</p> <p>Once you are on a supported machine, clone the source code by following the first steps (2-4 and 6) in the Development Getting Started Guide.</p> <p>To start configuration cases and building the model, see the User Guide</p>"},{"location":"Data-Models/","title":"Data Models","text":"<p>The E3SM data models are key components to support many different scenarios:</p> <ul> <li>AMIP style experiments with observed sea surface temperatures</li> <li>component model spin-up, such as land forced by atmospheric reanalysis</li> <li>idealized experiments, such as aquaplanet or radiative-convective equilibrium</li> </ul> <p>More details can be found for each component below.</p> <ul> <li>Data Atmosphere</li> <li>Data Land</li> <li>Data Ocean</li> </ul>"},{"location":"Data-Models/user-guide/data-atmos/","title":"The E3SM Data Atmosphere Model","text":"<p>Warning</p> <p>This page is still under construction</p>"},{"location":"Data-Models/user-guide/data-land/","title":"The E3SM Data Land Model","text":"<p>Warning</p> <p>This page is still under construction</p>"},{"location":"Data-Models/user-guide/data-ocean/","title":"The E3SM Data Ocean Model","text":"<p>The E3SM data ocean has several different modes to support various realistic and idealized experiments. Sea surface temperatures (SST) can be either prescribed or prognostic. Prescribed SSTs are specified either through a data stream or analytically. Prognostic modes allow the SST field to evolve and respond to atmospheric conditions. The guides below provide more details on how to use these capabilities.</p> <ul> <li>Prescribed<ul> <li>SST from Observations</li> <li>Idealized SST</li> </ul> </li> <li>Prognostic<ul> <li>Traditional Slab Ocean Model (SOM)</li> <li>Relaxed Slab Ocean (RSO)</li> </ul> </li> </ul>"},{"location":"Data-Models/user-guide/data-ocean/#sst-from-observations","title":"SST from Observations","text":"<p>Using SST data derived from observations is the most common use of the data ocean model, often for AMIP style experiments to reproduce historical periods.</p> <p>Example compsets that use this capability are <code>F2010</code> and <code>F20TR</code>. These compsets use the <code>_DOCN%DOM_</code> compset modifier, which sets the <code>DOCN_MODE</code> variable in <code>env_run.xml</code>  to \"prescribed\".</p> <p>Several additional XML variables need to be set in order to use this capability, which are set to defaults for common configurations, such as <code>F2010</code> at <code>ne30pg2</code> atmospheric resolution.</p> <pre><code>SSTICE_DATA_FILENAME  Prescribed SST and ice coverage data file name\nSSTICE_GRID_FILENAME  Grid file in \"domain\" format corresponding to SSTICE_DATA_FILENAME\nSSTICE_YEAR_ALIGN     The model year that corresponds to SSTICE_YEAR_START on the data file\nSSTICE_YEAR_START     The first year of data to use from SSTICE_DATA_FILENAME\nSSTICE_YEAR_END       The last year of data to use from SSTICE_DATA_FILENAME\n</code></pre> <p>Most users will not need to edit these values from their defaults, but many scenarios require non-standard SST data, such as tropical cyclone hindcasts where the daily evolution of high-resolution SST data may be desireable.</p>"},{"location":"Data-Models/user-guide/data-ocean/#idealized-sst","title":"Idealized SST","text":"<p>The two main uses of idealized SST modes are aquaplanet (AQP) and radiative-convective equilibrium (RCE). The latter is just a special case of an aquaplanet where the SST is [usually] a constant value everywhere, traditionally used in conjunction with special modifications to homogenize radiation and disable rotation. There are several analytically specified SST patterns established by model intercomparison projects such as the Aqua-Planet Experiment (APE)<sup>1</sup> and RCEMIP<sup>2</sup><sup>3</sup>.</p>"},{"location":"Data-Models/user-guide/data-ocean/#idealized-sst-compsets","title":"Idealized SST compsets","text":"<p>The following list shows the currently defined E3SM compsets that utilize idealized SST.</p> <pre><code>FAQP\nFAQP-MMF1\nFAQP-MMF2\nF-SCREAM-LR-AQP1\nF-SCREAM-HR-AQP1\nFRCE\nFRCE-MMF1\nFRCE-MMF2\nFRCE-MW_295dT1p25\nFRCE-MW_300dT0p625\nFRCE-MW_300dT1p25\nFRCE-MW_300dT2p5\nFRCE-MW_305dT1p25\nFRCE-MW-MMF1_295dT1p25\nFRCE-MW-MMF1_300dT0p625\nFRCE-MW-MMF1_300dT1p25\nFRCE-MW-MMF1_300dT2p5\nFRCE-MW-MMF1_305dT1p25\n</code></pre> <p>These all use \"analytic\" SST patterns that are specified via the <code>docn_comp_run()</code> subroutine in <code>components/data_comps/docn/src/docn_comp_mod.F90</code>. The <code>AQP</code> compsets currently only use the basic aquaplanet pattern that is symmetric about the equator. Other APE patterns introduce different meridional gradients and/or asymmetries. The various analytic SST patterns can be selected by changing the data ocean specifier: <code>_DOCN%AQP1_</code>.</p> <p>The first 10 analytic aquaplanet SST patterns correspond to the aqua-planet experiment (APE) protocol as follows</p> <pre><code>AQP1    = control symmetric SST pattern\nAQP2    = Flat\nAQP3    = Qobs = average of AQP1 and AQP2\nAQP4    = Peaked\nAQP5    = Control+5N\nAQP6    = 1KEQ - small warm pool\nAQP7    = 3KEQ - small warm pool\nAQP8    = 3KW1 - large warm pool\nAQP9    = Control+10N\nAQP10   = Control+15N\n</code></pre> <p>Note</p> <p>When using aquaplanet mode the orbital parameters will take on the idealized values shown below such that there are no seasonal variations, but there is still a diurnal cycle. <pre><code>orb_eccen = 0\norb_obliq = 0\norb_mvelp = 0\norb_mode = \"fixed_parameters\"\n</code></pre></p> <p>The basic RCE compsets use the <code>_DOCN%AQPCONST_</code> modifier to produce a globally constant SST value, which is set by the <code>DOCN_AQPCONST_VALUE</code> variable in <code>env_run.xml</code>. The \"FRCE-MW\" compsets were designed for RCEMIP-II to produce a \"mock walker-cell\" configuration, in which sinusoidal SST variations are applied to promote a coherent large-scale circulation.</p>"},{"location":"Data-Models/user-guide/data-ocean/#sst-data-file","title":"SST Data File","text":"<p>In addition to the analytic SST modes the user can also specify an idealized aquaplanet SST pattern via the <code>_DOCN%AQPFILE_</code> option. The <code>aquapfile</code> namelist variable is used to specify the SST pattern in this mode. Note that this option has not been used or tested recently, so the user may experience difficulty trying to use this feature.</p>"},{"location":"Data-Models/user-guide/data-ocean/#traditional-slab-ocean-model","title":"Traditional Slab Ocean Model","text":"<p>A slab ocean model (SOM) allows responsive SSTs to address the \"infinite heat source\" problem associated with prescribed SSTs, but is much cheaper than running with a full ocean model. The traditional SOM appraoch requires special inputs, such as a specified mixed layer depth pattern that can vary in time and a prescribed heat flux to account for the missing effects of ocean dynamics often referred to as \"Q-flux\". The Q-flux data is often estimated from a fully coupled simulation with active ocean and sea-ice so that the SOM simulation will resemble the full model.</p> <p>Currently, we do not have Q-flux data to drive the SOM in E3SM. An alternative appraoch is to use a \"relaxed\" slab ocean (RSO) in which a specified relaxation time scale is used to bring the SST field back to a target SST field. The RSO mode is much simpler to use, but carries caveats that the user should be aware of before using. See Data Ocean - Relaxed Slab Ocean for more information.</p>"},{"location":"Data-Models/user-guide/data-ocean/#relaxed-slab-ocean","title":"Relaxed Slab Ocean","text":"<p>The relaxed slab ocean (RSO) is similar in many ways to the traditional slab ocean model, but uses a specified relaxation time scale to avoid the need for specified \"Q-flux\" data to represent the effects of ocean transport. The RSO implementation in E3SM was inspired by Zarzycki (2016)<sup>4</sup>.</p> <p>A key consideration for the user is whether they need to use a realistic distribution of mixed layer depths (MLD), or whether their use case can benefit from the simplicity of a globally uniform MLD.</p> <p>The RSO mode has the following namelist variables to influence the ocean behavior:</p> <pre><code>RSO_relax_tau   SST relaxation timescale\nRSO_fixed_MLD   globally uniform MLD value (use -1 for realistic MLD)\n</code></pre> <p>Other RSO parameter values are hardcoded in <code>components/data_comps/docn/src/docn_comp_mod.F90</code>.</p> <pre><code>RSO_slab_option = 0           ! Option for setting RSO_X_cool\nRSO_R_cool      = 11.75/86400 ! base cooling rate [K/s]\nRSO_Tdeep       = 271.00      ! deep water temperature [K]\nRSO_dT_o        = 27.0        ! scaling temperature gradient\nRSO_h_o         = 30.0        ! scaling mixed layer depth\n</code></pre> <p>The RSO mode uses the <code>SSTICE_DATA_FILENAME</code> in <code>env_run.xml</code> for its data stream. For a globally uniform MLD this file only need to contain a <code>SST_cpl</code> variable for the SST that will act as the target SST value for relaxation. If a realistic MLD pattern is desired then the <code>hblt</code> variable must also be present. This data can be derived a number of ways, but we currently do not have a dedicated tool or workflow.</p> <ol> <li> <p>Michael BLACKBURN and Brian J. HOSKINS. Context and Aims of the Aqua-Planet Experiment. Journal of the Meteorological Society of Japan. Ser. II, 91A:1\u201315, October 2013. doi:10.2151/jmsj.2013-A01.\u00a0\u21a9</p> </li> <li> <p>Allison A. Wing, Kevin A. Reed, Masaki Satoh, Bjorn Stevens, Sandrine Bony, and Tomoki Ohno. Radiative\u2013convective equilibrium model intercomparison project. Geoscientific Model Development, 11(2):793\u2013813, March 2018. Publisher: Copernicus GmbH. doi:10.5194/gmd-11-793-2018.\u00a0\u21a9</p> </li> <li> <p>Allison A. Wing, Levi G. Silvers, and Kevin A. Reed. RCEMIP-II: mock-Walker simulations as phase II of the radiative\u2013convective equilibrium model intercomparison project. Geoscientific Model Development, 17(16):6195\u20136225, August 2024. Publisher: Copernicus GmbH. doi:10.5194/gmd-17-6195-2024.\u00a0\u21a9</p> </li> <li> <p>Colin M. Zarzycki. Tropical cyclone intensity errors associated with lack of two-way ocean coupling in high-resolution global simulations. Journal of Climate, 29(23):8589 \u2013 8610, 2016. doi:10.1175/JCLI-D-16-0273.1.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/","title":"The E3SM Atmosphere Model (EAM)","text":"<p>EAM is the state-of-the-art atmospheric component of the E3SM model that uses a Spectral Element Dynamical Core and a suite of parameterizations to represent a range of atmospheric processes, which are described in the Technical Guide (see below). Its nominal resolution is roughly 100km in the horizontal, with a model time step of 1800 seconds, and runs with 80 layers in the vertical (model top of 60km).</p> <ul> <li>The EAM User Guide explains how to control EAM when its running within E3SM.</li> <li>The EAM Developer Guide explains EAM data structures and how to write new code.</li> <li>The EAM Technical Guide explains the science behind EAM's code</li> </ul>"},{"location":"EAM/dev-guide/","title":"EAM Developer Guide","text":"<p>coming soon.</p>"},{"location":"EAM/tech-guide/","title":"EAM Technical Guide","text":"<p>This Technical Guide describes the physics of version 3 of the E3SM Atmospheric Model</p>"},{"location":"EAM/tech-guide/#dynamics-and-physics","title":"Dynamics and Physics","text":"<ul> <li> <p>HOMME: Dynamical core.</p> </li> <li> <p>Atmospheric-Grid: Grid used with dynamical core</p> </li> <li> <p>P3: Stratiform cloud microphysics scheme.</p> </li> <li> <p>CLUBB: Parameterization of subgrid-scale turbulence and clouds.</p> </li> <li> <p>Zhang-McFarlane: Deep convection parameterization.</p> </li> <li> <p>RRTMG: Parameterization of radiation.</p> </li> <li> <p>ORODRAG: Parameterization of orographic drag</p> </li> <li> <p>MAM: Primary parameterization schemes used to represent aerosols.</p> </li> <li> <p>VBS: Parameterization of secondary organic aerosols.</p> </li> <li> <p>Dust: Parameterization of dust emissions.</p> </li> <li> <p>OCEANFILMS: Parameterization of sea soray irganic aerosol emissions.</p> </li> <li> <p>chemUCI + Linoz v3: Interactive atmospheric chemistry packages.</p> </li> </ul>"},{"location":"EAM/tech-guide/#diagnostic-outputs","title":"Diagnostic outputs","text":"<ul> <li> <p>COSP: Scheme that allows the model to output satellite simulator output.</p> </li> <li> <p>ARM Diags: Diagnostic package that allows the model output to be compared against ARM measurements.</p> </li> </ul>"},{"location":"EAM/tech-guide/armdiags/","title":"ARM diagnostics","text":""},{"location":"EAM/tech-guide/armdiags/#overview","title":"Overview","text":"<p>The ARM data-oriented metrics and diagnostics package (ARM Diags) was developed to facilitate the use of ARM data in earth system model evaluation and model intercomparison (Zhang et al., 2020)<sup>1</sup>. It includes ARM data sets, compiled from multiple ARM data products, and a Python-based analysis toolkit for computation ad visualization. It also includes simulation data from models participating in CMIP, which allows modeling groups to compare a new, candidate version of their model to existing CMIP models. The ARM Diags has been applied in several model evaluation studies to help address a range of issues in earth system models (Zheng et al., 2023;<sup>2</sup> Emmenegger et al., 2022;<sup>3</sup> Zhang et al., 2018<sup>4</sup>). The Majority of ARM Diags sets are ported into E3SM Diags (Zhang et al., 2022)<sup>5</sup> for routine evaluation of the model.</p>"},{"location":"EAM/tech-guide/armdiags/#to-enable-the-use-of-arm-diags","title":"To enable the use of ARM Diags","text":"<p>To enable using ARM Diags for a simulation, often, a new tape that output at high-frequency over limited-area (nearest grid box to supported ARM site) needs to be included in the namelist file, an example as follows:</p> <pre><code>fincl7 = 'PS','Q','T','Z3','CLOUD','CONCLD','CLDICE',\n   'CLDLIQ','FREQR','REI','REL','PRECT','TMQ','PRECC',\n   'TREFHT','QREFHT','OMEGA','CLDTOT','LHFLX','SHFLX',\n   'FLDS','FSDS','FLNS','FSNS','FLNSC','FSDSC','FSNSC',\n   'AODVIS','AODABS','LS_FLXPRC','LS_FLXSNW',\n   'LS_REFFRAIN','ZMFLXPRC','ZMFLXSNW','CCN1','CCN2',\n   'CCN3','CCN4','CCN5','num_a1','num_a2','num_a3',\n   'num_a4','so4_a1','so4_a2','so4_a3','AREL','TGCLDLWP',\n   'AQRAIN','ANRAIN','FREQR','PRECL','RELHUM'\nfincl7lonlat='262.5e_36.6n','203.4e_71.3n','147.4e_2.0s',\n   '166.9e_0.5s','130.9e_12.4s','331.97e_39.09n'\n</code></pre> <p>Note that in this example fincl7 should set to write output at hourly (<code>nhtfrq = -1</code>). And here additional variables are included for ARM simulator analysis. The ARM site information is shown below:</p> <pre><code>    \"sgpc1\": [\"97.5W 36.4N Oklahoma ARM\"],\n\n    \"nsac1\": [\"156.6W 71.3N Barrow ARM\"],\n\n    \"twpc1\": [\"147.4E 2.1S Manus ARM\"],\n\n    \"twpc2\": [\"166.9E 0.5S Nauru ARM\"],\n\n    \"twpc3\": [\"130.9E 12.4S Darwin ARM\"],\n\n    \"enac1\": [\"28.0E 39.1N Graciosa Island ARM\"], \n</code></pre>"},{"location":"EAM/tech-guide/armdiags/#diagnostics-and-metrics-currently-implemented-in-the-arm-diags","title":"Diagnostics and metrics currently implemented in the ARM Diags","text":"Statistical Metrics Variables Time sampling Line plots and Taylor diagrams for annual cycle variability of each variable Precipitation, column water vapor, surface energy budget components, near-surface temperature and specific humidity, surface pressure, total cloud fraction, and aerosol optical depth. Monthly mean Contour and vertical profiles of annual cycle and diurnal cycle of cloud fraction Vertical profiles of cloud fraction Hourly mean Line and harmonic dial plots of diurnal cycle of precipitation Surface precipitation rate Hourly mean Probability density function (PDF) plots of precipitation rate Surface precipitation rate Hourly mean CCN Annual Cycles CCN number concentrations at 0.1%, 0.2%, 0.5% and 1.0% supersaturation levels Hourly mean Aerosol Annual Cycles Total aerosol number concentration Hourly mean Aerosol Chemical Annual Cycles Organic, sulfate, nitrate, ammonium, chloride mass concentration Hourly mean Process-oriented metrics Variables Time sampling Convection Onset 1. Surface precipitation rate   2. Column Precipitable Water Vapor Hourly mean Aerosol-CCN Activation 1. Total aerosol number concentration   2. CCN number concentrations at different supersaturation levels (0.1%, 0.2%, 0.5% and 1.0) Hourly mean <ol> <li> <p>C. Zhang, S. Xie, C. Tao, S. Tang, T. Emmenegger, J. D. Neelin, K. A. Schiro, W. Lin, and Z. Shaheen. The ARM Data-Oriented Metrics and Diagnostics Package for Climate Models: A New Tool for Evaluating Climate Models with Field Data. Bulletin of the American Meteorological Society, 101(10):E1619\u2013E1627, October 2020. URL: https://journals.ametsoc.org/view/journals/bams/101/10/bamsD190282.xml (visited on 2024-03-29), doi:10.1175/BAMS-D-19-0282.1.\u00a0\u21a9</p> </li> <li> <p>Xiaojian Zheng, Cheng Tao, Chengzhu Zhang, Shaocheng Xie, Yuying Zhang, Baike Xi, and Xiquan Dong. Assessment of CMIP5 and CMIP6 AMIP Simulated Clouds and Surface Shortwave Radiation Using ARM Observations over Different Climate Regions. Journal of Climate, 36(24):8475\u20138495, November 2023. URL: https://journals.ametsoc.org/view/journals/clim/36/24/JCLI-D-23-0247.1.xml (visited on 2024-03-29), doi:10.1175/JCLI-D-23-0247.1.\u00a0\u21a9</p> </li> <li> <p>Todd Emmenegger, Yi-Hung Kuo, Shaocheng Xie, Chengzhu Zhang, Cheng Tao, and J. David Neelin. Evaluating Tropical Precipitation Relations in CMIP6 Models with ARM Data. Journal of Climate, 35(19):6343\u20136360, October 2022. URL: https://journals.ametsoc.org/view/journals/clim/35/19/JCLI-D-21-0386.1.xml (visited on 2024-03-29), doi:10.1175/JCLI-D-21-0386.1.\u00a0\u21a9</p> </li> <li> <p>Chengzhu Zhang, Shaocheng Xie, Stephen A. Klein, Hsi\u2010yen Ma, Shuaiqi Tang, Kwinten Van Weverberg, Cyril J. Morcrette, and Jon Petch. CAUSES: Diagnosis of the Summertime Warm Bias in CMIP5 Climate Models at the ARM Southern Great Plains Site. Journal of Geophysical Research: Atmospheres, 123(6):2968\u20132992, March 2018. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1002/2017JD027200 (visited on 2024-03-29), doi:10.1002/2017JD027200.\u00a0\u21a9</p> </li> <li> <p>Chengzhu Zhang, Jean-Christophe Golaz, Ryan Forsyth, Tom Vo, Shaocheng Xie, Zeshawn Shaheen, Gerald L. Potter, Xylar S. Asay-Davis, Charles S. Zender, Wuyin Lin, Chih-Chieh Chen, Chris R. Terai, Salil Mahajan, Tian Zhou, Karthik Balaguru, Qi Tang, Cheng Tao, Yuying Zhang, Todd Emmenegger, Susannah Burrows, and Paul A. Ullrich. The E3SM Diagnostics Package (E3SM Diags v2.7): a Python-based diagnostics package for Earth system model evaluation. Geoscientific Model Development, 15(24):9031\u20139056, December 2022. URL: https://gmd.copernicus.org/articles/15/9031/2022/ (visited on 2024-03-29), doi:10.5194/gmd-15-9031-2022.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/atmosphere-grid-overview/","title":"Atmosphere Grid Overview","text":"<p>The E3SM atmosphere component uses a cube-sphere grid, partly to avoid the convergence of latitude lines at the poles. The grid is constructed by subdividing each cube face into NxN elements and then projecting these to a spherical geometry.</p>"},{"location":"EAM/tech-guide/atmosphere-grid-overview/#the-np4-gll-grid","title":"The np4 GLL Grid","text":"<p>The atmospheric dycore is based on the spectral element (SE) method using the Gauss-Lobatto-Legendre (GLL) quadrature aproach. An irregular grid of 4x4 GLL nodes (i.e. np4) is used to represent the model state within each element of the cube-sphere grid. The illustration below indicates the GLL nodes of the ne4np4 grid with green dots, while the elements are outlined in blue. Notice the irregular spacing of the GLL nodes, which causes them to cluster at the element corners.</p> <p>While the atmosphere history output is primarily on the physics grid (see below), it is possible to output on the np4 grid. The input topography and initial condition data must be on the np4 grid. When mapping between SE and FV grids TempestRemap should be used. SE GLL data does not naturally represent as FV type cell averages, and thus mapping tools which only work with cell centered data (ESMF, SCRIP) should be avoided.  </p> <p>For a np4 grid with N elements per cube edge the total number of unique GLL nodes can be calculated as: <code>N*(np-1)^2 + 2</code></p> <p></p>"},{"location":"EAM/tech-guide/atmosphere-grid-overview/#the-pg2-physgrid","title":"The pg2 \"physgrid\"","text":"<p>Starting in v2, physics calculations and history output in E3SM use a quasi-equal area finite volume (FV) grid, rather the GLL nodes of the spectral element grid. This FV grid is constructed byt dividing each spectral element of the cube-sphere into a grid of 2x2 subcells, referred to as \"pg2\" or \"physgrid\" (shown below). Finer divisions of the spectral element are possible, such as 3x3, but these grids do not seem to have any notable advantages (see Hannah et al. 2021). Quantities on the physgrid should be considered cell average values over each FV cell, rather than nodal values.</p> <p>For a pg2 grid with N elements per cube edge the total number of physics columns can be calculated as: <code>ncol = N*N*6*(2*2)</code></p> <p></p>"},{"location":"EAM/tech-guide/chemUCIlinozv3/","title":"chemUCI and Linoz","text":""},{"location":"EAM/tech-guide/chemUCIlinozv3/#overview","title":"Overview","text":"<p>Atmospheric interactive chemistry is handled by chemUCI (in the troposphere) and Linoz v3 (in the stratosphere). chemUCI consists of 28 advected tracers for the O3-CH4-HOx-NOx-NMVOCs chemistry. Compared to E3SMv2, the E3SMv3 linearized stratospheric chemistry scheme (Linoz v3) expends the interactive species to include O3, N2O, NOy, and CH4. The boundary between stratosphere and troposphere adopts the e90 tropopause algorithm.</p>"},{"location":"EAM/tech-guide/chemUCIlinozv3/#namelist-parameters","title":"Namelist parameters","text":"<p>chemUCI and Linoz Namelist Parameters</p>"},{"location":"EAM/tech-guide/clubb/","title":"Cloud Layers Unified By Binormals","text":""},{"location":"EAM/tech-guide/clubb/#overview","title":"Overview","text":"<p>The Cloud Layers Unified By Binormals (CLUBB) parameterization is a parameterization of subgrid-scale turbulence and clouds.<sup>1</sup><sup>2</sup><sup>3</sup><sup>4</sup> It prognoses turbulent fluxes of heat, moisture, and momentum, and it diagnoses the liquid cloud fraction and liquid water mixing ratio.  To do so, it prognoses higher-order turbulence moments and closes those prognostic equations by use of an assumed double-Gaussian shape of the subgrid probability density function.  CLUBB operates throughout the troposphere, but it contributes especially to the planetary boundary layer and low-cloud regimes, including stratocumulus and shallow cumulus regimes.  </p>"},{"location":"EAM/tech-guide/clubb/#namelist-parameters","title":"Namelist parameters","text":"<p>CLUBB Namelist Parameters</p> <ol> <li> <p>Vincent E. Larson. CLUBB-SILHS: A parameterization of subgrid variability in the atmosphere. March 2022. arXiv:1711.03675 [physics]. URL: http://arxiv.org/abs/1711.03675 (visited on 2024-03-29), doi:10.48550/arXiv.1711.03675.\u00a0\u21a9</p> </li> <li> <p>Peter A. Bogenschutz, Andrew Gettelman, Cecile Hannay, Vincent E. Larson, Richard B. Neale, Cheryl Craig, and Chih-Chieh Chen. The path to CAM6: coupled simulations with CAM5.4 and CAM5.5. Geoscientific Model Development, 11(1):235\u2013255, January 2018. URL: https://gmd.copernicus.org/articles/11/235/2018/ (visited on 2024-03-29), doi:10.5194/gmd-11-235-2018.\u00a0\u21a9</p> </li> <li> <p>Vincent E. Larson and Jean-Christophe Golaz. Using Probability Density Functions to Derive Consistent Closure Relationships among Higher-Order Moments. Monthly Weather Review, 133(4):1023\u20131042, April 2005. URL: https://journals.ametsoc.org/view/journals/mwre/133/4/mwr2902.1.xml (visited on 2024-03-29), doi:10.1175/MWR2902.1.\u00a0\u21a9</p> </li> <li> <p>Jean-Christophe Golaz, Vincent E. Larson, and William R. Cotton. A PDF-Based Model for Boundary Layer Clouds. Part I: Method and Model Description. Journal of the Atmospheric Sciences, 59(24):3540\u20133551, December 2002. URL: https://journals.ametsoc.org/view/journals/atsc/59/24/1520-0469_2002_059_3540_apbmfb_2.0.co_2.xml (visited on 2024-03-29), doi:10.1175/1520-0469(2002)059&lt;3540:APBMFB&gt;2.0.CO;2.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/cosp/","title":"Cloud Feedback Model Intercomparison Project (CFMIP) Observation Simulator Package","text":""},{"location":"EAM/tech-guide/cosp/#overview","title":"Overview","text":"<p>The Cloud Feedback Model Intercomparison Project (CFMIP) Observation Simulator Package (COSP; Bodas-Salcedo et al., 2011;<sup>1</sup> Swales et al., 2018;<sup>2</sup> Zhang et al., 2019;<sup>3</sup> Zhang et al., 2024<sup>4</sup>) was developed to improve the consistency between model clouds and satellite observations. COSP contains several independent satellite simulators for better comparing model clouds with satellite measurements collected by the International Satellite Cloud Climatology Project (ISCCP), the Moderate Resolution Imaging Spectroradiometer (MODIS), the Multi-angle Imaging SpectroRadiometer (MISR), Cloud-Aerosol Lidar and Infrared Pathfinder Satellite Observation (CALIPSO), and CloudSat. The use of satellite simulators will not only make a fairer comparison between model clouds and satellite data but also allow a more in-depth analysis of clouds. For example, clouds can be assessed in terms of their optical properties and vertical location, which dictate their radiative effects.</p>"},{"location":"EAM/tech-guide/cosp/#namelist-parameters","title":"Namelist parameters","text":"<p>COSP Namelist Parameters</p>"},{"location":"EAM/tech-guide/cosp/#to-turn-on-cosp-outputs","title":"To turn on COSP outputs","text":"<p>Run (add to the run script) the following command before running <code>./case.setup</code></p> <p><code>./xmlchange --id CAM_CONFIG_OPTS --append --val='-cosp'</code></p> Related Outputs Description <code>FISCCP1_COSP</code> Grid-box fraction covered by each ISCCP D level cloud type <code>CLMODIS</code> MODIS Cloud Area Fraction <code>CLD_MISR</code> Cloud Fraction from MISR Simulator <code>CLDTOT_CAL</code> Calipso Total Cloud Fraction <code>CLDHGH_CAL</code> Calipso High-level Cloud Fraction <code>CLDMED_CAL</code> Calipso Mid-level Cloud Fraction <code>CLDLOW_CAL</code> Calipso Low-level Cloud Fraction <code>CLD_CAL_TMPLIQ</code> Calipso Liquid Cloud Fraction as a function of temperature <code>CLD_CAL_TMPICE</code> Calipso Ice Cloud Fraction as a function of temperature <ol> <li> <p>A. Bodas-Salcedo, M. J. Webb, S. Bony, H. Chepfer, J.-L. Dufresne, S. A. Klein, Y. Zhang, R. Marchand, J. M. Haynes, R. Pincus, and V. O. John. COSP: Satellite simulation software for model assessment. Bulletin of the American Meteorological Society, 92(8):1023\u20131043, August 2011. URL: https://journals.ametsoc.org/doi/10.1175/2011BAMS2856.1 (visited on 2024-03-29), doi:10.1175/2011BAMS2856.1.\u00a0\u21a9</p> </li> <li> <p>Dustin J. Swales, Robert Pincus, and Alejandro Bodas-Salcedo. The Cloud Feedback Model Intercomparison Project Observational Simulator Package: Version 2. Geoscientific Model Development, 11(1):77\u201381, January 2018. URL: https://gmd.copernicus.org/articles/11/77/2018/ (visited on 2024-03-29), doi:10.5194/gmd-11-77-2018.\u00a0\u21a9</p> </li> <li> <p>Yuying Zhang, Shaocheng Xie, Wuyin Lin, Stephen A. Klein, Mark Zelinka, Po\u2010Lun Ma, Philip J. Rasch, Yun Qian, Qi Tang, and Hsi\u2010Yen Ma. Evaluation of Clouds in Version 1 of the E3SM Atmosphere Model With Satellite Simulators. Journal of Advances in Modeling Earth Systems, 11(5):1253\u20131268, May 2019. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2018MS001562 (visited on 2024-03-29), doi:10.1029/2018MS001562.\u00a0\u21a9</p> </li> <li> <p>Yuying Zhang, Shaocheng Xie, Yi Qin, Wuyin Lin, Jean-Christophe Golaz, Xue Zheng, Po-Lun Ma, Yun Qian, Qi Tang, Christopher R. Terai, and Meng Zhang. Understanding changes in cloud simulations from E3SM version 1 to version 2. Geoscientific Model Development, 17(1):169\u2013189, January 2024. URL: https://gmd.copernicus.org/articles/17/169/2024/ (visited on 2024-03-29), doi:10.5194/gmd-17-169-2024.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/dust/","title":"Dust aerosol","text":""},{"location":"EAM/tech-guide/dust/#overview","title":"Overview","text":"<p>Dust-related processes are represented in the E3SM atmosphere and land model components. In E3SMv3, dust deposition will also be coupled with the sea ice and ocean biogeochemistry in the ocean model. Total emission fluxes of dust particles are calculated at each model time step. A new dust emission scheme following Kok et al. (2014)<sup>1</sup> is implemented to E3SMv3, replacing the Zender scheme (Zender et al., 2003)<sup>2</sup> in E3SMv1 and v2 as the default option. The new dust emission scheme includes a time-varying soil erodibility factor for dust mobilization, and includes dust sources in high latitudes (e.g., &gt;60 degree N). A manuscript by Feng et al. is in prep to document the performance of the new emission scheme on dust life cycle and radiative effects in E3SMv3. Dust aerosol is represented in the accumulation and coarse aerosol modes of the MAM4 module following emission. Other dust properties such as optical properties and size distribution at emission are documented in Feng et al. (2022).<sup>3</sup></p>"},{"location":"EAM/tech-guide/dust/#namelist-parameters","title":"Namelist parameters","text":"<p>Dust Namelist Parameters</p> <ol> <li> <p>J. F. Kok, N. M. Mahowald, G. Fratini, J. A. Gillies, M. Ishizuka, J. F. Leys, M. Mikami, M.-S. Park, S.-U. Park, R. S. Van Pelt, and T. M. Zobeck. An improved dust emission model \u2013 Part 1: Model description and comparison against measurements. Atmospheric Chemistry and Physics, 14(23):13023\u201313041, December 2014. URL: https://acp.copernicus.org/articles/14/13023/2014/ (visited on 2024-03-29), doi:10.5194/acp-14-13023-2014.\u00a0\u21a9</p> </li> <li> <p>Charles S. Zender, Huisheng Bian, and David Newman. Mineral Dust Entrainment and Deposition (DEAD) model: Description and 1990s dust climatology. Journal of Geophysical Research: Atmospheres, 108(D14):2002JD002775, July 2003. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2002JD002775 (visited on 2024-03-29), doi:10.1029/2002JD002775.\u00a0\u21a9</p> </li> <li> <p>Y. Feng, H. Wang, P. J. Rasch, K. Zhang, W. Lin, Q. Tang, S. Xie, D. S. Hamilton, N. Mahowald, and H. Yu. Global Dust Cycle and Direct Radiative Effect in E3SM Version 1: Impact of Increasing Model Resolution. Journal of Advances in Modeling Earth Systems, 14(7):e2021MS002909, July 2022. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2021MS002909 (visited on 2024-03-29), doi:10.1029/2021MS002909.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/homme/","title":"High-Order Methods Modeling Environment","text":""},{"location":"EAM/tech-guide/homme/#overview","title":"Overview","text":"<p>EAM uses the a dynamical core (dycore) from the High Order Method Modeling Environment (HOMME).<sup>1</sup><sup>2</sup><sup>3</sup> The EAM dycore solves the atmospheric primitive equations governing the evolution of velocity, density, pressure and temperature, as well as the transport of water species and related hydrometers, aerosols and other atmospheric constituents.  The governing equations are written in a vertically lagrangian terrain following mass coordinate.  They are discretized with second order finite differences in the radial direction and spectral finite elements in the horizontal (surface of the sphere) directions, and advanced in time with a 3rd order accurate 5 stage Runge-Kutta method.  Dissipation is added through the use of monotoncity contraints on some advectiion terms, explicitly added hyperviscosity, and a Laplacian-based sponge layer in the first few layers at the model top.  The transported species  makes use of an efficient interpolatory semi-Lagrangian method.  EAMv3 uses 80 layers in the vertical.  The use of the spectral finite element method allows EAMv3 to run on fully unstructured grids, including the cubed-sphere grid (SE Atmosphere Grid Overview (EAM &amp; CAM)) which provides quasi-uniform resolution over the globe, and regionally refined meshes (RRM) which enhance horizontal resolution in regions of interest (Library of Regionally-Refined Model (RRM) Grids).</p>"},{"location":"EAM/tech-guide/homme/#namelist-parameters","title":"Namelist parameters","text":"<p>Many dynamical core parameters can not be changed independently.  For example, increasing the hyperviscosity coefficient may require reducing the hyperviscosity timestep.   Dycore timesteps are tuned for each resolution and the defaults are close to the CFL stability limit. For complete details, as well as their interactions, see EAM's HOMME dycore.</p> <p>HOMME Namelist Parameters</p> <ol> <li> <p>Mark A. Taylor and Aim\u00e9 Fournier. A compatible and conservative spectral element method on unstructured grids. Journal of Computational Physics, 229(17):5879\u20135895, August 2010. URL: https://linkinghub.elsevier.com/retrieve/pii/S0021999110001841 (visited on 2024-03-29), doi:10.1016/j.jcp.2010.04.008.\u00a0\u21a9</p> </li> <li> <p>O. Guba, M. A. Taylor, P. A. Ullrich, J. R. Overfelt, and M. N. Levy. The spectral element method on variable resolution grids: evaluating grid sensitivity and resolution-aware numerical viscosity. preprint, Numerical Methods, June 2014. URL: https://gmd.copernicus.org/preprints/7/4081/2014/gmdd-7-4081-2014.pdf (visited on 2024-03-29), doi:10.5194/gmdd-7-4081-2014.\u00a0\u21a9</p> </li> <li> <p>Mark A. Taylor, Oksana Guba, Andrew Steyer, Paul A. Ullrich, David M. Hall, and Christopher Eldred. An Energy Consistent Discretization of the Nonhydrostatic Equations in Primitive Variables. Journal of Advances in Modeling Earth Systems, 12(1):e2019MS001783, January 2020. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2019MS001783 (visited on 2024-03-29), doi:10.1029/2019MS001783.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/mam/","title":"Modal Aerosol Module","text":""},{"location":"EAM/tech-guide/mam/#mam5-overview","title":"MAM5 Overview","text":"<p>The Five-mode Modal Aerosol Model (MAM5) supersedes the MAM4 utilized in previous iterations of E3SM (E3SM-V1 and -V2). MAM5 introduces a fifth mode, specifically designed to represent stratospheric coarse mode aerosols, primarily originating from volcanic eruptions and DMS decomposition. This mode exclusively comprises sulfate aerosols, characterized by a smaller standard deviation (STD) value of 1.2. The STD value denotes the width of the aerosol mode, where a higher STD implies a greater gravitational settling effect (Wang et al., 2020;<sup>1</sup> Liu et al., 2012<sup>2</sup>). By setting the STD to 1.2, the simulated properties of volcanic aerosols align closely with observational findings (Mills et al., 2016).<sup>3</sup> MAM5 represents a pioneering aerosol model, effectively segregating tropospheric and stratospheric aerosols (Ke et al., in preparation), thereby mitigating the risk of overestimating dust and sea salt aerosols within the stratosphere in previous MAM4 (Visioni et al., 2021).<sup>4</sup> Volcanic eruptions derived from Neely and Schmidt (2016).<sup>5</sup></p>"},{"location":"EAM/tech-guide/mam/#mam4-overview","title":"MAM4 Overview","text":"<p>The representation of atmospheric aerosols and their roles in the Earth system by EAMv1/v2/v3 was inherited from the global atmosphere model EAMv0 and its four-mode modal aerosol module (MAM4), including Aitken, primary-carbon, accumulation, and coarse modes (Liu et al., 2016).<sup>6</sup> It treats a combination of processes, controlling the evolution of aerosols that are either directly emitted or converted from precursor gases from a variety of natural and anthropogenic sources. The processes include transport (by grid-scale wind, subgrid turbulence, convection, and sedimentation), aerosol microphysics (i.e., particle nucleation, condensation/evaporation of trace gases, aging, and coagulation), cloud processing (i.e., aqueous chemistry, scavenging by hydrometeors, resuspension from evaporating hydrometeors, and wet deposition), and dry deposition. Aerosol species in the original MAM4 (Liu et al., 2016)<sup>6</sup> include sulfate, primary organic aerosol (POA) or particulate organic matter (POM), secondary organic aerosol (SOA), black carbon (BC), sea salt, and mineral dust. As described by Wang et al. (2020),<sup>1</sup> the enhanced MAM4 in EAMv1/v2 added marine organic aerosol (MOA) to all four modes (Burrows et al., 2022).<sup>7</sup> In MAM4 of EAMv3, the Aitken mode has sulfate, sea salt, SOA and MOA; the primary-carbon mode has BC, POA and MOA; the accumulation and coarse modes include all seven species. Ammonium (NH4) and nitrate (NO3) aerosols are also explicitly treated in EAMv3 (Wu et al., 2022),<sup>8</sup> as an optional feature for research, in which new species (NH4, NO3, Ca, CO3, Na, Cl) are introduced to the Aitken, accumulation and coarse modes. All aerosol species within each of the four individual modes the MAM4 is assumed to be internally mixed and represented by a single number concentration, while particles are externally mixed among the different modes.</p>"},{"location":"EAM/tech-guide/mam/#sea-salt","title":"Sea salt","text":"<p>In MAM4, sea salt aerosol is represented in the Aitken, accumulation, and coarse mode with particle emission size (diameter) ranges of 0.02-0.08, 0.08-1.0, and 1.0-10.0 \u03bcm, respectively. The emission flux of natural sea salt is first divided into 31 size bins, following the parameterization of M\u00e5rtensson et al. (2003)<sup>9</sup> and Monahan et al. (1986),<sup>10</sup> and then redistributed to the three MAM4 size modes.</p>"},{"location":"EAM/tech-guide/mam/#namelist-parameters","title":"Namelist parameters","text":"<p>MAM Namelist Parameters</p> <ol> <li> <p>Hailong Wang, Richard C. Easter, Rudong Zhang, Po\u2010Lun Ma, Balwinder Singh, Kai Zhang, Dilip Ganguly, Philip J. Rasch, Susannah M. Burrows, Steven J. Ghan, Sijia Lou, Yun Qian, Yang Yang, Yan Feng, Mark Flanner, L. Ruby Leung, Xiaohong Liu, Manish Shrivastava, Jian Sun, Qi Tang, Shaocheng Xie, and Jin\u2010Ho Yoon. Aerosols in the E3SM Version 1: New Developments and Their Impacts on Radiative Forcing. Journal of Advances in Modeling Earth Systems, 12(1):e2019MS001851, January 2020. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2019MS001851 (visited on 2024-03-29), doi:10.1029/2019MS001851.\u00a0\u21a9\u21a9</p> </li> <li> <p>X. Liu, R. C. Easter, S. J. Ghan, R. Zaveri, P. Rasch, X. Shi, J.-F. Lamarque, A. Gettelman, H. Morrison, F. Vitt, A. Conley, S. Park, R. Neale, C. Hannay, A. M. L. Ekman, P. Hess, N. Mahowald, W. Collins, M. J. Iacono, C. S. Bretherton, M. G. Flanner, and D. Mitchell. Toward a minimal representation of aerosols in climate models: description and evaluation in the Community Atmosphere Model CAM5. Geoscientific Model Development, 5(3):709\u2013739, May 2012. URL: https://gmd.copernicus.org/articles/5/709/2012/ (visited on 2024-03-29), doi:10.5194/gmd-5-709-2012.\u00a0\u21a9</p> </li> <li> <p>Michael J. Mills, Anja Schmidt, Richard Easter, Susan Solomon, Douglas E. Kinnison, Steven J. Ghan, Ryan R. Neely, Daniel R. Marsh, Andrew Conley, Charles G. Bardeen, and Andrew Gettelman. Global volcanic aerosol properties derived from emissions, 1990\u20132014, using CESM1(WACCM). Journal of Geophysical Research: Atmospheres, 121(5):2332\u20132348, March 2016. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1002/2015JD024290 (visited on 2024-04-25), doi:10.1002/2015JD024290.\u00a0\u21a9</p> </li> <li> <p>Daniele Visioni, Simone Tilmes, Charles Bardeen, Michael Mills, Douglas G. MacMartin, Ben Kravitz, and Jadwiga H. Richter. Limitations of assuming internal mixing between different aerosol species: a case study with sulfate geoengineering simulations. Atmospheric Chemistry and Physics, 22(3):1739\u20131756, February 2022. URL: https://acp.copernicus.org/articles/22/1739/2022/ (visited on 2024-04-25), doi:10.5194/acp-22-1739-2022.\u00a0\u21a9</p> </li> <li> <p>R. R. Neely III and A. Schmidt. VolcanEESM: Global volcanic sulphur dioxide (SO2) emissions database from 1850 to present - Version 1.0. 2016. URL: https://catalogue.ceda.ac.uk/uuid/a8a7e52b299a46c9b09d8e56b283d385 (visited on 2024-04-25), doi:10.5285/76EBDC0B-0EED-4F70-B89E-55E606BCD568.\u00a0\u21a9</p> </li> <li> <p>X. Liu, P.-L. Ma, H. Wang, S. Tilmes, B. Singh, R. C. Easter, S. J. Ghan, and P. J. Rasch. Description and evaluation of a new four-mode version of the Modal Aerosol Module (MAM4) within version 5.3 of the Community Atmosphere Model. Geoscientific Model Development, 9(2):505\u2013522, February 2016. URL: https://gmd.copernicus.org/articles/9/505/2016/ (visited on 2024-03-29), doi:10.5194/gmd-9-505-2016.\u00a0\u21a9\u21a9</p> </li> <li> <p>Susannah M. Burrows, Richard C. Easter, Xiaohong Liu, Po-Lun Ma, Hailong Wang, Scott M. Elliott, Balwinder Singh, Kai Zhang, and Philip J. Rasch. OCEANFILMS (Organic Compounds from Ecosystems to Aerosols: Natural Films and Interfaces via Langmuir Molecular Surfactants) sea spray organic aerosol emissions \u2013 implementation in a global climate model and impacts on clouds. Atmospheric Chemistry and Physics, 22(8):5223\u20135251, April 2022. URL: https://acp.copernicus.org/articles/22/5223/2022/ (visited on 2024-03-29), doi:10.5194/acp-22-5223-2022.\u00a0\u21a9</p> </li> <li> <p>Mingxuan Wu, Hailong Wang, Richard C. Easter, Zheng Lu, Xiaohong Liu, Balwinder Singh, Po\u2010Lun Ma, Qi Tang, Rahul A. Zaveri, Ziming Ke, Rudong Zhang, Louisa K. Emmons, Simone Tilmes, Jack E. Dibb, Xue Zheng, Shaocheng Xie, and L. Ruby Leung. Development and Evaluation of E3SM\u2010MOSAIC: Spatial Distributions and Radiative Effects of Nitrate Aerosol. Journal of Advances in Modeling Earth Systems, 14(11):e2022MS003157, November 2022. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2022MS003157 (visited on 2024-03-29), doi:10.1029/2022MS003157.\u00a0\u21a9</p> </li> <li> <p>E. M. M\u00e5rtensson, E. D. Nilsson, G. De Leeuw, L. H. Cohen, and H.\u2010C. Hansson. Laboratory simulations and parameterization of the primary marine aerosol production. Journal of Geophysical Research: Atmospheres, 108(D9):2002JD002263, May 2003. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2002JD002263 (visited on 2024-03-29), doi:10.1029/2002JD002263.\u00a0\u21a9</p> </li> <li> <p>E. C. Monahan, D. E. Spiel, and K. L. Davidson. A Model of Marine Aerosol Generation Via Whitecaps and Wave Disruption. In Edward C. Monahan and Gear\u00f3id Mac Niocaill, editors, Oceanic Whitecaps: And Their Role in Air-Sea Exchange Processes, pages 167\u2013174. Springer Netherlands, Dordrecht, 1986. URL: https://doi.org/10.1007/978-94-009-4668-2_16 (visited on 2024-03-29), doi:10.1007/978-94-009-4668-2_16.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/oceanfilms/","title":"OCEANFILMS","text":""},{"location":"EAM/tech-guide/oceanfilms/#overview","title":"Overview","text":"<p>E3SM (v1-v3) uses the OCEANFILMS (Organic Compounds from Ecosystems to Aerosols: Natural Films and Interfaces via Langmuir Molecular Surfactants) parameterization to represent sea spray organic aerosol emissions.  OCEANFILMS is a physically based model that links sea spray chemistry with ocean biogeochemistry using a Langmuir partitioning approach.  The underlying physical assumptions and parameterization are described in Burrows et al. (2014);<sup>1</sup> the implementation in E3SM and impact on clouds and climate are documented in Burrows et al. (2022).<sup>2</sup></p>"},{"location":"EAM/tech-guide/oceanfilms/#namelist-parameters","title":"Namelist parameters","text":"<p>OCEANFILMS Namelist Parameters</p> <ol> <li> <p>S. M. Burrows, O. Ogunro, A. A. Frossard, L. M. Russell, P. J. Rasch, and S. M. Elliott. A physically based framework for modeling the organic fractionation of sea spray aerosol from bubble film Langmuir equilibria. Atmospheric Chemistry and Physics, 14(24):13601\u201313629, December 2014. URL: https://acp.copernicus.org/articles/14/13601/2014/ (visited on 2024-03-29), doi:10.5194/acp-14-13601-2014.\u00a0\u21a9</p> </li> <li> <p>Susannah M. Burrows, Richard C. Easter, Xiaohong Liu, Po-Lun Ma, Hailong Wang, Scott M. Elliott, Balwinder Singh, Kai Zhang, and Philip J. Rasch. OCEANFILMS (Organic Compounds from Ecosystems to Aerosols: Natural Films and Interfaces via Langmuir Molecular Surfactants) sea spray organic aerosol emissions \u2013 implementation in a global climate model and impacts on clouds. Atmospheric Chemistry and Physics, 22(8):5223\u20135251, April 2022. URL: https://acp.copernicus.org/articles/22/5223/2022/ (visited on 2024-03-29), doi:10.5194/acp-22-5223-2022.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/orodrag/","title":"Orographic drag scheme","text":""},{"location":"EAM/tech-guide/orodrag/#overview","title":"Overview","text":"<p>The orographic drag schemes includes two main options: the default Gravity Wave Drag scheme of McFarlane (1987)<sup>1</sup> and a new suite of orographic drag parameterization schemes. The new suite includes 4 components all combined in one module (i.e. subroutine gwdo2d). The schemes include orographic gravity wave drag (oGWD, Xie et al.,2020)<sup>2</sup>, flow-blocking drag (FBD, Xie et al.,2020)<sup>2</sup>, small-scale GWD (sGWD, Tsiringakis et al.,2017)<sup>3</sup>, and turbulent-scale orographic form drag (TOFD, Beljaars et al., 2004)<sup>4</sup>. The oGWD and TOFD schemes are used to replace the default oGWD (McFarlane, 1987)<sup>1</sup> and Turbulent Mountain Stress (TMS, documented on Richter et al., 2010)<sup>5</sup> module in EAM, while the FBD and sGWD are added enhanced drag schemes. Each of the schemes are used to predict and add enhanced drags from surface to high level that would help decelerate the wind especially over the mountainous regions among the globe. The oGWD, FBD, and sGWD are implemented in gw_drag.F90, while TOFD is implemented in clubb_intr.F90 to join the vertical diffusion process. There are also new topographic parameters (orographic asymmetry [OA], orographic convexity [OC], effective orographic length [OL]) are input into the model for the new oGWD and FBD scheme implmented. The concept of each scheme is illustrate in the figure below. Currently, only the scheme of McFarlane (1987) is turned on as default in E3SMv3.0.</p> <p></p>"},{"location":"EAM/tech-guide/orodrag/#default-ogwd-scheme","title":"Default oGWD scheme","text":"<p>The current default oGWD scheme in E3SMv3.0 is from McFarlane (1987)<sup>1</sup>. It is a linear orographic gravity wave drag scheme that parameterizes the subgrid process of vertical propagation of gravity wave originating from orographic source. The output from this scheme is a vertical profile of drag (or deceleration terms) when gravity wave breaks at higher levels and deposits momemtum flux to that level. This scheme is shown to improve the excessive westerly wind bias in the extratropics and the wind bias in the polar region. This scheme is turned on by default in E3SMv3.0.</p>"},{"location":"EAM/tech-guide/orodrag/#default-tms-scheme","title":"Default TMS scheme","text":"<p>The turbulent mountain stress (TMS) scheme is documented on Richter et al.,(2010)<sup>5</sup>. It parameterizes the turbulent scale form drag (TOFD) through adding enhanced effective roughness length to the model. This method is justified by the observation that area-averaged wind sufficiently far above hilly terrain behave logarithmically. It leads to significant decrease of overspeed surface wind in the model. It is turned OFF in E3SMv3.0.</p>"},{"location":"EAM/tech-guide/orodrag/#new-ogwd-scheme","title":"New oGWD scheme","text":"<p>The Xie et al.(2020)<sup>2</sup> oGWD scheme is a nonlinear orographic gravity wave drag scheme that parameterizes the subgrid oGWD (&gt;5km). It includes both the linear oGWD like that of McFarlane (1987)<sup>1</sup> and nonlinear oGWD like low-level wave breaking (LLWB). The LLWB downstream often results in downslope windstorm that can enhance the drag by several times that of linear oGWD. The incorporation of the nonlinear drag is by adding an \"enhancement factor\" that is a function of the higher moments of the orography, e.g. orographic asymmetry (OA), orographic convexity (OC), effective orographic length (OL).</p>"},{"location":"EAM/tech-guide/orodrag/#fbd-scheme","title":"FBD scheme","text":"<p>The Xie et al.(2020)<sup>2</sup> FBD scheme parameterizes the drag by flow blocked on the mountain flanks or flowing around the mountain under upstream stable conditions (&gt;5km). It occurs when the mean flow does not have enough kinetic energy to traverse an obstacle and either stops upstream or diverges around the obstacle. This provides drag near the surface where the blocking occurs in addition to the oGWD.</p>"},{"location":"EAM/tech-guide/orodrag/#tofd-scheme","title":"TOFD scheme","text":"<p>The TOFD scheme (Beljaars et al.,2004)<sup>4</sup> parameterizes the drag generated by the shear stresses in the boundary layer when the flow encounters smaller obstacles (&lt;5km). As airflow encounters an obstacle, it is disrupted, leading to the formation of eddies and vortices. These turbulent structures enhance mixing, allowing different layers of air to interact over a short distance. The intensity of the mixing is typically higher close to the obstacle, with rapid changes in velocity and direction of the airflow and can exhibit large control over the surface wind. It is an alternative scheme to the current TMS in E3SMv3. An important difference between the TOFD and TMS is that TOFD explicitly calculate the stress profile while TMS uses an enhanced effective roughtness length approach.</p>"},{"location":"EAM/tech-guide/orodrag/#sgwd-scheme","title":"sGWD scheme","text":"<p>The Tsiringakis et al.(2017)<sup>3</sup> sGWD scheme parameterizes the small-scale orographic gravity wave drag (sGWD) within the relatively shallow stable boundary layer. Models applying the form drag such as TOFD schemes usually lack sufficient cyclonic filling and do not accurately represent the development of cyclones over land (Holstag 2006)<sup>6</sup>. This caused significant temperature bias that occurs due to runaway cooling at the surface. To bridge the gap of this missing drag in the boundary layer, studies have hypothesized that the missing drag can be generated by sGWD. sGWD occurs under the relative stable boundary layer with low winds where the turbulence is significantly reduced.</p>"},{"location":"EAM/tech-guide/orodrag/#namelist-parameters","title":"Namelist parameters","text":"<p>orodrag Namelist Parameters</p> <ol> <li> <p>N.A. McFarlane. The effect of orographically excited gravity wave drag on the general circulation of the lower stratosphere and troposphere. Journal of the Atmospheric Sciences, 1987. URL: https://journals.ametsoc.org/view/journals/atsc/44/14/1520-0469_1987_044_1775_teooeg_2_0_co_2.xml (visited on 2024-11-19), doi:10.1175/1520-0469(1987)044&lt;1775:TEOOEG&gt;2.0.CO;2.\u00a0\u21a9\u21a9\u21a9\u21a9</p> </li> <li> <p>Xie J., Zhang M., Xie Z., Liu H., Chai Z., He J., and H. Zhang. An orographic-drag parametrization scheme including orographic anisotropy for all flow directions. Journal of Advances in Modeling Earth Systems, 2020. URL: https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2019MS001921/ (visited on 2024-11-19), doi:10.1029/2019MS001921.\u00a0\u21a9\u21a9\u21a9\u21a9</p> </li> <li> <p>A.A.M. Holtslag A. Tsiringakis, G.J. Steeneveld. Small-scale orographic gravity wave drag in stable boundary layers and its impact on synoptic systems and near-surface meteorology. Quarterly Journal of the Royal Meterological Society, 2017. URL: https://rmets.onlinelibrary.wiley.com/doi/abs/10.1002/qj.3021 (visited on 2024-11-19), doi:10.1002/qj.3021.\u00a0\u21a9\u21a9</p> </li> <li> <p>N. Wood A. Beljaars, A. Brown. A new parametrization of turbulent orographic form drag. Quarterly Journal of the Royal Meterological Society, 2004. URL: https://rmets.onlinelibrary.wiley.com/doi/abs/10.1256/qj.03.73/ (visited on 2024-11-19), doi:10.1256/qj.03.73.\u00a0\u21a9\u21a9</p> </li> <li> <p>R.R. Garcia J.H. Richter, F. Sassi. The effect of orographically excited gravity wave drag on the general circulation of the lower stratosphere and troposphere. Journal of the Atmospheric Sciences, 2010. URL: https://journals.ametsoc.org/view/journals/atsc/67/1/2009jas3112.1.xml?tab_body=pdf (visited on 2024-11-19), doi:10.1175/2009JAS3112.1.\u00a0\u21a9\u21a9</p> </li> <li> <p>A.A Holtslag. Preface:gewexatmospheric boundary-layer study (gabls) on stable boundary layers. Boundary-Layer Meterology, 2006. URL: https://link.springer.com/article/10.1007/s10546-005-9008-6 (visited on 2024-11-19), doi:10.1007/s10546-005-9008-6.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/p3/","title":"Predicted Particle Properties","text":""},{"location":"EAM/tech-guide/p3/#overview","title":"Overview","text":"<p>The stratiform cloud microphysics scheme in v3 is Predicted Particle Properties (P3; Morrison &amp; Milbrandt, 2015;<sup>1</sup> Milbrandt &amp; Morrison, 2016<sup>2</sup>). P3 offers a new approach to representing the evolution of ice particles that is more physical than the traditional approach of using predefined ice categories. It has been implemented in E3SM (Wang et al., 2021)<sup>3</sup> to address the limitations in the original microphysics scheme- the lack of riming particles and the artificial conversion between ice crystals and snow particles. The current version in E3SM is a two-moment scheme with a single ice category (Morrison &amp; Milbrandt, 2015).<sup>1</sup> In addition to the total ice number and mass mixing ratios, P3 prognoses the rimed mass and rimed volume mixing ratios, which allows for the prediction of the continuous evolution of the rime fraction and particle density. It is worth noting that the ice nucleation parameterizations are changed to be aerosol-dependent in this study, with the heterogenous ice nucleation parameterizations from the Classical Nucleation Theory (Liu et al., 2012)<sup>4</sup> and the homogenous in-situ cirrus formation based on Liu and Penner (2005).<sup>5</sup> This differs from the P3 used in WRF and that used in the E3SM v1 in Wang et al. (2021)<sup>3</sup> where the heterogeneous ice nucleation parameterizations are temperature dependent only.</p>"},{"location":"EAM/tech-guide/p3/#namelist-parameters","title":"Namelist parameters","text":"<p>P3 Namelist Parameters</p> <ol> <li> <p>Hugh Morrison and Jason A. Milbrandt. Parameterization of Cloud Microphysics Based on the Prediction of Bulk Ice Particle Properties. Part I: Scheme Description and Idealized Tests. Journal of the Atmospheric Sciences, 72(1):287\u2013311, January 2015. URL: https://journals.ametsoc.org/view/journals/atsc/72/1/jas-d-14-0065.1.xml (visited on 2024-03-29), doi:10.1175/JAS-D-14-0065.1.\u00a0\u21a9\u21a9</p> </li> <li> <p>J. A. Milbrandt and H. Morrison. Parameterization of Cloud Microphysics Based on the Prediction of Bulk Ice Particle Properties. Part III: Introduction of Multiple Free Categories. Journal of the Atmospheric Sciences, 73(3):975\u2013995, March 2016. URL: https://journals.ametsoc.org/view/journals/atsc/73/3/jas-d-15-0204.1.xml (visited on 2024-03-29), doi:10.1175/JAS-D-15-0204.1.\u00a0\u21a9</p> </li> <li> <p>Jingyu Wang, Jiwen Fan, Zhe Feng, Kai Zhang, Erika Roesler, Benjamin Hillman, Jacob Shpund, Wuyin Lin, and Shaocheng Xie. Impact of a New Cloud Microphysics Parameterization on the Simulations of Mesoscale Convective Systems in E3SM. Journal of Advances in Modeling Earth Systems, 13(11):e2021MS002628, November 2021. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2021MS002628 (visited on 2024-03-29), doi:10.1029/2021MS002628.\u00a0\u21a9\u21a9</p> </li> <li> <p>X. Liu, R. C. Easter, S. J. Ghan, R. Zaveri, P. Rasch, X. Shi, J.-F. Lamarque, A. Gettelman, H. Morrison, F. Vitt, A. Conley, S. Park, R. Neale, C. Hannay, A. M. L. Ekman, P. Hess, N. Mahowald, W. Collins, M. J. Iacono, C. S. Bretherton, M. G. Flanner, and D. Mitchell. Toward a minimal representation of aerosols in climate models: description and evaluation in the Community Atmosphere Model CAM5. Geoscientific Model Development, 5(3):709\u2013739, May 2012. URL: https://gmd.copernicus.org/articles/5/709/2012/ (visited on 2024-03-29), doi:10.5194/gmd-5-709-2012.\u00a0\u21a9</p> </li> <li> <p>Xiaohong Liu and Joyce E. Penner. Ice nucleation parameterization for global models. Meteorologische Zeitschrift, pages 499\u2013514, September 2005. URL: https://www.schweizerbart.de/papers/metz/detail/14/54281/Ice_nucleation_parameterization_for_global_models (visited on 2024-03-29), doi:10.1127/0941-2948/2005/0059.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/rrtmg/","title":"Rapid Radiative Transfer Model for GCMs","text":""},{"location":"EAM/tech-guide/rrtmg/#overview","title":"Overview","text":"<p>The calculation of radiative energy flux through the atmosphere is done using the RRTMG radiation package (Iacono et al., 2008;<sup>1</sup> Mlawer et al., 1997<sup>2</sup>). The details are consistent with the implementation in CAM5 described in Neale et al. (2012).<sup>3</sup> Radiative fluxes are broadly split into shortwave and longwave and computed by separate codes. The shortwave solver uses the 2-stream approximation, while the longwave is an absorption/emission code. Both shortwave and longwave use the correlated k-distribution method for integration of fluxes. Subgrid cloud overlap is accounted for using the Monte Carlo Independent Column Approximation (MCICA; Pincus and Morcrette, 2003),<sup>4</sup> assuming the cloudy portions of the column are maximally overlapped in vertically contiguous layers and randomly overlapped when two layers are separated by a completely clear layer. Cloud optics are parameterized as described in Neale et al.(2010).<sup>3</sup></p>"},{"location":"EAM/tech-guide/rrtmg/#namelist-parameters","title":"Namelist parameters","text":"<p>RRTMG Namelist Parameters</p> <ol> <li> <p>Michael J. Iacono, Jennifer S. Delamere, Eli J. Mlawer, Mark W. Shephard, Shepard A. Clough, and William D. Collins. Radiative forcing by long\u2010lived greenhouse gases: Calculations with the AER radiative transfer models. Journal of Geophysical Research: Atmospheres, 113(D13):2008JD009944, July 2008. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2008JD009944 (visited on 2024-03-29), doi:10.1029/2008JD009944.\u00a0\u21a9</p> </li> <li> <p>Eli J. Mlawer, Steven J. Taubman, Patrick D. Brown, Michael J. Iacono, and Shepard A. Clough. Radiative transfer for inhomogeneous atmospheres: RRTM, a validated correlated\u2010k model for the longwave. Journal of Geophysical Research: Atmospheres, 102(D14):16663\u201316682, July 1997. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/97JD00237 (visited on 2024-03-29), doi:10.1029/97JD00237.\u00a0\u21a9</p> </li> <li> <p>Richard B. Neale, Andrew Gettelman, Sungsu Park, Chih-Chieh Chen, Peter H. Lauritzen, David L. Williamson, Andrew J. Conley, Doug Kinnison, Dan Marsh, Anne K. Smith, Francis M. Vitt, Rolando Garcia, Jean-Francois Lamarque, Michael J. Mills, Simone Tilmes, Hugh Morrison, Philip Cameron-Smith, William D. Collins, Michael J. Iacono, Richard C. Easter, Xiaohong Liu, Steven J. Ghan, Philip J. Rasch, and Mark A. Taylor. Description of the NCAR Community Atmosphere Model (CAM 5.0). UNKNOWN, 2012. URL: https://opensky.ucar.edu/islandora/object/technotes%3A594/ (visited on 2024-04-25), doi:10.5065/wgtk-4g06.\u00a0\u21a9\u21a9</p> </li> <li> <p>Robert Pincus, Howard W. Barker, and Jean\u2010Jacques Morcrette. A fast, flexible, approximate technique for computing radiative transfer in inhomogeneous cloud fields. Journal of Geophysical Research: Atmospheres, 108(D13):2002JD003322, July 2003. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2002JD003322 (visited on 2024-03-29), doi:10.1029/2002JD003322.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/vbs/","title":"Volatility Basis Set (VBS) approach for SOA","text":""},{"location":"EAM/tech-guide/vbs/#overview","title":"Overview","text":"<p>A modified volatility basis set (VBS) approach is used for both SOA precursor gases and particulate SOA that includes gas\u2010phase functionalization/fragmentation and particle\u2010phase oligomerization similar to FragNVSOA configuration of Shrivastava et al. (2015).<sup>1</sup> It includes a detailed treatment of SOA precursor gas chemistry including multigenerational aging via fragmentation and functionalization reactions, particle\u2010phase oligomerization that generates low \u201ceffective volatility\u201d SOA, and particle\u2010phase loss by photolysis. The sources of SOA include natural biogenic, anthropogenic and biomass burning organic gases that are oxidized to form lower volatility species and undergo dynamic gas-particle partitioning to form SOA. Biogenic SOA is formed by oxidation of isoprene (ISOP_VBS) and monoterpene (C10H16) volatile organic compounds (VOCs). Emissions of anthropogenic and biomass burning organic gases in the range of intermediate volatility organics (IVOCs, referred to as SOAG0) are estimated as total primary organic matter (POM) emitted from these sources multiplied by specified tunable factors. IVOCs undergo multigenerational aging with OH radicals forming SOA corresponding to anthropogenic and biomass burning sources. Photolysis of SOA is included as a chemical sink in the particle phase, in addition to dry and wet removal sinks. The photolysis rate constant of particle-phase SOA is assumed to be 0.04% of typical NO2 photolysis frequencies following Hodzic et al. (2016).<sup>2</sup> The emissions of VBS SOA related gas species and oxidants (prescribed) read from a file are documented in the User Guide.</p> <ol> <li> <p>Manish Shrivastava, Richard C. Easter, Xiaohong Liu, Alla Zelenyuk, Balwinder Singh, Kai Zhang, Po\u2010Lun Ma, Duli Chand, Steven Ghan, Jose L. Jimenez, Qi Zhang, Jerome Fast, Philip J. Rasch, and Petri Tiitta. Global transformation and fate of SOA: Implications of low\u2010volatility SOA and gas\u2010phase fragmentation reactions. Journal of Geophysical Research: Atmospheres, 120(9):4169\u20134195, May 2015. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1002/2014JD022563 (visited on 2024-03-29), doi:10.1002/2014JD022563.\u00a0\u21a9</p> </li> <li> <p>Alma Hodzic, Prasad S. Kasibhatla, Duseong S. Jo, Christopher D. Cappa, Jose L. Jimenez, Sasha Madronich, and Rokjin J. Park. Rethinking the global secondary organic aerosol (SOA) budget: stronger production, faster removal, shorter lifetime. Atmospheric Chemistry and Physics, 16(12):7917\u20137941, June 2016. URL: https://acp.copernicus.org/articles/16/7917/2016/ (visited on 2024-03-29), doi:10.5194/acp-16-7917-2016.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/tech-guide/zm/","title":"Zhang and McFarlane deep convection scheme","text":""},{"location":"EAM/tech-guide/zm/#overview","title":"Overview","text":"<p>The ZM scheme (Zhang and McFarlane, 1995)<sup>1</sup> used in E3SMv3 is a bulk mass flux-type scheme; it has three components: a trigger for convection initiation, a cloud model including both updrafts and downdrafts, and a closure. The original CAPE-based trigger for convection was replaced by a trigger function based on dynamic CAPE generation by Xie et al. (2019)<sup>2</sup> (see dCAPE-ULL description below for more details). The closure predicts cloud base mass flux using dilute CAPE (Neale et al., 2008).<sup>3</sup> The updraft model is a bulk entraining plume model. Both updrafts and downdrafts are assumed saturated, with downdraft mass flux at the downdraft initiation level set proportional to the updraft cloud base mass flux. The microphysical processes inside the updrafts are represented by a convective microphysics scheme (see ZM convective microphysics description below). An additional adjustment is made to cloud base mass flux to incorporate the effect of large-scale circulation (see mass flux adjustment description below).</p>"},{"location":"EAM/tech-guide/zm/#dcape-ull","title":"dCAPE-ULL","text":"<p>A notable update related to clouds and precipitation in E3SMv2 is the use of a new convective trigger function described by Xie et al. (2019)<sup>2</sup> in ZM to improve the simulation of precipitation and its diurnal cycle. The new convective trigger named as dCAPE-ULL uses the dynamic CAPE (dCAPE) trigger developed by Xie and Zhang (2000)<sup>4</sup> with an unrestricted air parcel launch level (ULL) approach used by Wang et al. (2015).<sup>5</sup> It was designed to address the unrealistically strong coupling of convection to the surface heating in ZM that often results in unrealistically too active model convection during the day in summer season over lands and improve the model capability to capture mid-level convection for nocturnal precipitation.</p>"},{"location":"EAM/tech-guide/zm/#zm-convective-microphysics","title":"ZM convective microphysics","text":"<p>The convective microphysics scheme is based on the work of Song and Zhang (2011)<sup>6</sup> to improve the representation of microphysical processes in convective clouds and their interaction with aerosol and stratiform clouds in GCMs. It explicitly treats the mass mixing ratio and number concentration of five hydrometeor species (cloud water, cloud ice, rain, snow, and graupel). The scheme is linked to stratiform cloud microphysics parameterization through convective detrainment of cloud liquid/ice water content and droplet/crystal number concentration, and to aerosols through cloud droplet activation and ice nucleation processes. Previous evaluations of the scheme showed that it improved the simulation of convective cloud properties and cloud hydrological cycle (Song et al., 2012;<sup>7</sup> Storer et al., 2015<sup>8</sup>). The assessment demonstrates that the convective microphysics scheme not only significantly improves the simulation of tropical variability across multiple scales but also enhances the simulation of climatological mean states.</p>"},{"location":"EAM/tech-guide/zm/#mass-flux-adjustment","title":"Mass flux adjustment","text":"<p>The convective mass flux adjustment (MAdj) is designed to represent the dynamical effects of large-scale vertical motion on convection. With MAdj, convection is enhanced (suppressed) when there is large-scale ascending (descending) motion at the planetary boundary layer top. The coupling of convection with the large-scale circulation significantly improves the simulation of internal variability across multiple scales from diurnal cycle, convectively coupled equatorial waves, to Madden-Julian oscillations (Song et al., 2023).<sup>9</sup></p>"},{"location":"EAM/tech-guide/zm/#mcsp","title":"MCSP","text":"<p>Due to inadequate model resolution, organized mesoscale convection cannot be resolved in general circulation models and thus needs to be parameterized. The Multiscale Coherent Structure Parameterization (MCSP) aims at representing the dynamical and physical effects of organized mesoscale convection.</p> <p>MCSP applies a sinusoidal baroclinic profile in the temperature, moisture, and momentum fields to represent the impact. Moncrieff et al. (2017)<sup>10</sup> and Chen et al. (2021)<sup>11</sup> have found that by adding MCSP, the both the representation of large-scale precipitation systems and the modes of variability from Tropical waves are improved.</p>"},{"location":"EAM/tech-guide/zm/#namelist-parameters","title":"Namelist parameters","text":"<p>ZM Namelist Parameters</p> <ol> <li> <p>G.J. Zhang and Norman A. McFarlane. Sensitivity of climate simulations to the parameterization of cumulus convection in the Canadian climate centre general circulation model. Atmosphere-Ocean, 33(3):407\u2013446, September 1995. URL: http://www.tandfonline.com/doi/abs/10.1080/07055900.1995.9649539 (visited on 2024-03-29), doi:10.1080/07055900.1995.9649539.\u00a0\u21a9</p> </li> <li> <p>Shaocheng Xie, Yi\u2010Chi Wang, Wuyin Lin, Hsi\u2010Yen Ma, Qi Tang, Shuaiqi Tang, Xue Zheng, Jean\u2010Christophe Golaz, Guang J. Zhang, and Minghua Zhang. Improved Diurnal Cycle of Precipitation in E3SM With a Revised Convective Triggering Function. Journal of Advances in Modeling Earth Systems, 11(7):2290\u20132310, July 2019. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2019MS001702 (visited on 2024-03-29), doi:10.1029/2019MS001702.\u00a0\u21a9\u21a9</p> </li> <li> <p>Richard B. Neale, Jadwiga H. Richter, and Markus Jochum. The Impact of Convection on ENSO: From a Delayed Oscillator to a Series of Events. Journal of Climate, 21(22):5904\u20135924, November 2008. URL: https://journals.ametsoc.org/view/journals/clim/21/22/2008jcli2244.1.xml (visited on 2024-03-29), doi:10.1175/2008JCLI2244.1.\u00a0\u21a9</p> </li> <li> <p>Shaocheng Xie and Minghua Zhang. Impact of the convection triggering function on single\u2010column model simulations. Journal of Geophysical Research: Atmospheres, 105(D11):14983\u201314996, June 2000. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2000JD900170 (visited on 2024-03-29), doi:10.1029/2000JD900170.\u00a0\u21a9</p> </li> <li> <p>Yi-Chi Wang, Hua-Lu Pan, and Huang-Hsiung Hsu. Impacts of the triggering function of cumulus parameterization on warm-season diurnal rainfall cycles at the Atmospheric Radiation Measurement Southern Great Plains site: CONVECTIVE TRIGGER ON SGP NOCTURNAL RAIN. Journal of Geophysical Research: Atmospheres, 120(20):10,681\u201310,702, October 2015. URL: http://doi.wiley.com/10.1002/2015JD023337 (visited on 2024-03-29), doi:10.1002/2015JD023337.\u00a0\u21a9</p> </li> <li> <p>Xiaoliang Song and Guang J. Zhang. Microphysics parameterization for convective clouds in a global climate model: Description and single-column model tests. Journal of Geophysical Research, 116(D2):D02201, January 2011. URL: http://doi.wiley.com/10.1029/2010JD014833 (visited on 2024-03-29), doi:10.1029/2010JD014833.\u00a0\u21a9</p> </li> <li> <p>Xiaoliang Song, Guang J. Zhang, and J.-L. F. Li. Evaluation of Microphysics Parameterization for Convective Clouds in the NCAR Community Atmosphere Model CAM5. Journal of Climate, 25(24):8568\u20138590, December 2012. URL: http://journals.ametsoc.org/doi/10.1175/JCLI-D-11-00563.1 (visited on 2024-03-29), doi:10.1175/JCLI-D-11-00563.1.\u00a0\u21a9</p> </li> <li> <p>Rachel L. Storer, Guang J. Zhang, and Xiaoliang Song. Effects of Convective Microphysics Parameterization on Large-Scale Cloud Hydrological Cycle and Radiative Budget in Tropical and Midlatitude Convective Regions. Journal of Climate, 28(23):9277\u20139297, December 2015. URL: https://journals.ametsoc.org/view/journals/clim/28/23/jcli-d-15-0064.1.xml (visited on 2024-03-29), doi:10.1175/JCLI-D-15-0064.1.\u00a0\u21a9</p> </li> <li> <p>Xiaoliang Song, Guang Zhang, Hui Wan, and Shaocheng Xie. Incorporating the Effect of Large\u2010Scale Vertical Motion on Convection Through Convective Mass Flux Adjustment in E3SMv2. Journal of Advances in Modeling Earth Systems, 15(10):e2022MS003553, October 2023. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2022MS003553 (visited on 2024-03-29), doi:10.1029/2022MS003553.\u00a0\u21a9</p> </li> <li> <p>Mitchell W. Moncrieff, Changhai Liu, and Peter Bogenschutz. Simulation, Modeling, and Dynamically Based Parameterization of Organized Tropical Convection for Global Climate Models. Journal of the Atmospheric Sciences, 74(5):1363\u20131380, May 2017. URL: https://journals.ametsoc.org/view/journals/atsc/74/5/jas-d-16-0166.1.xml (visited on 2024-03-29), doi:10.1175/JAS-D-16-0166.1.\u00a0\u21a9</p> </li> <li> <p>C.\u2010C. Chen, J. H. Richter, C. Liu, M. W. Moncrieff, Q. Tang, W. Lin, S. Xie, and P. J. Rasch. Effects of Organized Convection Parameterization on the MJO and Precipitation in E3SMv1. Part I: Mesoscale Heating. Journal of Advances in Modeling Earth Systems, 13(6):e2020MS002401, June 2021. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2020MS002401 (visited on 2024-03-29), doi:10.1029/2020MS002401.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/user-guide/","title":"EAM User Guide","text":"<p>This User Guide describes how to set up and run EAM.</p>"},{"location":"EAM/user-guide/#steps-to-build-and-run-eam","title":"Steps to build and run EAM","text":"<p>EAM is not available as a standalone model.  Instead, EAM can be run in an atmosphere-only configuration. The difference when running in atmosphere-only mode (without an interactive ocean or sea-ice) would be to change the compset and grid. See the Case Control System Basic Usage for general descriptions of compsets and grids.</p> <p>Certain namelist paramaters, input data files, and output file specifcations can also be modified. These are described below as ways to customize runs.</p> <p>Step-by-step instructions on how to run and analyze E3SM with a script can be found at E3SM step-by-step guide</p>"},{"location":"EAM/user-guide/#scientifically-supported-compsets-and-grids","title":"Scientifically supported compsets and grids","text":""},{"location":"EAM/user-guide/#compsets","title":"Compsets","text":"<p>All of the compsets below run with the complete set of E3SM atmospheric configuration of EAMV3. For more information on the schemes in EAMv3, see the Technical Guide</p> <p><code>F2010</code> - Climatological present day climate (year 2010)</p> <p><code>F1850</code> - Climatological pre-industrial-day climate (year 1850)</p> <p><code>F20TR</code> - Historical EAM simulation with time varying sea-surface temperatures, aerosol emissions, and greenhouse gas forcings (year 1850-2014)</p>"},{"location":"EAM/user-guide/#grids","title":"Grids","text":"<p>Only one grid combination is currently supported for the above compsets:</p> <p><code>ne30pg2_r05_IcoswISC30E3r5</code> - ne30pg2 atmosphere, 0.5deg x 0.5deg land grid, and Icosahedral 30 km mesh with ice shelves cavities (wISC), E3SMv3 (E3) revision r5</p>"},{"location":"EAM/user-guide/#customizing-runs","title":"Customizing runs","text":""},{"location":"EAM/user-guide/#compile-time-options","title":"Compile-time options","text":"<p>Some customizations require making changes before the model is built.</p>"},{"location":"EAM/user-guide/#run-time-options","title":"Run-time options","text":"<p>Run-time customization is enabled by a Fortran namelist.</p> <p>Namelist parameters can be changed from default values by putting them in the <code>user_nl_eam</code> file in the case directory with the desired new value.</p> <p>This Table of Namelist Parameters includes many of the paramaters that control physics schemes described in the tech-guide</p>"},{"location":"EAM/user-guide/#history-file-namelist-parameters","title":"History File Namelist Parameters","text":"<p>By default, EAM will output a set of monthly-averaged variables. Additional output files can be specified using the following flags in the <code>user_nl_eam</code> file:</p> <p><code>finclX</code> - List of variables (in single quotes and separated by commas) that are added to tape X.</p> <p><code>fexclX</code> - List of variables (in single quotes and separated by commas) that will be excluded in tape X.</p> <p><code>nhtfrq</code> - List of write frequencies for each of the history files. A value of 0 denotes a monthly frequency. Negative values denote hourly frequencies (e.g., <code>-3</code> will write an output every 3 hours). Positive values denotes the frequency in model timesteps (e.g., <code>4</code> will write an output every 4 timesteps).</p> <p><code>mfilt</code> - List that sets the number of timesteps to write in a single file before starting a new file.</p> <p><code>avgflag_pertape</code> - List that sets the type of output to write. Choices are <code>'A'</code> for time-averaged output, <code>'A'</code> for instantaneous output, <code>'M'</code> for time-minimum output, and <code>'X'</code> for time-maximum output.</p>"},{"location":"EAM/user-guide/#example-output-specification","title":"Example output specification","text":"<pre><code>nhtfrq = 0,-24,-6,-3\nmfilt  = 1,30,120,24\navgflag_pertape = 'A','A','A','I'\n\nfexcl1 = 'U10' # Removes U10 output from monthly files\nfincl2 = 'PS','FLUT','PRECT','U200','V200','U850',\n          'V850','TCO','SCO','TREFHT','QREFHT'  # Output files of daily-averaged output, which includes 30 days of output in each file\nfincl3 = 'PS', 'PSL','PRECT','TUQ','TVQ','UBOT',\n          'VBOT','TREFHT','FLUT','OMEGA500','TBOT',\n          'U850','V850','U200','V200','T200','T500',\n          'Z700'  # Output files of 6-hour-averaged output, which includes 30 days of output in each file\nfincl4 = 'PRECT' # Output files of 3-hourly output with 3 days of output in every file\n</code></pre>"},{"location":"EAM/user-guide/#input-datasets","title":"Input datasets","text":"<p>Many properties of the simulated atmosphere are controlled by data sets read in by the model during initialization. Changing the content of these files is another way to customize a run.</p>"},{"location":"EAM/user-guide/#greenhouse-gases-non-reacting","title":"Greenhouse gases (non-reacting)","text":"<p>Greenhouse gas concentration inputs of non-reacting species are taken from CMIP6 Forcing Datasets provided from the input4MIPs data collection. In addition to what is provided by the input4MIPS, 2015 and 2016 have been added by extrapolating from 2013 and 2014.</p> <pre><code>inputdata/atm/cam/ggas/GHG_CMIP-1-2-0_Annual_Global_0000-2014_c20180105.nc\n</code></pre>"},{"location":"EAM/user-guide/#aerosol-physical-properties","title":"Aerosol physical properties","text":"<p>The aerosol properties files provide aerosol refractive index, density, and aerosol hygroscopicty information for each aerosol species, as well as information about lognormal mode definition and lookup tables of polynomial expression coefficients for aerosol optics calculation for each mode. These aerosol physical and chemical properties are used by the radiation, aerosol microphysics and other related source and sink processes, and droplet activation/ice nucleation schemes.</p>"},{"location":"EAM/user-guide/#aerosol-and-gas-emission-and-oxidant-files","title":"Aerosol and gas emission and oxidant files","text":"<p>Details of the aerosol and gas emission and oxidant files used in various historical, present-day, and future scenarios.</p>"},{"location":"EAM/user-guide/#linoz-v3-input-files","title":"Linoz v3 input files","text":"<p>Linozv3 uses the ozone tendency, (net production minus loss) calculated from its climatological mean state (function of month, latitude, altitude) and a first-order Taylor series expansion about the local ozone, temperature, and overhead ozone column. For historical simulation, Linozv3 uses the linozv3 data files with monthly resolution, spanning the dates 1849-01 -- 2014-12.</p>"},{"location":"EAM/user-guide/#historical-files","title":"Historical files","text":"<pre><code> linoz_data_file                = \u2018linv3_1849-2101_CMIP6_Hist_10deg_58km_c20231207.nc\u2019\n linoz_data_path                = '/lcrc/group/e3sm/data/inputdata/atm/cam/chem/trop_mozart/ub'\n linoz_data_type                = 'INTERP_MISSING_MONTHS'\n</code></pre> <p>Refer to this page for more details on Linoz v3 input files.</p>"},{"location":"EAM/user-guide/#topography","title":"Topography","text":"<p>The global elevation on the atmosphere grid is a key input dataset.  The dataset is grid dependent. It contains the geopotential data (on both the GLL dynamics and PG2 physics grids) and two surface roughness quantities, <code>SGH</code> and <code>SGH30</code>.</p> <p>EAMv3 NE30 data:</p> <pre><code>inputdata/atm/cam/topo/USGS-gtopo30_ne30np4pg2_x6t-SGH.c20210614.nc'\n</code></pre> <p>This file is computed via a complex procedure that starts with high resolution dataset (for EAMv3, we use the GTOPO30, a 30 arc-second resolution data set on a lat-lon grid) that is then downsampled to a 3km cubed-sphere grid (cube3000) and then downsampled to the atmosphere  grid on the (GLL nodes), and then smoothed with the same viscosity operator used by the dycore. The smoothed GLL topography is then mapped to the PG2 grid. Finally, two different surface roughness fields are computed:</p> <ul> <li><code>SGH30</code>: the variance between GTOPO30 and GTOPO30-downsampled-to-PG2 (independent of any dycore specific smoothing).     (used by CLUBB, TMS, vertical_diffusion)</li> <li><code>SGH</code>:  the variance between the cube3000 data and the smoothed PG2 data.  (used by GWD parameterizations)</li> </ul>"},{"location":"EAM/user-guide/#land-use-land-cover-change","title":"Land-use / land cover change","text":"<p>Info needed on land-use land cover change / land surface data</p> <p>Refer to ELM documentation.</p>"},{"location":"EAM/user-guide/#oceansea-ice","title":"Ocean/sea ice","text":"<p>The sea surface temperature and sea-ice coverage data used in F-case simulations are based on CMIP6 Forcing Datasets provided from the input4MIPs data collection. The file for the <code>F2010</code> compset is created from taking a monthly climatology of years 2005-2014. The file for the <code>F1850</code> compset is created from taking a monthly climatology of years 1870-1879.*</p> <p>*Provenenance for F1850 file</p> <p><code>F20TR</code></p> <pre><code>inputdata/ocn/docn7/SSTDATA/sst_ice_CMIP6_DECK_E3SM_1x1_c20180213.nc\n</code></pre> <p><code>F2010</code></p> <pre><code>inputdata/ocn/docn7/SSTDATA/sst_ice_CMIP6_DECK_E3SM_1x1_2010_clim_c20190821.nc \n</code></pre> <p><code>F1850</code></p> <pre><code>inputdata/ocn/docn7/SSTDATA/sst_ice_CMIP6_DECK_E3SM_1x1_1850_clim_c20190125.nc\n</code></pre>"},{"location":"EAM/user-guide/#solar-input","title":"Solar input","text":"<p>As with greenhouse gas emissions, solar input files are taken from the input4MIPs data collection that were prepared for CMIP6 Forcing Datasets.</p> <pre><code>inputdata/atm/cam/solar/Solar_1850-2299_input4MIPS_c20181106.nc\n</code></pre>"},{"location":"EAM/user-guide/aerosol_phys_prop/","title":"Aerosol physical properties","text":""},{"location":"EAM/user-guide/aerosol_phys_prop/#description","title":"Description","text":"<p>Key information</p> <ul> <li> <p>Original physical properties of aerosols are documented in Liu et al. (2012).<sup>1</sup> Detailed information is included in the supplement.</p> </li> <li> <p>Physical properties of aerosols used in E3SMv1 are documented in Wang et al. (2020).<sup>2</sup></p> </li> <li> <p>Marine organic aerosol properties are defined in Burrows et al. (2022).<sup>3</sup></p> </li> <li> <p>Dust refractive index and longwave absorption coefficients are updated by Feng et al. (2022).<sup>4</sup></p> </li> <li> <p>BC and POM hygroscopicity values are updated by Shan et al. (2024).</p> </li> <li> <p>Physical properties of the fifth mode aerosols are documented by Ke et al. (2024).</p> </li> </ul>"},{"location":"EAM/user-guide/aerosol_phys_prop/#included-fields","title":"Included fields","text":""},{"location":"EAM/user-guide/aerosol_phys_prop/#mode-properties","title":"Mode properties","text":"<ul> <li> <p>Geometric standard deviation of each lognormal mode</p> </li> <li> <p>Nominal geometric mean diameter and its lower/upper bound of values for each mode</p> </li> <li> <p>Coefficients of polynomial expression (lookup-table) for extinction, absorption, and asymmetry parameter calculations</p> </li> <li> <p>Aerosol refractive index table needed for interpolation (lookup-table) calculation (for different wavelengths)</p> </li> <li> <p>Crystalization and deliquesence relative humidity thresholds for aerosol wateruptake calculations</p> </li> </ul>"},{"location":"EAM/user-guide/aerosol_phys_prop/#species-properties","title":"Species properties","text":"<ul> <li> <p>Aerosol refractive index for each species</p> </li> <li> <p>Density for each species</p> </li> <li> <p>Aerosol hygroscopicity for each species</p> </li> <li> <p>Note that some of variables in the species property file are for bulk aerosols, so we ignore the description for them.</p> </li> </ul>"},{"location":"EAM/user-guide/aerosol_phys_prop/#files","title":"Files","text":"<p>Species properties</p> <pre><code>/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocpho_rrtmg_c130709_kPOM0.04.nc\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocphi_rrtmg_c100508.nc\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/bcpho_rrtmg_c100508.nc\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/dust_aeronet_rrtmg_c141106.nc\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/poly_rrtmg_c130816.nc\n</code></pre> <p>Mode properties</p> <pre><code>/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode1_rrtmg_aeronetdust_c141106.nc', \n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode2_rrtmg_c130628.nc',\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode3_rrtmg_aeronetdust_c141106.nc', \n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode4_rrtmg_c130628.nc',\n/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam5_mode5_rrtmg_sig1.2_dgnl.40_c03072023.nc'\n</code></pre>"},{"location":"EAM/user-guide/aerosol_phys_prop/#namelist","title":"Namelist","text":"<pre><code> mode_defs = 'mam5_mode1:accum:=', \n         'A:num_a1:N:num_c1:num_mr:+',\n         'A:so4_a1:N:so4_c1:sulfate:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+', \n         'A:pom_a1:N:pom_c1:p-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocpho_rrtmg_c130709_kPOM0.04.nc:+',\n         'A:soa_a1:N:soa_c1:s-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+', \n         'A:bc_a1:N:bc_c1:black-c:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/bcpho_rrtmg_c100508.nc:+',\n         'A:dst_a1:N:dst_c1:dust:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/dust_aeronet_rrtmg_c141106.nc:+', \n         'A:ncl_a1:N:ncl_c1:seasalt:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc:+',\n         'A:mom_a1:N:mom_c1:m-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/poly_rrtmg_c130816.nc', \n         'mam5_mode2:aitken:=',\n         'A:num_a2:N:num_c2:num_mr:+', \n         'A:so4_a2:N:so4_c2:sulfate:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+',\n         'A:soa_a2:N:soa_c2:s-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+', \n         'A:ncl_a2:N:ncl_c2:seasalt:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc:+',\n         'A:mom_a2:N:mom_c2:m-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/poly_rrtmg_c130816.nc', \n         'mam5_mode3:coarse:=',\n         'A:num_a3:N:num_c3:num_mr:+', \n         'A:dst_a3:N:dst_c3:dust:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/dust_aeronet_rrtmg_c141106.nc:+',\n         'A:ncl_a3:N:ncl_c3:seasalt:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ssam_rrtmg_c100508.nc:+', \n         'A:so4_a3:N:so4_c3:sulfate:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc:+',\n         'A:bc_a3:N:bc_c3:black-c:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/bcpho_rrtmg_c100508.nc:+', \n         'A:pom_a3:N:pom_c3:p-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocpho_rrtmg_c130709_kPOM0.04.nc:+',\n         'A:soa_a3:N:soa_c3:s-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocphi_rrtmg_c100508.nc:+', \n         'A:mom_a3:N:mom_c3:m-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/poly_rrtmg_c130816.nc',\n         'mam5_mode4:primary_carbon:=', \n         'A:num_a4:N:num_c4:num_mr:+',\n         'A:pom_a4:N:pom_c4:p-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/ocpho_rrtmg_c130709_kPOM0.04.nc:+', \n         'A:bc_a4:N:bc_c4:black-c:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/bcpho_rrtmg_c100508.nc:+',\n         'A:mom_a4:N:mom_c4:m-organic:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/poly_rrtmg_c130816.nc', \n         'mam5_mode5:strat_coarse:=',\n         'A:num_a5:N:num_c5:num_mr:+', \n         'A:so4_a5:N:so4_c5:sulfate:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/sulfate_rrtmg_c080918.nc'\n rad_climate = 'A:H2OLNZ:H2O', 'N:O2:O2','N:CO2:CO2', 'A:O3:O3',\n         'A:N2OLNZ:N2O', 'A:CH4LNZ:CH4','N:CFC11:CFC11', 'N:CFC12:CFC12',\n         'M:mam5_mode1:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode1_rrtmg_aeronetdust_c141106.nc', \n         'M:mam5_mode2:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode2_rrtmg_c130628.nc',\n         'M:mam5_mode3:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode3_rrtmg_aeronetdust_c141106.nc', \n         'M:mam5_mode4:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam4_mode4_rrtmg_c130628.nc',\n         'M:mam5_mode5:/lcrc/group/e3sm/data/inputdata/atm/cam/physprops/mam5_mode5_rrtmg_sig1.2_dgnl.40_c03072023.nc'\n</code></pre> <ol> <li> <p>X. Liu, R. C. Easter, S. J. Ghan, R. Zaveri, P. Rasch, X. Shi, J.-F. Lamarque, A. Gettelman, H. Morrison, F. Vitt, A. Conley, S. Park, R. Neale, C. Hannay, A. M. L. Ekman, P. Hess, N. Mahowald, W. Collins, M. J. Iacono, C. S. Bretherton, M. G. Flanner, and D. Mitchell. Toward a minimal representation of aerosols in climate models: description and evaluation in the Community Atmosphere Model CAM5. Geoscientific Model Development, 5(3):709\u2013739, May 2012. URL: https://gmd.copernicus.org/articles/5/709/2012/ (visited on 2024-03-29), doi:10.5194/gmd-5-709-2012.\u00a0\u21a9</p> </li> <li> <p>Hailong Wang, Richard C. Easter, Rudong Zhang, Po\u2010Lun Ma, Balwinder Singh, Kai Zhang, Dilip Ganguly, Philip J. Rasch, Susannah M. Burrows, Steven J. Ghan, Sijia Lou, Yun Qian, Yang Yang, Yan Feng, Mark Flanner, L. Ruby Leung, Xiaohong Liu, Manish Shrivastava, Jian Sun, Qi Tang, Shaocheng Xie, and Jin\u2010Ho Yoon. Aerosols in the E3SM Version 1: New Developments and Their Impacts on Radiative Forcing. Journal of Advances in Modeling Earth Systems, 12(1):e2019MS001851, January 2020. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2019MS001851 (visited on 2024-03-29), doi:10.1029/2019MS001851.\u00a0\u21a9</p> </li> <li> <p>Susannah M. Burrows, Richard C. Easter, Xiaohong Liu, Po-Lun Ma, Hailong Wang, Scott M. Elliott, Balwinder Singh, Kai Zhang, and Philip J. Rasch. OCEANFILMS (Organic Compounds from Ecosystems to Aerosols: Natural Films and Interfaces via Langmuir Molecular Surfactants) sea spray organic aerosol emissions \u2013 implementation in a global climate model and impacts on clouds. Atmospheric Chemistry and Physics, 22(8):5223\u20135251, April 2022. URL: https://acp.copernicus.org/articles/22/5223/2022/ (visited on 2024-03-29), doi:10.5194/acp-22-5223-2022.\u00a0\u21a9</p> </li> <li> <p>Y. Feng, H. Wang, P. J. Rasch, K. Zhang, W. Lin, Q. Tang, S. Xie, D. S. Hamilton, N. Mahowald, and H. Yu. Global Dust Cycle and Direct Radiative Effect in E3SM Version 1: Impact of Increasing Model Resolution. Journal of Advances in Modeling Earth Systems, 14(7):e2021MS002909, July 2022. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2021MS002909 (visited on 2024-03-29), doi:10.1029/2021MS002909.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/user-guide/emission_oxidant_files/","title":"Emission files for EAMv3 gas and aerosol species and oxidant file for VBS SOA and stratosphere sulfate formation","text":""},{"location":"EAM/user-guide/emission_oxidant_files/#overview","title":"Overview","text":"<p>This page documents emissions data for all required aerosols and precursor gases as well as oxidants input data for running EAMv3, mostly for the MAM4 aerosol scheme, from anthropogenic (i.e., industrial, energy, transportation, domestic, and agriculture activity sectors) and natural (i.e., sea spray, vegetation, fire smoke, volcano) sources. Sulfur from agriculture, domestic, transportation, waste, and shipping sectors is emitted at the surface while sulfur from energy and industry sectors is emitted at 100-300 m above the surface, and sulfur from forest fire and grass fire is emitted at higher elevations (0-6 km). POM and BC from forest fire and grass fire are emitted at 0-6 km, while those from other sources (domestic, energy, industry, transportation, waste, and shipping) are emitted at the surface. Injection height profiles for fire emissions are derived from the corresponding AeroCom profiles (Dentener et al., 2006)<sup>1</sup>, which give emissions in 6 altitude ranges (0-0.1, 0.1-0.5, 0.5-1, 1-2, 2-3, and 3-6 km). Otherwise, species emissions are assumed to be at the surface (bottom layer). Number emission fluxes each mode are calculated from mass emission fluxes based on AeroCom prescribed lognormal size distributions.</p>"},{"location":"EAM/user-guide/emission_oxidant_files/#aerosols-and-gas-precursors-common-for-eamv1v2v3","title":"Aerosols and gas precursors (common for EAMv1/v2/v3)","text":"<ul> <li>Species: SO2, SOAG0, DMS, bc_a4, pom_a4, so4_a1, so4_a2, num_a1, num_a2, num_a4</li> <li>Data sources</li> <li>Most of the original data are directly from input4MIPs with the following exceptions (E3SM specific treatments)</li> <li>SO2 takes 97.5% from the input4MIPs data (all SO2-em-anthro_input4MIPs sectors)</li> <li>SO4_a1 surf takes 2.5% from the corresponding surface sectors of input4MIPs data (SO2-em-anthro_input4MIPs sectors: AGR, SLV, WST, SHP)</li> <li>SO4_a2 surf takes 2.5% from the corresponding surface sectors of input4MIPs data (SO2-em-anthro_input4MIPs sectors: TRA, RCO)</li> <li>SO4_a1 elev takes 2.5% from the corresponding elevated sectors of input4MIPs data (SO2-em-anthro_input4MIPs sectors: ENE, IND)</li> <li>SO2 (97.5%) and SO4_a1 (2.5%) also take emissions from AR5 input file for sector contvolc (constant volcanic degassing)</li> <li>SOAG0 emissions are obtained by scaling OC (POM) emissions with a tunable factor.</li> <li>num_a1, num_a2 and num_a4 are determined by mass concentration of aerosols species in the corresponding sectors and modes.</li> </ul>"},{"location":"EAM/user-guide/emission_oxidant_files/#marine-organic-sea-spray","title":"Marine organic sea spray","text":"<p>Marine organic sea spray aerosol contributions are parameterized following the OCEANFILMS parameterization (E3SMv1; Burrows et al., 2014;<sup>2</sup> 2022<sup>3</sup>).  The input file for this parameterization provides a climatology of the ocean surface concentrations of several groups of organic macromolecules.  Briefly, the Parallel Ocean Program (POP; Maltrud et al., 1998)<sup>4</sup> and its biogeochemical elemental cycling (BEC) routines (Moore et al., 2004)<sup>5</sup> were used to simulate marine biogeochemistry fields, including particulate organic matter (POC), chlorophyll, and zooplankton concentrations; these fields were used to generate maps of the estimated surface distributions of classes of macromolecules following the methods described in Burrows et al. (2014).<sup>2</sup>  The scripts used to accomplish this translation are available here.</p> <p>The file used as an input to E3SM is available here: https://web.lcrc.anl.gov/public/e3sm/inputdata/atm/cam/chem/trop_mam/marine_BGC/monthly_macromolecules_0.1deg_bilinear_latlon_year01_merge_date.nc</p> <p>And is also published as a citeable dataset on Zenodo:</p> <p>Elliott, S. M., Maltrud, M., &amp; Burrows, S. M. (2015). Macromolecule distributions input file for the OCEANFILMS parameterization (Version v1) [Data set]. Zenodo.</p>"},{"location":"EAM/user-guide/emission_oxidant_files/#oceanic-dimethyl-sulfide-concentrations","title":"Oceanic dimethyl sulfide concentrations","text":"<p>Dimethyl sulfide (DMS) fluxes to the atmosphere are calculated in E3SM as a function of prescribed surface oceanic DMS concentrations, and an air-sea flux piston velocity that is a function of wind speed.</p> <p>E3SM uses a DMS surface concentration dataset developed from a dynamic ocean biogeochemistry simulation; the methods and underlying assumptions used to produce this dataset are documented in Wang, et al. (2015).  The resolution in the DMS dataset is 1.9x2.5 degrees.</p>"},{"location":"EAM/user-guide/emission_oxidant_files/#new-gas-species-for-chemuci-in-eamv3","title":"New gas species for chemUCI in EAMv3","text":"<ul> <li>Species: C2H4, C2H6, C3H8, CH2O, CH3CHO, CH3COCH3, CO, E90, ISOP, NO, NO2</li> <li>Data sources</li> <li>anthropogenic, biomass burning, and aircraft emissions (NO2) are regridded from NCAR CESM2 emission files. They  are time-dependent during historical period and in the future scenarios.</li> <li>biogenic emissions (C2H4, C2H6, C3H8, CH2O, CH3CHO, CH3COCH3, CO, ISOP) are from MEGAN-MACC offline data<ul> <li>1850-1979: monthly input cycled yearly from 30-year mean (1980-2009)</li> <li>1980-2014: time-varying MEGAN-MACC data (historical)</li> <li>2015-2100: monthly input cycled yearly from 30-year mean (1980-2009)</li> </ul> </li> <li>natural emissions from oceans (C2H4, C2H6, C3H8, CO) and soil (NO) are regridded from NCAR CESM2 emission files. Just cycled yearly during the historical period and in the future scenarios.</li> <li>E90 emissions?</li> </ul>"},{"location":"EAM/user-guide/emission_oxidant_files/#oxidants-file-needed-for-vbs-soa-and-stratosphere-sulfate-formation","title":"Oxidants file needed for VBS SOA and stratosphere sulfate formation","text":"<ul> <li>Species: prsd_O3, prsd_NO3, prsd_OH</li> <li>Data sources</li> <li>the file for historical simulation is the same as v1 and v2, inherited from CESM</li> <li>files for SSPs are regridded from NCAR CESM2 tracer files</li> </ul>"},{"location":"EAM/user-guide/emission_oxidant_files/#namelist-setting-for-emissions-input","title":"Namelist setting for emissions input","text":""},{"location":"EAM/user-guide/emission_oxidant_files/#historical-wcycl20tramip-f20tr","title":"Historical (WCYCL20TR)/AMIP (F20TR)","text":"<pre><code> ext_frc_specifier              = 'NO2         -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_NO2_aircraft_vertical_1750-2015_1.9x2.5_c20170608.nc',\n         'SO2         -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so2_elev_1850-2014_c180205_kzm_1850_2014_volcano.nc',\n         'SOAG0       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/emissions-cmip6_e3sm_SOAG0_elev_1850-2014_1.9x2.5_c20230201.nc',\n         'bc_a4       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_bc_a4_elev_1850-2014_c180205.nc',\n         'num_a1      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a1_elev_1850-2014_c180205.nc',\n         'num_a2      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a2_elev_1850-2014_c180205.nc',\n         'num_a4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a4_elev_1850-2014_c180205.nc',\n         'pom_a4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_pom_a4_elev_1850-2014_c180205.nc',\n         'so4_a1      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a1_elev_1850-2014_c180205.nc',\n         'so4_a2      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a2_elev_1850-2014_c180205.nc'\n\n srf_emis_specifier             = 'C10H16 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_MTERP_surface_1850-2014_1.9x2.5_c20230126.nc',\n         'C2H4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_C2H4_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'C2H6      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_C2H6_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'C3H8      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_C3H8_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'CH2O   -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CH2O_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'CH3CHO    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CH3CHO_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'CH3COCH3  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CH3COCH3_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'CO     -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CO_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'DMS    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DMSflux.1850-2100.1deg_latlon_conserv.POPmonthlyClimFromACES4BGC_c20160727.nc',\n         'E90       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions_E90_surface_1750-2015_1.9x2.5_c20210408.nc',\n         'ISOP   -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_ISOP_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'ISOP_VBS -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_ISOP_surface_1850-2014_1.9x2.5_c20210323.nc',\n         'NO     -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_NO_surface_1850-2014_1.9x2.5_c20220425.nc',\n         'SO2    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so2_surf_1850-2014_c180205.nc',\n         'SOAG0  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/emissions-cmip6_e3sm_SOAG0_surf_1850-2014_1.9x2.5_c20230201.nc',\n         'bc_a4  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_bc_a4_surf_1850-2014_c180205.nc',\n         'num_a1 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a1_surf_1850-2014_c180205.nc',\n         'num_a2 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a2_surf_1850-2014_c180205.nc',\n         'num_a4 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a4_surf_1850-2014_c180205.nc',\n         'pom_a4 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_pom_a4_surf_1850-2014_c180205.nc',\n         'so4_a1 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a1_surf_1850-2014_c180205.nc',\n         'so4_a2 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a2_surf_1850-2014_c180205.nc'\n\n tracer_cnst_datapath           = '\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/oxid'\n tracer_cnst_file               = 'oxid_1.9x2.5_L26_1850-2015_c20181106.nc'\n tracer_cnst_filelist           = ''\n tracer_cnst_specifier          = 'prsd_O3:O3','prsd_NO3:NO3','prsd_OH:OH'\n tracer_cnst_type               = 'INTERP_MISSING_MONTHS'\n</code></pre>"},{"location":"EAM/user-guide/emission_oxidant_files/#f2010","title":"F2010","text":"<pre><code> ext_frc_cycle_yr               = 2010\n ext_frc_specifier              = 'NO2         -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_NO2_aircraft_vertical_2010_clim_1.9x2.5_c20230213.nc',\n         'SO2         -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so2_elev_1x1_2010_clim_c20190821.nc',\n         'SOAG0       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/emissions-cmip6_e3sm_SOAG0_elev_2010_clim_1.9x2.5_c20230213.nc',\n         'bc_a4       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_bc_a4_elev_1x1_2010_clim_c20190821.nc',\n         'num_a1      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a1_elev_1x1_2010_clim_c20190821.nc',\n         'num_a2      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a2_elev_1x1_2010_clim_c20190821.nc',\n         'num_a4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a4_elev_1x1_2010_clim_c20190821.nc',\n         'pom_a4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_pom_a4_elev_1x1_2010_clim_c20190821.nc',\n         'so4_a1      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a1_elev_1x1_2010_clim_c20190821.nc',\n         'so4_a2      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a2_elev_1x1_2010_clim_c20190821.nc'\n ext_frc_type           = 'CYCLICAL'\n\n srf_emis_cycle_yr              = 2010\n srf_emis_specifier             = 'C10H16 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_MTERP_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'C2H4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_C2H4_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'C2H6      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_C2H6_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'C3H8      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_C3H8_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'CH2O   -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CH2O_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'CH3CHO    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CH3CHO_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'CH3COCH3  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CH3COCH3_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'CO     -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_CO_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'DMS    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DMSflux.2010.1deg_latlon_conserv.POPmonthlyClimFromACES4BGC_c20190220.nc',\n         'E90       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions_E90_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'ISOP   -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_ISOP_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'ISOP_VBS -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_ISOP_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'NO     -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/chem_gases/2degrees/emissions-cmip6_e3sm_NO_surface_2010_clim_1.9x2.5_c20230213.nc',\n         'SO2    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so2_surf_1x1_2010_clim_c20190821.nc',\n         'SOAG0  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/emissions-cmip6_e3sm_SOAG0_surf_2010_clim_1.9x2.5_c20230213.nc',\n         'bc_a4  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_bc_a4_surf_1x1_2010_clim_c20190821.nc',\n         'num_a1 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a1_surf_1x1_2010_clim_c20190821.nc',\n         'num_a2 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a2_surf_1x1_2010_clim_c20190821.nc',\n         'num_a4 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_num_a4_surf_1x1_2010_clim_c20190821.nc',\n         'pom_a4 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_pom_a4_surf_1x1_2010_clim_c20190821.nc',\n         'so4_a1 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a1_surf_1x1_2010_clim_c20190821.nc',\n         'so4_a2 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DECK_ne30/cmip6_mam4_so4_a2_surf_1x1_2010_clim_c20190821.nc'\n srf_emis_type          = 'CYCLICAL'\n\n tracer_cnst_cycle_yr           = 2015\n tracer_cnst_datapath           = '\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/oxid'\n tracer_cnst_file               = 'oxid_1.9x2.5_L26_1850-2015_c20181106.nc'\n tracer_cnst_filelist           = ''\n tracer_cnst_specifier          = 'prsd_O3:O3','prsd_NO3:NO3','prsd_OH:OH'\n tracer_cnst_type               = 'CYCLICAL'\n ```\n\n### Future Scenarios\n\n#### SSP370\n\n```fortran\next_frc_specifier              = 'NO2         -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_NO2_aircraft_vertical_2015-2100_1.9x2.5_c20240208.nc',\n         'SO2         -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so2_elev_2015-2100_c210216.nc',\n         'SOAG0       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_SOAG0_elev_2015-2100_1.9x2.5_c20240208.nc',\n         'bc_a4       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_bc_a4_elev_2015-2100_c210216.nc',\n         'num_a1      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a1_elev_2015-2100_c210216.nc',\n         'num_a2      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a2_elev_2015-2100_c210216.nc',\n         'num_a4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a4_elev_2015-2100_c210216.nc',\n         'pom_a4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_pom_a4_elev_2015-2100_c210216.nc',\n         'so4_a1      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a1_elev_2015-2100_c210216.nc',\n         'so4_a2      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a2_elev_2015-2100_c210216.nc'\n\nsrf_emis_specifier             = 'C10H16 -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_MTERP_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'C2H4      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_C2H4_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'C2H6      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_C2H6_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'C3H8      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_C3H8_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'CH2O      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CH2O_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'CH3CHO    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CH3CHO_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'CH3COCH3  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CH3COCH3_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'CO        -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CO_surface_2015-2100_1.9x2.5_c20240208.nc ',\n         'DMS       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DMSflux.1850-2100.1deg_latlon_conserv.POPmonthlyClimFromACES4BGC_c20160727.nc',\n         'E90       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/emissions_E90_surface_1750-2101_1.9x2.5_c20231222.nc',\n         'ISOP      -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'ISOP_VBS  -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'NO        -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_NO_surface_2015-2100_1.9x2.5_c20240208.nc',\n         'SO2       -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so2_surf_2015-2100_c210216.nc',\n         'SOAG0     -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_SOAG0_surf_2015-2100_1.9x2.5_c20240208.nc',\n         'bc_a4     -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_bc_a4_surf_2015-2100_c210216.nc',\n         'num_a1    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a1_surf_2015-2100_c210216.nc',\n         'num_a2    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a2_surf_2015-2100_c210216.nc',\n         'num_a4    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a4_surf_2015-2100_c210216.nc',\n         'pom_a4    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_pom_a4_surf_2015-2100_c210216.nc',\n         'so4_a1    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a1_surf_2015-2100_c210216.nc',\n         'so4_a2    -&gt; \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a2_surf_2015-2100_c210216.nc'\n\n tracer_cnst_datapath           = '\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/oxid'\n tracer_cnst_file               = 'oxid_SSP370_1.9x2.5_L70_1849-2101_c20240228.nc'\n tracer_cnst_filelist           = ''\n tracer_cnst_specifier          = 'prsd_O3:O3','prsd_NO3:NO3','prsd_OH:OH'\n tracer_cnst_type               = 'INTERP_MISSING_MONTHS'\n</code></pre> <ol> <li> <p>F. Dentener, S. Kinne, T. Bond, O. Boucher, J. Cofala, S. Generoso, P. Ginoux, S. Gong, J. J. Hoelzemann, A. Ito, L. Marelli, J. E. Penner, J.-P. Putaud, C. Textor, M. Schulz, G. R. van der Werf, and J. Wilson. Emissions of primary aerosol and precursor gases in the years 2000 and 1750 prescribed data-sets for AeroCom. Atmospheric Chemistry and Physics, 6(12):4321\u20134344, 2006. URL: https://acp.copernicus.org/articles/6/4321/2006/acp-6-4321-2006.html (visited on 2024-04-24), doi:10.5194/acp-6-4321-2006.\u00a0\u21a9</p> </li> <li> <p>S. M. Burrows, O. Ogunro, A. A. Frossard, L. M. Russell, P. J. Rasch, and S. M. Elliott. A physically based framework for modeling the organic fractionation of sea spray aerosol from bubble film Langmuir equilibria. Atmospheric Chemistry and Physics, 14(24):13601\u201313629, December 2014. URL: https://acp.copernicus.org/articles/14/13601/2014/ (visited on 2024-03-29), doi:10.5194/acp-14-13601-2014.\u00a0\u21a9\u21a9</p> </li> <li> <p>Susannah M. Burrows, Richard C. Easter, Xiaohong Liu, Po-Lun Ma, Hailong Wang, Scott M. Elliott, Balwinder Singh, Kai Zhang, and Philip J. Rasch. OCEANFILMS (Organic Compounds from Ecosystems to Aerosols: Natural Films and Interfaces via Langmuir Molecular Surfactants) sea spray organic aerosol emissions \u2013 implementation in a global climate model and impacts on clouds. Atmospheric Chemistry and Physics, 22(8):5223\u20135251, April 2022. URL: https://acp.copernicus.org/articles/22/5223/2022/ (visited on 2024-03-29), doi:10.5194/acp-22-5223-2022.\u00a0\u21a9</p> </li> <li> <p>Mathew E. Maltrud, Richard D. Smith, Albert J. Semtner, and Robert C. Malone. Global eddy\u2010resolving ocean simulations driven by 1985\u20131995 atmospheric winds. Journal of Geophysical Research: Oceans, 103(C13):30825\u201330853, December 1998. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/1998JC900013 (visited on 2024-03-29), doi:10.1029/1998JC900013.\u00a0\u21a9</p> </li> <li> <p>J. Keith Moore, Scott C. Doney, and Keith Lindsay. Upper ocean ecosystem dynamics and iron cycling in a global three\u2010dimensional model. Global Biogeochemical Cycles, 18(4):2004GB002220, December 2004. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2004GB002220 (visited on 2024-03-29), doi:10.1029/2004GB002220.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAM/user-guide/namelist_parameters/","title":"Namelist parameters associated with atmosphere schemes","text":""},{"location":"EAM/user-guide/namelist_parameters/#chemuci-and-linoz-v3","title":"chemUCI and Linoz v3","text":"Parameter Description Default value* <code>airpl_emis_file</code> Aviation emission <code>chlorine_loading_file</code> Chlorine loading <code>chlorine_loading_fixed_ymd</code> <code>chlorine_loading_type</code> <code>ext_frc_specifier</code> 3-D emissions <code>ext_frc_cycle_yr</code> <code>ext_frc_type</code> <code>srf_emis_specifier</code> Surface emissions <code>srf_emis_cycle_yr</code> <code>srf_emis_type</code> Upper bound of mean raindrop diameter <code>linoz_data_file</code> Linoz data file <code>linoz_data_cycle_yr</code> <code>linoz_data_path</code> <code>linoz_data_type</code> <code>lght_no_prd_factor</code> Lightning NOx emission factor <code>5.0</code> <code>fstrat_efold_list</code> Tracer (from troposphere) list with e-folding decay in the stratosphere <ul> <li>Many of these namelist parameters specify input data files. Check the <code>atm_in</code> file for examples or refer to the Users' Guide.</li> </ul>"},{"location":"EAM/user-guide/namelist_parameters/#cloud-layers-unified-by-binormals","title":"Cloud Layers Unified By Binormals","text":"Parameter Description Default value <code>gamma_coef</code> Width of vertical velocity within a Gaussian PDF component at low skewness <code>0.12</code> <code>gamma_coefb</code> Width of vertical velocity within a Gaussian PDF component at high skewness <code>0.28</code> <code>C8</code> Coefficient of damping of third moment of vertical velocity, w\u20193 <code>5.2</code> <code>C1</code> Coefficient of damping of second vertical moment of vertical velocity, w\u20192, at low skewness <code>2.4</code> <code>C14</code> Coefficient of damping of second horizontal moments of vertical velocity, u\u20192 and v\u20192 <code>2.0</code> <code>c_k10</code> Ratio of diffusivity of momentum to heat <code>0.35</code>"},{"location":"EAM/user-guide/namelist_parameters/#dust-aerosol","title":"Dust aerosol","text":"Parameter Description Default value <code>dust_emis_scheme</code>* The v3 dust emission scheme (Kok et al., 2014) <code>2</code>  (set to 1 to switch to the v1/v2 scheme) <p>*This parameter is set in <code>user_nl_drv</code></p>"},{"location":"EAM/user-guide/namelist_parameters/#homme","title":"HOMME","text":"Parameter Description Default value <code>se_tstep</code> Main dycore timestep. Additional parameters control the hyper viscsosity, trancer and vertical remap timesteps, which are derived from se_tstep.  units = seconds Scales linearly with horizontal resolution.  NE30 default: <code>300</code> <code>nu</code> Tensor hyperviscosity coefficient, independent of spatial resolution.  units = 1/s <code>3.4e-8</code> <code>nu_top</code> Scalar viscosity at model top.  units = m^2/s Horizontal resolution dependent  NE30 default: <code>2.5e5</code> <code>transport_alg</code> Select between semi-lagrangian and Eulerian based transport schemes <code>12</code> = semi-lagranian method with monotinicity and mass preservation <code>statefreq</code> print a varieity of dycore metrics to the atm.log file every \u201cstatefreq\u201d timesteps <code>480</code> <code>vert_remap_alg</code> Algorithm used to remap the vertically lagrangian levels back to the reference levels <code>10</code> = strict monotonicity applied on top of a 2nd order accurate PPM method <code>se_ftype</code> Controls how physics tendencies are applied.  0=\u201ddribbled\u201d in during dynamics timesteps.  1=\u201dhard adjustment\u201d after each physics timestep.  2=hybrid approach: hard adjustment for tracers, dribbled for remaining tendencies <code>2</code>"},{"location":"EAM/user-guide/namelist_parameters/#modal-aerosol-module","title":"Modal Aerosol Module","text":"Parameter Description Default value <code>is_output_interactive_volc</code> Switch for diagnostic output of the stratospheric aerosol optics <code>.false.</code> <code>mam_amicphys_optaa</code> Recommended option of the new time-splitting treatment of H2SO4 production and loss <code>1</code>  (0 to turn it off) <code>n_so4_monolayers_pcage</code> Number of monolayers required to age primary-carbon mode particles <code>3</code> <code>seasalt_emis_scale</code> Tuning parameter for sea salt emission <code>0.55</code>"},{"location":"EAM/user-guide/namelist_parameters/#oceanfilms","title":"OCEANFILMS","text":"Parameter Description Default value <code>mam_mom_cycle_yr</code> <code>1</code> <code>mam_mom_datapath</code> Full pathname of the directory that contains the files specified in mam_mom_filelist <code>'atm/cam/chem/trop_mam/marine_BGC/'</code> <code>mam_mom_filename</code> Filename of file that contains a sequence of filenames for prescribed marine organic matter ocean concentrations.  The filenames in this file are relative to the directory specified by mam_mom_datapath. <code>'monthly_macromolecules_0.1deg_bilinear_latlon_year01_merge_date.nc'</code> <code>mam_mom_rmfile</code> Remove the file containing prescribed aerosol deposition fluxes from local disk when no longer needed. <code>FALSE</code> <code>mam_mom_specifier</code> Names of variables containing aerosol data in the prescribed aerosol datasets. <code>'chla:CHL1','mpoly:TRUEPOLYC','mprot:TRUEPROTC','mlip:TRUELIPC'</code> <code>mam_mom_datatype</code> Type of time interpolation for data in mam_mom files. Can be set to <code>'CYCLICAL'</code>, <code>'SERIAL'</code>, <code>'INTERP_MISSING_MONTHS'</code>, or <code>'FIXED'</code>. <code>'CYCLICAL'</code> <code>mam_mom_cycle_yr</code> The  cycle year of the prescribed aerosol flux data if mam_mom_type is <code>'CYCLICAL'</code>. Format: YYYY <code>1</code> <code>mam_mom_fixed_ymd</code> The date at which the prescribed aerosol flux data is fixed if mam_mom_type is <code>'FIXED'</code>. Format: YYYYMMDD <code>0</code> <code>mam_mom_fixed_tod</code> The time of day (seconds) corresponding to mam_mom_fixed_ymd at which the prescribed aerosol flux data is fixed if mam_mom_type is 'FIXED'. <code>0</code> <code>mam_mom_bubble_thickness</code> Bubble film thickness (in m) for marine organic aerosol emission mechanism.  The physically reasonable range is approximately (0.1 - 1) x 10^ -6. <code>0.1e-6</code> <code>mam_mom_mixing_state</code> Switch to select mixing state assumption in marine organic aerosol code. Currently implemented options: 0 : total external mixture, add to mass; 1 : total external mixture, replace mass; 2 : total internal mixture, add to mass; 3 : total internal mixture, replace mass. <code>0</code> [Note: set to 3 in the atm_in namelist] <code>mam_mom_parameterization</code> Selection of alternate parameterizations for marine organic matter emissions.  Set fmoa=1 for Burrows et al. (2014) <sup>1</sup> parameterization; fmoa=2 for Gantt et al. (2011) <sup>2</sup> parameterization; fmoa=3 for simple parameterization based on Quinn et al., 2014; <sup>3</sup> fmoa=4 for Rinaldi et al. (JGR, 2013).* <sup>4</sup> <code>1</code> <p>*Note: non-default values have not been carefully tested and may not work as expected.</p>"},{"location":"EAM/user-guide/namelist_parameters/#predicted-particle-properties","title":"Predicted Particle Properties","text":"Parameter Description Default value <code>do_prescribed_ccn</code> Turn on the prescribed CCN if true <code>false</code> <code>micro_aerosolactivation</code> Turn on aerosol activation if true <code>true</code> <code>micro_p3_lookup_dir</code> Directory of P3 look-up tables <code>inputdata/atm/cam/physprops</code> <code>micro_p3_tableversion</code> P3 look-up table Version <code>4.1.2</code> <code>micro_subgrid_cloud</code> Sub-grid cloud properties <code>true</code> <code>micro_tend_output</code> Output of P3 microphysical process rates <code>false</code> <code>p3_accret_coeff</code> Tunable parameter for adjusting rain accretion efficiency <code>117.25</code> <code>p3_autocon_coeff</code> Tunable parameter for adjusting droplet autoconversion efficiency <code>30500</code> <code>p3_embryonic_rain_size</code> Radius of embryomic raindrops from auto-conversion <code>0.000025</code> (m) <code>p3_max_mean_rain_size</code> Upper bound of mean raindrop diameter <code>0.005</code> (m) <code>p3_mincdnc</code> Lower bound of droplet number concentration <code>20.d6</code> (# m-3) <code>p3_nc_autocon_expon</code> Nc exponent in droplet auto-conversion <code>-1.1</code> <code>p3_qc_accret_expon</code> Qc exponent in rain accretion <code>1.15</code> <code>p3_qc_autocon_expon</code> Qc exponeent in droplet autoconversion <code>3.19</code> <code>p3_wbf_coeff</code> Tunable parameter for adjusting WBF efficiency <code>1.0</code> <code>do_cooper_inp3</code> Turn on Cooper ice nucleation scheme if true <code>false</code>"},{"location":"EAM/user-guide/namelist_parameters/#rapid-radiative-transfer-model-for-gcms","title":"Rapid Radiative Transfer Model for GCMs","text":"Parameter Description Default value <code>iradsw</code> Frequency for updating shortwave fluxes and heating rate; iradsw &gt; 0 interpreted as number of timesteps, iradsw &lt; 0 interpreted as hours; iradsw = 0 disables shortwave radiation entirely <code>-1</code> <code>iradlw</code> Frequency for updating longwave fluxes and heating rate; iradlw &gt; 0 interpreted as number of timesteps, iradlw &lt; 0 interpreted as hours; iradlw = 0 disables longwave radiation entirely <code>-1</code> <code>irad_always</code> Length of time in timesteps (irad_always &gt; 0) or in hours (irad_always &lt; 0) SW/LW radiation will be run continuously from the start of an initial or restart run <code>0</code> <code>use_rad_dt_cosz</code> If true, use the radiation dt for all cosz calculations; calculates solar zenith angle averaged over a time step. In default model solar zenith angle is held constant over time <code>.true.</code>  (set by namelist_defaults_eam.xml for default physics) <code>spectralflux</code> Calculate fluxes (up and down) per band <code>.false.</code> <code>liqcldoptics</code> Choice of cloud optical property parameterization for liquid clouds. Valid options are \u2018slingo\u2019 or \u2018gammadist\u2019 <code>gammadist</code> <code>icecldoptics</code> Choice of cloud optical property parameterization for ice clouds. Valid options are \u2018ebertcurry\u2019 or \u2018mitchell\u2019 <code>mitchell</code>"},{"location":"EAM/user-guide/namelist_parameters/#zhang-and-mcfarlane-deep-convection-scheme","title":"Zhang and McFarlane deep convection scheme","text":"ZM Parameters Description Default value <code>zmconv_ke</code> Tunable evaporation efficiency in ZM deep convection scheme <code>2.5E-6</code> <code>zmconv_tau</code> Relaxation time in ZM deep convection scheme <code>3600</code> <code>zmconv_dmpdz</code> Parcel fractional mass entrainment rate <code>-0.7E-3</code> <code>zmconv_alfa</code> Initial downdraft mass flux fraction <code>0.14D0</code> <code>zmconv_tiedke_add</code> Temperature perturbation of an air parcel <code>0.8D0</code> <code>zmconv_cape_cin</code> Number of negative buoyancy regions that are allowed <code>1</code> dCAPE-ULL Parameters Description Default value <code>zmconv_trig_dcape</code> Enable dynamic CAPE (DCAPE) trigger for ZM deep convection <code>.false.</code> <code>zmconv_trig_ull</code> Enable unrestricted launch level (ULL) mode for ZM deep convection <code>.false.</code> Conv. micro. Parameters Description Default value <code>zmconv_microp</code> Convective microphysics option in ZM convection scheme <code>true</code> <code>zmconv_auto_fac</code> Cloud droplet-rain autoconversion enhancement factor in the convective microphysics scheme <code>7.0</code> <code>zmconv_accr_fac</code> Cloud droplet-rain accretion enhancement factor in the convective microphysics scheme <code>1.5</code> <code>zmconv_micro_dcs</code> Autoconversion size threshold for cloud ice to snow (m) <code>150.E-6</code> Mass flux adj. Parameters Description Default value <code>zmconv_clos_dyn_adj</code> Apply mass flux adjustment to ZM convection scheme <code>true</code> MCSP Parameters Description Default value <code>zmconv_mcsp_heat_coeff</code> MCSP heating coefficient <code>0.3</code> <code>zmconv_mcsp_moisture_coeff</code> MCSP moisture coefficient <code>0.0</code> <code>zmconv_mcsp_uwind_coeff</code> MCSP zonal wind coefficient <code>0.0</code> <code>zmconv_mcsp_vwind_coeff</code> MCSP meridional wind coefficient <code>0.0</code>"},{"location":"EAM/user-guide/namelist_parameters/#cloud-feedback-model-intercomparison-project-cfmip-observation-simulator-package","title":"Cloud Feedback Model Intercomparison Project (CFMIP) Observation Simulator Package","text":"Parameter Description Default value <code>cosp_lite</code> This namelist sets cosp_ncolumns=10 and cosp_nradsteps=3 (appropriate for COSP statistics derived from seasonal averages), and runs MISR, ISCCP, MODIS, and CALIPSO lidar simulators (cosp_lmisr_sim=.true.,cosp_lisccp_sim=.true., cosp_lmodis_sim=.true.,cosp_llidar_sim=.true.). <code>false</code>"},{"location":"EAM/user-guide/namelist_parameters/#orographic-drag-schemes","title":"Orographic drag schemes","text":"Parameter Description Default value <code>use_gw_oro</code> This namelist controls the default linear orographic gravity wave drag (oGWD) for E3SM, if used, the default oGWD is turned on. <code>true</code> <code>do_tms</code> This namelist controls the default Turbulent Mountain Stress (TMS) for E3SM, if used, the default TMS is turned on. <code>false</code> <code>effgw_oro</code> Efficiency associated with orographic gravity waves. <code>0.375</code> <code>tms_orocnst</code> Turbulent mountain stress parameter used when TMS calculation is turned on <code>1.0</code> <code>tms_z0fac</code> Factor determining z_0 from orographic standard deviation [ no unit ] for TMS. <code>0.75</code> <code>use_od_ls</code> This namelist controls the new nonlinear oGWD, if used, the nonlinear oGWD is turned on. use_od_ls should not be used at the same time with use_gw_oro. <code>false</code> <code>use_od_bl</code> This namelist controls the Flow-blocking drag (FBD) scheme, if used, the FBD scheme is turned on. <code>false</code> <code>use_od_ss</code> This namelist controls the small-scale GWD (sGWD) scheme, if used, the sGWD scheme is turned on. <code>false</code> <code>use_od_fd</code> This namelist controls the Turbulent orographic form drag (TOFD) scheme, if used, the TOFD scheme is turned on. <code>false</code> <code>od_ls_ncleff</code> Tuning parameter of nonlinear oGWD. Stands for effective resolution of the grid for oGWD. Scales the magnitude of nonlinear oGWD. <code>3</code> <code>od_bl_ncd</code> Tuning parameter of FBD. Stands for bulk drag coefficient. Scales the magnitude of FBD. <code>3</code> <code>od_ss_sncleff</code> Tuning parameter of sGWD. Stands for effective resolution of the grid for sGWD.Scales the magnitude of sGWD. <code>1</code> <ol> <li> <p>S. M. Burrows, O. Ogunro, A. A. Frossard, L. M. Russell, P. J. Rasch, and S. M. Elliott. A physically based framework for modeling the organic fractionation of sea spray aerosol from bubble film Langmuir equilibria. Atmospheric Chemistry and Physics, 14(24):13601\u201313629, December 2014. URL: https://acp.copernicus.org/articles/14/13601/2014/ (visited on 2024-03-29), doi:10.5194/acp-14-13601-2014.\u00a0\u21a9</p> </li> <li> <p>B. Gantt, N. Meskhidze, M. C. Facchini, M. Rinaldi, D. Ceburnis, and C. D. O'Dowd. Wind speed dependent size-resolved parameterization for the organic mass fraction of sea spray aerosol. Atmospheric Chemistry and Physics, 11(16):8777\u20138790, August 2011. URL: https://acp.copernicus.org/articles/11/8777/2011/acp-11-8777-2011.html (visited on 2024-04-25), doi:10.5194/acp-11-8777-2011.\u00a0\u21a9</p> </li> <li> <p>Patricia K. Quinn, Timothy S. Bates, Kristen S. Schulz, D. J. Coffman, A. A. Frossard, L. M. Russell, W. C. Keene, and D. J. Kieber. Contribution of sea surface carbon pool to organic matter enrichment in sea spray aerosol. Nature Geoscience, 7(3):228\u2013232, March 2014. URL: https://www.nature.com/articles/ngeo2092 (visited on 2024-04-25), doi:10.1038/ngeo2092.\u00a0\u21a9</p> </li> <li> <p>Matteo Rinaldi, Sandro Fuzzi, Stefano Decesari, Salvatore Marullo, Rosalia Santoleri, Antonello Provenzale, Jost Von Hardenberg, Darius Ceburnis, Aditya Vaishya, Colin D. O'Dowd, and Maria Cristina Facchini. Is chlorophyll\u2010 \\textit a the best surrogate for organic matter enrichment in submicron primary marine aerosol? Journal of Geophysical Research: Atmospheres, 118(10):4964\u20134973, May 2013. URL: https://agupubs.onlinelibrary.wiley.com/doi/10.1002/jgrd.50417 (visited on 2024-04-25), doi:10.1002/jgrd.50417.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/","title":"EAMxx","text":""},{"location":"EAMxx/#a-high-performance-e3sm-atmosphere-model-in-c","title":"A High-performance E3SM Atmosphere Model in C++","text":"<p>EAMxx was designed and built from the ground up employing modern C++ in order to embrace leading-edge software practices and enable \"performance portability\" <sup>1</sup> across various leadership-class supercomputers. The latter goal is achieved by using the Kokkos library. EAMxx is a \"clean-start\" model with almost no similarity to the E3SM atmosphere model used in versions 1-3. Currently only the km-scale explicit-convection version called SCREAM<sup>2</sup> (the Simple Cloud-Resolving E3SM Atmosphere Model) is available, but a low-resolution version is in development.</p>"},{"location":"EAMxx/#trail-map","title":"Trail Map","text":"<p>Like the documentation for other component models, EAMxx documentation is divided into the following sections:</p> <ul> <li>User Guide - info about running EAMxx and all options for modifying a simulation</li> <li>Developer Guide - information needed to contribute to EAMxx development</li> <li>Technical Guide - equations and numerical methods used in EAMxx</li> </ul> <p>Put another way, the User Guide provides information about how to successfully run a model that includes EAMxx and how to customize runs without changing source code. The Developer Guide includes information about EAMxx software design that will assist those who wish to intelligently modify source code. Scientific and modeling details about the specific process implementations in the current model version are provided in the Technical Guide.</p> <ol> <li> <p>Performance Portability: A software-design practice focused on providing the ability to run the same model on differing architectures (cpu, gpu, ...) without modifying the source code and, ideally, without sacrificing performance.\u00a0\u21a9</p> </li> <li> <p>Note: Prior to EAMxx version 1, this project, software library, and atmosphere driver were generally referred to as SCREAM. However, at this point, we wish to make the distinction between EAMxx, the next-gen atmosphere driver and C++ software library, and SCREAM, the particular high-resolution configuration of EAMxx.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/","title":"Eamxx tutorial 2025 part1","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#2025-e3sm-all-hands-eamxx-tutorial","title":"2025 E3SM All-Hands EAMxx Tutorial","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#part-1-running-eamxx","title":"Part 1: Running EAMxx","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#housekeeping","title":"Housekeeping","text":"<p>Open a terminal and ssh into NERSC account</p> <pre><code>ssh &lt;username&gt;@perlmutter-p1.nersc.gov\n</code></pre> <p>Make a git clone of E3SM (if you don\u2019t already have a copy):</p> <pre><code>git clone git@github.com:E3SM-Project/E3SM.git\ngit submodule update --init --recursive\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#e3sm-case-setup","title":"E3SM Case Setup","text":"<p>For the sake of time, compile E3SM case by running provided script at</p> <pre><code>/global/cfs/cdirs/e3sm/eamxx-tutorial-2025/runscript/run_e3sm.template.sh\n</code></pre> <p>For reference see: https://docs.e3sm.org/E3SM/EAMxx/</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#agenda","title":"Agenda","text":"<p>Part 1: Running and changing an EAMxx case Runtime options, controlling output, DPxx, running unit tests</p> <p>Part 2: Adding a new process to EAMxx AtmosphereProcess interface, adding a process, running it</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#running-eamxx-cases","title":"Running EAMxx cases","text":"<p>Identical to typical E3SM cases, but using compset <code>F2010-SCREAMv1</code></p> <p>Edit the run script provided to suit your needs</p> <pre><code>/global/cfs/cdirs/e3sm/eamxx-tutorial-2025/runscript/run_e3sm.template.sh\n</code></pre> <p>Update <code>CODE_ROOT</code> to point to your E3SM clone</p> <p>Run the script!</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#goals-of-part-1","title":"Goals of Part 1","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#build-e3sm-with-eamxx","title":"Build E3SM with EAMxx","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#make-runtime-changes-to-eamxx","title":"Make runtime changes to EAMxx","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#add-remove-and-adjust-output-streams","title":"Add, remove, and adjust output streams","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#primer-on-dpxx","title":"Primer on DPxx","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#run-unit-tests","title":"Run unit tests","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#runtime-options","title":"Runtime options","text":"<p>namelist options are in YAML now!</p>  OLD EAM   NEW EAMxx  <pre><code> nudge_tprof            = 0\n nudge_ucoef            = 1.\n nudge_uprof            = 2\n nudge_vcoef            = 1.\n nudge_vprof            = 2\n nudge_vwin_hdelta              = 0.1\n nudge_vwin_hi          = 1.\n nudge_vwin_hindex              = 80.\n nudge_vwin_ldelta              = 0.1\n nudge_vwin_lindex              = 0.\n nudge_vwin_lo          = 0.\n/\n&amp;phys_ctl_nl\n cam_chempkg            = 'chemuci_linozv3_mam5_vbs'\n cam_physpkg            = 'default'\n cflx_cpl_opt           =  2\n cld_macmic_num_steps           =  6\n conv_water_in_rad              =  1\n convproc_do_aer                = .true.\n convproc_do_gas                = .false.\n convproc_method_activate               = 2\n deep_scheme            = 'ZM'\n demott_ice_nuc         = .true.\n do_aerocom_ind3                = .true.\n...\n</code></pre> <pre><code>################################################################\n# Do NOT modify this file. It is generated by scream/buildnml using\n# the data from $case/namelist_scream.xml. If you want to make some\n# local changes, you can edit this XML file or use atmchange.\n################################################################\nscorpio:\n  model_restart:\n    iotype: default\n    output_control:\n      frequency: 6\n      frequency_units: ndays\n  output_yaml_files: !strings\n  - /path/to/run/data/output_file.yaml\natmosphere_processes:\n  type: group\n  atm_procs_list: !strings\n  - sc_import\n  - homme\n  - physics\n  - sc_export\n  compute_tendencies: !strings []\n  enable_postcondition_checks: true\n  enable_precondition_checks: true\n  homme:\n    bfb_hash: 18\n    moisture: moist\n    compute_tendencies: !strings []\n    enable_postcondition_checks: true\n...\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#runtime-options-in-eamxx","title":"Runtime options in EAMxx","text":"<p>YAML has support in C++ and more human readable</p> <p>EAMxx introduces <code>atmchange</code> and <code>atmquery</code> that mimic and expand upon <code>xmlchange</code> and <code>xmlquery</code>. In EAMxx, changes are recorded via <code>atmchange</code> not through files like user_nl_eam.</p>  OLD EAM   NEW EAMxx  <pre><code>cat &lt;&lt; EOF &gt;&gt; user_nl_eam\n cld_macmic_num_steps = 12\nEOF\n</code></pre> <pre><code>./atmchange mac_aer_mic::number_of_subcycles=12\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#runtime-options-exercise","title":"Runtime options exercise","text":"<ol> <li> <p>Navigate to the <code>case_scripts</code> directory of the case you built</p> </li> <li> <p>Issue the following commands: <code>./atmquery --help</code>, <code>./atmchange --help</code></p> </li> <li> <p>Experiment with changing the namelist, e.g., <code>./atmchange mac_aer_mic::number_of_subcycles=12</code></p> </li> <li> <p>Run with the new options with <code>./case.submit</code></p> </li> </ol>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#output-control","title":"Output control","text":"OLD EAM namelist   NEW EAMxx YAML  <pre><code>cat &lt;&lt; EOF &gt;&gt; user_nl_eam\n mfilt = 1\n nhtfrq = 1\n fincl1 = 'Q','CLDLIQ','CLDICE'\nEOF\n</code></pre> <pre><code>averaging_type: average\nfields:\n  physics_pg2:\n    field_names:\n      - Q\n      - CLDLIQ\n      - CLDICE\nmax_snapshots_per_file: 1\nfilename_prefix: output.scream_monthly.NAME_1\noutput_control:\n  frequency: 1\n  frequency_units: nmonths\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#output-control-exercise","title":"Output control exercise","text":"<p>The runscript should have copied an output yaml file to the case_scripts directory called <code>tutorial_output.yaml</code></p> <p>Copy this file to a differently named file, e.g., <code>tutorial_output_2.yaml</code> and change options. Be sure to change the <code>filename_prefix</code>!</p> <p>Add this new output stream to the run using the atmchange command, then rerun the case.</p> <pre><code>./atmchange output_yaml_files+=tutorial_output_2.yaml\n./atmquery output_yaml_files\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#running-doubly-periodic-eamxx","title":"Running Doubly Periodic EAMxx","text":"<ul> <li>Intensive Observation Period (IOP) specializationm, now fully supported C++.</li> <li>Compsets: <code>FIOP-SCREAMv1-DP</code> (general) and <code>FRCE-SCREAMv1-DP</code> (RCE).</li> <li>Over 30 cases, can easily run on any machine with a CIME config.</li> </ul> <p>DPxx resource page: https://github.com/E3SM-Project/scmlib/wiki/Doubly-Periodic-SCREAM-Home</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part1/#running-the-unit-test-suite","title":"Running the unit test suite","text":"<p>EAMxx has a simple utility, <code>test-all-eamxx</code>, to manage the suite of unit tests.</p> <pre><code>salloc --nodes 1 --qos interactive --time 01:00:00 --constraint gpu --gpus 4 --account e3sm\n./components/eamxx/scripts/test-all-eamxx -m pm-gpu -t dbg\n</code></pre> <p>Note: see <code>test-all-eamxx --help</code> for more options, including <code>--config-only</code> and <code>-w $NEW_LOC</code>.</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/","title":"Eamxx tutorial 2025 part2","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#2025-e3sm-all-hands-eamxx-tutorial","title":"2025 E3SM All-Hands EAMxx Tutorial","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#part-2-adding-a-new-process-to-eamxx","title":"Part 2: Adding a new process to EAMxx","text":""},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#agenda","title":"Agenda","text":"<p>Part 1: Running and changing an EAMxx case Runtime options, controlling output, DPxx, running unit tests</p> <p>Part 2: Adding a new process to EAMxx AtmosphereProcess interface, adding a process, running it</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#adding-a-new-process-to-eamxx","title":"Adding a new process to EAMxx","text":"<ul> <li>EAMxx expects a process interface</li> <li>An instant of AtmosphereProcess</li> <li>Must add new process to CMake, MCT, etc.</li> <li>Runtime options</li> </ul>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#pompei","title":"POMPEI","text":"<p>POMPEI: Practicing On Manually Adding Processes to EAMxx Interfaces</p> <ul> <li>Idealized injection of a new volcanic tracer <code>ash</code></li> <li>Injection details are defined in <code>pompei.hpp</code> and <code>pompei.cpp</code> files</li> <li>Interfacing with EAMxx via an <code>AtmosphereProcess</code> instance (<code>*_interface.*pp</code> files)</li> <li><code>set_grid</code>, <code>initialize_impl</code>, <code>run_impl</code>, <code>finalize_impl</code></li> </ul>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#add-pompei-skeleton-to-eamxx","title":"Add <code>pompei</code> skeleton to EAMxx","text":"<p>In the EAMxx physics directory, create a pompei folder and copy templates</p> <pre><code>cd components/eamxx/src/physics\nmkdir pompei\ncp /global/cfs/cdirs/e3sm/eamxx-tutorial-2025/source/eamxx_interface/eamxx_template_process_interface.*  .\nmv eamxx_template_process_interface.cpp eamxx_pompei_process_interface.cpp\nmv eamxx_template_process_interface.hpp eamxx_pompei_process_interface.hpp\ncp /global/cfs/cdirs/e3sm/eamxx-tutorial-2025/source/pompei/pompei.* ./\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#pompeihpp","title":"<code>pompei.hpp</code>","text":"<pre><code>#ifndef POMPEI_INTERNAL_HPP\n#define POMPEI_INTERNAL_HPP\n\nnamespace pompei {\n\ndouble ash_emission_rate(const double days_after_eruption);\n\n}  // namespace pompei\n\n#endif  // POMPEI_INTERNAL_HPP\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#pompeicpp","title":"<code>pompei.cpp</code>","text":"<pre><code>#include \"pompei.hpp\"\n#include &lt;cmath&gt;\n\nnamespace pompei {\n\ndouble ash_emission_rate(const double days_since_eruption) {\n  if(days_since_eruption &lt;= 0) return 0;\n\n  double initial_emission = 1e4;\n  double decay_rate       = -0.05;\n  return initial_emission * exp(days_since_eruption * decay_rate);\n}\n\n}  // namespace pompei\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#an-atmosphereprocess-in-eamxx","title":"An <code>AtmosphereProcess</code> in EAMxx","text":"<ul> <li>Intantiated inside an interface layer and contains at a minimum:</li> <li><code>set_grid</code></li> <li><code>initialize_impl</code></li> <li><code>run_impl</code></li> <li><code>finalize_impl</code></li> <li><code>pompei</code> is an instance of <code>AtmosphereProcess</code></li> </ul> <p>We will walk through the interface layer in detail next</p>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#the-interface-hpp-header-file","title":"The interface hpp (header) file","text":"<ul> <li>Stores the definitions of all interface methods</li> <li>Developer can define internal function and variables</li> </ul> <p>Tasks:</p> <ul> <li>Replace <code>AP_TEMPLATE</code> with <code>POMPEI</code></li> <li>Set a desired name for the process</li> <li>Add global parameters for the process under <code>protected</code> section</li> </ul> <p>See next slide for complete hpp file!</p> <pre><code>/*\n * First define this process intereface as a new header file\n */\n#ifndef EAMXX_POMPEI_PROCESS_INTERFACE_HPP\n#define EAMXX_POMPEI_PROCESS_INTERFACE_HPP\n/*\n * Any include statements.  By default you want to include the\n * atmosphere_process.hpp header\n */\n#include \"share/atm_process/atmosphere_process.hpp\"\n\nnamespace scream {\n\n/*\n * Class definition for new process interface.  Change \"AP_TEMPLATE\" to a name\n * that makes sense.\n */\nclass POMPEI : public AtmosphereProcess {\n  // Define public functions\n public:\n  POMPEI(const ekat::Comm &amp;comm, const ekat::ParameterList &amp;params);\n\n  AtmosphereProcessType type() const override {\n    return AtmosphereProcessType::Physics;\n  }\n\n  std::string name() const override { return \"my_disastrous_pompei\"; }\n\n  void set_grids(\n      const std::shared_ptr&lt;const GridsManager&gt; grids_manager) override;\n// Define the protected functions, usually at least initialize_impl, run_impl\n// and finalize_impl, but others could be included.  See\n// eamxx_template_process_interface.cpp for definitions of each of these.\n#ifndef KOKKOS_ENABLE_CUDA\n protected:\n#endif\n  void initialize_impl(const RunType run_type) override;\n  void run_impl(const double dt) override;\n  void finalize_impl() override;\n\n  // Could also define here universal variables for the process interface.\n  util::TimeStamp m_eruption_start;\n  std::shared_ptr&lt;const AbstractGrid&gt; m_grid;\n  int m_ncols, m_nlevs;\n  Field m_emission_mask;\n};\n\n}  // namespace scream\n\n#endif  // EAMXX_POMPEI_PROCESS_INTERFACE_HPP\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#the-interface-cpp-source-file","title":"The interface cpp (source) file","text":"<p>Replace <code>AP_TEMPLATE</code> with <code>POMPEI</code> and then:</p> <ul> <li>Define a constructor for the process</li> <li>Define <code>set_grids</code>, which tells EAMxx variables and grid</li> <li>Define <code>initialize_impl</code>, which initializes the process</li> <li>Define <code>run_impl</code>, what this process does each time step it is called</li> <li>Define <code>finalize_impl</code>, and last actions to take at the end of the simulation</li> </ul>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#include-statements-complete-section-on-next-slide","title":"Include statements (complete section on next slide)","text":"<p>Top of file, use of #include statements to access any other codes we need</p> <p>We add the header fo the process and other files we need</p> <pre><code>/*\n * Add any #include statements pointing to headers needed by this process.\n * Typical headers would be\n *     eamxx_$PROCESS_process_interface.hpp  (the eamxx interface header file\n * for this process) physics/share/physics_constants.hpp   (a header storing all\n * physical constants in eamxx) $PROCESS.hpp                          (a header\n * file for the process itself)\n */\n#include \"eamxx_pompei_process_interface.hpp\"  // interface header\n\n#include \"physics/share/physics_constants.hpp\"  // constants in eamxx/src (eamxx/src is in compiler path)\n#include \"pompei.hpp\"                           // emission rate\n#include \"share/field/field_utils.hpp\"  // field utilities\n\nnamespace scream {\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#constructor-complete-section-on-next-slide","title":"Constructor (complete section on next slide)","text":"<p>First section of code we see in the template</p> <p>Instantiates an <code>AtmosphereProcess</code></p> <p>Note that <code>params.get&lt;T&gt;(\"name\")</code> only supports <code>T=int,\u00a0bool,\u00a0double,\u00a0std::string, std::vector</code></p> <pre><code>/*-----------------------------------------------------------------------------------------------\n * The Constructor for this interface\n *\n * Inputs:\n *     comm - an EKAT communication group\n *     params - a parameter list of options for the process.\n */\n\nPOMPEI::POMPEI(const ekat::Comm &amp;comm, const ekat::ParameterList &amp;params)\n    : AtmosphereProcess(comm, params) {\n  // The 'params' variable will hold all runtime options.\n  // Note that `params.get&lt;X&gt;(\"Y\") is the syntax to get the parameter labeled\n  // \"Y\" from the list which is of type X.\n  //\n  // ex:\n  // m_Y = params.get&lt;X&gt;(\"Y\");\n\n  m_eruption_start =\n      util::str_to_time_stamp(params.get&lt;std::string&gt;(\"eruption_date\"));\n}\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#set_grids","title":"<code>set_grids</code>","text":"<ul> <li>EAMxx stores grid info</li> <li>FieldManager stores fields</li> <li>fields have:</li> <li>Pointers to actual data</li> <li>Units</li> <li>Data layout</li> <li>Grid</li> <li><code>add_field</code>/<code>add_tracer</code> calls</li> </ul> <pre><code>/*-----------------------------------------------------------------------------------------------\n * set_grids(grids_manager)\n *\n * set_grids establishes which grid this process will be run on.\n * It is also where all fields (variables) that the process will need access to.\n *\n * Inputs:\n *     grids_manager - a grids manager object which stores all grids used in\n * this simulation\n */\nvoid POMPEI::set_grids(\n    const std::shared_ptr&lt;const GridsManager&gt; grids_manager) {\n  // Some typical namespaces used in set_grids,\n  //   using namespace ShortFieldTagsNames;\n  //   using PC = scream::physics::Constants&lt;Real&gt;;\n\n  // Specify which grid this process will act upon, typical options are\n  // \"dynamics\" or \"physics\". auto m_grid = grids_manager-&gt;get_grid(\"physics\");\n\n  // When declaring a field for use we need:\n  //\n  // to set the units.  These can be found from ekat::units::Units\n  // For example,\n  //   constexpr auto nondim = ekat::units::Units::nondimensional();\n  //\n  // to set the layout, which is how the field is configured in space\n  // For example,\n  //   const auto layout = m_grid-&gt;get_3d_scalar_layout(true);\n\n  // We can now add all fields used by this process and designate how they will\n  // be used, The format for declaring a field is:\n  //   add_field&lt;MODE&gt;(NAME,LAYOUT,UNITS,GRID_NAME);\n  // where,\n  //   MODE is either \"Required\", \"Computed\" or \"Updated\".\n  //     \"Required\" = input only  (process cannot change this field)\n  //     \"Computed\" = output only (field doesn't have to exist, process will set\n  //     values for this field) \"Updated\"  = input and output (process is able\n  //     to update field which should already exist)\n  //   NAME is the name of the field as a string\n  //   LAYOUT is the physical layout of the field on the grid, e.g. 2D, 3D.  See\n  //   layout example above. UNITS are the units of the field, see units example\n  //   above GRID_NAME is the name of the grid this process is run on, typically\n  //   \"m_grid-&gt;name()\"\n  //\n  //   *Note, there is a special add_field call for tracers which has a\n  //   different signature.  The format is,\n  //     add_tracer&lt;MODE&gt;(NAME,GRID,UNITS)\n  //   where,\n  //     NAME and UNITS are as above\n  //     GRID is the actual grid, typically \"m_grid\"\n\n  m_grid  = grids_manager-&gt;get_grid(\"physics\");\n  m_ncols = m_grid-&gt;get_num_local_dofs();\n  m_nlevs = m_grid-&gt;get_num_vertical_levels();\n\n  constexpr auto Pa = ekat::units::Pa;\n  constexpr auto kg = ekat::units::kg;\n  constexpr auto m  = ekat::units::m;\n\n  const auto layout_3d = m_grid-&gt;get_3d_scalar_layout(true);\n  const auto layout_2d = m_grid-&gt;get_2d_scalar_layout();\n\n  // we need dp to scale layer content --&gt; strictly input (Required)\n  add_field&lt;Required&gt;(\"pseudo_density\", layout_3d, Pa, m_grid-&gt;name());\n\n  // we are declaring a tracer to be advected (will be init'ed to zero later, so\n  // Updated) but note add_tracer\n  add_tracer&lt;Updated&gt;(\"ash\", m_grid, kg / kg);\n\n  // we are interested in creating a \"diagnostic\" (in the context of this\n  // process) ash_column (a la LWP) hence, Computed\n  add_field&lt;Computed&gt;(\"ash_column\", layout_2d, kg / (m * m), m_grid-&gt;name());\n}\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#initialize_impl-complete-section-on-next-slide","title":"<code>initialize_impl</code> (complete section on next slide)","text":"<p>Before simulation begins and happens only once</p> <ul> <li>Let's create a mask to control where ash is injected into the system</li> <li>By far the most \"Kokkos\" you will do all day!!!</li> <li>Create a mask for the injection region</li> <li>Use Kokkos to parallelize the loop</li> </ul> <pre><code>/*-----------------------------------------------------------------------------------------------\n * intialize_impl(run_type)\n *\n * called once for each process at initialization of EAMxx.  This impl can be\n * defined with any actions or functions that are needed at initialization.\n *\n * Inputs:\n *     run_type - an enum which describes the run type.  initial or restart\n *\n * can also be empty\n */\nvoid POMPEI::initialize_impl(const RunType /* run_type */) {\n  // NOTE: run_type tells us if this is an initial or restarted run,\n  // NOTE: run_type tells us if this is an initial or restarted run,\n  // Some universal constants that we will need\n  using PC               = scream::physics::Constants&lt;Real&gt;;\n  constexpr Real deg2rad = PC::Pi / 180;\n  constexpr Real r_earth = PC::r_earth;\n\n  // We can create our helper \"mask\" field. It will be 1 where the volcano\n  // injection in the atmosphere happens, and 0 elsewhere.\n  const std::string mask_name = \"emission_mask\";\n  constexpr auto nondim       = ekat::units::Units::nondimensional();\n  const auto layout_3d        = m_grid-&gt;get_3d_scalar_layout(true);\n  FieldIdentifier rate_fid(mask_name, layout_3d, nondim, m_grid-&gt;name());\n  m_emission_mask = Field(rate_fid);\n  m_emission_mask.allocate_view();\n  m_emission_mask.deep_copy(0);  // 0 means \"not injecting here\"\n\n  // The grid already stores lat/lon, so go ahead and pre-compute the mask field\n  auto lat =\n      m_grid-&gt;get_geometry_data(\"lat\");  // WATCH OUT: it's in degrees, NOT rad\n  auto lon =\n      m_grid-&gt;get_geometry_data(\"lon\");  // WATCH OUT: it's in degrees, NOT rad\n\n  // Target location of volcanic eruption\n  auto volcano_lat  = 40.8214 * deg2rad;\n  auto volcano_lon  = 14.4260 * deg2rad;\n  auto emission_lev = 27;\n  auto radius       = m_params.get&lt;double&gt;(\"plume_radius_in_km\");\n  EKAT_REQUIRE_MSG(\n      radius &gt; 0,\n      \"Error! Plume radius must be positive. Input value: \" &lt;&lt; radius &lt;&lt; \".\\n\");\n\n  // Extract Kokkos (device) views from the fields\n  // NOTE: views are \"just\" multi-dimensional arrays, which are accessible on\n  // device\n  auto emission_view = m_emission_mask.get_view&lt;Real **&gt;();\n  auto lat_view      = lat.get_view&lt;const Real *&gt;();\n  auto lon_view      = lon.get_view&lt;const Real *&gt;();\n\n  // -------------------------------------------------------------------------------------------\n  // // We define a lambda function for computing the mask that we can then use\n  // with Kokkos. A lambda is just a function defined \"on-the fly\".\n  // KOKKOS_LAMBDA simply adds some decoration for GPU execution, nothing to\n  // worry about for now\n  auto compute_mask = KOKKOS_LAMBDA(const int icol) {\n    auto lat_rad   = lat_view(icol) * deg2rad;\n    auto lon_rad   = lon_view(icol) * deg2rad;\n    auto delta_lat = lat_rad - volcano_lat;\n    auto delta_lon = lon_rad - volcano_lon;\n\n    auto dist =\n        r_earth / 1e3 * sqrt(delta_lat * delta_lat + delta_lon * delta_lon);\n\n    // If the distance between this point and the center of the volcano is\n    // within the radius set the MASK value to 1 (true).\n    if(dist &lt; radius) {\n      emission_view(icol, emission_lev) =\n          1;  // this is the actual calculation!!!!\n    }\n  };\n\n  // A policy tells kokkos how to parallelize the loop. Here, we are doing\n  // a single for loop over the range of indices [0,ncols)\n  auto policy =\n      Kokkos::RangePolicy&lt;Field::device_t::execution_space&gt;(0, m_ncols);\n\n  // Execute the lambda in parallel according to the execution policy\n  Kokkos::parallel_for(\"compute_ash_mask\", policy, compute_mask);\n}\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#run_impl-complete-section-on-next-slide","title":"<code>run_impl</code> (complete section on next slide)","text":"<p>where the volcano does its thing</p> <ul> <li>Let's use the emission function we defined in <code>pompei.cpp</code></li> <li>Note the use of built-in \"field\" functions to simplify this code</li> </ul> <pre><code>/*-----------------------------------------------------------------------------------------------\n * run_impl(dt)\n *\n * The main run call for the process.  This is where most of the interface to\n * the underlying process takes place.  This impl is called every timestep.\n *\n * Inputs:\n *     dt - the timestep for this run step.\n */\nvoid POMPEI::run_impl(const double dt) {\n  // Typically here the developer would retrieve data from fields,\n  // For example,\n  //   const auto X = get_input_field(NAME_X);\n  //   const auto Y = get_output_field(NAME_Y);\n\n  // Another typical step is to issue a call to the underlying process code.\n  using PC = scream::physics::Constants&lt;Real&gt;;\n  auto g   = PC::gravit;\n\n  auto t    = end_of_step_ts();\n  auto rate = pompei::ash_emission_rate(t.days_from(m_eruption_start));\n  auto mass = dt * rate;\n\n  auto qash     = get_field_out(\"ash\");\n  auto qash_col = get_field_out(\"ash_column\");\n  auto rho      = get_field_in(\"pseudo_density\");\n\n  qash.scale(rho);\n  qash.scale(1 / g);\n  qash.update(m_emission_mask, mass, 1.0);\n  qash.scale_inv(rho);\n  qash.scale(g);\n\n  vert_contraction&lt;Real&gt;(qash_col, qash, rho);\n}\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#finalize_impl-complete-section-on-next-slide","title":"<code>finalize_impl</code> (complete section on next slide)","text":"<p>anything we need to clean up</p> <ul> <li>Typically empty</li> <li>For demonstration purposes, one can print a statement to the e3sm log</li> </ul> <pre><code>/*-----------------------------------------------------------------------------------------------\n * finalize_impl()\n *\n * Called at the end of the simulation, handles all finalization of the process.\n *\n * In most cases this is left blank, as EAMxx takes care of most finalization\n * steps. But just in case a process has specific needs the option is available.\n */\nvoid POMPEI::finalize_impl() {\n  // Usually blank\n}\n/*-----------------------------------------------------------------------------------------------*/\n\n}  // namespace scream\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#hooking-everything-up","title":"Hooking everything up","text":"<ul> <li>We have the code, now we need to make sure the compiler sees it.</li> <li> <p>We will need to create a CMakeLists.txt file for pompei.</p> </li> <li> <p>In the pompei folder create a new file: CMakeLists.txt</p> </li> </ul> <pre><code># List cpp sources to be compiled\n# In this case we have the pompei model code in pompei.cpp\n# and the interface code between pompei and eamxx.\nset(POMPEI_SRCS\n  eamxx_pompei_process_interface.cpp\n  pompei.cpp\n)\n\n# Create a library of the pompei code.\nset(POMPEI_LIBS \"pompei\")\nadd_library(pompei ${POMPEI_SRCS})\ntarget_compile_definitions(pompei PUBLIC EAMXX_HAS_POMPEI)\ntarget_link_libraries(pompei physics_share scream_share)\n\n# Add this library to eamxx_physics\ntarget_link_libraries(eamxx_physics INTERFACE pompei)\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#adding-pompei-to-parent-cmakeliststxt","title":"Adding pompei to parent CMakeLists.txt","text":"<p>Need to make CMake aware of our new file: Open ../CMakeLists.txt and add the following:</p> <pre><code>add_subdirectory(pompei)\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#register-pompei-with-the-physics-factory","title":"Register pompei with the physics factory","text":"<p>To <code>components/src/physics/register_physics.hpp</code>, add:</p> <pre><code>#ifndef EAMXX_HAS_POMPEI\n#include \"eamxx/pompei/eamxx_pompei_process_interface.hpp\"\n#endif\n\n// later in the file\n\n#ifndef EAMXX_HAS_POMPEI\n  proc_factory.register_product(\"pompei\", &amp;create_atmosphere_process&lt;POMPEI&gt;);\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#link-pompei-via-mct-coupling-layer","title":"Link pompei via MCT coupling layer","text":"<p>in <code>components/eamxx/src/mct_coupling/CMakeLists.txt</code> add:</p> <pre><code>set (SCREAM_LIBS\n# later\n  pompei\n)\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#add-pompei-to-the-namelist","title":"Add pompei to the namelist","text":"<p>In <code>components/eamxx/cime_config/namelist_defaults_scream.xml</code>, add:</p> <pre><code>    &lt;!-- Pompei --&gt;\n    &lt;pompei inherit=\"atm_proc_base\"&gt;\n      &lt;eruption_date type=\"string\" doc=\"Start date/time in YYYY-MM-DD-SSSSS format for the eruption\"&gt;${RUN_REFDATE}-${RUN_REFTOD}&lt;/eruption_date&gt;\n      &lt;plume_radius_in_km type=\"real\" doc=\"Radius of eruption plume, in km\" constraints=\"gt 0; le 100000\"&gt;100&lt;/plume_radius_in_km&gt;\n    &lt;/pompei&gt;\n    &lt;!-- later... --&gt;\n    &lt;initial_conditions&gt;\n    &lt;!-- ... --&gt;\n    &lt;!-- Ash initial condition to 0.0 --&gt;\n    &lt;ash               &gt;0.0&lt;/ash&gt;\n</code></pre>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#ready-to-launch","title":"Ready to launch","text":"<ul> <li>Just need to update our submission to run with pompei turned on.</li> <li>Remember the atmchange commands we discussed in part 1.</li> <li>Go back to the runscript we used and search for atmchange.  You\u2019ll see a block of  commented out code which will turn pompei on.  Uncomment this and rerun the script.</li> <li>Note, you may need to change the case name or delete the old case to get this going.</li> </ul>"},{"location":"EAMxx/_presentations_srcs/eamxx-tutorial-2025-part2/#the-runtime-parameters-in-the-run-script","title":"The runtime parameters in the run script","text":"<pre><code># increase SCREAM_NUM_TRACERS from 10 to 11 (note that scream supports both 128 and 72 levels for low-res)\n./xmlchange SCREAM_CMAKE_OPTIONS=\"SCREAM_NP 4 SCREAM_NUM_VERTICAL_LEV 128 SCREAM_NUM_TRACERS 11\"\n\n# add pompei to the list of aerosol processes\n./atmchange mac_aero_mic::atm_procs_list+=pompei\n# if you want to change the eruption date, you can do so with the following command\n./atmchange atmosphere_processes::physics::mac_aero_mic::pompei::eruption_date=\"0001-01-02-00000\"\n# if you want to change the eruption radius, you can do so with the following command\n./atmchange atmosphere_processes::physics::mac_aero_mic::pompei::plume_radius_in_km=1000.0\n</code></pre>"},{"location":"EAMxx/developer/TPLs/","title":"Third-party Libraries Required by EAMxx","text":"<ul> <li>First, we note that if you are running EAMxx on a supported machine, then you can expect that the third-party libraries (TPLs) are installed, properly configured, and recognized by the EAMxx build system.</li> <li>However, if you choose to run and/or develop EAMxx on a local machine, workstation, or unsupported cluster, then you will likely need to build some number of the TPLs manually.<ul> <li>Note: The exception to this is if you are running on a machine with   a module system that already provides them--e.g., research institutions   that run E3SM regularly.</li> </ul> </li> </ul>"},{"location":"EAMxx/developer/TPLs/#list-of-tpls","title":"List of TPLs","text":"<ul> <li>Note: For this section, we will assume you plan to build EAMxx on a fresh Linux<sup>1</sup> system with the standard development tools available.<ul> <li>E.g., a package manager (<code>apt</code>, <code>yum</code>), <code>git</code>, <code>make</code>, <code>cmake</code>, etc.</li> </ul> </li> </ul> TPLs You Will (almost certainly) Need to Install or Build Manually <ul> <li>OpenMPI<ul> <li>Only required for builds employing multi-node parallelism.</li> <li>Required for parallel configurations of the netCDF libraries.</li> <li>Likely to be provided by your package manager or module system.</li> </ul> </li> <li>HDF5<ul> <li>High-performance data-wrangling library.</li> <li>The link above provides <code>.deb</code> and <code>.rpm</code> binary packages, though the page also provides a link to build from source.</li> </ul> </li> <li>netCDF-C<ul> <li>Used for I/O of simulation data in a format containing descriptive metadata.</li> </ul> </li> <li>netCDF-fortran</li> <li>PnetCDF<ul> <li>Only required for builds employing multi-node parallelism.</li> </ul> </li> </ul> <p>Build Tips</p> <ul> <li>As of 2024, the author found much less resistance configuring the build for the netCDF libraries using Autoconf, rather than CMake.</li> </ul> Auxiliary TPLs Your System May Already Have Installed <p>The following list of TPLs may be pre-installed on some systems, and are   helpful, if not required, for building the netCDF libraries.   However, in the author's experience they did need to be built on a fresh   installation of Red Hat Enterprise Linux 8.</p> <p>Required</p> <ul> <li>LAPACK or BLAS<ul> <li>Alternatively, OpenBLAS, which is unlikely to be pre-installed.</li> </ul> </li> </ul> <p>Likely Required</p> <ul> <li>Autoconf</li> <li>Libtool</li> </ul> <p>Maybe Required<sup>2</sup></p> <ul> <li>help2man</li> </ul>"},{"location":"EAMxx/developer/TPLs/#help-hints","title":"Help &amp; Hints","text":"<p>Building third-party libraries can be a pain. To help here are some reasonable example scripts to start from that should help getting the TPLs You Will Need to Build compiled and working.</p> Basic Configuration Script Examples <p>Disclaimer</p> <p>We provide these scripts as demonstrative examples, only. They will almost certainly not build your libraries successfully if they are copy/paste-ed as they appear here. That being said, every hardware/software environment is different and will display different and sometimes strange behaviors. So, the best advice we can provide is to begin with something resembling what is below and respond to the compiler messages by modifying: environment variables, <code>PATH</code> or <code>[LD_]LIBRARY_PATH</code> entries, configuration arguments, and compiler arguments as required. As long as you do all of that perfectly, you should be just fine. </p> <ol> <li> <p>We only support build instructions for Linux, though some individuals have previously built EAMxx on MacOS with success. We would not recommend using EAMxx on Windows, other than via WSL. However, if you do end up building and running on MacOS or Windows, please let the developers know or submit a PR!\u00a0\u21a9</p> </li> <li> <p>Computers are weird. While it's by no means required from a functionality standpoint, a recently-configured RHEL8 system seemed to be convinced it needed help2man for some reason.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/TPLs/#assumptions","title":"Assumptions","text":"<ul> <li>Source code is downloaded to a directory we assign to the variable <code>${TPL_ROOT}</code>.</li> <li>We build the libraries in a separate build and install directory in the root directory of the source code.<ul> <li>E.g., <code>${TPL_ROOT}/&lt;lib-name&gt;/{build/,install/}</code></li> <li>The bash scripts below are placed in the <code>build/</code> directory.<ul> <li>Hence, note that when executing the configure script from the <code>build/</code> directory, the final <code>../configure [...]</code> command in the script (that calls autoconf) is running the <code>configure</code> command in the source directory for that TPL--e.g., <code>${TPL_ROOT}/&lt;lib-name&gt;/</code></li> </ul> </li> </ul> </li> <li><code>libtool</code> is installed and on your <code>PATH</code>.<ul> <li>I.e., <code>which libtool</code> returns the location of the executable.</li> </ul> </li> </ul> <code>configure-hdf5.sh</code> <pre><code>#!/bin/bash\n\n# add MPI C/C++ compilers to the proper environment variables\nmpi_path=\"${TPL_ROOT}/openmpi/install/bin/\"\nexport CC=\"${mpi_path}/mpicc\"\nexport CXX=\"${mpi_path}/mpicxx\"\n\n# configure HDF5 build\n../configure \\\n  --prefix=${TPL_ROOT}/hdf5/install \\\n  --enable-shared \\\n  --enable-hl \\\n  --enable-parallel \\\n  --with-zlib=/usr/include,/usr/lib\n</code></pre> <code>configure-netcdf-c.sh</code> <pre><code>#!/bin/bash\n\n# add MPI C/C++ to the proper environment variables\nmpi_path=\"${TPL_ROOT}/openmpi/install/bin\"\nexport CC=\"${mpi_path}/mpicc\"\nexport CXX=\"${mpi_path}/mpicxx\"\n\n# historically, netcdf can be a little picky to build, so it can help to\n# make ABSOLUTELY CERTAIN that the build system knows where HDF5 is\n# via the \"sledgehammer\" approach\nhdf5_path=\"${TPL_ROOT}/hdf5/install\"\nexport LD_LIBRARY_PATH=\"${LD_LIBRARY_PATH}:${hdf5_path}/lib\"\nexport LIBRARY_PATH=${LIBRARY_PATH}:${hdf5_path}/lib\nexport PKG_CONFIG_PATH=${PKG_CONFIG_PATH}:${hdf5_path}/lib/pkgconfig\nexport CPPFLAGS=\"-I${hdf5_path}/include\"\n\n../configure --prefix=${TPL_ROOT}/netcdf-c/install\n</code></pre> <code>configure-netcdf-fortran.sh</code> <pre><code>#! /bin/bash\n\n# add MPI Fortran compiler to the proper environment variables\nmpi_path=\"${TPL_ROOT}/openmpi/install/bin\"\nexport FC=\"${mpi_path}/mpif90\"\n\n# local variables, to be used below\nexport NetCDF_C_ROOT=${TPL_ROOT}/netcdf-c/install\nexport NETCDF_C_LIBRARY=${NetCDF_C_ROOT}/lib\nexport NETCDF_C_INCLUDE_DIR=${NetCDF_C_ROOT}/include\n\n# add netcdf-C bits and pieces to the proper paths\nexport LD_LIBRARY_PATH=\"${NETCDF_C_LIBRARY}:${LD_LIBRARY_PATH}\"\nexport LIBRARY_PATH=\"${NETCDF_C_LIBRARY}:${LIBRARY_PATH}\"\nexport PATH=${NetCDF_C_ROOT}/bin:${PATH}\n\n# add netcdf-C include and library dir to the requisite compiler flags\nexport CPPFLAGS=\"-I${NETCDF_C_INCLUDE_DIR}\"\nexport LDFLAGS=\"-L${NETCDF_C_LIBRARY}\"\n\n# while we're at it, tell it where to find hdf5, too\nexport HDF5_ROOT=${TPL_ROOT}/hdf5/install\n\n../configure --prefix=${TPL_ROOT}/netcdf-fortran/install\n</code></pre> <code>configure-pnetcdf.sh</code> <pre><code>#!/bin/bash\n\nmpi_path=\"${TPL_ROOT}/openmpi/install/bin\"\nexport CC=\"${mpi_path}/mpicc\"\nexport CXX=\"${mpi_path}/mpicxx\"\nexport FC=\"${mpi_path}/mpif90\"\n\n../configure \\\n  --prefix=${TPL_ROOT}/pnetcdf/install \\\n  --enable-shared \\\n  MPICC=mpicc \\\n  MPICXX=mpicxx \\\n  MPIF77=mpifort \\\n  MPIF90=mpifort\n</code></pre>"},{"location":"EAMxx/developer/code_structure/","title":"EAMxx Source Code Structure","text":"<p>E3SM/components/eamxx/</p> <pre><code>.\n\u251c\u2500\u2500 cime_config/\n\u251c\u2500\u2500 cmake/\n\u2502   \u2514\u2500\u2500 machine-files/\n\u2502\u2500\u2500 CMakeLists.txt\n\u2502\u2500\u2500 CTestConfig.cmake\n\u251c\u2500\u2500 docs/\n\u251c\u2500\u2500 mkdocs.yml\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 scripts/\n\u2502   \u251c\u2500\u2500 atmchange\n\u2502   \u251c\u2500\u2500 atmquery\n\u2502   \u2514\u2500\u2500 test-all-eamxx\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 control/\n\u2502   \u251c\u2500\u2500 diagnostics/\n\u2502   \u251c\u2500\u2500 dynamics/\n\u2502   \u2502   \u2514\u2500\u2500 homme/\n\u2502   \u251c\u2500\u2500 mct_coupling/\n\u2502   \u251c\u2500\u2500 physics/\n\u2502   \u2502   \u251c\u2500\u2500 cld_fraction/\n\u2502   \u2502   \u251c\u2500\u2500 cosp/\n\u2502   \u2502   \u251c\u2500\u2500 iop_forcing/\n\u2502   \u2502   \u251c\u2500\u2500 mam/\n\u2502   \u2502   \u251c\u2500\u2500 ml_correction/\n\u2502   \u2502   \u251c\u2500\u2500 nudging/\n\u2502   \u2502   \u251c\u2500\u2500 p3/\n\u2502   \u2502   \u251c\u2500\u2500 rrtmgp/\n\u2502   \u2502   \u251c\u2500\u2500 share/\n\u2502   \u2502   \u251c\u2500\u2500 shoc/\n\u2502   \u2502   \u251c\u2500\u2500 spa/\n\u2502   \u2502   \u2514\u2500\u2500 tms/\n\u2502   \u251c\u2500\u2500 python/\n\u2502   \u251c\u2500\u2500 eamxx_config.h.in\n\u2502   \u2514\u2500\u2500 share/\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 generic/\n\u2502   \u251c\u2500\u2500 meta-tests/\n\u2502   \u251c\u2500\u2500 multi-process/\n\u2502   \u2502   \u251c\u2500\u2500 dynamics_physics/\n\u2502   \u2502   \u2514\u2500\u2500 physics_only/\n\u2502   \u251c\u2500\u2500 python/\n\u2502   \u2514\u2500\u2500 single-process/\n\u2514\u2500\u2500 tpls/\n</code></pre> EAMxx Root Directory<code>src/</code> Directory<code>tests/</code> Directory <p>All EAMxx-specific code can be found in <code>components/eamxx</code> within the E3SM repo. Here's how things are organized:</p> <ul> <li><code>cime_config</code>: Tools and XML files for integrating EAMxx with E3SM via the   CIME framework.</li> <li><code>cmake</code>: CMake functions and macros used by the configuration/build system.</li> <li><code>docs</code>: Documentation for the EAMxx project, including design documents,   instructions for building and testing EAMxx, and this document.</li> <li><code>scripts</code>: Miscellaneous scripts that implement workflows for running tests   and analyzing performance.</li> <li><code>src</code>: All C++ source code (and any bridges to Fortran) for EAMxx are stored   here. We describe the contents of this directory in greater detail below.</li> <li><code>tests</code>: Implements standalone, end-to-end tests for various EAMxx   components (RRTMG, HOMME, P3, SHOC, etc).</li> <li><code>tpls</code>: Utilities for building EAMxx-specific third-party libraries.<sup>1</sup></li> </ul> <p>In addition, you'll notice the following files in <code>components/eamxx</code>:</p> <ul> <li><code>CMakeLists.txt</code>: The CMake file that defines EAMxx's configuration/build   system.</li> <li><code>CTestConfig.cmake</code>: This CTest file contains parameters that determine how   our test results are reported to the E3SM CDash Site.</li> <li><code>README.md</code>: EAMxx's top-level README file, which describes the project and   its purpose.</li> <li><code>mkdocs.yml</code>: The configuration file for mkdocs,   the tool we currently use to build and publish our documentation.</li> </ul> <p>Herein lies the source code for EAMxx. Broadly, here's where things are located:</p> <ul> <li><code>control</code>: Contains the atmosphere driver and basic tests for it.</li> <li><code>diagnostics</code>: A collection of simple classes used to compute diagnostic   quantities.</li> <li><code>dynamics</code>: Home the files implementing the necessary interfaces between   EAMxx and the HOMME non-hydrostatic dycore.<ul> <li>Note: HOMME itself is in components/homme</li> </ul> </li> <li><code>mct_coupling</code>: Glue code for embedding EAMxx within E3SM as an atmosphere   component using the MCT coupler.</li> <li><code>physics</code>: Source code for physics-related atmospheric processes, including<ul> <li><code>cosp</code>: Diagnostic-only<sup>2</sup> package used for computing radiation-related quantities.</li> <li><code>iop_forcing</code>: \"Intensive Observation Period\" package that can be used in conjunction with the Doubly-Periodic (DP) configuration of SCREAM.</li> <li><code>mam</code>: Contains the high-performance Modal Aerosol Model, parameterized with 4 size modes known as MAM4xx.</li> <li><code>ml_correction</code>: This is a product developed as a part of a Lawrence Livermore National Laboratory LDRD project in which the goal was to improve the results of low-resolution SCREAM runs by employing machine-learning algorithms to analyze the output of nudged high-resolution runs.<ul> <li>This code is not actively supported but may be useful/or interesting to some.</li> </ul> </li> <li><code>nudging</code>: Contains machinery that can be applied to \"nudge\" quantities in EAMxx toward desired values, typically coming from previous model runs or reanalysis data.<ul> <li>See the Nudging in EAMxx page in the User Guide for further details.</li> </ul> </li> <li><code>p3</code>: The C++/Kokkos implementation of P3 microphysics within EAMxx.</li> <li><code>rrtmgp</code>: A stub for the radiation processes as represented in EAMxx.</li> <li><code>share</code>: Utilities and data structures common to these processes.</li> <li><code>shoc</code>: The C++/Kokkos implementation of SHOC macrophysics within EAMxx.</li> </ul> </li> <li><code>python</code>: Source code for the experimental PyEAMxx package that enables building and running an individual EAMxx atmosphere process using python/conda.<ul> <li>As of time of writing, this feature is still in development and should e considered a prototype.<ul> <li>See the pyEAMxx page in the User Guide for a more detailed description.</li> </ul> </li> </ul> </li> <li><code>share</code>: Utilities used by various components within EAMxx. Of note:<ul> <li><code>io</code>: EAMxx's interface to the SCORPIO library.</li> </ul> </li> </ul> <p>Each of these directories contains a <code>CMakeLists.txt</code> file for defining how EAMxx is configured and built, and a <code>tests/</code> subdirectory that houses relevant unit and verification tests.</p> <p>You'll also see some other files in the <code>src/</code> directory itself, such as</p> <ul> <li><code>eamxx_config.h.in</code>: A template for generating a C++ header file with   EAMxx configuration information.</li> </ul> <ul> <li><code>generic/</code>:</li> <li><code>meta-tests/</code>: </li> <li><code>multi-process/</code>: <ul> <li><code>dynamics_physics/</code>: </li> <li><code>physics_only/</code>: </li> </ul> </li> <li><code>python/</code>: </li> <li><code>single-process/</code>: </li> </ul> <ol> <li> <p>Here there be dragons... These are some of the more arcane EAMxx features that even the bravest of developers may never lay eyes on.\u00a0\u21a9</p> </li> <li> <p>Diagnostic: Refers to quantities or variables that are not inputs to any part of the model but capture useful descriptive data.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/dev_quickstart/","title":"Quick-start Guide for Developers","text":""},{"location":"EAMxx/developer/dev_quickstart/#motivation","title":"Motivation","text":"<p>The intention of this guide is to provide a new developer with the most straightforward path toward productively building, running, and testing EAMxx. Specifically, we will discuss building and testing in the EAMxx \"standalone\" configuration using the <code>test-all-eamxx</code> workflow. Note that tests related to running the full E3SM model are discussed in Full Model Testing.</p>"},{"location":"EAMxx/developer/dev_quickstart/#stratosphere-level-overview","title":"Stratosphere-level Overview","text":"<p>At the most basic level, EAMxx is built and run using CMake, a widely-used tool to \"automatically\"<sup>1</sup> configure, build, and test a project on any arbitrary computing platform. Thus, one can certainly build and test EAMxx with their own customized CMake/CTest setup. However, we would strongly advise against doing this unless you know what you're doing and have good reasons for choosing this option.</p> <p>Instead, we recommend using the EAMxx-designed <code>test-all-eamxx</code> workflow that employs a variety of shell and python scripts to automate the series of tasks common to development. More details on this are provided below in the section on Running EAMxx.</p> <p>A detailed, example-based walk-through of modifying and testing new code may be found in Testing for Development and comprehensive details about the standalone testing tools are located in EAMxx Automated Standalone Testing</p>"},{"location":"EAMxx/developer/dev_quickstart/#note-on-computing-platforms","title":"Note on Computing Platforms","text":"<p>EAMxx is tested and supported on the E3SM-supported machines, as well as a handful of other machines.<sup>2</sup> This means that, if you have an account on one of these machines, EAMxx tests can be run with no extra configuration required. However, many of the standalone EAMxx tests are able to be run on a reasonably-equipped laptop or personal workstation.<sup>3</sup> This second choice requires some extra configurations<sup>4</sup> but the effort required may be worth the potential speedup in development.</p>"},{"location":"EAMxx/developer/dev_quickstart/#lets-get-started-quickly","title":"Let's Get Started (Quickly)","text":"<p>Disclaimer</p> <p>We make use of many code snippets below for demonstrative purposes. As such, we provide no guarantee that any of these are working code, and the author would be quite surprised if more than a couple of them run without edits. If you take the time to debug these examples, feel free to submit a PR with a working version, and we are sure some future developer will appreciate it!</p>"},{"location":"EAMxx/developer/dev_quickstart/#running-eamxx-via-test-all-eamxx","title":"Running EAMxx via <code>test-all-eamxx</code>","text":"<p>The quickest method for a new developer to get EAMxx up and running is to use the automated configure/build/test workflow provided by <code>scripts/test-all-eamxx</code>. This is a good \"smoke test\"<sup>5</sup> to confirm that your development environment is configured properly and that there are no glaring run-time errors preventing successful running and testing.</p> <p>Running via <code>test-all-eamxx</code> requires at minimum 1 to 2 command-line arguments to work correctly and likely more if your goals are more than modest. In the following sections, we present the configurations a new developer is most likely to require.</p>"},{"location":"EAMxx/developer/dev_quickstart/#selected-useful-testing-options","title":"Selected Useful Testing Options","text":"<p>We give an overview of common basic use cases here, and we provide full details on the various capabilities and options of <code>test-all-eamxx</code> in EAMxx Automated Standalone Testing.</p> <p>Note</p> <p>For all discussion of running standalone testing via <code>test-all-eamxx</code>, including the following, we assume the commands are run from the root directory of EAMxx. That is, if one begins in the root E3SM directory, assume that each code snippet begins with an implicit</p> <pre><code>$ eamxx_root=\"&lt;some/file/path&gt;/E3SM/components/eamxx\"\n$ cd \"${eamxx_root}\"\n</code></pre> Configure Only Without Build or Test <p>Useful for: Mid-development testing when debugging compilation, and it may be useful to confirm/debug changes to CMakeLists.txt, file dependencies, TPL availability, etc.</p> <pre><code>$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] --config-only\n</code></pre> Parallel Build and Test Execution <p>Note:</p> <ul> <li>This is unnecessary when running on supported machines because efficient defaults are already set within <code>test-all-eamxx</code>.</li> <li>If you are testing locally or on an otherwise unsupported machine, it is recommended to set these values manually.<ul> <li>The reason for this is that the default value for each case is <code>0</code>, which should theoretically choose the optimal number of threads on modern systems, but there is no guarantee this will behave as expected or that it will not bog down your system.</li> </ul> </li> </ul> <pre><code>$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    # if running multiple test configurations, this will launch those build\n    # stacks in parallel \\\n    --parallel \\\n    # will compile using M threads (equivalent to a manual 'make -jM') \\\n    --make-parallel-level &lt;M&gt; \\\n    # will run tests of the same configuration using N threads \\\n    --ctest-parallel-level &lt;N&gt; \\\n</code></pre> Only Run Requested Test Cases <p>As a first step, you are likely to only be concerned with testing your specific modifications, so there is no need to run the full suite of EAMxx tests. So, we may restrict the tests that will be run by using an appropriate regular expression (\"regex\").<sup>6</sup></p> <pre><code># This example regex will match the exact substring \"ash_injection\".\n# That is, it will match \"ash_injection_validate_test\",\n# \"test_suite_ash_injection\", and \"test_ash_injection_quick\" but not\n# \"ash_in_jection_test\" or \"ash_injector_test\".\n\n$ test_choice=\"[^\\s]*ash_injection[^\\s]*\"\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    --limit-test-regex \"${test_choice}\"\n</code></pre> Baseline Tests <p>Baseline tests compare the current state of the code to some \"baseline\" value to ensure that the modifications do not negatively impact the current solutions provided by the model. An example of this, provided below, is focused on testing the code with our new Ash-Injection-related modifications as compared to the code before we started working.</p> <p>Note, however, that any new Ash-Injection-specific tests or tests involving processes that interact with Ash-Injection may give different answers for perfectly good reasons. Regardless, we would like to establish that our modifications do not cause any unexpected interactions, so all remaining baseline tests should pass.</p> <pre><code># For simplicity, we'll assume we begin at the most up-to-date\n# commit on origin/master\n$ cd \"${eamxx_root}\"\n$ git checkout master\n$ export bl_loc=\"${HOME}/eamxx-baselines\"\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    # set the location where we will save the baseline files we are about\n    # to generate \\\n    --baseline-dir \"${bl_loc}\" \\\n    # this flag indicates we will generate new baselines \\\n    --generate\n[\"one eternity later...\"]\n# create a new branch to develop from\n$ git checkout -b jane_dev/eamxx/ash_injection_proc\n[\"write all the code...\"]\n# Note: the presence of the '--baseline-dir' flag indicates we will\n# compare test results to the latest baselines found in that directory\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    # set the location where we saved the previous baselines \\\n    --baseline-dir \"${bl_loc}\"\n[\"mam4_ash_injection_standalone test fails... no baseline! (so do the others)\"]\n[\"homme_standalone test passes! (so do other non-associated tests)\"]\n</code></pre> \"Quick-rerunning\" Tests <p>Rebuilding EAMxx can take quite some time, so <code>test-all-eamxx</code> has a couple of options to rerun tests quickly and avoid configure or build costs.</p> <p><code>--quick-rerun</code></p> <ul> <li>Useful for: rerunning when there's no need to reconfigure.<ul> <li>No edits made to any <code>CMakeLists.txt</code> files.</li> <li>No relevant files renamed or moved to a different directory.</li> <li>You plan to re-run tests that did not necessarily fail on the   previous run.</li> </ul> </li> </ul> <pre><code>$ test_choice=\"[^\\s]*ash_injection[^\\s]*\"\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    --limit-test-regex \"${test_choice}\"\n[\"tests run...\"]\n[\"modify ash_injection_test.cpp...\"]\n# no need to reconfigure--let's be quick!\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    --quick-rerun\n</code></pre> <p><code>--quick-rerun-failed</code></p> <ul> <li>Useful for: rerunning only failed tests when there's no need to   reconfigure or, potentially, no need to rebuild.<ul> <li>No edits made to any <code>CMakeLists.txt</code> files.</li> <li>No relevant files renamed or moved to a different directory.</li> <li>In contrast to above, you only wish to rerun tests that failed the   previous run.</li> </ul> </li> </ul> <pre><code># run all of the eamxx tests\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args]\n[\"tests run...\"]\n[\"ash_injection-related tests fail... so much output, though :(\"]\n# no need to reconfigure or rebuild--rerun to make the output easier to parse.\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    --quick-rerun\n</code></pre> Efficiently Building for Multiple Architectures <p>The default build directory employed by <code>test-all-eamxx</code> is <code>${eamxx_root}/ctest-build/&lt;test-configuration&gt;</code>, where <code>test-configuration</code> can be <code>full_debug</code>, <code>release</code>, etc. The implication of this is that if we are testing for both CPU and GPU on the same machine, the default configuration will result in a GPU build overwriting the previous CPU build, or vice-versa. This will result in long build times and make testing on both architectures inefficient.</p> <p>For this reason, it is recommended to use the <code>--work-dir</code> flag to set separate build directories for each architecture.</p> <pre><code># we are on a machine with lots of cpu cores, so we will be extra clever\n# and run simultaneously by using only a portion of cores for each build\n\n$ echo ${total_cores}\n100\n\n$ build_loc_cpu=\"ctest-cpu-build\"\n$ build_threads_cpu=20\n$ test_threads_cpu=20\n$ build_loc_gpu=\"ctest-gpu-build\"\n$ build_threads_gpu=40\n\n# Launch the cpu build/test\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    --work-dir \"${build_loc_cpu}\" \\\n    --make-parallel-level \"${build_threads_cpu}\" \\\n    --ctest-parallel-level \"${test_threads_cpu}\"\n\n# launch the gpu build/test\n$ ./scripts/test-all-eamxx &lt;required-args&gt; [optional-args] \\\n    --work-dir \"${build_loc_gpu}\" \\\n    --make-parallel-level \"${build_threads_gpu}\"\n</code></pre>"},{"location":"EAMxx/developer/dev_quickstart/#testing-on-supported-machines","title":"Testing on Supported Machines","text":"<p>When testing on a supported E3SM machine, the only configuration required is to set the proper \"machine ID\" flag that indicates the machine name and potentially the desired device to run with (CPU, GPU). This is because <code>test-all-eamxx</code> configures the run according to a \"machine file\" that sets an environment known to build and test successfully and efficiently<sup>7</sup>.</p> Example: Running on Perlmutter <pre><code># run tests on cpu\n[\"start interactive session on cpu node (see below)...\"]\n$ ./scripts/test-all-eamxx --machine pm-cpu\n[\"test runs...\"]\n[\"logout from cpu node...\"]\n[\"start interactive session on gpu node...\"]\n$ ./scripts/test-all-eamxx --machine pm-gpu\n</code></pre> <code>test-all-eamxx</code> must be run on a <code>compute</code> node <p>The <code>test-all-eamxx</code> script assumes it is being run on a compute node (i.e., not the <code>login</code> or <code>head</code> node).</p> <p>This can be handled most easily by launching the job manually from an interactive session.<sup>8</sup></p> <p>To illustrate, if the platform's batch scheduler is <code>slurm</code>, we could do</p> <pre><code>$ salloc --nodes 1 --qos interactive --time 02:00:00 [...]\n&lt;response indicating interactive node name&gt;\n$ ssh &lt;node-id&gt;\n$ ./scripts/test-all-eamxx --machine &lt;machine-id&gt;\n</code></pre>"},{"location":"EAMxx/developer/dev_quickstart/#testing-locally","title":"Testing Locally","text":"<p>Running EAMxx on your local workstation, laptop, or less-trafficked cluster machine can potentially make your development quicker and less complicated. However, following the No Free Lunches principle, there is some fiddly setup involved in making your life easier.</p> <p>Testing on a local, or otherwise unknown, machine requires the <code>--local</code> (or <code>-l</code>) flag and correctly-configured files in the <code>~/.cime/</code> directory. For a full explanation of how to configure your own machine, see the pages on Local Configuration Files and Third-party Libraries, but we will briefly summarize here.</p> Example <code>scream_mach_specs.py</code> Configuration File <p>The <code>test-all-eamxx</code> workflow expects to find a file called <code>scream_mach_specs.py</code> in the directory <code>~/.cime/</code>. This file is imported using the utility function <code>get_all_machines()</code> located in <code>scripts/machine_specs.py</code>, and it is used to setup the required build environment for your machine. </p> <p>Your local <code>scream_mach_specs.py</code> configuration file must be a valid python module that defines a <code>Local</code> specialization of the <code>Machine</code> class, that is defined in <code>machine_specs.py</code>. The parent <code>Machine</code> class definition is included below, and we also provide a bare-bones example of a local <code>scream_mach_specs.py</code> defining the <code>Local</code> version of the <code>Machine</code> class.</p> <p>Your local <code>scream_mach_specs.py</code> configuration file should specify such things as:</p> <ul> <li>Compiler paths and/or binary name</li> <li>The number of resources (CPU threads) to be used for building or running<ul> <li><code>num_bld_res</code> and <code>num_run_res</code></li> </ul> </li> <li>Baselines directory location</li> <li>Commands required to setup the build environment<ul> <li>E.g., the paths to the requisite third-party libraries (TPLs).</li> </ul> </li> <li>GPU architecture</li> <li>Etc.</li> </ul> <p>We recommend setting as many of the class variables as you can, because (mostly) more information is better than less.</p> ${eamxx_root}/scripts/machine_specs.py:[L58-L88]<pre><code>###############################################################################\nclass Machine(object):\n###############################################################################\n    \"\"\"\n    Parent class for objects describing a machine to use for EAMxx\n    standalone testing.\n    \"\"\"\n    concrete = False\n    name = \"\"\n    mach_file = \"\"\n    env_setup = []\n    gpu_arch = \"none\"\n    num_bld_res = -1\n    num_run_res = -1\n    batch = \"\"\n    cxx_compiler = \"mpicxx\"\n    c_compiler   = \"mpicc\"\n    ftn_compiler = \"mpifort\"\n    baselines_dir = \"\"\n\n    @classmethod\n    def setup_base(cls,name,num_bld_res=-1,num_run_res=-1):\n        cls.name = name\n        cls.mach_file = pathlib.Path(EAMXX_DIR) / \"cmake\" /\n                        \"machine-files\" / (cls.name + \".cmake\")\n        cls.num_bld_res = num_bld_res if num_bld_res &gt; 0 else get_available_cpu_count()\n        cls.num_run_res = num_run_res if num_run_res &gt; 0 else get_available_cpu_count()\n\n    @classmethod\n    def uses_gpu (cls):\n        return cls.gpu_arch!=\"none\"\n\n###############################################################################\n</code></pre> ~/.cime/scream_mach_specs.py<pre><code>from machines_specs import Machine\n\n###############################################################################\nclass Local(Machine):\n###############################################################################\n    concrete = True\n    @classmethod\n    def setup(cls):\n        # NOTE: do not change this line because `test-all-eamxx -l`\n        # specifically looks for a machine named \"local\".\n        super().setup_base(\"local\")\n\n        # NOTE: these are run by the shell (likely bash), so must have\n        #       shell syntax, and can use shell environment variables\n        #       (e.g, $HOME or ~)\n        cls.env_setup = [\n                         # source my personal .bashrc \n                         \". ~/.bashrc\",\n                         # source a custom script to setup my eamxx\n                         # environment\n                         \"source ${HOME}/.cime/eamxx-setup.sh\"\n                         ]\n\n        # define the python-variable home directory for use below\n        home_dir = \"/home/arthur_dent\"\n\n        # NOTE: the syntax used in the python strings below is called\n        #       \"formatted string literals\" or more commonly \"f-strings\"\n\n        # provide the path to my baselines directory\n        cls.baselines_dir = f\"{home_dir}/eamxx-baselines\"\n\n        # provide the path to a custom cmake file, used to pass build\n        # variables directly to cmake\n        cls.mach_file = f\"{home_dir}/.cime/eamxx_mach_file.cmake\"\n\n        # set a couple of environment variables that are used in the\n        # setup script and/or eamxx_mach_file.cmake\n        # path to directory containing personally-built libraries\n        tpl_path = f\"{home_dir}/TPLs\"\n        # path to personally-built openmpi compilers\n        mpi_bindir = f\"{tpl_path}/openmpi-4.1.2/install/bin\"\n\n        # specific paths to \n        cls.cxx_compiler = f\"{mpi_bindir}/mpicxx\"\n        cls.c_compiler = f\"{mpi_bindir}/mpicc\"\n        cls.ftn_compiler = f\"{mpi_bindir}/mpifort\"\n\n###############################################################################\n</code></pre> <ol> <li> <p>In reality, significant effort is involved in designing a project to build \"automagically,\" but the idea is to take that process out of the user's hands.\u00a0\u21a9</p> </li> <li> <p>If you're feeling brave and want to read some python, you can find details about supported machines and their configurations in machine_specs.py in the <code>scripts/</code> directory. Or, for general machine files for E3SM, you can take a look at <code>E3SM/cime_config/machines/</code> \u21a9</p> </li> <li> <p>Mac computers with an Apple silicon CPU (e.g., M1, M2...) are not officially supported and present challenges related to handling floating-point exceptions. However, some have had success building on this architecture, and if you achieve a robust build configuration for Mac please reach out to the development team!\u00a0\u21a9</p> </li> <li> <p>In particular, it is likely you will need to manually build/install the required Third-party libraries.\u00a0\u21a9</p> </li> <li> <p>Smoke Test is a term used by software developers to describe a type of test that initially indicates whether something is working properly--as in, \"flip the switch and see if anything starts smoking.\"  \u21a9</p> </li> <li> <p>For those that are not regex ninjas (yet), there are useful tools only to construct or decode regex strings--e.g., RegExr.\u00a0\u21a9</p> </li> <li> <p>If you discover that a supported machine does not successfully build and test, please file an Issue with the tag Machine Files. Also, no promises the standard configuration is perfectly efficient.\u00a0\u21a9</p> </li> <li> <p>While probably not time-efficient, there is no reason <code>test-all-eamxx</code> cannot also be run by submitting to the batch scheduler. If this is your goal, the exercise is left to the reader.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/field/","title":"Field","text":"<p>In EAMxx, a <code>Field</code> is a data structure holding two things: pointers to the data and pointers to metadata. Both the data and metadata are stored in <code>std::shared_ptr</code> instances, to ensure consistency across all copies of the field. This allows for fast shallow copy semantic for this class.</p> <p>The data is stored on both CPU and device memory (these may be the same, depending on the Kokkos backend). In EAMxx, we always assume and guarantee that the device data is up to date. That implies that the data must be explicitly synced to host before using it on host, and explicitly synced to device after host manipulation, in order to ensure correctness. In order to access the data, users must use the <code>get_view</code>/ <code>get_strided_view</code> methods, which takes two template arguments: the data type, and an enum specifying whether CPU or device data is needed. The data type is used to reinterpret the generic pointer stored inside to a view of the correct scalar type and layout. It is a possibly const-qualified type, and if the field was marked as \"read-only\", the method ensures that the provided data type is const. A read-only field can be created via the <code>getConst</code> method, which returns a shallow copy of the field, but marked as read-only. The enum specifying host or device data is optional, with device being the default.</p> <p>The metadata is a collection of information on the field, such as name, layout, units, allocation size, and more. Part of the metadata is immutable after creation (e.g., name, units, or layout), while some metadata can be partially or completely modified. The metadata is contained in the <code>FieldHeader</code> data structure, which contains four parts:</p> <ul> <li><code>FieldIdentifier</code>: stores the field's name, layout, units, data type,   and name of the grid where it's defined. These information are condensed   in a single string, that can be used to uniquely identify a field, allowing   to distinguish between different version of the same field.   The layout is stored in the <code>FieldLayout</code> data structure, which includes:</li> <li>the field tags: stored as a <code>std::vector&lt;FieldTag&gt;</code>, they give context to the     field's extents.</li> <li>the field dims: stored both as a <code>std::vector&lt;int&gt;</code>, as well as a 1d <code>Kokkos::View</code>.</li> <li><code>FieldTracking</code>: stores information on the usage of the field, as well as its   possible connections to other fields. In particular, the tracked items are:</li> <li>the field time stamp: the time stamp when the field was last updated.</li> <li>the field accumulation start time: used for fields that are accumulated over     several time steps (or time step subcycles). For instance, it allows to     reconstruct fluxes from raw accumulations.</li> <li>the providers/customers: lists of atmosphere processes (see below) that     respectively require/compute the field in their calculations.</li> <li>the field groups: a list of field groups that this field belongs too. Field groups     are used to access a group of fields without explicit prior knowledge about the     number and/or names of the fields.</li> <li><code>FieldAllocProp</code>: stores information about the allocation. While the field is not   yet allocated, users can request special allocations for the field, for instance   to accommodate packing (for SIMD), which may require padding. Upon allocation,   this information is then used by the Field structure to extract the actual data,   wrapped in a properly shaped <code>Kokkos::View</code>. The alloc props are also   responsible of tracking additional information in case the field is a \"slice\" of   a higher-dimensional one, a fact that can affect how the data is accessed.</li> <li>Extra data: stored as a <code>std::map&lt;std::string,ekat::any&gt;</code>, allows to catch any   metadata that does not fit in the above structures. This is a last resort structure,   intended to accommodate the most peculiar corner cases, and should be used sparingly.</li> </ul>"},{"location":"EAMxx/developer/grid/","title":"Grids and Remappers","text":"<p>In EAMxx, the <code>AbstractGrid</code> is an interface used to access information regarding the horizontal and vertical discretization. The most important information that the grid stores is:</p> <ul> <li>the number of local/global DOFs: these are the degrees of freedom of the   horizontal grid only. Here, local/global refers to the MPI partitioning.</li> <li>the DOFs global IDs (GIDs): a list of GIDs of the DOFs on the current MPI rank,   stored as a Field</li> <li>the local IDs (LIDs) to index list: this list maps the LID of a DOF (that is,   the position of the DOF in the GID list) to a \"native\" indexing system for that   DOF. For instance, a <code>PointGrid</code> (a class derived from <code>AbstractGrid</code>) is a   simple collection of points, so the \"native\" indexing system coincides with the   LIDs. However, for a <code>SEGrid</code> (a derived class, for spectral element grids),   the \"native\" indexing is a triplet <code>(ielem,igp,jgp)</code>, specifying the element   index, and the two indices of the Gauss point within the element.</li> <li>geometry data: stored as a <code>std::map&lt;std::string,Field&gt;</code>, this represent any   data that is intrinsically linked to the grid (either along the horizontal or   vertical direction), such as lat/lon coordinates, vertical coordinates, area   associated with the DOF.</li> </ul> <p>Grids can also be used to retrieve the layout of a 2d/3d scalar/vector field, which allows certain downstream classes to perform certain operations without assuming anything on the horizontal grid.</p> <p>In general, grid objects are passed around the different parts of EAMxx as const objects (read-only). The internal data can only be modified during construction, which usually is handled by a <code>GridsManager</code> object.</p>"},{"location":"EAMxx/developer/io/","title":"Input-Output","text":"<p>In EAMxx, I/O is handled through the SCORPIO library, currently a submodule of E3SM. The <code>scream_io</code> library within eamxx allows to interface the EAMxx infrastructure classes with the SCORPIO library.</p>"},{"location":"EAMxx/developer/kokkos_ekat/","title":"Kokkos and EKAT","text":""},{"location":"EAMxx/developer/kokkos_ekat/#kokkos","title":"Kokkos","text":"<p>EAMxx uses Kokkos for performance portable abstractions for parallel execution of code and data management to various HPC platforms, including OpenMP, Cuda, HIP, and SYCL. Here we give a brief overview of the important concepts for understanding Kokkos in EAMxx. For a more in depth description, see the Kokkos wiki.</p>"},{"location":"EAMxx/developer/kokkos_ekat/#kokkosdevice","title":"Kokkos::Device","text":"<p><code>Kokkos::Device</code> is a struct which contain the type definitions for two main Kokkos concepts: execution space (<code>Kokkos::Device::execution_space</code>), the place on-node where parallel operations (like for-loops, reductions, etc.) are executed, and the memory space (<code>Kokkos::Device::memory_space</code>), the memory location on-node where data is stored. Given your machine architecture, Kokkos defines a default \"device\" space, given by</p> <pre><code>Kokkos::Device&lt;Kokkos::DefaultExecutionSpace,\n         Kokkos::DefaultExecutionSpace::memory_space&gt;\n</code></pre> <p>where all performance critical code should be executed (e.g., on an NVIDIA machine, this device would be the GPU accelerators) and a default \"host\" space, given by</p> <pre><code>Kokkos::Device&lt;Kokkos::DefaultHostExecutionSpace,\n         Kokkos::DefaultHostExecutionSpace::memory_space&gt;\n</code></pre> <p>where data can be accessed by the CPU cores and is necessary for I/O interfacing, for example. Currently, these default spaces are the ones used by EAMxx. On CPU-only machines, host and device represent the same space.</p>"},{"location":"EAMxx/developer/kokkos_ekat/#kokkos-views","title":"Kokkos Views","text":"<p>The main data struct provided by Kokkos used in EAMxx in the <code>Kokkos::View</code>. This is a multi-dimensional data array that can live on either device or host memory space. These Views are necessary when running on GPU architectures as data structures like <code>std::vector</code> and <code>std::array</code> will be unavailable on device.</p> <p>Views are constructed in EAMxx most commonly with the following template and input arguments</p> <pre><code>Kokkos::View&lt;DataType, LayoutType, DeviceType&gt;(const std::string&amp; label,\n                         int dim0, int dim1, ...)\n</code></pre> <p>where</p> <ul> <li><code>DataType</code>: scalar type of the view, given as <code>ScalarType</code>+<code>*</code>(x's number of   run-time dimensions). E.g., a 2D view of doubles will have <code>DataType =   double**</code>. There is also an ability to define compile-time dimensions by   using <code>[]</code>, see   Kokkos wiki section on views.</li> <li><code>LayoutType</code>: mapping of indices into the underlying 1D memory storage. Types   are:</li> <li><code>LayoutRight</code> (used in EAMxx): strides increase from the right most to the   left most dimension, right-most dimension is contiguous</li> <li><code>LayoutLeft</code>: strides increase from the left most to the right most   dimension, left-most dimension is contiguous</li> <li><code>LayoutStride</code>: strides can be arbitrary for each dimension</li> <li><code>DeviceType</code>: provides space where data live, defaults to the default device</li> </ul> <p>The following example defines a view \"temperature\" which has dimensions columns and levels:</p> <pre><code>Kokkos::View&lt;double**, Kokkos::LayoutRight, Kokkos::DefaultDevice&gt; temperature(\n  \"temperature\", ncols, nlevs);\n</code></pre>"},{"location":"EAMxx/developer/kokkos_ekat/#deep-copy","title":"Deep Copy","text":"<p>Kokkos provides <code>Kokkos::deep_copy(dst, src)</code> which copies data between views of the same dimensions, or a scalar values into a view. Common uses</p> <pre><code>Kokkos::deep_copy(view0, view1); // Copy all data from view1 into view0\nKokkos::deep_copy(view0, 5); // Set all values of view0 to 5\n</code></pre> <p>As seen in the next section, we can use <code>deep_copy()</code> to copy data between host and device.</p>"},{"location":"EAMxx/developer/kokkos_ekat/#mirror-views","title":"Mirror Views","text":"<p>We will often need to have memory allocation the resides on device (for computation), and then need that identical data on host (say, for output). Kokkos has a concept of mirror views, where data can be copied from host to device and vice versa.</p> <p>Here is an example using the device view <code>temperature</code> from above</p> <pre><code>// Allocate view on host that exactly mirrors the size of layout of the device\nview\nauto host_temperature = Kokkos::create_mirror_view(temperature);\n\n// Copy all data from device to host\nKokkos::deep_copy(host_temperature, temperature);\n</code></pre> <p>Kokkos also offers an all-in-one option</p> <pre><code>// Note: must hand the host device instance as first argument\nauto host_temperature = Kokkos::create_mirror_view_and_copy(\n  Kokkos::DefaultHostDevice(), temperature);\n</code></pre>"},{"location":"EAMxx/developer/kokkos_ekat/#parallel-execution","title":"Parallel Execution","text":"<p>The most basic parallel execution pattern used by EAMxx is the <code>Kokkos::parallel_for</code> which defines a for-loop with completely independent iterations. The <code>parallel_for</code> takes in an optional label for debugging, an execution policy, which defines a range and location (host or device) for the code to be run, and a lambda describing the body of code to be executed. The following are execution policies used in EAMxx</p> <ul> <li><code>int count</code>: 1D iteration range <code>[0, count)</code></li> <li><code>RangePolicy&lt;ExecSpace&gt;(int beg, int end)</code>: 1D iteration range for indices   <code>[beg, end)</code></li> <li><code>MDRangePolicy&lt;ExecSpace, Kokkos::Rank&lt;N&gt;&gt;(int[N] beg, int[N] end)</code>: multi-   dimensional iteration range <code>[beg, end)</code></li> <li><code>TeamPolicy&lt;ExecSpace&gt;(int league_size, int team_size, int vector_size)</code>: 1D   iteration over <code>league_size</code>, assigned to thread teams of size <code>team_size</code>,   each with <code>vector_size</code> vector lanes. Both <code>team_size</code> and <code>vector_size</code> can   be given <code>Kokkos::AUTO</code> as input for Kokkos to automatically compute.</li> </ul> <p>If no <code>ExecSpace</code> template is given, the default execution space is used.</p> <p>For lambda capture, use <code>KOKKOS_LAMBDA</code> macro which sets capture automatically based on architecture.</p> <p>Example using <code>RangePolicy</code> to initialize a view</p> <pre><code>Kokkos::View&lt;double**, Kokkos::LayoutRight&gt; temperature(\"temperature\", ncols,\n                            nlevs);\nKokkos::parallel_for(\"Init_temp\",\n           Kokkos::RangePolicy(0, ncols*nlevs),\n           KOKKOS_LAMBDA (const int idx) {\n  int icol = idx/nlevs;\n  int ilev = idx%nlevs;\n\n  temperature(icol, ilev) = 0;\n});\n</code></pre> <p>Same example with <code>TeamPolicy</code></p> <pre><code>Kokkos::parallel_for(\"Init_temp\",\n           Kokkos::TeamPolicy(ncols*nlevs, Kokkos::AUTO, Kokkos::AUTO),\n           KOKKOS_LAMBDA (const TeamPolicy::member_type&amp; team) {\n  // league_rank() gives the index for this team\n  int icol = team.league_rank()/nlevs;\n  int ilev = team.league_rank()%nlevs;\n\n  temperature(icol, ilev) = 0;\n});\n</code></pre>"},{"location":"EAMxx/developer/kokkos_ekat/#hierarchical-parallelism","title":"Hierarchical Parallelism","text":"<p>Using <code>TeamPolicy</code>, we can have up to three nested levels of parallelism: team parallelism, thread parallelism, vector parallelism. These nested policies can be called within the lambda body using the following execution policies</p> <ul> <li><code>TeamThreadRange(team, begin, end)</code>: execute over threads of a team</li> <li><code>TeamVectorRange(team, begin, end)</code>: execute over threads and vector lanes of   a team</li> <li><code>ThreadVectorRange(team, begin, end)</code>: execute over vector lanes of a thread</li> </ul> <p>An example of using these policies</p> <pre><code>Kokkos::View&lt;double***&gt; Q(\"tracers\", ncols, ntracers, nlevs);\nKokkos::parallel_for(Kokkos::TeamPolicy(ncols, Kokkos::AUTO),\n           KOKKOS_LAMBDA (TeamPolicy::member_type&amp; team) {\n  int icol = team.league_rank();\n  Kokkos::parallel_for(Kokkos::TeamVectorRange(team, nlevs), [&amp;](int ilev) {\n  temperature(icol, ilev) = 0;\n  });\n\n  Kokkos::parallel_for(Kokkos::TeamThreadRange(team, nlevs), [&amp;](int ilev) {\n  Kokkos::parallel_for(Kokkos::ThreadVectorRange(team, ntracers), [&amp;](int iq) {\n    Q(icol, iq, ilev) = 0;\n  });\n  });\n});\n</code></pre> <p>IMPORTANT! Nested policies cannot be used in arbitrary order. <code>ThreadVectorRange</code> must be used inside a <code>TeamThreadRange</code>, and <code>TeamVectorRange</code> must be the only level of nested parallelism.</p> <pre><code>Kokkos::parallel_for(TeamPolicy(...), ... {\n   // OK\n   Kokkos::parallel_for(TeamThreadRange, ... {\n\n   });\n\n   // OK\n   Kokkos::parallel_for(TeamThreadRange, ... {\n   Kokkos::parallel_for(ThreadVectorRange, ... {\n\n   });\n   });\n\n   // OK\n   Kokkos::parallel_for(TeamVectorRange, ...{\n\n   });\n\n   // WRONG,ThreadVectorRange must be nested in TeamThreadRange\n   Kokkos::parallel_for(ThreadVectorRange, ...{\n\n   });\n\n   // WRONG, a TeamVectorRange must be the only nested level\n   Kokkos::parallel_for(TeamVectorRange, ...{\n   Kokkos::parallel_for(ThreadVectorRange, ... {\n\n   });\n   });\n});\n</code></pre> <p>Using these incorrectly can be very tricky to debug as the code almost certainly will not error out, but race conditions will exist among threads.</p>"},{"location":"EAMxx/developer/kokkos_ekat/#ekat","title":"EKAT","text":""},{"location":"EAMxx/developer/kokkos_ekat/#kokkostypes","title":"KokkosTypes","text":""},{"location":"EAMxx/developer/kokkos_ekat/#teampolicyfactory","title":"TeamPolicyFactory","text":""},{"location":"EAMxx/developer/kokkos_ekat/#reductionutils","title":"ReductionUtils","text":""},{"location":"EAMxx/developer/kokkos_ekat/#vectorization-packs","title":"Vectorization: Packs","text":""},{"location":"EAMxx/developer/kokkos_ekat/#scratch-memory-worspacemanager","title":"Scratch Memory: WorspaceManager","text":""},{"location":"EAMxx/developer/kokkos_ekat/#algorithms","title":"Algorithms","text":""},{"location":"EAMxx/developer/processes/","title":"Atmospheric Processes","text":"<p>In EAMxx, <code>AtmosphereProcess</code> (AP) is an abstract class representing a portion of the atmosphere timestep algorithm. In simple terms, an AP is an object that given certain input fields performs some calculations to compute some output fields. The concrete AP classes allow to create a buffer layer between particular packages (e.g., dynamics dycore, physics parameterizations) and the atmosphere driver (AD), allowing separation of concerns, so that the AD does not need to know details about the package, and the package does not need to know about the EAMxx infrastructure.</p> <p>To enhance this separation of concerns, EAMxx implements two more classes for handling APs:</p> <ul> <li>the concrete class <code>AtmosphereProcessGroup</code> (APG), which allows to group   together a set of AP's, which can be seen from outside as a single process;</li> <li>the <code>AtmosphereProcessFactory</code> class, which allows an APG to create its   internal processes without any knowledge of what they are.</li> </ul> <p>This infrastructure allows the AD to view the whole atmosphere as a single APG, and to be completely agnostic to what processes are run, and in which order. This design allows to have a code base that is cleaner, self-container, and easy to test via a battery of targeted unit tests.</p> <p>In EAMxx, we already have a few concrete AP's, interfacing the AD to the Hommexx non-hydrostatic dycore as well as some physics parameterizations (P3, SHOC, RRMTPG, etc). In the next section we describe the interfaces of an AP class, and we show an example of how to write a new concrete AP class.</p>"},{"location":"EAMxx/developer/processes/#atmosphere-process-interfaces","title":"Atmosphere process interfaces","text":"<p>An AP has several interfaces, which can be grouped into three categories:</p> <ul> <li>initialization: these interfaces are used to create the AP, as well as to   initialize internal data structures;</li> <li>run: these interfaces are used to make the AP compute its output fields from   its input fields;</li> <li>finalization: these interfaces are used to perform any clean up operation   (e.g., release files) before the AP is destroyed.</li> </ul> <p>Among the above, the initialization sequence is the most complex, and consists of several steps:</p> <ul> <li>The AD creates the APG corresponding to the whole atmosphere. As mentioned   above, this phase will make use of a factory, which allows the AD to be   agnostic to what is actually in the group. All AP's can start performing any   initialization work that they can, but at this point they are limited to use   only an MPI communicator as well as a list of runtime parameters (which were   previously read from an input file).</li> <li>The AD passes a <code>GridsManager</code> to the AP's, so that they can get information   about the grids they need. At this point, all AP's have all the information   they need to establish the layout of the input and output fields they need,   and can store a list of these \"requests\"</li> <li>After creating all fields (based on AP's requests), the AD passes a copy of   each input and output field to the AP's. These fields will be divided in   \"required\" and \"computed\", which differ in that the former are only passed   to the AP's as 'read-only' fields (see the field   documentation for more details)</li> <li>The AP's are queried for how much scratch memory they may need at run time.   After all AP's communicate their needs, the AD will provide a pointer to   scratch memory to the AP's. This is memory that can be used to initialize   temporary views/fields or other internal data structures. All AP's are given   the same pointer, which means no data persistence should be expected at run   time between one timestep and the next.</li> <li>The AD calls the 'initialize' method on each AP. At this point, all fields   are set, and AP's can complete any remaining initialization task</li> </ul> <p>While the base AP class provides an (empty) implementation for some methods, in case derived classes do not need a feature, some methods are purely virtual, and concrete classes will have to override them. Looking at existing concrete AP implementations is a good way to have a first idea of what a new AP class needs to implement. Here, we show go over the possible implementation of these methods in a hypothetical AP class. The header file may look something like this</p> <pre><code>#include &lt;share/atm_process/atmosphere_process.hpp&gt;\n\nclass MyProcess : public AtmosphereProcess\n{\npublic:\n  using gm_ptr = std::shared_ptr&lt;const GridsManager&gt;;\n\n  MyProcess(const ekat::Comm&amp; comm, const ekat::ParameterList&amp; pl);\n\n  std::string name () const override { return \"my_fancy_process\"; }\n  void set_grids (const gm_ptr&amp; grids_manager) override;\n  size_t requested_buffer_size_in_bytes () const override;\n  void init_buffers (const ATMBufferManager&amp; buffer_manager) override;\nprotected:\n\n  void initialize_impl (const RunType run_type) override;\n  void run_impl        (const double dt) override;\n  void finalize_impl   () override;\n\n  using view_1d = typename KokkosTypes&lt;DefaultDevice&gt;::view_1d&lt;Real&gt;;\n  using view_2d = typename KokkosTypes&lt;DefaultDevice&gt;::view_2d&lt;Real&gt;;\n\n  view_1d m_temp1;\n  view_2d m_temp2;\n\n  int m_ncols;\n  int m_nlevs;\n  bool m_has_blah;\n};\n</code></pre> <p>A few comments:</p> <ul> <li>we added two views to the class, which are meant to be used to store   intermediate results during calculations at runtime;</li> <li>there are other methods that the class can override (such as additional   operations when the AD sets a field in the AP), but most AP's only need to   override only these;</li> <li>we strongly encourage to add the keyword <code>override</code> when overriding a method;   in case of small typos (e.g., missing a <code>&amp;</code> or a <code>const</code>, the compiler will   be erroring out, since the signature will not match any virtual method in the   base class;</li> <li><code>finalize_impl</code> is often empty; unless the AP is managing external resources,   everything should be correctly released during destruction;</li> <li>the two methods for buffers can be omitted if the AP does not need any   scratch memory (and the default implementation from the base class will be   used).</li> </ul> <p>Here is a possible implementation of the methods, with some inline comments to explain</p> <pre><code>MyProcess::MyProcess (const ekat::Comm&amp; comm, const ekat::ParameterList&amp; pl)\n : AtmosphereProcess(comm,pl)\n{\n  // The base class copies pl into protected member m_params\n  m_has_blah = m_params.get&lt;bool&gt;(\"enable_blah\");\n}\n\nvoid MyProcess::set_grids (const std::shared_ptr&lt;GridsManager&gt;&amp; gm)\n{\n  using namespace ekat::units;\n  const auto nondim = Units::nondimensional();\n\n  auto grid = gm-&gt;get_grid(\"physics\");\n  m_ncols = grid-&gt;get_num_local_dofs();\n  m_nlevs = grid-&gt;get_num_vertical_levels();\n\n  // In these names, 2d refers to \"horizontal only\", while 3d to \"horiz+vert\".\n  // But the grid stores dofs linearly, so there is only one array dimension\n  FieldLayout scalar2d = grid-&gt;get_2d_scalar_layout();\n  FieldLayout vector3d = grid-&gt;get_3d_vector_layout(true,2);\n\n  // Declare fields needed:\n  //  - Required: 'input' (read-only)\n  //  - Computed: 'output'\n  //  - Updated: 'input'+'output'\n  // Tell the AD we need 'velocity' to accommodate a Pack scalar type\n  add_field&lt;Required&gt;(\"coeff_2d\",scalar2d,nondim,grid-&gt;name);\n  add_field&lt;Updated&gt;(\"velocity\",vector3d,m/s,grid-&gt;name,SCREAM_PACK_SIZE);\n}\n\nsize_t MyProcess::requested_buffer_size_in_bytes ()\n{\n  // We use temp2 only if the blah feature is on\n  return m_ncols + (m_has_blah ? m_ncols*m_nlev : 0);\n}\n\nvoid MyProcess::init_buffers (const ATMBufferManager&amp; buffer_manager)\n{\n  auto mem = reinterpret_cast&lt;Real*&gt;(buffer_manager.get_memory());\n\n  m_temp1 = view_1d&lt;Real&gt;(mem,m_ncols);\n  mem += m_ncols;\n\n  if (m_has_blah) {\n    m_temp2 = view_2d&lt;Real&gt;(mem,m_ncols,m_nlevs);\n    mem += m_ncols*m_nlevs;\n  }\n\n  // Make sure we use exactly the mem we said we would\n  size_t used_mem = (mem - buffer_manager.get_memory())*sizeof(Real);\n  EKAT_REQUIRE_MSG(used_mem==requested_buffer_size_in_bytes(),\n    \"Error! Used memory != requested memory for MyProcess.\"\n    \"  used memory: \" + std::to_string(used_mem) + \"\\n\"\n    \"  requested: \" + std::to_string(requested_buffer_size_in_bytes()) + \"\\n\");\n}\n\nvoid MyProcess::initialize_impl(const RunType run_type)\n{\n  // Can complete any initialization of the background pkg\n  my_process_pkg_init(m_has_blah);\n}\n\nvoid MyProcess:run_impl (const double dt)\n{\n  using Policy = typename KokkosTypes&lt;DefaultDevice&gt;::TeamPolicy\n  using Member = typename KokkosTypes&lt;DefaultDevice&gt;::MemberType\n  using PackT  = ekat::Pack&lt;Real,SCREAM_PACK_SIZE&gt;;\n\n  // Create team policy\n  Policy policy(m_ncols,m_nlevs,1);\n\n  // Create local copies of class members (or else use KOKKOS_CLASS_LAMBDA)\n  auto temp1 = m_temp1;\n  auto temp2 = m_temp2;\n  auto do_blah = m_has_blah;\n\n  // Get views from fields. We \n  auto coeff2d  = get_field_in(\"coeff_2d\").get_view&lt;const Real*&gt;();\n  auto velocity = get_field_out(\"velocity\").get_view&lt;PackT**&gt;();\n\n  // Since we process velocity with a Pack scalar type, find out how many packs\n  // we have in each column\n  auto nlevs_packs = ekat::PackInfo&lt;SCREAM_PACK_SIZE&gt;::num_packs(m_nlevs);\n\n  // Call some function in the background pkg\n  do_some_work (coeff_2d,velocity,temp1,temp2,do_blah);\n\n  // Do some more work here\n  auto work = KOKKOS_LAMBDA (const Member&amp; team) {\n    int icol = team.league_rank();\n    auto col_work = [&amp;](const int ilev) {\n      velocity(icol,ilev) *= coeff_2d;\n    };\n    Kokkos::parallel_for(Kokkos::TeamVectorRange(team,nlevs_packs),col_work);\n  };\n  Kokkos::parallel_for(policy,work);\n  Kokkos::fence();\n}\n\nvoid MyProcess::finalize_impl ()\n{\n  // If the background package needs to cleanup something, do it now\n  my_process_pkg_cleanup();\n}\n</code></pre>"},{"location":"EAMxx/developer/dev_testing/","title":"Overview","text":""},{"location":"EAMxx/developer/dev_testing/#testing-philosophy-and-motivation","title":"Testing Philosophy and Motivation","text":"<p>Rigorous testing has been and continues to be integral to our development approach of moving quickly and embracing leading-edge software practices. We believe that scientific code must be tested for the results to be trusted, and as the complexity of advanced algorithms and code increases, the burden of proof increases right alongside it. These practices have enabled us to design a novel, high-resolution model of Earth's atmosphere that is trusted by the Department of Energy to provide high-quality answers for the forthcoming versions of E3SM.</p> <p>For these reasons, we devote significant space and effort to describing our testing practices in these documentation pages. This is not meant to make development more difficult, but, rather, to raise the bar of expectations for the next generation of scientists and research software engineers (RSEs).</p>"},{"location":"EAMxx/developer/dev_testing/ci_nightly/","title":"Continuous Integration and Nightly Testing","text":""},{"location":"EAMxx/developer/dev_testing/ci_nightly/#autotester","title":"Autotester","text":"<p>EAMxx uses GitHub actions and a Sandia product called Autotester 2 (AT2) to run CI testing on a CPU and GPU machine for every GitHub pull request. As of Feb 2025, our CI testing includes 5 CIME cases and the standalone EAMxx tests (<code>test-all-eamxx</code>).</p>"},{"location":"EAMxx/developer/dev_testing/ci_nightly/#nightly-overview-cdash","title":"Nightly overview, CDash","text":"<p>Our nightly testing is much more extensive than the CI testing. You can see our dashboard here under the section E3SM_EAMXX</p> <p>We run a variety of CIME test suites and standalone testing on a number of platforms. We even do some performance testing on Frontier.</p>"},{"location":"EAMxx/developer/dev_testing/full_model_testing/","title":"Full-model Testing","text":"<p>Full model system testing of EAMxx is done via CIME test cases (much like the rest of E3SM).</p> <p>We offer a number of test suites, including:</p> <ul> <li><code>e3sm_eamxx_v1_lowres</code><ul> <li>A handful of reasonably quickly-running tests run at     ultra-low-resolution (<code>ne4</code> grid).</li> </ul> </li> <li><code>e3sm_eamxx_mam4xx_v1_lowres</code><ul> <li>Tests designed for the MAM4xx aerosol library and are separate from     the above (mostly <code>ne4</code>, though also includes <code>ne30</code>).</li> </ul> </li> <li><code>e3sm_eamxx_v1_dp-eamxx</code><sup>1</sup><ul> <li>A quickly-running test that employs the doubly-periodic (dp)     configuration of EAMxx at low-resolution (<code>ne30)</code>.</li> </ul> </li> <li><code>e3sm_eamxx_v1_medres</code><ul> <li>Tests intended to be a middle-ground (<code>ne30</code>) between the     <code>_lowres</code> and <code>_hires</code> in that it is a more comprehensive test of     capabilities than low-resolution but runs more quickly than high-resolution.</li> </ul> </li> <li><code>e3sm_eamxx_v1_hires</code><ul> <li>A small number of larger, longer-running (high-resolution) tests     to measure performance.</li> </ul> </li> </ul> <p>Note: See the collapsed section \"Lists of Test Cases and Suites...\" below for more information on these test suite configurations.</p> Running a Test Suite<pre><code>cd $repo/cime/scripts\n./create_test e3sm_scream_v1_at --wait\n</code></pre> Running a Single Test Case<pre><code>cd $repo/cime/scripts\n./create_test SMS.ne4_ne4.F2010-SCREAMv1 --wait\n</code></pre> <ul> <li>There are many behavioral tweaks you can make to a test case, like changing the run length, test type, etc.<ul> <li>Most of this is not specific to EAMxx and works for any CIME case.</li> </ul> </li> <li>This general information and much more can be found in the CIME docs.</li> </ul>"},{"location":"EAMxx/developer/dev_testing/full_model_testing/#eamxx-specific-model-configuration","title":"EAMxx-specific Model Configuration","text":"<p>The main model-level configuration options for EAMxx are:</p> <ol> <li>grids</li> <li>compsets</li> <li>testmods</li> </ol>"},{"location":"EAMxx/developer/dev_testing/full_model_testing/#common-eamxx-grids","title":"Common EAMxx Grids<sup>2</sup>","text":"<ul> <li><code>ne4_ne4</code>:<sup>3</sup> ultra-low-resolution</li> <li><code>ne4pg2_ne4pg2</code>:<sup>3</sup> ultra-low-resolution with phys grid</li> <li><code>ne30_ne30</code>: low-resolution</li> <li><code>ne30pg2_ne30pg2</code>: low-resolution with phys grid</li> <li><code>ne1024pg2_ne1024pg2</code>: ultra-high-resolution with phys grid</li> </ul> <p>More information about grids may be found on this Confluence Page.</p>"},{"location":"EAMxx/developer/dev_testing/full_model_testing/#common-eamxx-compsets","title":"Common EAMxx Compsets","text":"<ul> <li><code>F2010-SCREAMv1</code>: V1 standard compset with EAMxx V1 atmosphere</li> <li><code>FIOP-SCREAMv1-DP</code>: V1 with <code>dpxx</code><sup>1</sup></li> <li><code>F2010-SCREAMv1-noAero</code>: V1 without aerosol forcing</li> </ul> <p>Full info on supported compsets may be found by taking a look at the EAMxx <code>config_compsets.xml</code> source file.</p>"},{"location":"EAMxx/developer/dev_testing/full_model_testing/#common-eamxx-testmods","title":"Common EAMxx Testmods","text":"<ul> <li><code>small_kernels</code><ul> <li>Enable smaller-granularity kernels, which can improve performance   on some systems.</li> </ul> </li> <li><code>scream-output-preset-{i}, i = 1,..., 6</code><ul> <li>6 output presets for EAMxx</li> <li>These turn some combination of our three output streams   (<code>phys_dyn</code>, <code>phys</code>, and <code>diags</code>), various remaps, etc.</li> </ul> </li> <li><code>bfbhash</code><ul> <li>Turns on bit-for-bit hash output.</li> <li>See this Confluence page   for additional information.</li> </ul> </li> </ul> <p>Further Reading</p> <p>Additional information about running EAMxx may be found at this webpage.</p> List of Selected Test Cases and Suites from <code>cime_config/tests.py</code> <pre><code>\"e3sm_eamxx_v1_lowres\" : {\n        \"time\"  : \"01:00:00\",\n        \"inherit\" : (\"e3sm_eamxx_mam4xx_v1_lowres\"),\n        \"tests\" : (\n            \"ERP_D_Lh4.ne4_ne4.F2010-SCREAMv1.eamxx-output-preset-1\",\n            \"ERS_Ln9.ne4_ne4.F2000-SCREAMv1-AQP1.eamxx-output-preset-2\",\n            \"SMS_D_Ln9.ne4_ne4.F2010-SCREAMv1-noAero.eamxx-output-preset-3\",\n            \"ERP_Ln22.ne4pg2_ne4pg2.F2010-SCREAMv1.eamxx-output-preset-4\",\n            \"ERS_D_Ln22.ne4pg2_ne4pg2.F2010-SCREAMv1.eamxx-rad_frequency_2--eamxx-output-preset-5\",\n            \"ERS_Ln22.ne4pg2_ne4pg2.F2010-SCREAMv1.eamxx-small_kernels--eamxx-output-preset-5\",\n            \"ERS_Ln22.ne4pg2_ne4pg2.F2010-SCREAMv1.eamxx-small_kernels_p3--eamxx-output-preset-5\",\n            \"ERS_Ln22.ne4pg2_ne4pg2.F2010-SCREAMv1.eamxx-small_kernels_shoc--eamxx-output-preset-5\",\n            \"SMS_D_Ln5.ne4pg2_oQU480.F2010-SCREAMv1-MPASSI.eamxx-mam4xx-all_mam4xx_procs\",\n            )\n    },\n\"e3sm_eamxx_mam4xx_v1_lowres\" : {\n        \"time\"  : \"01:00:00\",\n        \"tests\" : (\n            \"SMS_D_Ln5.ne4pg2_oQU480.F2010-SCREAMv1-MPASSI.eamxx-mam4xx-optics\",\n            \"SMS_D_Ln5.ne4pg2_oQU480.F2010-SCREAMv1-MPASSI.eamxx-mam4xx-aci\",\n            \"SMS_D_Ln5.ne4pg2_oQU480.F2010-SCREAMv1-MPASSI.eamxx-mam4xx-wetscav\",\n            \"SMS_D_Ln5.ne4pg2_oQU480.F2010-SCREAMv1-MPASSI.eamxx-mam4xx-drydep\",\n            \"SMS_D_Ln5.ne30pg2_oECv3.F2010-SCREAMv1-MPASSI.eamxx-mam4xx-remap_emiss_ne4_ne30\"\n        )\n    },\n\"e3sm_eamxx_v1_dp-eamxx\" : {\n    \"time\"  : \"01:00:00\",\n    # each test runs with 225 dynamics and 100 physics columns,\n    # roughly size of ne2\n    \"tests\" : (\n        \"ERS_P16_Ln22.ne30pg2_ne30pg2.FIOP-SCREAMv1-DP.eamxx-dpxx-dycomsrf01\",\n        \"ERS_P16_Ln22.ne30pg2_ne30pg2.FIOP-SCREAMv1-DP.eamxx-dpxx-arm97\",\n        \"ERS_P16_Ln22.ne30pg2_ne30pg2.FIOP-SCREAMv1-DP.eamxx-dpxx-comble\",\n        \"ERS_P16_Ln22.ne30pg2_ne30pg2.FRCE-SCREAMv1-DP\",\n        )\n},\n\"e3sm_eamxx_v1_medres\" : {\n    \"time\"  : \"02:00:00\",\n    \"tests\" : (\n        \"ERS_Ln22.ne30_ne30.F2010-SCREAMv1.eamxx-internal_diagnostics_level--eamxx-output-preset-3\",\n        \"PEM_Ln90.ne30pg2_ne30pg2.F2010-SCREAMv1.eamxx-spa_remap--eamxx-output-preset-4\",\n        \"ERS_Ln90.ne30pg2_ne30pg2.F2010-SCREAMv1.eamxx-small_kernels--eamxx-output-preset-5\",\n        \"ERP_Ln22.conusx4v1pg2_r05_oECv3.F2010-SCREAMv1-noAero.eamxx-bfbhash--eamxx-output-preset-6\",\n        \"ERS_Ln22.ne30pg2_ne30pg2.F2010-SCREAMv1.eamxx-L128--eamxx-output-preset-4\",\n        \"REP_Ld5.ne30pg2_ne30pg2.F2010-SCREAMv1.eamxx-L128--eamxx-output-preset-6\",\n        \"SMS.ne30pg2_EC30to60E2r2.WCYCLXX2010\",\n        \"ERS_Ln90.ne30pg2_ne30pg2.F2010-SCREAMv1.eamxx-L128--eamxx-sl_nsubstep2\",\n        )\n},\n# Used to track performance\n\"e3sm_eamxx_v1_hires\" : {\n    \"time\"  : \"01:00:00\",\n    \"tests\" : (\n        \"SMS_Ln300.ne30pg2_ne30pg2.F2010-SCREAMv1.eamxx-perf_test--eamxx-output-preset-1\"\n        )\n}\n</code></pre> Cubed-sphere representation of the earth depicting spectral     elements (blue boxes) and Gauss-Legendre-Lobatto interpolation points     (green dots). <ol> <li> <p>An EAMxx compset configuration employing doubly-periodic lateral boundary conditions.\u00a0\u21a9\u21a9</p> </li> <li> <p>See below for some additional details about Grid Nomenclature</p> Notes on Grid Nomenclature <p>  The convention of E3SM and EAMxx is to characterize grids in terms of:</p> <ul> <li>The Number of spectral Elements (<code>ne&lt;X&gt;</code>) along each dimension (e.g., length and width) of a face of the \"cubed sphere\" model used to represent the earth.<ul> <li>That is, an <code>ne4_ne4</code> grid has 16 elements on each face of the cubed sphere.</li> <li>As such, the number of elements tiling the cubed-sphere earth is  \\(N_{\\text{elements}} = N_{\\text{sides}}\\times [\\text{ne}]^2 = 6 [\\text{ne}]\\).</li> <li>Note that the grid resolution may be written denoting an <code>np&lt;X&gt;</code> term that indicates the number of Gauss-Legendre-Lobatto nodes used to discretize each dimension of the spectral element.</li> <li>For <code>ne&lt;X&gt;</code> grids, <code>np</code> is essentially fixed at 4 for modern E3SM, meaning each element is discretized on an 4\\(\\times\\)4 grid.</li> <li>Thus, the total number of GLL nodes discretizing the surface of the cubed sphere is  \\(N_{\\text{points}} = N_{\\text{elements}}\\) \\(\\times \\left([\\text{np}] - 1\\right)^2 + 2\\)</li> </ul> </li> </ul> <p>\u21a9</p> </li> <li> <p>Note: The <code>ne4</code> (ultra-low resolution) grid is intended to only be used for unit testing or debugging.\u00a0\u21a9\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/dev_testing/test_all_eamxx/","title":"Automated Standalone Testing","text":""},{"location":"EAMxx/developer/dev_testing/test_all_eamxx/#eamxx-automated-standalone-testing-test-all-eamxx","title":"EAMxx Automated Standalone Testing  (<code>test-all-eamxx</code>)","text":""},{"location":"EAMxx/developer/dev_testing/test_all_eamxx/#local-configuration-files","title":"Local Configuration Files","text":"<p>In this section we describe our testing methodology for standalone EAMxx configurations. We use several types of tests</p> <ul> <li>Unit tests are individual test programs that demonstrate that a small set   of code performs a single function or a set of related functions. We use   a C++ unit testing framework called Catch2   to implement unit tests.</li> <li>Property (verification) tests are test programs that configure code that   demonstrates that a part of EAMxx (for example, an atmospheric physics   parameterization or the dynamical core) is able to produce an answer that   satisfies some physical constraint or matches a known solution under specific   circumstances.</li> <li>Fortran-C++ \"bit-for-bit\" (BFB) tests are test programs, often implemented   as unit tests, that demonstrate that a set of C++ code ported from Fortran   produces bit-for-bit identical results to its Fortran counterpart, provided   certain compiler options are enabled (such as \"strict\" floating-point   arithmetic).</li> <li>Test Suites are named collections of tests that can be run on demand using   the ctest command.</li> </ul> <p>We also support a <code>test-all-eamxx</code> configuration that runs all of the standalone tests for an EAMxx configuration. Note, your current machine must be known to EAMxx before <code>test-all-eamxx</code> will work. A machine can be made known to EAMxx by editing the eamxx/scripts/machines_specs.py files. There are some instructions on what to do at the top of this file.</p> <p><code>test-all-eamxx</code> has an informative help dump, displaying some examples, important information, and options flags/descriptions (provided below in the collapsed text box).</p> <pre><code>cd ${e3sm_root}/components/eamxx\n./scripts/test-all-eamxx --help\n</code></pre> Output from <code>test-all-eamxx --help</code> <p> <pre><code>usage: \ntest-all-eamxx &lt;ARGS&gt; [--verbose]\nOR\ntest-all-eamxx --help\n\nEXAMPLES (assumes user is on machine mappy):\n    # Run all tests on current machine using the EAMxx-approved\n    env for this machine \n    &gt; cd $eamxx_repo/components/eamxx\n    &gt; ./scripts/test-all-eamxx -m mappy\n\n    # Run all tests on current machine with default behavior except using your current shell env \n    &gt; cd $eamxx_repo/components/eamxx\n    &gt; ./scripts/test-all-eamxx --preserve-env -m mappy\n\n    # Run all tests on current machine with default behavior except using non-default baselines \n    &gt; cd $eamxx_repo/components/eamxx\n    &gt; ./scripts/test-all-eamxx -m mappy --baseline-dir=PATH_TO_BASELINES\n\n    # Run all tests on current machine with default behavior except using local baselines \n    &gt; cd $eamxx_repo/components/eamxx\n    &gt; ./scripts/test-all-eamxx -m mappy --baseline-dir=LOCAL\n\n    # Run only the dbg test on current machine with default behavior otherwise\n    &gt; cd $eamxx_repo/components/eamxx\n    &gt; ./scripts/test-all-eamxx -m mappy -t dbg\n\nDrive `ctest` testing of EAMxx for a complete set of tests. This will be our\ngold standard to determine if the code is working or not on the current platform.\nFor batch machines, this script expects to already be on a compute node;\nit does not do batch submissions.\n\nIMPORTANT: the default behavior of this script *changes your environment*,\n           by loading machine-specific modules and setting machine-specific\n           env vars. To prevent this behavior, use --preserve-env flag.\n\nBaselines: By default, test-all-eamxx will not run baseline tests. If you set\n-b AUTO, baseline tests will be done with the pre-existing public baselines in\nthe location specified by the machine spec. You can regenerate\nbaselines any time by using the -g flag, but be aware this will impact everyone\nif you regenerate the public baselines. You can change the target baseline area\nusing -b $path. You can also use the magic word \"LOCAL\" to have test-all-eamxx\npick a local directory for you if you want to manage your own baselines within\nthe current repo. If -g is provided, no tests will be run; -g means generate only.\n\nThe general workflow for baseline-changing PRs is:\n1) Issue PR\n2) AT will fail with differences in the baseline tests\n3) Review and merge.\n4) Ask JimF or LucaB for a bless to baselines on mappy and weaver.\n\nIf you are developing a branch and baselines tests are failing unexpectedly, it is\nlikely that your branch has fallen out of date. You should upstream merge or rebase\nyour branch.\n\nTo sum up, the baseline handling for test-all-eamxx should basically match what we\ndo for create_test tests, the only difference is that test-all-eamxx does baseline\ncomparison tests by default.\n\noptions:\n  -h, --help            show this help message and exit\n  -cxx, --cxx-compiler CXX_COMPILER\n                        C++ compiler (default: None)\n  -f90, --f90-compiler F90_COMPILER\n                        F90 compiler (default: None)\n  --c-compiler C_COMPILER\n                        C compiler (default: None)\n  -s, --submit          Submit results to dashboard (default: False)\n  -p, --parallel        Launch the different build types stacks in parallel\n                        (default: False)\n  -g, --generate        Instruct test-all-eamxx to generate baselines from\n                        current commit. Skips tests (default: False)\n  -b, --baseline-dir BASELINE_DIR\n                        Directory where baselines should be read from (or\n                        written to, if -g is used). Default is None which\n                        skips all baseline tests. AUTO means use public\n                        baselines. You can also use LOCAL to manage baselines\n                        in your local work dir. Lastly, you can provide a path\n                        here as well. (default: None)\n  -m, --machine MACHINE\n                        Provide machine name. This is *always* required. It\n                        can, but does not have to, match EAMXX_MACHINE. You\n                        can decorate this with compiler info if a machine\n                        supports multiple compiler types. This value will\n                        be used as the CTEST_SITE for cdash if the tests are\n                        submitted. It is expected that an EAMxx machine file\n                        exists for this value. (default: None)\n  --config-only         In the testing phase, only run config step, skip build\n                        and tests (default: False)\n  -c, --custom-cmake-opts CUSTOM_CMAKE_OPTS\n                        Extra custom options to pass to cmake. Can use\n                        multiple times for multiple cmake options. The -D is\n                        added for you (default: [])\n  -e, --custom-env-vars CUSTOM_ENV_VARS\n                        Extra custom environment variables to be used. These\n                        will override(if applicable) whatever was found in\n                        machine_specs. Each -e flag supports a single env var,\n                        so to pass multiple env var, do -e 'KEY1=VALUE1' -e\n                        'KEY2=VALUE2' (default: [])\n  --preserve-env        Whether to skip machine env setup, and preserve the\n                        current user env (useful to manually test new modules)\n                        (default: False)\n  -t, --test TESTS      Only run specific test configurations, choices='dbg'\n                        (debug), 'sp' (debug single precision), 'fpe' (debug\n                        pksize=1 floating point exceptions on), 'opt'\n                        (release), 'cov' (debug coverage), 'valg' (Release\n                        build where tests run through valgrind), 'csm' (debug\n                        with compute sanitizer memcheck), 'csr' (debug with\n                        compute sanitizer racecheck), 'csi' (debug with\n                        compute sanitizer initcheck), 'css' (debug with\n                        compute sanitizer synccheck) (default: [])\n  -l, --local           Allow to not specify a machine name, and have test-\n                        all-eamxx to look for '~/.cime/scream_mach_specs.py'\n                        for machine specifications. (default: False)\n  -r, --root-dir ROOT_DIR\n                        The root directory of the EAMxx src you want to test.\n                        Default will be the EAMxx src containing this script.\n                        (default: None)\n  -w, --work-dir WORK_DIR\n                        The work directory where all the building/testing will\n                        happen. Defaults to ${root_dir}/ctest-build (default:\n                        None)\n  --quick-rerun         Do not clean the build dir, and do not reconfigure.\n                        Just (incremental) build and test. (default: False)\n  --quick-rerun-failed  Do not clean the build dir, and do not reconfigure.\n                        Just (incremental) build and retest failed tests only.\n                        (default: False)\n  --make-parallel-level MAKE_PARALLEL_LEVEL\n                        Max number of jobs to be created during compilation.\n                        If not provided, use default for given machine.\n                        (default: 0)\n  --ctest-parallel-level CTEST_PARALLEL_LEVEL\n                        Force to use this value for CTEST_PARALLEL_LEVEL. If\n                        not provided, use default for given machine. (default:\n                        0)\n  -x, --extra-verbose   Have ctest run in extra-verbose mode, which should\n                        print full output from all tests (default: False)\n  --limit-test-regex LIMIT_TEST_REGEX\n                        Limit ctest to running only tests that match this\n                        regex (default: None)\n  --test-level {at,nightly,experimental}\n                        Set the testing level. (default: at)\n  --test-size {short,medium,long}\n                        Set the testing level. Defaults to medium unless the\n                        test is cov or mem_check(short is default in those\n                        cases). (default: None)\n</code></pre></p> <p>If you are unsure of the CMake configuration for you development cycle, one trick you can use is to run <code>test-all-eamxx --config-only</code> for the <code>dbg</code> test and then copy the <code>cmake</code> commands from the resulting output.</p> <pre><code>cd $eamxx_repo/components/eamxx\n./scripts/test-all-eamxx -t dbg -m $machine\n# wait for a few seconds*\n# Ctrl-C *\n# Copy the contents of DCMAKE_COMMAND that was passed to ctest *\n# Add \"cmake\" to beginning of contents and path to eamxx at the end. *\n</code></pre> <p>Considerations for using <code>test-all-eamxx</code>:</p> <ul> <li>Your machine must be known to our scripts, see above.</li> <li>If you try to run commands by-hand (i.e., outside of <code>test-all-eamxx</code>, <code>cmake</code>, <code>make</code>, <code>ctest</code>, etc.), you'll need to load the eamxx-env into your shell, which can be achieved by running <code>cd eamxx/scripts; eval $(./eamxx-env-cmd $machine)</code></li> <li><code>test-all-eamxx</code> expects to be run from a compute node if you are on a batch machine.</li> <li>You'll need to think about your baseline situation, as many of our   tests rely on pre-existing baselines. The <code>-b</code> option controls the baseline   location and can have the following values (Note: If no <code>-b</code> flag is   passed at all, no baseline testing will be done):<ul> <li><code>AUTO</code><ul> <li>A common public baseline area shared by all developers</li> </ul> </li> <li><code>$path</code><ul> <li>A specific arbitrary path</li> </ul> </li> </ul> </li> </ul>"},{"location":"EAMxx/developer/dev_testing/test_all_eamxx/#baseline-tests","title":"Baseline Tests","text":"<p>(Work in Progress)</p>"},{"location":"EAMxx/developer/dev_testing/test_all_eamxx/#eamxx-test-suites","title":"EAMxx Test Suites","text":""},{"location":"EAMxx/developer/dev_testing/test_all_eamxx/#the-p3_regression-suite","title":"The <code>p3_regression</code> Suite","text":"<p><code>p3_regression</code> uses a baseline file to compare any new or altered implementations with our P3 Fortran reference implementation. If you're working on the C++/Kokkos implementation, you can invoke any new tests to the function <code>Baseline::run_and_cmp</code> in <code>${EAMxx_SRC_DIR}/components/eamxx/p3/tests/p3_run_and_cmp.cpp</code>.</p> <p>If the reference Fortran implementation changes enough that a new baseline file is required, make sure to let other EAMxx team members know, in order to minimize disruptions.</p>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/","title":"Developing and Testing Your Code","text":""},{"location":"EAMxx/developer/dev_testing/testing_for_development/#initial-notes-for-the-included-examples","title":"Initial Notes for the Included Examples","text":"<p>For the purposes of this guide, we will employ the working example of adding a new atmosphere processes to the MAM4xx aerosol library, specifically the not-real, example process \"Ash-Injection.\" The source files for this process will be found at <code>src/physics/mam/</code>. Note that here, and for the remainder of this guide, we will denote all paths relative to the EAMxx root directory <code>E3SM/components/eamxx/</code> (see Code Structure for additional details on how EAMxx code is organized).</p>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#example-adding-a-new-atmosphere-process","title":"Example: Adding a New Atmosphere Process","text":"<p>The minimum files required for a new process will be those defining the interface to EAMxx. For our case, and following the current informal naming standard, these will be the <code>eamxx_inject_ash_process_interface.&lt;x&gt;pp</code> files, located at <code>src/physics/mam/</code>, and trivial skeleton examples are provided below.</p> eamxx_inject_ash_process_interface.hppeamxx_inject_ash_process_interface.cpp <pre><code>#ifndef EAMXX_MAM_INJECT_ASH_HPP\n#define EAMXX_MAM_INJECT_ASH_HPP\n\n#include \"share/atm_process/atmosphere_process.hpp\"\n\nnamespace scream {\nclass MAMInjectAsh : public AtmosphereProcess {\npublic:\n  MAMInjectAsh(const ekat::Comm &amp;comm, const ekat::ParameterList &amp;params);\n  AtmosphereProcessType type() const override {\n    return AtmosphereProcessType::Physics;\n  }\n  std::string name() const override { return \"MAMInjectAsh\"; }\n  void\n  set_grids(const std::shared_ptr&lt;const GridsManager&gt; grids_manager) override;\n\nprotected:\n  void initialize_impl(const RunType run_type) override;\n  void run_impl(const double dt) override;\n  void finalize_impl() override { /* Nothing to do */ }\n\n  Field source_mask;\n  Field lat;\n  Field lon;\n}\n} // namespace scream\n\n#endif // EAMXX_MAM_INJECT_ASH_HPP\n</code></pre> <pre><code>#include \"ash_source_calculation.hpp\"\n#include \"eamxx_inject_ash_process_interface.hpp\"\n\nnamespace scream {\n\nMAMInjectAsh::MAMInjectAsh(const ekat::Comm &amp;comm,\n                           const ekat::ParameterList &amp;params)\n    : AtmosphereProcess(comm, params) {\n  [...]\n}\nvoid MAMInjectAsh::set_grids(\n    const std::shared_ptr&lt;const GridsManager&gt; grids_manager) {\n  constexpr auto kg = ekat::units::kg;\n  auto grid = grids_manager-&gt;get_grid(\"physics\");\n  add_tracer&lt;Updated&gt;(\"ash\", grid, kg / kg);\n  lat = grid-&gt;get_geometry_data(\"lat\");\n  lon = grid-&gt;get_geometry_data(\"lon\");\n}\nvoid MAM_AshInjection::initialize_impl(const RunType run_type) {\n  source_mask = get_field_out(\"ash\").clone(\"source_mask\");\n  [...] // set source_mask=1 only on area of interest, using lat/lon field\n}\nvoid MAM_AshInjection::run_impl(const double dt) {\n  auto t = end_of_step_ts();\n  auto ash = get_field_out(\"ash\");\n  auto rate = compute_ash_injection_rate(\n      t); // defined in ash_source_calculation.hpp header\n  ash.update(source_mask, rate * dt,\n             decay); // ash = decay*ash + rate*dt*source_mask\n}\n} // namespace scream\n</code></pre>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#add-the-new-process-to-cmake-build","title":"Add the New Process to CMake Build","text":"<p>In order to ensure the code you've added is configured and built by CMake, we need to add to the relevant <code>CMakeLists.txt</code> file. At minimum, we need to add <code>eamxx_inject_ash_process_interface.cpp</code> to the EAMxx library named <code>mam</code>, as shown below. Of course, there may be additional configuration commands that are required for a proper build, but this is beyond the scope of this guide.</p> src/physics/mam/CMakeLists.txt <pre><code>[...]\n# EAMxx mam4xx-based atmospheric processes\nadd_library(mam\n            eamxx_mam_microphysics_process_interface.cpp\n            eamxx_mam_optics_process_interface.cpp\n            [...]\n            eamxx_inject_ash_process_interface.cpp)\n[...]\n</code></pre>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#adding-verification-and-validation-tests","title":"Adding Verification and Validation Tests","text":"<p>All new code that is added to EAMxx is required to be tested. At minimum, a process must be Validation Tested. That is, tested against known, trusted data, and this data can be samples taken by real-world instruments or comparable results generated by other code. Ideally, any new and sufficiently complex functions should also have Verification Tests that test for mathematical or scientific \"correctness\".<sup>1</sup></p>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#single-process-validation-test","title":"Single-process Validation Test","text":"<p>First, we add a validation test for (only) our new process to <code>tests/single-process/mam/inject_ash/</code>. Defining the test behavior and pass/fail criteria requires 3 files:</p> <ul> <li><code>CMakeLists.txt</code><ul> <li>Largely reusable boilerplate code but should be tailored to the proper   test parameters.</li> <li>Defines build and run behavior.</li> <li>Enumerates the required NetCDF input files.</li> </ul> </li> <li><code>input.yaml</code><ul> <li>Defines key parameters for the model and test run.</li> <li>Enumerates the keys (<code>std::string</code>) used to access the input files from   within the process source code.</li> <li>Provides information about the test's initial condition.<ul> <li>Input file names/paths.</li> <li>Other required input values.</li> </ul> </li> </ul> </li> <li><code>output.yaml</code><ul> <li>Defines the output fields used as pass/fail criteria.</li> <li>Defines the tests runtime output behavior.</li> </ul> </li> </ul> CMakeLists.txtinput.yamloutput.yaml <pre><code>include (EAMxxUtils)\n\nset (TEST_BASE_NAME mam4_inject_ash_standalone)\nset (FIXTURES_BASE_NAME ${TEST_BASE_NAME}_generate_output_nc_files)\n# Create the test\nCreateADUnitTest(${TEST_BASE_NAME}\n  LABELS mam4_inject_ash physics\n  LIBS mam\n  MPI_RANKS ${TEST_RANK_START} ${TEST_RANK_END}\n  FIXTURES_SETUP_INDIVIDUAL ${FIXTURES_BASE_NAME}\n)\n\n# Set AD configurable options\nset (ATM_TIME_STEP 1800)\nSetVarDependingOnTestSize(NUM_STEPS 2 5 48)  # 1h 2.5h 24h\nset (RUN_T0 2021-10-12-45000)\n\n# Copy (and configure) yaml files needed by tests\nconfigure_file(${CMAKE_CURRENT_SOURCE_DIR}/input.yaml\n               ${CMAKE_CURRENT_BINARY_DIR}/input.yaml)\nconfigure_file(${CMAKE_CURRENT_SOURCE_DIR}/output.yaml\n               ${CMAKE_CURRENT_BINARY_DIR}/output.yaml)\n\n# Ensure test input files are present in the data dir\nset (TEST_INPUT_FILES\n  eamxx/init/${inject_ash_IC_file}\n  eamxx/mam4xx/.../inject_ash_input_data_file_ABC.nc\n  eamxx/mam4xx/.../inject_ash_input_data_file_XYZ.nc\n  [...]\n  &lt;path-to-required-input-file&gt;\n)\nforeach (file IN ITEMS ${TEST_INPUT_FILES})\n  GetInputFile(${file})\nendforeach()\n\n# Compare results between runs employing differing numbers of MPI ranks\n# to ensure they are bfb\ninclude (CompareNCFiles)\nCompareNCFilesFamilyMpi (\n  TEST_BASE_NAME ${TEST_BASE_NAME}\n  FILE_META_NAME ${TEST_BASE_NAME}_output.INSTANT.nsteps_x1.npMPIRANKS.${RUN_T0}.nc\n  MPI_RANKS ${TEST_RANK_START} ${TEST_RANK_END}\n  LABELS mam4_inject_ash physics\n  META_FIXTURES_REQUIRED ${FIXTURES_BASE_NAME}_npMPIRANKS_omp1\n)\n# Compare one of the output files with the baselines.\n# Note: one is enough, since we already check that np1 is BFB with npX\nif (EAMXX_ENABLE_BASELINE_TESTS)\n  set (OUT_FILE ${TEST_BASE_NAME}_output.INSTANT.nsteps_x1.np${TEST_RANK_END}.${RUN_T0}.nc)\n  CreateBaselineTest(${TEST_BASE_NAME} ${TEST_RANK_END} ${OUT_FILE} ${FIXTURES_BASE_NAME})\nendif()\n</code></pre> <pre><code>%YAML 1.1\n---\ndriver_options:\n  atmosphere_dag_verbosity_level: 5\ntime_stepping:\n  time_step: ${ATM_TIME_STEP}\n  run_t0: ${RUN_T0}  # YYYY-MM-DD-XXXXX\n  number_of_steps: ${NUM_STEPS}\natmosphere_processes:\n  atm_procs_list: [mam4_inject_ash]\n  mam4_inject_ash:\n    inject_ash_ABC_data: ${EAMXX_DATA_DIR}/mam4xx/.../inject_ash_input_data_file_ABC.nc\n    inject_ash_XYZ_data: ${EAMXX_DATA_DIR}/mam4xx/.../inject_ash_input_data_file_XYZ.nc\n    &lt;identifying-string-used-by-inject_ash_xyz.xpp&gt;: /path/to/.../data_file.nc\ngrids_manager:\n  type: mesh_free\n  geo_data_source: IC_FILE\n  grids_names: [physics_gll]\n  physics_gll:\n    type: point_grid\n    aliases: [physics]\n    number_of_global_columns:   218\n    number_of_vertical_levels:  72\ninitial_conditions:\n  # The name of the file containing the initial conditions for this test.\n  filename: ${EAMXX_DATA_DIR}/init/${inject_ash_IC_file}\n  topography_filename: ${TOPO_DATA_DIR}/${EAMxx_tests_TOPO_FILE}\n\n  # other variables to pass as input\n  num_ABC : 42.0\n  num_XYZ : 1.618\n  &lt;input_variable&gt; : &lt;value&gt;\n# The parameters for I/O control\nscorpio:\n  output_yaml_files: [\"output.yaml\"]\n...\n</code></pre> <pre><code>%YAML 1.1\n---\nfilename_prefix: mam4_inject_ash_standalone_output\naveraging_type: instant\nfields:\n  physics:\n    field_names:\n      - answer_field\noutput_control:\n  frequency: 1\n  frequency_units: nsteps\n...\n</code></pre>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#function-level-verification-tests","title":"Function-level Verification Tests","text":"<p>Next, because of the highly-technical nature of our new <code>compute_ash_injection_rate()</code> function, we add a verification test to the 'tests/' subdirectory, co-located with the source code (<code>src/physics/mam/</code>). This subdirectory contains a <code>CMakeLists.txt</code> that we modify to add our new test to the build system. Any required data files should be placed here, and the preferred format for data is yaml, though NetCDF can also be used.</p> src/physics/mam/tests/ash_injection.cpp <pre><code>#include \"catch2/catch.hpp\"\n#include \"ash_source_calculation.hpp\"\n\nnamespace {\nusing namespace scream;\nTEST_CASE(\"verify compute_ash_injection_rate\", \"mam\")\n{\n  // initialize the data and test variables\n  tol = 1.0e-12;\n  util::TimeStamp t1 = ...\n  util::TimeStamp t2 = t1 + 86400 * 100; // 100 days later\n  [...]\n  // call the function we are testing\n  auto rate1 = compute_ash_injection_rate(t1);\n  auto rate2 = compute_ash_injection_rate(t2);\n  // apply the REQUIRE() function from catch2/catch.hpp to test\n  // whether the resulting test answer is within a set error tolerance\n  // from the reference answer. Check all properties that are meaningful\n  REQUIRE (rate1 &gt;= 0);\n  REQUIRE (rate2 &gt;= 0);\n  REQUIRE (rate2 &lt; rate1);\n  [...]\n}\n</code></pre>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#multi-process-validation-tests","title":"Multi-process Validation Tests","text":"<p>Finally, because the Ash-Injection process is not called in isolation, we must validate the results generated when Ash-Injection is called in combination with other processes. At time of writing, these tests are divided into the self-describing directories <code>physics_only</code> and <code>dynamics_physics</code>. The subdirectories and test directories are named according to the convention of listing the names of included processes and potentially relevant grid information. Generally speaking, these tests are configured in the same manner as the single-process tests, via the 3 files <code>CMakeLists.txt</code>, <code>input.yaml</code>, <code>output.yaml</code>, and for this reason we omit further details</p>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#code-build-test-repeat","title":"Code, Build, Test... Repeat","text":"<p>Now that we've written all of the necessary code and there are no errors, we build EAMxx, run our tests, and watch them pass with flying colors. </p> <p>However, for those of us that are mere mortals, we may need to iterate on this process a bit until everything works perfectly. In this case, the automated build and test workflow provided by <code>scripts/test-all-eamxx</code> is designed to make this cycle as painless as possible.</p>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#suggested-very-thorough-and-conservative-testing-progression","title":"Suggested (Very Thorough and Conservative) Testing Progression","text":"<p>To fully cover all the potential interactions of the Ash-Injection process, a reasonable series of tests is provided in the example script below.</p> <p>Note: There is no reason all of this could not be done at once, but we write the script in favor of being clear and explicit.</p> Thorough and Careful Testing Script <p>For the purposes of this example, we assume we are on a non-supported local workstation named \"bingo-pajama\" that has 64 CPU cores and an NVIDIA GPU. We also assume that we have working configuration files in <code>~/.cime/</code> for both CPU and GPU build configurations.</p> <pre><code>#!/bin/bash\n\n# machine-related variables\nmachine_name=\"bingo-pajama\"\ntotal_ncores=64\nid_cpu=\"${machine_name}-cpu\"\nid_gpu=\"${machine_name}-gpu\"\n\n# name of log file for conveniently capturing output\noutfile_prefix=\"ash_injection_buildNtest\"\nofile_cpu=\"${outfile_prefix}-${id_cpu}.log\"\nofile_gpu=\"${outfile_prefix}-${id_gpu}.log\"\n\n# parallelism variables\nmake_ncores=60\ntest_ncores=60\npbuild=\"-p --make-parallel-level ${make_ncores}\"\nptest=\"--ctest-parallel-level ${test_ncores}\"\n\n# flags to assist with testing/debugging\nvflag=\"--extra-verbose\"\n# limit test configuration to double-precision debug\ntest_config=\"-t dbg\"\nbl_loc=\"${HOME}/eamxx-baselines\"\n\n# navigate to the root directory of eamxx\ncd \"${eamxx_root}\"\n# switch to the master branch\ngit checkout master\n# pull so we are at the latest commit (origin/HEAD)\ngit pull origin master\n# update the submodules (the below is typically unnecessary, but thorough)\ngit submodule sync --recursive &amp;&amp; \\\n  git submodule update --init --recursive --progress\n\n# flags common to all tests\nbase_flags=\"${pbuild} ${vflag} ${test_config}\"\n# flags common to this stage of tests\ntest_base_flags=\"${base_flags} --baseline-dir ${bl_loc} --generate\"\n# general test flags per architecture\ncpu_flags=\"--work-dir ${PWD}/${id_cpu} --local ${id_cpu} ${ptest}\"\ngpu_flags=\"--work-dir ${PWD}/${id_gpu} --local ${id_gpu}\"\n# specific flags for this test per architecture\ncpu_test_flags=\"${test_base_flags} ${cpu_flags}\"\ngpu_test_flags=\"${test_base_flags} ${gpu_flags}\"\n\n# generate baselines for cpu and gpu\necho \"TEST FLAGS = ${cpu_test_flags}\"\n./scripts/test-all-eamxx ${cpu_test_flags}\necho \"TEST FLAGS = ${gpu_test_flags}\"\n./scripts/test-all-eamxx ${gpu_test_flags}\n\n# Verify the 'compute_ash_injection_rate()' function works as expected by\nrunning only that test\ntest_choice=\"[^\\s]*compute_ash_injection_rate_test[^\\s]*\"\ntest_base_flags=\"${base_flags} --limit-test-regex ${test_choice}\"\ncpu_test_flags=\"${test_base_flags} ${cpu_flags}\"\ngpu_test_flags=\"${test_base_flags} ${gpu_flags}\"\n\n# run verification tests\necho \"TEST FLAGS = ${cpu_test_flags}\"\n# now that we're running tests that may fail, use 'tee' to\n# duplicate stdout and stderr to file so debugging is slightly easier\n./scripts/test-all-eamxx ${cpu_test_flags} |&amp; tee \"${ofile_cpu}\"\necho \"TEST FLAGS = ${gpu_test_flags}\"\n./scripts/test-all-eamxx ${gpu_test_flags} |&amp; tee \"${ofile_gpu}\"\n\n# Validate the Ash-Injection process generates the solutions we expect\ntest_choice=\"[^\\s]*mam4_ash_injection_standalone[^\\s]*\"\ntest_base_flags=\"${base_flags} --limit-test-regex ${test_choice}\"\ncpu_test_flags=\"${test_base_flags} ${cpu_flags}\"\ngpu_test_flags=\"${test_base_flags} ${gpu_flags}\"\n# run single-process verification tests\necho \"TEST FLAGS = ${cpu_test_flags}\"\n./scripts/test-all-eamxx ${cpu_test_flags} |&amp; tee \"${ofile_cpu}\"\necho \"TEST FLAGS = ${gpu_test_flags}\"\n./scripts/test-all-eamxx ${gpu_test_flags} |&amp; tee \"${ofile_gpu}\"\n\n# validate all the processes that interact with ash_injection generate\n# expected solutions\nash_injection_multiproc_tests=(\n                           # physics_only\n                           shoc_mam4_ash_injection\n                           p3_mam4_ash_injection\n                           # dynamics_physics\n                           homme_shoc_cld_p3_mam4_ash_injection_rrtmgp\n                           homme_shoc_cld_spa_p3_rrtmgp_mam4_ash_injection\n                           )\nfor tchoice in ${ash_injection_multiproc_tests[@]}; do\n  test_choice=\"[^\\s]*${tchoice}[^\\s]*\"\n  test_base_flags=\"${base_flags} --limit-test-regex ${test_choice}\"\n  cpu_test_flags=\"${test_base_flags} ${cpu_flags}\"\n  gpu_test_flags=\"${test_base_flags} ${gpu_flags}\"\n  # run single-process verification tests\n  echo \"TEST FLAGS = ${cpu_test_flags}\"\n  ./scripts/test-all-eamxx ${cpu_test_flags} |&amp; tee \"${ofile_cpu}\"\n  echo \"TEST FLAGS = ${gpu_test_flags}\"\n  ./scripts/test-all-eamxx ${gpu_test_flags} |&amp; tee \"${ofile_gpu}\"\ndone\n# NOTE: just setting 'test_choice=\"[^\\s]*_mam4_ash_injection^\\s]*\"' would\n#       also do the trick in this case\n\n# run full eamxx test suite against pre-Ash-Injection baselines for all\n# test configurations (not just 'dbg')\nbase_flags=\"${pbuild} ${vflag} --baseline-dir ${bl_loc}\"\ncpu_test_flags=\"${base_flags} ${cpu_flags}\"\ngpu_test_flags=\"${base_flags} ${gpu_flags}\"\n# run the full suite of eamxx baseline tests\necho \"TEST FLAGS = ${cpu_test_flags}\"\n./scripts/test-all-eamxx ${cpu_test_flags} |&amp; tee \"${ofile_cpu}\"\necho \"TEST FLAGS = ${gpu_test_flags}\"\n./scripts/test-all-eamxx ${gpu_test_flags} |&amp; tee \"${ofile_gpu}\"\n</code></pre>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#testing-modifications-to-existing-code","title":"Testing Modifications to Existing Code","text":"<p>Note that if you are merely modifying or augmenting existing code, you may not need to create additional tests, provided there is already a test that targets the piece of code that was edited. However, one case for which you should create a test is when adding a new function to existing code. In this case, a verification test should be added that checks the new functionality for correctness.</p>"},{"location":"EAMxx/developer/dev_testing/testing_for_development/#submit-code-to-e3sm-repository-for-review-and-integration","title":"Submit Code to E3SM Repository for Review and Integration","text":"<p>Whew!</p> <p>Now that we have added some exciting new functionality to EAMxx and confirmed that:</p> <ul> <li>The process sub-components (functions) work correctly.<ul> <li>Verification testing of the functions</li> </ul> </li> <li>The process gives us expected answers both in isolation and when interacting with other processes.<ul> <li>Single- and multi-process Validation testing</li> </ul> </li> <li>We have not introduced regressions from the baseline results.<ul> <li>Baseline testing</li> </ul> </li> </ul> <p>Now it's time to submit the code!</p> <p>Getting your new code integrated into E3SM requires several steps involving git and completed using E3SM's GitHub repository. This process is collectively referred to as a Pull Request or PR.<sup>2</sup></p> <p>At a very high level, the steps involved are:</p> <ol> <li>Fork the E3SM repository (referred to as a repo by the cool kids).</li> <li>Push your development branch to your own E3SM fork.</li> <li>Submit the Pull Request from your fork to the <code>E3SM-Project/E3SM</code> repository.</li> <li>Respond to Reviews and comments provided by other developers, and make the necessary modifications to your code.</li> <li>Once all reviewers are satisfied with the changes, your code will be Merged into the master branch of E3SM. </li> </ol> <ol> <li> <p>Admittedly, \"correctness\" is a slippery concept, but at the very least we can always test for properties like mass conservation, non-negativity, etc.\u00a0\u21a9</p> </li> <li> <p>Here is an E3SM-based reference about Submitting a Pull Request (PR) (along with a lot of other good info for developers), and here is another reference  provided by GitHub.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/style/format/","title":"EAMxx Code Formatting Standards","text":"<p>To enforce consistent code format throughout EAMxx, we make use of an autoformatting workflow, carried out via Github Actions in the E3SM repository.</p> <ul> <li>The tool we employ is   <code>clang-format</code>,   and the version we have chosen is v14.<sup>1</sup></li> </ul> <ul> <li>The standard we maintain is largely identical to the   LLVM Coding Standards,   and a list of the handful of customizations of this convention are   enumerated in the configuration file <code>$EAMXX_ROOT/.clang-format</code>.<ul> <li>See this How-to Guide     for additional details on how to configure <code>clang-format</code> on your chosen     development machine.</li> </ul> </li> </ul>"},{"location":"EAMxx/developer/style/format/#automated-workflow-summary","title":"Automated Workflow Summary","text":"<ul> <li>The <code>eamxx-format</code> workflow runs automatically and passes or fails based on   adherence to our formatting standard.</li> <li>The workflow is triggered by any Pull Request (PR) that modifies EAMxx code.<ul> <li>It is also triggered by other PR-related triggers, such as pushing     changes, or converting from draft to ready.</li> </ul> </li> <li>All code modified by a PR must be formatted prior to merging.</li> <li>It is not necessary for your code to be formatted upon opening a   Pull Request, but feel free to <code>clang-format</code> as you develop if that is   your preference.<ul> <li>The one situation for which opening a pre-formatted PR may not be     preferred is if the file has never previously been <code>clang-format</code>-ed     and requires a large number of changes.         - I.e., touching the majority of lines in a file for format-only           changes will make it difficult for a reviewer to determine which           lines were changed for substantive reasons.         - In this case, please refrain from formatting the code prior to           opening the PR, and, instead, run <code>clang-format</code> once the PR is           approved to be merged and make that the final commit.</li> </ul> </li> <li>As of now, the <code>eamxx-format</code> workflow only considers files that are edited   by the Pull Request.</li> <li>In addition to the pass/fail status, the workflow, provides the path to any   files that caused the failure.<ul> <li>This information is found on the Summary page for any failed     <code>eamxx-format</code> Job.<sup>2</sup></li> </ul> </li> </ul> <ol> <li> <p>It turns out that this is important because there really are differences in behavior across versions.\u00a0\u21a9</p> </li> <li> <p>To get to this summary, select the Checks tab at the top of the PR page and select the <code>eamxx-format</code> workflow from the left sidebar. The summary is in the main pane of the page with the title clang-format-linter summary.<sup>3</sup> \u21a9</p> </li> <li> <p>Note that this can also be accessed the long way around by following the Actions link at the top of the E3SM repository page; select <code>eamxx-format</code> from the All workflows section of the Actions sidebar; then choose the most recent run that is associated with your PR, which should be near the top of the list.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/style/functions/","title":"Functions and Methods","text":""},{"location":"EAMxx/developer/style/functions/#naming","title":"Naming","text":"<ul> <li>Please name functions (methods) to be descriptive and verb-ish so   that the name describes what the function does.<ul> <li>For example, <code>install_flux_capacitor()</code> instead of <code>f_capacitor_method()</code>     or <code>ifc()</code>.</li> <li>To note, if your function cannot be named verb-ishly, that is probably a     sign that there is a fundamental issue with your function.</li> </ul> </li> <li>In general, functions should use <code>snake_case</code> and not contain capitalization,   unless capitalizing that quantity is a standard convention (e.g.,   <code>find_Doc_Brown()</code>).</li> </ul>"},{"location":"EAMxx/developer/style/functions/#usage","title":"Usage","text":"<ul> <li>In situations where multiple class-member variables are passed as function   arguments, favor passing the object, rather than the individual variables,   for the sake of shorter lines and function signatures.</li> <li>As a rule of thumb, developers should prefer passing arguments by reference,   rather than by value, especially in cases for which the argument is large   or structurally complex.<ul> <li>E.g., prefer <code>func(Type &amp;x) { ... }</code> versus <code>func(Type x) { ... }</code>.</li> <li>This holds true much of the time because passing by value creates a copy     of the argument for use by the function, and this increases memory     pressure and a resultant performance penalty.</li> </ul> </li> <li> <p>To be more in-depth on the topic, we echo the guidance from the   C++ Core Guidelines   and would encourage the curious to read more deeply on the topic.</p> <ul> <li>For \"in\" parameters, pass cheaply-copied types by value and others by reference to <code>const</code>.</li> <li>For \"in-out\" parameters, pass by reference to non-<code>const</code>.</li> <li>For \"out\" parameters, prefer return values to output parameters.</li> </ul> <ul> <li>The authors go on to explain that \"cheap to copy\" includes variables     holding 2 or 3 words--for example a double, pointer, or reference.</li> <li>To illustrate, the below function adheres to the provided guidance.</li> </ul> <pre><code>SmallStruct func(LargeNComplex &amp;notSmall, double forty_two,\n                 const int *laser, const BigStruct &amp;lotsaData) {\n\n  // SmallStruct object is only assigned-to and then returned, so it is\n  // defined as the return type\n  SmallStruct ans;\n  // forty_two, a scalar double, is considered small and so passed by value\n  ans.val = forty_two;\n  // lotsaData, a BigStruct object, is only accessed and so is\n  // passed by const reference\n  ans.other_val = lotsaData.small_piece;\n\n  // we pass laser by value and as const because pointers are cheap to copy,\n  // and the value is not changed\n  for (int i = 0; i &lt; forty_two; ++i) {\n    ans.val_vector.push_back(laser[i] + notSmall.epsilon[i]);\n  }\n\n  // notSmall is large and also modified in the function, so we pass by\n  // reference\n  // it is also accessed, above, so it must be an argument and not the\n  // return value\n  notSmall.ans_struct = ans;\n  return ans;\n}\n</code></pre> </li> </ul>"},{"location":"EAMxx/developer/style/style/","title":"EAMxx Code Style Standards","text":"<p>EAMxx does not currently impose strict styling standards, other than those of the autoformatter. However, if we can follow consistent style and usage guidelines, we can make EAMxx developers' lives easier and turnaround times quicker. In the age of modern text editors with autocomplete and running our code on machines with enormous storage capacity, there is no real need to save screen or disk space with minimal naming strategies or other meaning-obscuring style choices. So, please adhere to the spirit of these guidelines, and your fellow developers will thank you for it!</p>"},{"location":"EAMxx/developer/style/style/#general-guidelines","title":"General Guidelines","text":"<ul> <li>Please give descriptive, rather than terse, names to your   variables, functions, classes, etc.</li> <li>Avoid idiosyncratic naming or styling conventions.<ul> <li>If the utility of a style decision would not be immediately apparent to     a reasonable developer, please avoid its usage.</li> </ul> </li> <li>In the hierarchy of coding concerns, correctness and speed take the top   tiers, but below that level, please favor readability and clarity over   space savings, line-breaking, heavy use of arcane language features, etc.<ul> <li>That said, if an arcane language feature is the correct tool to     be used, please do so.<ul> <li>And perhaps add a comment to aid the non-Jedi-Master developers who     read the code next. </li> </ul> </li> </ul> </li> <li>With regard to comments, the general wisdom is that the correct amount of   comments is the amount required to make the code clear and easy to understand.<ul> <li>To quote     Jeff Atwood     from his essay about code comments: <p>Only at the point where the code cannot be made easier to understand   should you begin to add comments.</p> </li> <li>However, since that does not offer much in the way of prescriptive     guidance, here are some guidelines gathered from around the internet.<ul> <li>A general rule of thumb, though not always true, is that comments     should explain why something is being done in the code,     rather than what the code is doing.<sup>1</sup></li> <li>Comments should dispel confusion and not cause it.</li> <li>Comments should not duplicate the code.<sup>2</sup></li> <li>Provide links or references when using code from elsewhere or     whenever it is otherwise appropriate.</li> <li>A bad comment is worse than no comment.</li> <li>Add comments to explain non-standard usage or unidiomatic code.</li> </ul> </li> </ul> </li> </ul> <ol> <li> <p>An obvious exception to this is explaining complex or opaque parts of the code that cannot be made simpler--for instance, a clever arithmetic trick in a complicated interpolation scheme.\u00a0\u21a9</p> </li> <li> <p>For example, this type of comment does not add any information and is unnecessary.</p> <p><pre><code>// perform initialization\nthis-&gt;initialize();\n</code></pre> \u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/style/style_guide_overview/","title":"EAMxx C++ Style Guide","text":"<p>EAMxx enforces some standards on style and format. For the purpose of this guide, we draw a distinction between these two related topics and loosely define them as:</p> <ul> <li>Style<ul> <li>Style is concerned with how the code reads on a lexical level as     well as with the structural and technical decisions that determine how     the code runs.</li> <li>For example:<ul> <li>Descriptive, as opposed to terse, variable names.</li> <li>Employing small, single-purpose functions.</li> <li>Usage or non-usage of advanced C++ features.</li> <li>The usage and content of comments.</li> </ul> </li> </ul> </li> <li>Format<ul> <li>Format is the domain of how the code looks or how the code is     organized.</li> <li>The good news for formatting is that we enforce a strict, LLVM-based     formatting standard, and we employ     <code>clang-format</code>     to automatically conduct and enforce this standard.</li> </ul> </li> </ul> <p>More detail regarding each of these topics is contained in the following sections.</p>"},{"location":"EAMxx/developer/style/templates/","title":"Templating","text":"<ul> <li>Templating and polymorphism are arguably the most powerful features of C++,   but with great power comes great potential pain.<ul> <li>EAMxx makes extensive use of templates, throughout, and this is encouraged     but should be done judiciously.</li> <li>Adding complexity should only be done in service of improved     functionality or speed because these typically come at the price of     clarity and readability.</li> </ul> </li> <li>Template parameters should mostly obey the same naming conventions of the   type they correspond to.<ul> <li><code>lower_snake_case</code> for variables.<ul> <li>E.g., variables of integral types or objects.</li> </ul> </li> <li><code>UpperCamelCase</code> for types, classes, or structs.</li> <li> <p>However, terseness that follows EAMxx or Kokkos conventions can improve     readability, though favoring descriptiveness should be the default     case.</p> <ul> <li> <p>Take this <code>update()</code> function declaration as an example.</p> <pre><code>template&lt;int *atom_counter, HostOrDevice HD = Device, typename ST&gt;\nvoid update(const Field &amp;x, const ST alpha, const ST beta);\n</code></pre> </li> <li> <p>The first template parameter is an integer-pointer that self-describes.</p> </li> <li>The second template parameter, <code>HD</code> (<code>enum</code> type), is     tersely-named but the type provides sufficient descriptive     information.</li> <li>The second and third template parameters, including <code>ST</code>     (\"scalar type\"), are standard conventions used throughout EAMxx, and     the abbreviation saves an enormous amount of space in aggregate.</li> </ul> </li> </ul> </li> </ul>"},{"location":"EAMxx/developer/style/types/","title":"Types, Classes, Structures","text":""},{"location":"EAMxx/developer/style/types/#naming","title":"Naming","text":"<ul> <li>Please name types (classes, structures/<code>struct</code>, enumerations/<code>enum</code>) as   descriptive nouns,   that describe what the type is or what its purpose is.<ul> <li>As an example, <code>AtmosphericManipulator</code> and not <code>Manipulator</code> or <code>AtMnp</code>.</li> <li>If you find yourself unable to name your type this way, that may     indicate that it should be broken into independent classes, variables,     or functions.         - See FIXME: below for an example.</li> </ul> </li> <li>Types, classes, or structs should make use of <code>UpperCamelCase</code>.<ul> <li>Variables containing an object or an instance of a type, class, or struct,     should follow the     naming convention for variables     and be <code>lower_snake_case</code>.</li> </ul> </li> </ul>"},{"location":"EAMxx/developer/style/types/#usage","title":"Usage","text":"<ul> <li> <p>There should be a logical grouping among the variables and classes contained   in a type, such that the name captures that association.</p> <ul> <li> <p>To demonstrate, consider the following <code>Fruit</code> class.</p> <pre><code>class Fruit {\n  enum FruitName {Apple, Banana, Orange};\n\n  FruitName m_fruit_name;\n\n  void is_juiceable(FruitName fruit_) { ... };\n\n  enum Color {Red, Green, Blue};\n\n  Color fruit_color;\n\n  bool is_favorite_color(Color color_) { ... };\n};\n</code></pre> </li> <li> <p>It would be better to break this into a separate <code>Fruit</code> and <code>Color</code>     class because:         1. <code>Color</code> is not inherently associated with fruits--it could also            belong to, for instance, a <code>Vegetable</code> class.         2. There is no strong reason the <code>is_favorite_color()</code> needs to be a            part of <code>Fruit</code>, since it would work the same way if it knew nothing            about fruits.</p> </li> <li>Related to the previous guideline, types/classes/structs should ideally   encapsulate concepts to improve both readability and usability.</li> <li>This implies that even a small struct has a reason to exist when it     serves the goal of shrinking or simplifying the outer class.</li> <li>An example of this in EAMxx is the     <code>TimeInterval</code>     struct that only contains 4 class variables and 3 relatively simple     methods; yet, it serves to keep the     <code>DataInterpolation</code>     class smaller and better-organized.</li> </ul> </li> </ul>"},{"location":"EAMxx/developer/style/types/#organization","title":"Organization","text":"<p>For the sake of consistency to aid readability and findability, we recommend classes be organized (ordered) according to the following rules.</p> <ul> <li>Public interfaces should appear at the top of a class declaration.<ul> <li>These are the typically what other developers or users will be looking     for when reading or interacting with your code.</li> </ul> </li> <li>Place methods first and class variables last, according to the same logic as   above.</li> <li>Group methods of the same \"kind\" or \"purpose.\"<ul> <li>E.g., group getters together and separate them from state-changing     methods that are also grouped together.</li> <li>Avoid interleaving functions of different kind.</li> </ul> </li> <li>Seek to group class-variable declarations together in a meaningful way.<ul> <li>This could be according to the actual C++ type, but even better     would be done according to how the variables will be used or what     other parts of the code they will interact with.</li> <li> <p>To illustrate, in the snippet below, a class storing 2 grid-types and     a <code>bool</code> should prefer <code>class A</code> to <code>class B</code></p> <pre><code>class A {\n  MyGrid source;\n  MyGrid target;\n  bool forward;\n};\nclass B {\n  MyGrid source;\n  bool forward;\n  MyGrid target;\n};\n</code></pre> </li> </ul> </li> </ul> <p>We acknowledge that these rules do not form a complete logical schema, and so, we defer to the judgement of the developer and their willingness to consider the poor souls that will one day read their code. </p>"},{"location":"EAMxx/developer/style/variables/","title":"Variables","text":""},{"location":"EAMxx/developer/style/variables/#naming","title":"Naming","text":"<ul> <li>Please name variables as descriptive nouns.<ul> <li>That is, for a variable holding data related to horizontal winds, choose     <code>horizontal_winds</code> or even <code>horiz_winds</code> versus <code>wh</code>.</li> <li>In cases for which this may be untenable, add comments explaining     non-obvious variable names.</li> </ul> </li> <li>In general, variables should use <code>snake_case</code> and be entirely lowercase,   unless capitalizing is a standard convention (e.g., <code>T</code> for temperature).</li> <li>We do not currently employ a stylistic distinction between different types of   variables--e.g., <code>const</code>, <code>static</code>, member variables, etc.</li> <li>We do, however, ask that some convention is employed to identify member   variables of a class.<ul> <li>Some commonly used techniques include distinguishing member variables     with a leading <code>m_</code> (<code>m_var</code> \\(\\approx\\) \"my var\"), or a trailing/leading     underscore (<code>var_</code> or <code>_var</code>).</li> <li>That said, this convention should be locally consistent within a     given class, struct, or otherwise.</li> </ul> </li> <li>As to favoring nouns for naming, one should avoid using articles or   verbs in variable names.<ul> <li>The key \"exception\" here would be prefixes like <code>is_</code>, <code>has_</code>, <code>can_</code>     that are commonly used with boolean variables.</li> </ul> </li> </ul>"},{"location":"EAMxx/developer/style/variables/#usage","title":"Usage","text":""},{"location":"EAMxx/developer/style/variables/#intermediate-variables","title":"Intermediate Variables","text":"<p>There is a balance to be struck between introducing extra, or intermediate, variables and avoiding excess allocations/de-allocations or minimizing clutter.</p> <ul> <li>In line with the hierarchy of correct/fast/understandable, mentioned in   the Style Standards Overview,   it often improves matters to introduce an intermediate variable,   pointer, subview, etc., rather than triply-indexing into a variable   that's contained within a class-member struct.</li> <li>This principle applies to calculations as well, as there are situations   in which readability is improved by breaking complex operations into   multiple steps.</li> <li>Generally speaking, unless the code is highly-optimized and/or   performance-critical, usage of intermediate variables is preferred.<ul> <li>Here, readability and bug-safety are the top concerns, so the clarity     provided by descriptive intermediate variables and resultant shorter     lines, trumps most other factors.</li> </ul> </li> </ul>"},{"location":"EAMxx/developer/style/variables/#descriptive-power-vs-brevity-in-naming","title":"Descriptive Power vs. Brevity in Naming","text":"<p>There is obvious a crossover point at which a name becomes too descriptive or simply too long, so as to be cumbersome to use. Thus, the issue of descriptive naming should be balanced against brevity in name choice, and we give some examples and rules of thumb.</p> <ul> <li>Consider synonyms that may shorten a variable name without sacrificing clarity.</li> <li>Make use of common word truncations or abbreviations.<ul> <li>E.g., <code>mgr</code> instead of <code>manager</code> or <code>dev</code> in place of <code>device</code>.</li> <li>However, avoid non-standard abbreviations that may only be common     parlance within a small group.         - This includes names that correspond to standard arithmetic variables           in an equation (<code>gamma</code>, <code>y_hat</code>), unless the equation is           included as a comment and the connection is readily apparent.</li> </ul> </li> <li>The converse of the previous is avoid making contractions that negatively   impact clarity.<ul> <li>A notorious example of this is removing vowels.<ul> <li>E.g., <code>loop_cnt</code>, rather than <code>loop_count</code> provides little savings,     at the expense of clarity.<sup>1</sup></li> </ul> </li> </ul> </li> </ul> <ol> <li> <p>Much like some dangerous options-trading strategies, this practice offers limited upside, yet the potential downside is unlimited.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/developer/style/resources/clang-format_HOWTO/","title":"How-to Guide: <code>clang-format</code>","text":"<p>This guide is for developers who wish to apply <code>clang-format</code> on their chosen development machine, whether that be their personal machine or a multi-user cluster. In this guide, we will describe how to configure/run <code>clang-format</code> on EAMxx code and also how to install it if necessary.</p>"},{"location":"EAMxx/developer/style/resources/clang-format_HOWTO/#configure-and-run-clang-format","title":"Configure and Run <code>clang-format</code>","text":"<p>Running <code>clang-format</code> according to the defined EAMxx standard can be done using only command line arguments; however, the command is quite long. The easier route is to reference the configuration file (<code>$EAMXX_ROOT/.clang-format</code>). In this case the command is</p> <pre><code>clang-format [-i] --style=\"file:${EAMXX_ROOT}/.clang-format\" &lt;path/to/c++/source/file(s)&gt;\n</code></pre> <p>where the <code>-i</code> (<code>--in-place</code>) argument controls whether the formatting edits are conducted and change the source file(s) (\"in place\") or the required edits are printed to <code>stdout</code> (flag omitted). Also, note that the <code>--style</code> flag can also fully define the options without the configuration file as follows, but this is not recommended as the configuration could change before this guide is updated to reflect as such.</p> Terminal One-(long-)liner <pre><code>clang-format [-i] --style=\"{BasedOnStyle: llvm, ColumnLimit: 100, AlignConsecutiveAssignments: true, AlignConsecutiveBitFields: true, AlignConsecutiveMacros: true, AlignEscapedNewlines: true, AlignTrailingComments: true}\" &lt;path/to/c++/source/file(s)&gt;\n</code></pre>"},{"location":"EAMxx/developer/style/resources/clang-format_HOWTO/#installing-clang-format","title":"Installing <code>clang-format</code>","text":"<p>On a personal machine, which we will consider to be one for which you have <code>sudo</code> privileges, installation can be conducted via package manager or by building <code>llvm v14</code> from scratch. If you are a non-admin user of a multi-user cluster, HPC platform, etc., then it is likely to be an easy process, though potentially not immediate.</p> If you require or already have multiple versions of <code>clang-format</code> installed <p>Note that, depending on your requirements, this could be placed in your shell config file (<code>.bashrc</code>, <code>.zshrc</code>), or if only needed for a shell session, it can be done directly from the command line.</p> <p>The other option is to add a versioned symbolic link to your <code>PATH</code>. This is sometimes included in the package's <code>bin/</code> directory by default and, if not, can be added there after of placed somewhere that is already on your <code>PATH</code>.</p> <pre><code>$ cd /opt/homebrew/opt/llvm@14/bin\n$ ls clang-format*\nclang-format\n// no versioned binary so we create symlink\n$ ln -s ./clang-format ./clang-format-14\n$ which clang-format\n/opt/homebrew/opt/llvm@14/bin/clang-format-14\n</code></pre> <p>OR</p> <pre><code>$ cd /opt/homebrew/opt/llvm@14/bin\n$ ls clang-format*\nclang-format\n// no versioned binary so we create symlink in a directory already on PATH\n$ echo $PATH\n/usr/bin:/usr/local/bin\n$ ln -s ./clang-format /usr/local/bin/clang-format-14\n$ which clang-format\n/usr/local/bin/clang-format-14\n</code></pre> Personal MachineMulti-user System Mac Users (Homebrew Package Manager)Linux Users (Package Manager)Build from Source <p>For Mac users, the Homebrew package manager (<code>brew</code>) is the quickest and most straightforward way to get <code>clang-format</code> installed. Since <code>clang-format</code> v14 is not available to install directly from Homebrew, we install the entire LLVM package at version 14, and this is as simple as</p> <pre><code>brew install llvm@14\n</code></pre> <p>It it likely that Homebrew will issue a message about not linking the <code>clang</code>-related tools by default, so next we add the binary to our <code>PATH</code>.</p> <pre><code>$ export PATH=\"/opt/homebrew/opt/llvm@14/bin/clang-format:$PATH\"\n# Note: this is the default location for a recent Mac running Apple silicon.\n# It may be different on another system.\n# You can confirm where yours is installed via 'brew info llvm@14'\n$ which clang-format\n/opt/homebrew/opt/llvm@14/bin/clang-format\n</code></pre> <p>Note also, that if your system has multiple version of <code>clang-format</code> installed, it may be preferable to instead set a versioned alias to <code>clang-format</code> (<code>clang-format-14</code>) as in</p> <pre><code>// create a shell-alias\nalias clang-format-14=\"/opt/homebrew/opt/llvm@14/bin/clang-format\"\n</code></pre> <p>Given the many flavors of Linux, it is difficult to generalize, but there is a high probability the proper version of <code>clang-format</code> or <code>llvm</code> is provided by the built-in package manager. The commands will differ based on your Linux distribution, but using the Debian/Ubuntu <code>apt</code> syntax, it could be accomplished via something like</p> <pre><code>$ apt search clang-format\n[...]\nclang-format-14/...\n$ apt install clang-format-14\n</code></pre> <p>If you do not succeed in the above, <code>clang-format</code> can also be fully built from the LLVM Compiler Infrastructure. It will begin with something like</p> <pre><code>git clone git@github.com:llvm/llvm-project.git\ngit checkout llvmorg-14.0.6 # version tag\n</code></pre> <p>Also, if you only need <code>clang-format</code> and not any of the other tooling, it will build faster/smaller if you use the CMake flag <code>-DLLVM_ENABLE_PROJECTS=\"clang\"</code> to only build <code>clang</code> and it's friends, rather than all of <code>llvm</code>. And finally, the README for LLVM version 14.0.6 is far more comprehensive that the one for the latest version, and it contains instructions specific to that build.</p> <p>In many cases <code>llvm</code>, <code>clang</code>, or <code>clang-format</code> will be available as a module, though whether version 14 is an option could be less likely. In the optimistic case, it could be as simple as (using Lmod syntax)</p> <pre><code>$ module avail llvm # [clang, clang-format]\n[... list ]\n$ module load llvm/14.0.6\n</code></pre> <p>If it is not available, you will probably need to reach out to a system administrator to get an official version installed.<sup>1</sup></p> Unnecessary but Convenient Workflow Customization (<code>direnv</code>) <p>If you'd like to add a layer of automation/complexity to ensure you only use <code>clang-format v14</code> on <code>EAMxx</code> and/or want to use a newer version on the rest of your system, there is a very handy terminal tool called direnv (<code>brew install direnv</code>) that allows you to automatically load and unload environment variables based on <code>$PWD</code> using a <code>.envrc</code> file. As an example, here's my <code>.envrc</code> that adds <code>clang-format v14</code> to the path when I'm working on <code>EAMxx</code>.</p> <pre><code>PATH_add /opt/homebrew/opt/llvm@14/bin/clang-format\n\n# also, since I often forget to load a python environment that's required for\n# running ctest, this creates or loads a python 3 virtual environment with numpy\nlayout python3\npip install --upgrade pip\n# the upgrade isn't strictly necessary but trades a little extra setup on\n# the front end to avoid pip endlessly reminding you to update\npip install numpy\n</code></pre> <p>This file can be placed in the top-level <code>EAMxx</code> directory, and running <code>direnv allow</code> enables the functionality. Namely, executing <code>cd EAMxx</code> loads the defined environment that stays loaded in any subdirectories, and resets the standard environment when exiting to a directory above/outside of <code>EAMxx</code>.</p> <p>For the <code>conda</code> fans, this tool can also be used to auto-load a pre-configured <code>conda</code> environment since the <code>.envrc</code> is essentially a bash script with a few bells and whistles tacked on.</p> <ol> <li> <p>There are rumors of using <code>conda</code> creatively to do a user-install, but that is not an option we support or suggest.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/technical/","title":"EAMxx Technical Guide","text":"<p>The goal of this document is to describe the specific equations, parameterizations, and numerical methods used in the current version of EAMxx. Because our master-branch implementation changes every time we make a new commit, this documentation will also evolve continuously. As such, documentation for master should always be considered to be preliminary and under construction. If you want trustworthy documentation, pull it from an official model release.</p>"},{"location":"EAMxx/technical/#overview","title":"Overview","text":"<p>Currently, EAMxx is only configured for km-scale convection-permitting runs. In order to provide scientifically-credible simulations at lower resolution, parameterizations for the following processes would be needed:</p> <ol> <li>Deep Convection</li> <li>Gravity-Wave Drag</li> <li>Energy Fixer</li> </ol> <p>The only configuration of EAMxx that is currently implemented is the convection-permitting version, commonly known as the Simple Cloud-Resolving E3SM Atmosphere Model (SCREAM).</p> <p>Processes in EAMxx-SCREAM are:</p> <ol> <li>a non-hydrostatic version of the spectral-element dynamical core used by other E3SM Atmosphere Model versions<sup>1</sup> with semi-Lagrangian tracer advection as described by Bradley et al. (2022).<sup>2</sup></li> <li>turbulent mountain stress is crudely parameterized following Fiedler and Panofsky (1972) <sup>3</sup> to reduce excessive winds around topography.</li> <li>the Simple Higher-Order Closure (SHOC) parameterization from Bogenschutz and Krueger (2013) <sup>4</sup>, which handles turbulent diffusion, condensation/evaporation, and liquid cloud fraction.</li> <li>an all-or-nothing ice cloud fraction parameterization that sets ice cloud fraction to 100% whenever cloud ice mass \\(q_i\\) is less than a user-specified threshold set by default to 1e-5 kg/kg. This scheme also sets the total cloud fraction (used by microphysics) to the maximum of the liquid and ice cloud fraction.</li> <li>the effects of aerosol are prescribed via the Simple Prescribed Aerosol (SPA) scheme, which is very similar to MACv2-SP.<sup>5</sup></li> <li>the P3 microphysics scheme from Morrison and Milbrandt (2015) <sup>6</sup> modified as described by Caldwell et al. (2021) <sup>7</sup> to assume instantaneous liquid saturation adjustment for consistency with SHOC.</li> <li>RTE/RRTMGP radiation from Pincus et al. (2019) <sup>8</sup> rewritten in C++ for consistency and performance.</li> <li>the CFMIP Observation Simulator Package (COSP) is also integrated into EAMxx, but currently only the ISCCP output is enabled.</li> </ol> <p>By default processes are called in this order, but which processes to include and in what order is modifiable at run time. After all atmospheric processes are called, output is written. Surface components are then called before the next atmosphere step starts. These processes are described in more detail in Caldwell et al. (2021) <sup>7</sup>. As in EAM, dynamics operates on a spectral element grid and all other processes use a finite-volume grid that divides each spectral element into 4 quadrilaterals. This physics grid is described in Hannah et al. (2021) <sup>9</sup>.</p> <ol> <li> <p>Mark A. Taylor, Oksana Guba, Andrew Steyer, Paul A. Ullrich, David M. Hall, and Christopher Eldred. An energy consistent discretization of the nonhydrostatic equations in primitive variables. Journal of Advances in Modeling Earth Systems, 12(1):e2019MS001783, 2020. e2019MS001783 10.1029/2019MS001783. URL: https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2019MS001783, arXiv:https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2019MS001783, doi:https://doi.org/10.1029/2019MS001783.\u00a0\u21a9</p> </li> <li> <p>A. M. Bradley, P. A. Bosler, and O. Guba. Islet: interpolation semi-lagrangian element-based transport. Geoscientific Model Development, 15(16):6285\u20136310, 2022. URL: https://gmd.copernicus.org/articles/15/6285/2022/, doi:10.5194/gmd-15-6285-2022.\u00a0\u21a9</p> </li> <li> <p>F. Fiedler and H. A. Panofsky. The geostrophic drag coefficient and the \u2018effective\u2019 roughness length. Quarterly Journal of the Royal Meteorological Society, 98(415):213\u2013220, 1972. URL: https://rmets.onlinelibrary.wiley.com/doi/abs/10.1002/qj.49709841519, arXiv:https://rmets.onlinelibrary.wiley.com/doi/pdf/10.1002/qj.49709841519, doi:https://doi.org/10.1002/qj.49709841519.\u00a0\u21a9</p> </li> <li> <p>Peter A. Bogenschutz and Steven K. Krueger. A simplified pdf parameterization of subgrid-scale clouds and turbulence for cloud-resolving models. Journal of Advances in Modeling Earth Systems, 5(2):195\u2013211, 2013. URL: https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1002/jame.20018, doi:https://doi.org/10.1002/jame.20018.\u00a0\u21a9</p> </li> <li> <p>B. Stevens, S. Fiedler, S. Kinne, K. Peters, S. Rast, J. M\u00fcsse, S. J. Smith, and T. Mauritsen. Macv2-sp: a parameterization of anthropogenic aerosol optical properties and an associated twomey effect for use in cmip6. Geoscientific Model Development, 10(1):433\u2013452, 2017. URL: https://gmd.copernicus.org/articles/10/433/2017/, doi:10.5194/gmd-10-433-2017.\u00a0\u21a9</p> </li> <li> <p>Hugh Morrison and Jason A. Milbrandt. Parameterization of cloud microphysics based on the prediction of bulk ice particle properties. part i: scheme description and idealized tests. Journal of the Atmospheric Sciences, 72(1):287 \u2013 311, 2015. URL: https://journals.ametsoc.org/view/journals/atsc/72/1/jas-d-14-0065.1.xml, doi:10.1175/JAS-D-14-0065.1.\u00a0\u21a9</p> </li> <li> <p>P. M. Caldwell, C. R. Terai, B. Hillman, N. D. Keen, P. Bogenschutz, W. Lin, H. Beydoun, M. Taylor, L. Bertagna, A. M. Bradley, T. C. Clevenger, A. S. Donahue, C. Eldred, J. Foucar, J.-C. Golaz, O. Guba, R. Jacob, J. Johnson, J. Krishna, W. Liu, K. Pressel, A. G. Salinger, B. Singh, A. Steyer, P. Ullrich, D. Wu, X. Yuan, J. Shpund, H.-Y. Ma, and C. S. Zender. Convection-permitting simulations with the e3sm global atmosphere model. Journal of Advances in Modeling Earth Systems, 13(11):e2021MS002544, 2021. e2021MS002544 2021MS002544. URL: https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2021MS002544, arXiv:https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2021MS002544, doi:https://doi.org/10.1029/2021MS002544.\u00a0\u21a9\u21a9</p> </li> <li> <p>Robert Pincus, Eli J. Mlawer, and Jennifer S. Delamere. Balancing accuracy, efficiency, and flexibility in radiation calculations for dynamical models. Journal of Advances in Modeling Earth Systems, 11(10):3074\u20133089, 2019. URL: https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2019MS001621, arXiv:https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2019MS001621, doi:https://doi.org/10.1029/2019MS001621.\u00a0\u21a9</p> </li> <li> <p>Walter M. Hannah, Andrew M. Bradley, Oksana Guba, Qi Tang, Jean-Christophe Golaz, and Jon Wolfe. Separating physics and dynamics grids for improved computational efficiency in spectral element earth system models. Journal of Advances in Modeling Earth Systems, 13(7):e2020MS002419, 2021. e2020MS002419 2020MS002419. URL: https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2020MS002419, arXiv:https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2020MS002419, doi:https://doi.org/10.1029/2020MS002419.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/technical/aerocom_cldtop/","title":"The AeroCom algorithm","text":"<p>The goal of the AeroCom algorithm is to calculate properties at cloud top based on the AeroCom recommendation. There are two main parts of the algorithm: probabilistically determining \"cloud top\" and then \"calculating properties\" at said cloud top.</p> <p>We treat model columns independently, so we loop over all columns in parallel. We then loop over all layers in serial (due to needing an accumulative product), starting at 2 (second highest) layer because the highest is assumed to have no clouds. Let's take a photonic approach from above the model top. Let's say that \\(p_{k}\\) is the probability of a photon passing through the layer \\(k\\). We follow the maximum-random overlap assumption. In all cases, we assume the cloudiness (or cloudy fraction) is completely opaque.</p> <p>We assume the highest layer has no clouds, thus the \\(p_{k} = 1\\) for the highest layer. Note that \\(p_{k}\\) is initialized as 1 for all layers. We also clip the cloudy fraction \\(C_{i,k}\\) to ensure that \\(C_{i,k} \\in [0+\\epsilon, 1-\\epsilon]\\), where \\(\\epsilon = 0.001\\). Starting at the second highest layer, \\(k+1\\), we check if some \"cloudy\" conditions are met. These conditions are now arbitrarily defined by a cloudiness threshold of \\(\\epsilon\\) (i.e., \\(C_{i,k}&gt;\\epsilon\\)) and a non-zero threshold on the total (both liquid and ice) droplet number concentration (i.e., \\(cQ_{i,k} + iQ_{i,k} &gt; 0\\)). If the conditions are met, we estimate the cloud-top cloud fraction using an accumulative product following the maximum-random overlap assumption.</p> \\[c_{i} = 1 - \\prod_{k=2}^{K} p_{k} = 1 - \\prod_{k=2}^{K} \\frac{1 - \\max(C_{i,k}, C_{i,k-1})}{1-C_{i,k-1}}\\] <p>In order to estimate cloud-top properties, we weight by the probability of \"remaining cloudiness\" or \\(p_{k-1} - p_{k}\\).</p> Type Equation cloud property \\(x_{i} = \\sum_{k=2}^{K} X_{i,k} \\Phi_{i,k} (p_{k-1} - p_{k})\\) cloud content \\(x_{i} = \\sum_{k=2}^{K} \\Phi_{i,k} (p_{k-1} - p_{k})\\) other property \\(x_{i} = \\sum_{k=2}^{K} X_{i,k} (p_{k-1} - p_{k})\\) <p>In the above, \\(\\Phi_{i,k}\\) is the thermodynamic phase defined by the cloud droplet number concentration ratios.</p> \\[i\\Phi_{i,k} = \\frac{iQ_{i,k}}{iQ_{i,k} + cQ_{i,k}}\\] \\[c\\Phi_{i,k} = \\frac{cQ_{i,k}}{iQ_{i,k} + cQ_{i,k}}\\] <p>The thermodynamic phase is used only for cloud properties (e.g., cloud-top cloud droplet number concentration) or cloud content (e.g., cloud liquid content). Further, \\(X_{i,k}\\) is the three-dimensional cloud property of interest which is needed if we are converting a property from three-dimensional (\\(X\\)) to its two-dimensional counterpart (\\(x\\)). \"Other\" properties here include temperature and pressure which are not dependent on the thermodynamic phase.</p> <p>Most studies in this topic refer a technical report by Tiedtke et al. (1979)<sup>1</sup>. Another more recent general reference that may be of interest is that of R\u00e4is\u00e4nen et al. (2004)<sup>2</sup>.</p> <ol> <li> <p>M. Tiedtke, J.-F. Geleyn, A. Hollingsworth, and J.-F. Louis. ECMWF model parameterisation of sub-grid scale processes. Technical Report, ECMWF, Shinfield Park, Reading, January 1979. 10.\u00a0\u21a9</p> </li> <li> <p>Petri R\u00e4is\u00e4nen, Howard W Barker, Marat F Khairoutdinov, Jiangnan Li, and David A Randall. Stochastic generation of subgrid-scale cloudy columns for large-scale models. Quarterly Journal of the Royal Meteorological Society: A journal of the atmospheric sciences, applied meteorology and physical oceanography, 130(601):2047\u20132067, 2004.\u00a0\u21a9</p> </li> </ol>"},{"location":"EAMxx/user/","title":"EAMxx User Guide","text":"<p>This section contains documentation on how to create, setup, and run CIME cases with EAMxx as the atmosphere component. It is assumed that the reader has a familiarity with the CIME Case Control System. In particular, we assume that the user knows how to create a case, and what the <code>case.setup</code>, <code>case.build</code>, and <code>case.submit</code> commands do.</p> <p>This user guide is still under construction. In the meantime, in case you do not find the information you need, we suggest visiting our public EAMxx user guide on Confluence.</p>"},{"location":"EAMxx/user/clean_clear_sky/","title":"Clean- and clean-clear-sky diagnostics","text":"<p>In order to decompose the aerosol effective radiative forcing, additional diagnostic radiation calls are needed. These extra diagnostics are optionally added to the main radiation call. The extra diagnostics are:</p> <ul> <li>Clean-clear-sky fluxes: the fluxes that would be present if there were neither aerosols nor clouds, and are calculated by adding an additional radiation call at the very beginning of the logic before the optics class is endowed with aerosol and cloud properties.</li> <li>Clean-sky fluxes: the fluxes that would be present if there were no aerosols, and are calculated by adding an additional radiation call after substantiating an additional optics class, but not endowing it with aerosol properties.</li> </ul>"},{"location":"EAMxx/user/clean_clear_sky/#example-setup-current-as-of-april-2024","title":"Example setup (current as of April 2024)","text":"<p>The extra calls are controlled by runtime flags <code>extra_clnclrsky_diag</code> and <code>extra_clnsky_diag</code> (they take either <code>true</code> or <code>false</code> as their values).</p> <pre><code>    ./atmchange extra_clnclrsky_diag=true\n    ./atmchange extra_clnsky_diag=true\n</code></pre> <p>Below is an example output file to output the extra (clean and clean-clear-sky) radiation diagnostics atop the atmosphere.</p> <pre><code>%YAML 1.1\n---\nfilename_prefix: monthly.outputs\naveraging_type: average\nmax_snapshots_per_file: 1\nfields:\n  physics_pg2:\n    field_names:\n    - SW_clnclrsky_flux_up_at_model_top\n    - LW_clnclrsky_flux_up_at_model_top\n    - SW_clnsky_flux_up_at_model_top\n    - LW_clnsky_flux_up_at_model_top\noutput_control:\n  frequency: 1\n  frequency_units: nmonths\n</code></pre>"},{"location":"EAMxx/user/cosp/","title":"CFMIP Observation Simulator Package (COSP) in EAMxx","text":"<p>COSP is partially implemented and supported in EAMxx. Currently, minimal outputs from the ISCCP, MODIS, and MISR simulators have been enabled.</p>"},{"location":"EAMxx/user/cosp/#running-with-cosp","title":"Running with COSP","text":"<p>Turning COSP on simply requires adding the <code>cosp</code> process to <code>atm_procs_list</code> via <code>atmchange</code> in a case directory:</p> <pre><code>./atmchange physics::atm_procs_list=\"mac_aero_mic,rrtmgp,cosp\"\n</code></pre> <p>Additionally, the frequency at which COSP is run can be configured via <code>atmchange</code>:</p> <pre><code>./atmchange physics::cosp::cosp_frequency_units=\"steps\"\n./atmchange physics::cosp::cosp_frequency=1\n</code></pre> <p>COSP can be run with or without subcolumn sampling. This is configured by changing the <code>cosp_subcolumns</code> namelist variable via <code>atmchange</code>. A value of 1 implies no subcolumn sampling, while values greater than 1 specify the number of subcolumns to use for subcolumn sampling (assuming maximum-random overlap). E.g.,</p> <pre><code>./atmchange physics::cosp:cosp_subcolumns=1\n</code></pre> <p>would disable subcolumn sampling, while</p> <pre><code>./atmchange physics::cosp::cosp_subcolumns=10\n</code></pre> <p>would use 10 subcolumns for the COSP internal subcolumn sampling using <code>SCOPS</code>/<code>PREC_SCOPS</code>. The default for high resolution cases (e.g., <code>ne1024</code>) should be to not use subcolumns, while lower resolutions (e.g., <code>ne30</code>) should enable subcolumn sampling.</p> <p>Output streams need to be added manually. A minimal example:</p> <pre><code>./atmchange output_yaml_files=eamxx_daily_output.yaml\ncat &lt;&lt; EOF &gt; eamxx_cosp_daily_output.yaml\naveraging_type: average\nfields:\n  physics_pg2:\n    field_names:\n    - isccp_cldtot\n    - isccp_ctptau\n    - modis_ctptau\n    - misr_cthtau\n    - cosp_sunlit\nmax_snapshots_per_file: 1\nfilename_prefix: eamxx\noutput_control:\n  frequency: 1\n  frequency_units: ndays\nEOF\n</code></pre>"},{"location":"EAMxx/user/cosp/#available-output-fields","title":"Available output fields","text":"<p>The following output fields are available:</p> <ul> <li><code>isccp_cldtot</code><ul> <li>total cloud area from ISCCP simulator</li> </ul> </li> <li><code>isccp_ctptau</code><ul> <li>ISCCP-simulated cloud top pressure/optical depth joint histogram</li> </ul> </li> <li><code>modis_ctptau</code><ul> <li>MODIS-simulated cloud top pressure/optical depth joint histogram</li> </ul> </li> <li><code>misr_cthtau</code><ul> <li>MISR-simulated cloud top height/optical depth joint histogram</li> </ul> </li> <li><code>cosp_sunlit</code><ul> <li>sunlit flag aggregated at COSP frequency for renormalizing daytime averages</li> </ul> </li> </ul> <p>ISCCP, MODIS, and MISR outputs are valid only for daytime/sunlit columns (to be consistent with available satellite retrievals). In order to aggregate only daytime columns in time averages, these outputs are multiplied by the sunlit flag (0 or 1) at each COSP calculation time. Time averages of these quantities are then aggregated, along with the COSP sunlit flag each time COSP is called. In order to back out the daytime-only time averages from the outputs, one needs to divide the output fields by <code>cosp_sunlit</code>. E.g.,</p> <pre><code>isccp_ctptau = mean(isccp_ctptau) / mean(cosp_sunlit)\n</code></pre>"},{"location":"EAMxx/user/dp_eamxx/","title":"Doubly Periodic (DP) EAMxx","text":"<p>To run the DP configuration of EAMxx (DP-EAMxx) please refer to the official DP resource page.  At this location you will find full documentation of case descriptions and access to run scripts.  Using these scripts, you should be able to get DP-EAMxx up and running in a matter of minutes on any machine that EAMxx currently runs on (CPU or GPU).</p>"},{"location":"EAMxx/user/eamxx2py/","title":"Calling python code from EAMxx atmosphere processes","text":""},{"location":"EAMxx/user/eamxx2py/#requirements","title":"Requirements","text":"<p>In order to call python code from an EAMxx atmosphere process, EAMxx must be build with the CMake option <code>EAMXX_ENABLE_PYTHON=ON</code>, and the CMake variable <code>Python_EXECUTABLE</code> must point to a python3 executable, with python version &gt;= 3.9. Additionally, the python package <code>pybind11</code> must be installed (e.g., via pip or conda).</p> <p>If <code>EAMXX_ENABLE_PYTHON=OFF</code>, none of the code that is needed to call python from EAMxx will be compiled.</p>"},{"location":"EAMxx/user/eamxx2py/#usage","title":"Usage","text":"<p>If python support is enabled, every atmosphere process stores data structures that can hold python-compatible arrays and modules. During construction, if the input parameter list contains a non-trivial entry for the key <code>py_module_name</code>, EAMxx will automatically set up these data structures. In particular, EAMxx will</p> <ul> <li>create python-compatible arrays for each of the input/output/internal   fields that are registered in the class. These are stored in two maps:   <code>m_py_fields_dev</code> and <code>m_py_fields_host</code>, which store python-compatible   arrays for the device and host views of the Field, respectively. The maps   are in fact nested maps, so that the python-compatible array for field X   on grid Y can be retrieved via <code>m_py_fields_host[Y][X]</code>.</li> <li>load the python module provided via parameter list, so that its interfaces   can later be called during init/run phases. The module is then stored in   the local member <code>m_py_module</code>. If the module is in a non-standard path,   the parameter list entry <code>py_module_path</code> can be used to specify its path,   which will be added to python's search path before loading the module.</li> </ul> <p>Due to implementation details in the pybind11 library, and to avoid compiler warnings, all the python-compatible data structures are stored wrapped inside <code>std::any</code> objects. As such, the need to be properly casted to the correct underlying type before being used. In particular, the fields and module can be casted as follows:</p> <pre><code>  auto&amp; f = std::any_cast&lt;pybind11::array&amp;&gt;(m_py_fields_host[grid_name][fname]);\n  auto&amp; pymod = std::any_cast&lt;pybind11::module&amp;&gt;(m_py_module);\n</code></pre> <p>Once the module is available, a function from it can be called using the <code>attr</code> method of the module. For instance, if the module had a function <code>run</code> that takes 2 arrays and a double (in this order), it can be invoked via</p> <pre><code> pymod.attr(\"run\")(f1,f2,my_double);\n</code></pre> <p>where <code>f1</code> and <code>f2</code> are of type <code>pybind11::array</code> (e.g., casted from objects in <code>m_py_fields_host</code>).</p>"},{"location":"EAMxx/user/eamxx2py/#example","title":"Example","text":"<p>We provided an example of how to use this feature in <code>eamxx_cld_fraction_process_interface.cpp</code>, which is a very small and simple atmosphere process. We paste here the code, which shows how to support both C++ and python implemenation in the same cpp file</p> <pre><code>#ifdef EAMXX_HAS_PYTHON\n  if (m_py_module.has_value()) {\n    // For now, we run Python code only on CPU\n    const auto&amp; py_fields = m_py_fields_host.at(m_grid-&gt;name());\n\n    const auto&amp; py_qi                = std::any_cast&lt;const py::array&amp;&gt;(py_fields.at(\"qi\"));\n    const auto&amp; py_liq_cld_frac      = std::any_cast&lt;const py::array&amp;&gt;(py_fields.at(\"cldfrac_liq\"));\n    const auto&amp; py_ice_cld_frac      = std::any_cast&lt;const py::array&amp;&gt;(py_fields.at(\"cldfrac_ice\"));\n    const auto&amp; py_tot_cld_frac      = std::any_cast&lt;const py::array&amp;&gt;(py_fields.at(\"cldfrac_tot\"));\n    const auto&amp; py_ice_cld_frac_4out = std::any_cast&lt;const py::array&amp;&gt;(py_fields.at(\"cldfrac_ice_for_analysis\"));\n    const auto&amp; py_tot_cld_frac_4out = std::any_cast&lt;const py::array&amp;&gt;(py_fields.at(\"cldfrac_tot_for_analysis\"));\n\n    // Sync input to host\n    liq_cld_frac.sync_to_host();\n\n    const auto&amp; py_module = std::any_cast&lt;const py::module&amp;&gt;(m_py_module);\n    double ice_threshold      = m_params.get&lt;double&gt;(\"ice_cloud_threshold\");\n    double ice_4out_threshold = m_params.get&lt;double&gt;(\"ice_cloud_for_analysis_threshold\");\n    py_module.attr(\"main\")(ice_threshold,ice_4out_threshold,py_qi,py_liq_cld_frac,py_ice_cld_frac,py_tot_cld_frac,py_ice_cld_frac_4out,py_tot_cld_frac_4out);\n\n    // Sync outputs to dev\n    qi.sync_to_dev();\n    liq_cld_frac.sync_to_dev();\n    ice_cld_frac.sync_to_dev();\n    tot_cld_frac.sync_to_dev();\n    ice_cld_frac_4out.sync_to_dev();\n    tot_cld_frac_4out.sync_to_dev();\n  } else\n#endif\n  {\n    auto qi_v                = qi.get_view&lt;const Pack**&gt;();\n    auto liq_cld_frac_v      = liq_cld_frac.get_view&lt;const Pack**&gt;();\n    auto ice_cld_frac_v      = ice_cld_frac.get_view&lt;Pack**&gt;();\n    auto tot_cld_frac_v      = tot_cld_frac.get_view&lt;Pack**&gt;();\n    auto ice_cld_frac_4out_v = ice_cld_frac_4out.get_view&lt;Pack**&gt;();\n    auto tot_cld_frac_4out_v = tot_cld_frac_4out.get_view&lt;Pack**&gt;();\n\n    CldFractionFunc::main(m_num_cols,m_num_levs,m_icecloud_threshold,m_icecloud_for_analysis_threshold,\n      qi_v,liq_cld_frac_v,ice_cld_frac_v,tot_cld_frac_v,ice_cld_frac_4out_v,tot_cld_frac_4out_v);\n  }\n</code></pre> <p>A few observations:</p> <ul> <li><code>m_py_module.has_value()</code> is a good way to check if the <code>std::any</code> object is storing anything or it's empty.   If empty, it means that the user did not specify the <code>py_module_name</code> input option. In this case, we interpret   this as \"proceed with the C++ implementation\", but of course, another process may only offer a python   implementation, in which case it would make sense to error out if the check fails.</li> <li>the namespace alias <code>py = pybind11</code> was used in this implementation. This is a common (and sometimes   recommended) practice.</li> <li>when casting to pybind11 data structures, we used const references, for both inputs and outputs. The reason   for using a reference is to avoid copy construction of pybind11 structures (even though they are usually   lightweight). The const qualifier is not really important, as python has no corresponding concept, and the   code would have been perfectly fine (and working the same way) without <code>const</code>.</li> <li>when passing host arrays to python, keep in mind that EAMxx only requires that device views be kept up to   date by atmosphere processes. Hence, you must take care of syncing to host all inputs before calling the   python interfaces, as well as syncing to device the outputs upon return.</li> </ul> <p>The python implemenetation of the CldFraction process is provided in <code>cld_fraction.py</code>, in the same folder as the process interface.</p>"},{"location":"EAMxx/user/eamxx_cases/","title":"Basics of EAMxx cases","text":"<p>This section explains how to create a case which uses EAMxx as the atmosphere model, as well as what are the currently supported compsets and grids for EAMxx.</p>"},{"location":"EAMxx/user/eamxx_params/","title":"EAMxx runtime configurable parameters","text":""},{"location":"EAMxx/user/eamxx_params/#atmosphere-processes-parameters","title":"Atmosphere Processes Parameters","text":""},{"location":"EAMxx/user/eamxx_params/#eamxx","title":"eamxx","text":"<ul> <li>eamxx::atm_procs_list:<ul> <li>description: List of atm processes in this atm process group</li> <li>type: array(string)</li> </ul> </li> <li>eamxx::type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>eamxx::schedule_type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>valid values: sequential</li> </ul> </li> <li>eamxx::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>eamxx::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>eamxx::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>eamxx::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>eamxx::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>eamxx::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#sc_import","title":"sc_import","text":"<ul> <li>sc_import::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>sc_import::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>sc_import::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>sc_import::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>sc_import::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>sc_import::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#sc_export","title":"sc_export","text":"<ul> <li>sc_export::prescribed_constants::fields:<ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li> <p>sc_export::prescribed_constants::values:</p> <ul> <li>description: MISSING</li> <li>type: array(real)</li> </ul> </li> <li> <p>sc_export::prescribed_from_file::fields:</p> <ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li>sc_export::prescribed_from_file::files:<ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li> <p>sc_export::prescribed_from_file::fields_alt_name:</p> <ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li> <p>sc_export::number_of_subcycles:</p> <ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>sc_export::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>sc_export::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>sc_export::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>sc_export::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>sc_export::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#homme","title":"homme","text":"<ul> <li>homme::moisture:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>homme::enable_column_conservation_checks:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>homme::enable_energy_fixer:<ul> <li>description: Turn on energy fixer for dycore (fixes dycore, pressure adjustment, PD coupling)</li> <li>type: logical</li> </ul> </li> <li>homme::enable_energy_fixer_debug_info:<ul> <li>description: Prints debug info that energy fixer indeed fixed energy (cost of an MPI reduce)</li> <li>type: logical</li> </ul> </li> <li>homme::bfb_hash:<ul> <li>description: MISSING</li> <li>type: integer</li> </ul> </li> <li>homme::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>homme::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>homme::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>homme::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>homme::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>homme::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#p3","title":"p3","text":"<ul> <li>p3::do_prescribed_ccn:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>p3::use_hetfrz_classnuc:<ul> <li>description: Switch to turn on heterogeneous freezing due to prognostic aerosols</li> <li>type: logical</li> </ul> </li> <li>p3::do_predict_nc:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>p3::enable_column_conservation_checks:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>p3::max_total_ni:<ul> <li>description: maximum total ice concentration (sum of all categories)</li> <li>type: real</li> <li>constraints: gt 0</li> </ul> </li> <li>p3::tables:<ul> <li>description: MISSING</li> <li>type: array(file)</li> </ul> </li> <li>p3::autoconversion_prefactor:<ul> <li>description: Autoconversion linear prefactor</li> <li>type: real</li> </ul> </li> <li>p3::autoconversion_qc_exponent:<ul> <li>description: Autoconversion qc exponent</li> <li>type: real</li> </ul> </li> <li>p3::autoconversion_nc_exponent:<ul> <li>description: Autoconversion nc exponent</li> <li>type: real</li> </ul> </li> <li>p3::autoconversion_radius:<ul> <li>description: Autoconversion droplet radius in meter</li> <li>type: real</li> </ul> </li> <li>p3::accretion_prefactor:<ul> <li>description: Accretion linear prefactor</li> <li>type: real</li> </ul> </li> <li>p3::accretion_qc_exponent:<ul> <li>description: Accretion qc exponent</li> <li>type: real</li> </ul> </li> <li>p3::accretion_qr_exponent:<ul> <li>description: Accretion qr exponent</li> <li>type: real</li> </ul> </li> <li>p3::rain_selfcollection_prefactor:<ul> <li>description: Rain self-collection prefactor</li> <li>type: real</li> </ul> </li> <li>p3::rain_selfcollection_breakup_diameter:<ul> <li>description: Rain self-collection breakup diameter in meter</li> <li>type: real</li> </ul> </li> <li>p3::constant_mu_rain:<ul> <li>description: Constant shape parameter (mu) in the rain droplet distribution</li> <li>type: real</li> </ul> </li> <li>p3::spa_ccn_to_nc_factor:<ul> <li>description: Scaling factor for turning SPA ccn into P3 nc</li> <li>type: real</li> </ul> </li> <li>p3::spa_ccn_to_nc_exponent:<ul> <li>description: Exponent for turning SPA ccn into P3 nc</li> <li>type: real</li> </ul> </li> <li>p3::cldliq_to_ice_collection_factor:<ul> <li>description: Cloud liquid to ice collection scaling factor</li> <li>type: real</li> </ul> </li> <li>p3::rain_to_ice_collection_factor:<ul> <li>description: Rain to ice collection scaling factor</li> <li>type: real</li> </ul> </li> <li>p3::min_rime_rho:<ul> <li>description: Minimum rime density in kg/m3</li> <li>type: real</li> </ul> </li> <li>p3::max_rime_rho:<ul> <li>description: Maximum rime density in kg/m3</li> <li>type: real</li> </ul> </li> <li>p3::immersion_freezing_exponent:<ul> <li>description: Immersion freezing exponent for both rain and cloud liquid</li> <li>type: real</li> </ul> </li> <li>p3::deposition_nucleation_exponent:<ul> <li>description: Deposition nucleation exponent factor</li> <li>type: real</li> </ul> </li> <li>p3::ice_sedimentation_factor:<ul> <li>description: Ice sedimentation fall speed factor</li> <li>type: real</li> </ul> </li> <li>p3::do_ice_production:<ul> <li>description: Flag to turn on ice production processes (loss processes unaffected)</li> <li>type: logical</li> </ul> </li> <li>p3::set_cld_frac_l_to_one:<ul> <li>description: set P3 input liquid cloud fraction to 1 everywhere</li> <li>type: logical</li> </ul> </li> <li>p3::set_cld_frac_r_to_one:<ul> <li>description: set P3 input rain cloud fraction to 1 everywhere</li> <li>type: logical</li> </ul> </li> <li>p3::set_cld_frac_i_to_one:<ul> <li>description: set P3 input ice cloud fraction to 1 everywhere</li> <li>type: logical</li> </ul> </li> <li>p3::use_separate_ice_liq_frac:<ul> <li>description: use separate ice and liquid cloud fractions from shoc</li> <li>type: logical</li> </ul> </li> <li>p3::extra_p3_diags:<ul> <li>description: Extra P3 diagnostics</li> <li>type: logical</li> </ul> </li> <li>p3::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>p3::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>p3::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>p3::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>p3::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>p3::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#shoc","title":"shoc","text":"<ul> <li>shoc::enable_column_conservation_checks:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>shoc::check_flux_state_consistency:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>shoc::lambda_low:<ul> <li>description: minimum value of stability correction.</li> <li>type: real</li> </ul> </li> <li>shoc::lambda_high:<ul> <li>description: maximum value of stability correction.</li> <li>type: real</li> </ul> </li> <li>shoc::lambda_slope:<ul> <li>description: slope of change from lambda_low to lambda_high.</li> <li>type: real</li> </ul> </li> <li>shoc::lambda_thresh:<ul> <li>description: stability threshold for which to apply more stability correction.</li> <li>type: real</li> </ul> </li> <li>shoc::thl2tune:<ul> <li>description: Temperature variance tuning factor</li> <li>type: real</li> </ul> </li> <li>shoc::qw2tune:<ul> <li>description: Moisture variance tuning factor</li> <li>type: real</li> </ul> </li> <li>shoc::qwthl2tune:<ul> <li>description: Temperature moisture covariance</li> <li>type: real</li> </ul> </li> <li>shoc::w2tune:<ul> <li>description: Vertical velocity variance</li> <li>type: real</li> </ul> </li> <li>shoc::length_fac:<ul> <li>description: Length scale factor</li> <li>type: real</li> </ul> </li> <li>shoc::c_diag_3rd_mom:<ul> <li>description: Third moment vertical velocity damping factor</li> <li>type: real</li> </ul> </li> <li>shoc::coeff_kh:<ul> <li>description: Eddy diffusivity coefficient for heat</li> <li>type: real</li> </ul> </li> <li>shoc::coeff_km:<ul> <li>description: Eddy diffusivity coefficient for momentum</li> <li>type: real</li> </ul> </li> <li>shoc::extra_shoc_diags:<ul> <li>description: Extra SHOC diagnostics</li> <li>type: logical</li> </ul> </li> <li>shoc::shoc_1p5tke:<ul> <li>description: turn off SGS variability in SHOC, effectively reducing it to a 1.5 TKE closure</li> <li>type: logical</li> </ul> </li> <li>shoc::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>shoc::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>shoc::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>shoc::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>shoc::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>shoc::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_atm_proc_base","title":"mam4_atm_proc_base","text":"<ul> <li>mam4_atm_proc_base::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_atm_proc_base::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_atm_proc_base::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_atm_proc_base::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_atm_proc_base::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_atm_proc_base::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_atm_proc_base::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_atm_proc_base::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_aci","title":"mam4_aci","text":"<ul> <li>mam4_aci::wsubmin:<ul> <li>description: Minimum diagnostic sub-grid vertical velocity</li> <li>type: real</li> </ul> </li> <li>mam4_aci::enable_aero_vertical_mix:<ul> <li>description: Enable vertical mixing of interstitial aerosols and liquid number during activation</li> <li>type: logical</li> </ul> </li> <li>mam4_aci::top_level_mam4xx:<ul> <li>description: Level corresponding to the top of troposphere clouds</li> <li>type: integer</li> </ul> </li> <li>mam4_aci::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_aci::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_aci::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_aci::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_aci::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_aci::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_aci::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_aci::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_drydep","title":"mam4_drydep","text":"<ul> <li>mam4_drydep::fractional_land_use_file:<ul> <li>description: File containing Fractional land use data for drydep</li> <li>type: file</li> </ul> </li> <li>mam4_drydep::drydep_remap_file:<ul> <li>description: File containing mapping data from the grid of frac land use files to the model grid. Unused if the grid is the same.</li> <li>type: file</li> </ul> </li> <li>mam4_drydep::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_drydep::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_drydep::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_drydep::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_drydep::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_drydep::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_drydep::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_drydep::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#cld_fraction","title":"cld_fraction","text":"<ul> <li>cld_fraction::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>cld_fraction::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>cld_fraction::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>cld_fraction::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>cld_fraction::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>cld_fraction::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_aero_microphys","title":"mam4_aero_microphys","text":"<ul> <li>mam4_aero_microphys::extra_mam4_aero_microphys_diags:<ul> <li>description: Extra MAM4xx aerosol microphysics diagnostics</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::mam4_do_cond:<ul> <li>description: Switch to enable aerosol microphysics condensation process</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::mam4_do_newnuc:<ul> <li>description: Switch to enable aerosol microphysics nucleation process</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::mam4_do_coag:<ul> <li>description: Switch to enable aerosol microphysics coagulation process</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::mam4_do_rename:<ul> <li>description: Switch to enable aerosol microphysics rename process</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::mam4_o3_tau:<ul> <li>description: Linoz tau parameter</li> <li>type: real</li> </ul> </li> <li>mam4_aero_microphys::mam4_o3_sfc:<ul> <li>description: Linoz surface parameter</li> <li>type: real</li> </ul> </li> <li>mam4_aero_microphys::mam4_o3_lbl:<ul> <li>description: Linoz lbl parameter</li> <li>type: integer</li> </ul> </li> <li>mam4_aero_microphys::mam4_psc_T:<ul> <li>description: Linoz psc ozone loss temperature (K) threshold</li> <li>type: real</li> </ul> </li> <li>mam4_aero_microphys::mam4_linoz_ymd:<ul> <li>description: MISSING</li> <li>type: integer</li> </ul> </li> <li>mam4_aero_microphys::mam4_linoz_file_name:<ul> <li>description: LINOZ chemistry file</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_oxid_ymd:<ul> <li>description: MISSING</li> <li>type: integer</li> </ul> </li> <li>mam4_aero_microphys::mam4_oxid_file_name:<ul> <li>description: File containing oxidants data</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_chlorine_loading_ymd:<ul> <li>description: Cycle year for chlorine</li> <li>type: integer</li> </ul> </li> <li>mam4_aero_microphys::mam4_linoz_chlorine_file:<ul> <li>description: File containing chlorine data</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_rsf_file:<ul> <li>description: File containing photolysis data</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_xs_long_file:<ul> <li>description: File containing photolysis data</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::elevated_emiss_ymd:<ul> <li>description: MISSING</li> <li>type: integer</li> </ul> </li> <li>mam4_aero_microphys::mam4_season_wes_file:<ul> <li>description: File containing season_wes data</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_so2_elevated_emiss_file_name:<ul> <li>description: elevated emissions for so2</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_so4_a1_elevated_emiss_file_name:<ul> <li>description: elevated emissions for so4_a1</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_so4_a2_elevated_emiss_file_name:<ul> <li>description: elevated emissions for ao4_a2</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_pom_a4_elevated_emiss_file_name:<ul> <li>description: elevated emissions for pom_a4</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_bc_a4_elevated_emiss_file_name:<ul> <li>description: elevated emissions for bc_a4</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_num_a1_elevated_emiss_file_name:<ul> <li>description: elevated emissions for num_a1</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_num_a2_elevated_emiss_file_name:<ul> <li>description: elevated emissions for num_a2</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_num_a4_elevated_emiss_file_name:<ul> <li>description: elevated emissions for num_a4</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::mam4_soag_elevated_emiss_file_name:<ul> <li>description: elevated emissions for soag</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::aero_microphys_remap_file:<ul> <li>description: File containing mapping data from the grid of frac land use files to the model grid. Unused if the grid is the same.</li> <li>type: file</li> </ul> </li> <li>mam4_aero_microphys::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_aero_microphys::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_aero_microphys::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_aero_microphys::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_aero_microphys::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_optics","title":"mam4_optics","text":"<ul> <li>mam4_optics::mam4_mode1_physical_properties_file:<ul> <li>description: File containing optical properties for MAM4 mode 1, accumulation mode</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_mode2_physical_properties_file:<ul> <li>description: File containing optical properties for MAM4 mode 2, Aitken mode</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_mode3_physical_properties_file:<ul> <li>description: File containing optical properties for MAM4 mode 3, coarse mode</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_mode4_physical_properties_file:<ul> <li>description: File containing optical properties for MAM4 mode 4, p-carbon mode</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_water_refindex_file:<ul> <li>description: File containing optical properties for aerosol water</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_soa_physical_properties_file:<ul> <li>description: File containing optical properties for secondary organic aerosol</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_dust_physical_properties_file:<ul> <li>description: File containing optical properties for dust</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_nacl_physical_properties_file:<ul> <li>description: File containing optical properties for sea salt</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_so4_physical_properties_file:<ul> <li>description: File containing optical properties for sulfate</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_pom_physical_properties_file:<ul> <li>description: File containing optical properties for primary organic aerosol</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_bc_physical_properties_file:<ul> <li>description: File containing optical properties for black carbon</li> <li>type: file</li> </ul> </li> <li>mam4_optics::mam4_mom_physical_properties_file:<ul> <li>description: File containing optical properties for marine organic aerosol</li> <li>type: file</li> </ul> </li> <li>mam4_optics::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_optics::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_optics::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_optics::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_optics::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_optics::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_optics::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_optics::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_wetscav","title":"mam4_wetscav","text":"<ul> <li>mam4_wetscav::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_wetscav::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_wetscav::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_wetscav::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_wetscav::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_wetscav::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_wetscav::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_wetscav::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_srf_online_emiss","title":"mam4_srf_online_emiss","text":"<ul> <li>mam4_srf_online_emiss::srf_emis_specifier_for_dms:<ul> <li>description: File containing surface emissions data for DMS</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_so2:<ul> <li>description: File containing surface emissions data for SO2</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_bc_a4:<ul> <li>description: File containing surface emissions data for bc_a4</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_num_a1:<ul> <li>description: File containing surface emissions data for num_a1</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_num_a2:<ul> <li>description: File containing surface emissions data for num_a2</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_num_a4:<ul> <li>description: File containing surface emissions data for num_a4</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_pom_a4:<ul> <li>description: File containing surface emissions data for pom_a4</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_so4_a1:<ul> <li>description: File containing surface emissions data for so4_a1</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_emis_specifier_for_so4_a2:<ul> <li>description: File containing surface emissions data for so4_a2</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::soil_erodibility_file:<ul> <li>description: File containing soil erodibility</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::marine_organics_file:<ul> <li>description: File containing marine organics emissions</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::srf_remap_file:<ul> <li>description: File containing mapping data from the grid of emission files to the model grid. Unused if the grid is the same.</li> <li>type: file</li> </ul> </li> <li>mam4_srf_online_emiss::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_srf_online_emiss::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_srf_online_emiss::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_srf_online_emiss::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_srf_online_emiss::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_srf_online_emiss::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_srf_online_emiss::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_srf_online_emiss::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mam4_constituent_fluxes","title":"mam4_constituent_fluxes","text":"<ul> <li>mam4_constituent_fluxes::create_fields_interval_checks:<ul> <li>description: Create field interval checks for all fields that are computed and requested in mam4xx.</li> <li>type: logical</li> </ul> </li> <li>mam4_constituent_fluxes::use_mam4_precribed_ozone:<ul> <li>description: Switch to enable prescribed ozone in MAM4xx</li> <li>type: logical</li> </ul> </li> <li>mam4_constituent_fluxes::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>mam4_constituent_fluxes::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_constituent_fluxes::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mam4_constituent_fluxes::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mam4_constituent_fluxes::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mam4_constituent_fluxes::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#nudging","title":"nudging","text":"<ul> <li>nudging::nudging_filenames_patterns:<ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li>nudging::nudging_fields:<ul> <li>description: List of fields to be nudged.  Note, syntax of 'A:B' represents nudging field A with data from field B in files, syntax of 'A' assumes that nudging file has the same variables name as EAMxx</li> <li>type: array(string)</li> </ul> </li> <li>nudging::nudging_timescale:<ul> <li>description: Timescale to apply nudging tendencies, 0: full replacement, &gt;0: actual timescale</li> <li>type: integer</li> </ul> </li> <li>nudging::use_nudging_weights:<ul> <li>description: Flag for nudging weights option</li> <li>type: logical</li> </ul> </li> <li>nudging::nudging_weights_file:<ul> <li>description: weights that relax the nudging fields update</li> <li>type: string</li> </ul> </li> <li>nudging::skip_vert_interpolation:<ul> <li>description: Flag for skipping vertical interpolation</li> <li>type: logical</li> </ul> </li> <li>nudging::source_pressure_type:<ul> <li>description: Flag for how source pressure levels are handled in the nudging dataset.     TIME_DEPENDENT_3D_PROFILE: The dataset contains a time-varying pressure profile, variable name 'p_mid' with dimensions (time,ncol,nlev).     STATIC_1D_VERTICAL_PROFILE: The dataset uses a fixed in time single pressure profile, variable name 'p_lev' with dimension (nlev).</li> <li>type: string</li> <li>valid values: TIME_DEPENDENT_3D_PROFILE,STATIC_1D_VERTICAL_PROFILE</li> </ul> </li> <li>nudging::source_pressure_file:<ul> <li>description: If STATIC_1D_VERTICAL_PROFILE, this is an optional arg to point to a file with the source pressure levels defined.     Default is to look for p_levs in the first nudging_filenames_patterns file</li> <li>type: string</li> </ul> </li> <li>nudging::nudging_refine_remap_mapfile:<ul> <li>description: Refine-remapping mapfile from the source nudging dataset to the physics grid</li> <li>type: string</li> </ul> </li> <li>nudging::nudging_refine_remap_vert_cutoff:<ul> <li>description: A vertical cutoff to go with refine-remap logic (in units of p_mid) where the nudging is turned off above it (closer to the surface)</li> <li>type: real</li> </ul> </li> <li>nudging::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>nudging::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>nudging::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>nudging::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>nudging::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>nudging::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#ml_correction","title":"ml_correction","text":"<ul> <li>ml_correction::ml_model_path_tq:<ul> <li>description: Path to pre-trained ML model for temperature and specific humidity</li> <li>type: string</li> </ul> </li> <li>ml_correction::ml_model_path_uv:<ul> <li>description: Path to pre-trained ML model for wind fields</li> <li>type: string</li> </ul> </li> <li>ml_correction::ml_model_path_sfc_fluxes:<ul> <li>description: Path to pre-trained ML model for surface fluxes</li> <li>type: string</li> </ul> </li> <li>ml_correction::ml_output_fields:<ul> <li>description: ML correction output variables, the following variables are supported: T_mid,qv,u,v</li> <li>type: array(string)</li> </ul> </li> <li>ml_correction::ml_correction_unit_test:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>ml_correction::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>ml_correction::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>ml_correction::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>ml_correction::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>ml_correction::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>ml_correction::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#iop_forcing","title":"iop_forcing","text":"<ul> <li>iop_forcing::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>iop_forcing::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>iop_forcing::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>iop_forcing::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>iop_forcing::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>iop_forcing::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#test_only","title":"test_only","text":"<ul> <li>test_only::my_param:<ul> <li>description: MISSING</li> <li>type: array(integer)</li> </ul> </li> <li>test_only::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>test_only::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>test_only::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>test_only::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>test_only::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>test_only::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#spa","title":"spa","text":"<ul> <li>spa::spa_remap_file:<ul> <li>description: File containing mapping data from the grid of spa_data_file to the model grid. Unused if the grid is the same.</li> <li>type: file</li> </ul> </li> <li>spa::spa_data_file:<ul> <li>description: File containing aerosol data. Must be on same grid as the atm, or a coarser one</li> <li>type: file</li> </ul> </li> <li>spa::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>spa::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>spa::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>spa::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>spa::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>spa::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#rrtmgp","title":"rrtmgp","text":"<ul> <li>rrtmgp::rrtmgp_coefficients_file_sw:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> <li>rrtmgp::rrtmgp_coefficients_file_lw:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> <li>rrtmgp::rrtmgp_cloud_optics_file_sw:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> <li>rrtmgp::rrtmgp_cloud_optics_file_lw:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> <li>rrtmgp::column_chunk_size:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::active_gases:<ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li>rrtmgp::ch4vmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::co2vmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::n2ovmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::f11vmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::f12vmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::n2vmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::covmr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::orbital_year:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::orbital_eccentricity:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>rrtmgp::orbital_obliquity:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>rrtmgp::orbital_mvelp:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>rrtmgp::fixed_total_solar_irradiance:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::rad_frequency:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>rrtmgp::do_aerosol_rad:<ul> <li>description: Flag to turn on/off considering aerosols in radiation calculations</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::enable_column_conservation_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::extra_clnclrsky_diag:<ul> <li>description: Flag to turn on/off an extra clean-clear-sky (with neither clouds nor aerosols) radiation call</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::extra_clnsky_diag:<ul> <li>description: Flag to turn on/off an extra clean-sky (with no aerosols) radiation call</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::do_subcol_sampling:<ul> <li>description: Flag to turn on/off subcolumn sampling of optical properties; if false treat cells as either completely clear or cloudy</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::pool_size_multiplier:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>rrtmgp::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>rrtmgp::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>rrtmgp::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>rrtmgp::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>rrtmgp::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#mac_aero_mic","title":"mac_aero_mic","text":"<ul> <li>mac_aero_mic::atm_procs_list:<ul> <li>description: List of atm processes in this atm process group</li> <li>type: array(string)</li> </ul> </li> <li>mac_aero_mic::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> </ul> </li> <li>mac_aero_mic::type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>mac_aero_mic::schedule_type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>valid values: sequential</li> </ul> </li> <li>mac_aero_mic::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mac_aero_mic::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>mac_aero_mic::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>mac_aero_mic::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>mac_aero_mic::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#cosp","title":"cosp","text":"<ul> <li>cosp::cosp_subcolumns:<ul> <li>description: Number of subcolumns to use for COSP simulators; cosp_subcolumns=1 implies no subcolumn sampling</li> <li>type: MISSING</li> </ul> </li> <li>cosp::cosp_frequency:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>cosp::cosp_frequency_units:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>valid values: steps,hours</li> </ul> </li> <li>cosp::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>cosp::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>cosp::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>cosp::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>cosp::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>cosp::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#tms","title":"tms","text":"<ul> <li>tms::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>tms::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>tms::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>tms::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>tms::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>tms::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#physics","title":"physics","text":"<ul> <li>physics::atm_procs_list:<ul> <li>description: List of atm processes in this atm process group</li> <li>type: array(string)</li> </ul> </li> <li>physics::type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>physics::schedule_type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>valid values: sequential</li> </ul> </li> <li>physics::number_of_subcycles:<ul> <li>description: how many times to subcycle this atm process</li> <li>type: MISSING</li> <li>constraints: gt 0</li> </ul> </li> <li>physics::enable_precondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>physics::enable_postcondition_checks:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>physics::repair_log_level:<ul> <li>description: MISSING</li> <li>type: string</li> <li>valid values: trace,debug,info,warn</li> </ul> </li> <li>physics::internal_diagnostics_level:<ul> <li>description: Whether to print hashes of the atm proc fields: 0=no, 1=yes (lump fields), 2=yes (individual fields)</li> <li>type: integer</li> <li>valid values: 0,1,2</li> </ul> </li> <li>physics::compute_tendencies:<ul> <li>description: list of computed fields for which this process will back out tendencies</li> <li>type: array(string)</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#initial-conditions-parameters","title":"Initial Conditions Parameters","text":"<ul> <li>initial_conditions::filename:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> <li>initial_conditions::topography_filename:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> <li>initial_conditions::phis:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::surf_evap:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::precip_liq_surf_mass:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::precip_ice_surf_mass:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::cldfrac_liq:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::sgs_buoy_flux:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::eddy_diff_mom:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::T_prev_micro_step:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::qv_prev_micro_step:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::qr:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::qm:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::ni_activated:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::nc_nuceat_tend:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::tke:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::sfc_alb_dir_vis:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::sfc_alb_dir_nir:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::sfc_alb_dif_vis:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::sfc_alb_dif_nir:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::surf_sens_flux:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::surf_lw_flux_up:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::surf_mom_flux:<ul> <li>description: MISSING</li> <li>type: array(real)</li> </ul> </li> <li>initial_conditions::dgnum:<ul> <li>description: Dry aerosol particles diameters (one per mode) [m]</li> <li>type: array(real)</li> </ul> </li> <li>initial_conditions::dgnumwet:<ul> <li>description: Wet aerosol particles diameter [m]</li> <li>type: array(real)</li> </ul> </li> <li>initial_conditions::wetdens:<ul> <li>description: Wet density of interstitial aerosol [kg/m3]</li> <li>type: array(real)</li> </ul> </li> <li>initial_conditions::constituent_fluxes:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::bc_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::bc_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::bc_c4:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::dst_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::dst_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::so4_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::so4_c2:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::so4_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::pom_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::pom_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::pom_c4:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::soa_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::soa_c2:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::soa_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::nacl_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::nacl_c2:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::nacl_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::mom_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::mom_c2:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::mom_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::mom_c4:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::num_c1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::num_c2:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::num_c3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::num_c4:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::wetdep_hydrophilic_bc:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::drydep_hydrophilic_bc:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::wetdep_hydrophilic_oc:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::drydep_hydrophilic_oc:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::wetdep_dust_bin1:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::wetdep_dust_bin2:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::wetdep_dust_bin3:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::wetdep_dust_bin4:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>initial_conditions::fraction_landuse:<ul> <li>description: Fractional land use for drydeposition of gasses and aerosols [fraction]</li> <li>type: real</li> </ul> </li> <li>initial_conditions::qc:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::qi:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::o3_volume_mix_ratio:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>initial_conditions::perturbed_fields:<ul> <li>description: IC fields (with level dimension) to apply a random perturbation to based on the parameters below.</li> <li>type: array(string)</li> </ul> </li> <li>initial_conditions::generate_perturbation_random_seed:<ul> <li>description: Whether or not to generate a random seed for perturbation.</li> <li>type: logical</li> </ul> </li> <li>initial_conditions::perturbation_random_seed:<ul> <li>description: Random seed used for perturbation. Will be overridded by generate_perturbation_random_seed=true.</li> <li>type: integer</li> </ul> </li> <li>initial_conditions::perturbation_limit:<ul> <li>description: Defines a range [1-x, 1+x] which perturbation will be taken from.</li> <li>type: real</li> </ul> </li> <li>initial_conditions::perturbation_minimum_pressure:<ul> <li>description: Minimum pressure (relative to a reference level pressure profile) for which perturbation will be applied.</li> <li>type: real</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#atmosphere-driver-parameters","title":"Atmosphere Driver Parameters","text":"<ul> <li>driver_options::atmosphere_dag_verbosity_level:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>driver_options::save_field_manager_content:<ul> <li>description: Saves a dictionary of the FM fields to file</li> <li>type: logical</li> </ul> </li> <li>driver_options::atm_log_level:<ul> <li>description: Verbosity level for the atm logger</li> <li>type: string</li> <li>valid values: trace,debug,info,warn,error</li> </ul> </li> <li>driver_options::atm_flush_level:<ul> <li>description: Verbosity level that triggers automatic flush of the atm logger</li> <li>type: string</li> <li>valid values: trace,debug,info,warn,error</li> </ul> </li> <li>driver_options::output_to_screen:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>driver_options::mass_column_conservation_error_tolerance:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>driver_options::energy_column_conservation_error_tolerance:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>driver_options::column_conservation_checks_fail_handling_type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>driver_options::check_all_computed_fields_for_nans:<ul> <li>description: MISSING</li> <li>type: logical</li> </ul> </li> <li>driver_options::property_check_data_fields:<ul> <li>description: list of additional data fields to output in property checks (only for physics grid)</li> <li>type: array(string)</li> </ul> </li> <li>driver_options::enable_iop:<ul> <li>description: Enable intensive observation period. Currently the only use case is DP-EAMxx</li> <li>type: logical</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#scorpio-parameters","title":"Scorpio Parameters","text":"<ul> <li>scorpio::output_yaml_files:<ul> <li>description: MISSING</li> <li>type: array(string)</li> </ul> </li> <li>scorpio::model_restart::iotype:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> </ul>"},{"location":"EAMxx/user/eamxx_params/#homme-namelist","title":"Homme namelist","text":"<ul> <li>ctl_nl::cubed_sphere_map:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::disable_diagnostics:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::dt_remap_factor:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>constraints: ge 1</li> </ul> </li> <li>ctl_nl::dt_tracer_factor:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>constraints: ge 1</li> </ul> </li> <li>ctl_nl::hv_ref_profiles:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::hypervis_order:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::hypervis_scaling:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::hypervis_subcycle:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::hypervis_subcycle_tom:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::hypervis_subcycle_q:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::nu_top:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::pgrad_correction:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_ftype:<ul> <li>description: MISSING</li> <li>type: MISSING</li> <li>valid values: 0,2</li> </ul> </li> <li>ctl_nl::se_geometry:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_limiter_option:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_ne:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_ne_x:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_ne_y:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_lx:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_ly:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_nsplit:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_partmethod:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_topology:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::se_tstep:<ul> <li>description: MISSING</li> <li>type: real</li> </ul> </li> <li>ctl_nl::statefreq:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::theta_advect_form:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::theta_hydrostatic_mode:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::tstep_type:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::vert_remap_q_alg:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::transport_alg:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::vtheta_thresh:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::internal_diagnostics_level:<ul> <li>description: MISSING</li> <li>type: integer</li> </ul> </li> <li>ctl_nl::semi_lagrange_trajectory_nsubstep:<ul> <li>description: MISSING</li> <li>type: MISSING</li> </ul> </li> <li>ctl_nl::mesh_file:<ul> <li>description: MISSING</li> <li>type: file</li> </ul> </li> </ul>"},{"location":"EAMxx/user/io_aliases/","title":"EAMxx Field Aliasing Feature","text":"<p>This document demonstrates the field aliasing feature for EAMxx I/O operations.</p>"},{"location":"EAMxx/user/io_aliases/#overview","title":"Overview","text":"<p>The field aliasing feature allows users to specify custom names for variables in netcdf output files while maintaining the original internal field names in the model. This is useful for:</p> <ul> <li>Creating shorter, more convenient variable names for output</li> <li>Maintaining compatibility with external tools that expect specific variable names</li> <li>Providing user-friendly names for complex internal field names</li> </ul>"},{"location":"EAMxx/user/io_aliases/#syntax","title":"Syntax","text":"<p>The alias syntax uses the delimiter <code>:=</code> to separate the alias name from the internal field name:</p> <pre><code>alias_name:=internal_field_name\n</code></pre>"},{"location":"EAMxx/user/io_aliases/#yaml-configuration-examples","title":"YAML Configuration Examples","text":""},{"location":"EAMxx/user/io_aliases/#basic-usage","title":"Basic Usage","text":"<pre><code>field_names:\n  - \"LWP:=LiqWaterPath\"      # Alias LWP for LiqWaterPath\n  - \"SWP:=SolidWaterPath\"    # Alias SWP for SolidWaterPath  \n  - \"T:=T_mid\"               # Alias T for T_mid\n  - \"qv\"                     # Regular field name (no alias)\n</code></pre>"},{"location":"EAMxx/user/io_aliases/#mixed-usage","title":"Mixed Usage","text":"<p>You can mix aliased and non-aliased fields in the same configuration:</p> <pre><code>field_names:\n  - \"T_mid\"                        # Regular field name\n  - \"LWP:=LiqWaterPath\"            # Aliased field\n  - \"p_mid\"                        # Regular field name  \n  - \"RH:=RelativeHumidity\"         # Aliased field\n</code></pre>"},{"location":"EAMxx/user/io_aliases/#output-behavior","title":"Output Behavior","text":"<p>When using aliases:</p> <ol> <li> <p>NetCDF Variables: The netcdf file will contain variables named according to the aliases</p> </li> <li> <p><code>LWP</code> instead of <code>LiqWaterPath</code></p> </li> <li><code>T</code> instead of <code>T_mid</code></li> <li> <p><code>RH</code> instead of <code>RelativeHumidity</code></p> </li> <li> <p>Internal Processing: All internal model operations use the original field names</p> </li> <li> <p>Field validation uses <code>LiqWaterPath</code>, <code>T_mid</code>, etc.</p> </li> <li>Diagnostic calculations use original names</li> <li> <p>Memory management uses original field structures</p> </li> <li> <p>Metadata: Variable attributes (units, long_name, etc.) are preserved from the original fields, and <code>eamxx_name</code> is added to the netcdf files to document aliasing</p> </li> </ol>"},{"location":"EAMxx/user/io_aliases/#caveats","title":"Caveats","text":"<p>Currently, a field can be requested only once in a single stream, and either the original name or the alias name counts.</p> <pre><code>field_names:\n  - \"LWP:=\"                   # Error: empty field name\n  - \":=LiqWaterPath\"          # Error: empty alias name  \n  - \"LWP:=Field1\"             # OK\n  - \"LWP:=Field2\"             # Error: duplicate alias LWP\n  - \"LWP1:=LiqWaterPath\"      # OK\n  - \"LWP2:=LiqWaterPath\"      # Error: duplicate field LiqWaterPath\n</code></pre>"},{"location":"EAMxx/user/io_metadata/","title":"IO Metadata","text":"<p>The IO metadata used for EAMxx output variables is stored in a csv file along the source code. Please find the csv file here. If you would like to contribute to expanding the metadata, please edit this csv file and issue a PR. Thank you!</p>"},{"location":"EAMxx/user/model_configuration/","title":"Model Configuration","text":""},{"location":"EAMxx/user/model_configuration/#model-inputs","title":"Model Inputs","text":"<p>This section explains how input parameters are passed to EAMxx, and how the user can change their value.</p> <p>The infrastructure for reading inputs into EAMxx involves a few scripts/files:</p> <ol> <li><code>atmchange</code> and <code>atmquery</code>: these scripts are located in <code>SRCDIR/components/eamxx/scripts</code>, and are soft-linked in the case folder. As their names suggest, they can be used to query and change the runtime configuration parameter of EAMxx. Since these two scripts are the only scripts that the average user needs to know and interact with, in the next sections we give a brief overview of how they can be used and how their output can be interpreted. Additionally, for both of the scripts a short help can also be obtained using the <code>-h</code> flag.</li> <li> <p><code>buildnml</code>: this script, located in <code>SRCDIR/components/eamxx/cime_config</code>, is called by CIME's case management scripts (<code>case.setup</code>, <code>case.build</code>, and <code>case.submit</code>), and is responsible for creating the input files that EAMxx will read to load its runtime parameters. Users should not have to modify this script, nor should they have to manually call it, but it is useful to know what it does. When <code>buildnml</code> runs, it creates a few files, containing EAMxx input parameters:</p> <ul> <li><code>eamxx_input.yaml</code>: this YAML file is located in the <code>RUNDIR/data</code> folder, and will be read by EAMxx at runtime to load all of its configuration parameters. More precisely, this file contains parameters that need to be used inside the EAMxx interfaces.</li> <li><code>namelist.nl</code>: this namelist file is located in the <code>RUNDIR/data</code> folder, and will be parsed at runtime to get all the parameters for the HOMME dycore (ADD REF). This file only contains dycore-specific parameters that are only recognized inside HOMME, and does not contain any parameter pertaining EAMxx infrastructure.</li> <li><code>namelist_eamxx.xml</code>: this XML file is located in the case directory, and contains all the runtime parameters that EAMxx will read in at runtime. <code>buildnml</code> uses this XML file as an intermediate file during the generation of <code>eamxx_input.yaml</code> and <code>namelist.nl</code>. More specifically, <code>buildnml</code> generates this file using case information to select the proper configurations from the file <code>namelist_defaults_eamxx.xml</code>, located in <code>SRCDIR/components/eamxx/cime_config</code>. Despite the fact that the only files that are needed at runtime are <code>eamxx_input.yaml</code> and <code>namelist.nl</code>, we generate and keep this XML file around to make the implementation of <code>atmquery</code> easier.</li> </ul> <p>Since these files are automatically generated when <code>buildnml</code> runs, users should not manually modify them. Any manual modification will be lost the next time <code>buildnml</code> runs (e.g., at <code>case.submit</code> time).</p> </li> </ol>"},{"location":"EAMxx/user/model_configuration/#querying-model-inputs-atmquery","title":"Querying model inputs: <code>atmquery</code>","text":"<p>This script is the simplest way for the user to check the value and properties of EAMxx input parameters. A basic usage of the script is</p> <pre><code>./atmquery my_param\n</code></pre> <p>which will retrieve the value of the parameter called <code>my_param</code>, by locating the XML node \"my_param\" in the file <code>namelist_eamxx.xml</code> in the RUNDIR folder. Obviously, an XML file can have multiple nodes with the same tag, and the script is implemented to error out if multiple matches are found. In such a scenario, the user needs to provide also the parents nodes names, using enough parents to uniquely identify the node (in most cases, one parent is enough). To specify a parent, the user can prepend the parent name and <code>::</code> to the node name:</p> <pre><code>./atmquery foo::my_param\n</code></pre> <p>The output will contain the fully scoped parameter name, along with the value. E.g.,</p> <pre><code>$ ./atmquery foo::my_param\n    namelist_defaults::node1::node2::foo::my_param:   10\n</code></pre> <p>If the input parameter is not a leaf but a node with sub-elements, the output will recursively print all sub-elements, properly indented:</p> <pre><code>$ ./atmquery homme\n    homme\n        moisture: moist\n        bfb_hash: 18\n        number_of_subcycles: 1\n        enable_precondition_checks: true\n        enable_postcondition_checks: true\n        repair_log_level: trace\n        internal_diagnostics_level: 0\n        compute_tendencies: none\n</code></pre> <p>It is sometimes desirable to query all the nodes that have a particular name, or that contain a particular string. We can do that by using the <code>--grep</code> flag:</p> <pre><code>$ ./atmquery --grep sub\n    iop_options::iop_dosubsidence: false\n    ctl_nl::hypervis_subcycle: 1\n    ctl_nl::hypervis_subcycle_tom: 1\n    ctl_nl::hypervis_subcycle_q: 6\n    atmosphere_processes::number_of_subcycles: 1\n    sc_import::number_of_subcycles: 1\n    homme::number_of_subcycles: 1\n    physics::number_of_subcycles: 1\n</code></pre> <p>Similarly to the CIME utility <code>xmlquery</code>, the options <code>--value</code>, <code>--type</code>, <code>--valid-values</code>, and <code>--full</code> can be used to respectively retrieve just the parameter value (useful for shell scripting), the parameter's type, a list of valid values for the parameter (when applicable), or all of the above:</p> <pre><code>$ ./atmquery atm_log_level --value\n    info\n$ ./atmquery atm_log_level --type\n    namelist_defaults::driver_options::atm_log_level: string\n$ ./atmquery atm_log_level --valid-values\n    namelist_defaults::driver_options::atm_log_level: ['trace', 'debug', 'info',\n                                                       'warn', 'error']\n$ ./atmquery atm_log_level --full\n    namelist_defaults::driver_options::atm_log_level\n        value: info\n        type: string\n        valid values: ['trace', 'debug', 'info', 'warn', 'error']\n</code></pre> <p>Finally, the option <code>--listall</code> can be used to list the whole content of the XML file, which will be displayed with each node indented in its parent scope:</p> <pre><code>$ ./atmquery --listall\n    namelist_defaults\n        grids_manager\n            type: homme\n            physics_grid_type: pg2\n            physics_grid_rebalance: none\n            dynamics_namelist_file_name: ./data/namelist.nl\n            vertical_coordinate_filename: /some/path/to/coords/file.nc\n        initial_conditions\n            filename: /some/path/to/ic/file.nc\n            topography_filename: /some/path/to/topo/file.nc\n    [...]\n</code></pre>"},{"location":"EAMxx/user/model_configuration/#changing-model-inputs-atmchange","title":"Changing model inputs: <code>atmchange</code>","text":"<p>When <code>buildnml</code> runs, the model inputs are deduced from the case configuration settings (e.g., the grid, the compset, etc.) and the <code>namelist_eamxx_defaults.xml</code> file, located in the eamxx source tree. The user can change any of these parameters using the <code>atmchange</code> script. A basic usage of the script is</p> <pre><code>./atmchange my_param=10\n</code></pre> <p>As for <code>atmquery</code>, if there are multiple matches for a given parameter name, the user must specify a unique scoped name, which allows <code>atmchange</code> to uniquely identify the XML node to modify:</p> <pre><code>$ ./atmquery homme::number_of_subcycles\n    namelist_defaults::atmosphere_processes::homme::number_of_subcycles: 1\n$ ./atmchange number_of_subcycles=10\nERROR: internal_diagnostics_level is ambiguous. Use ANY in the node path to\nallow multiple matches. Matches:\n    namelist_defaults::atmosphere_processes::number_of_subcycles\n    namelist_defaults::atmosphere_processes::sc_import::number_of_subcycles\n    namelist_defaults::atmosphere_processes::homme::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::mac_aero_mic::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::mac_aero_mic::tms::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::mac_aero_mic::shoc::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::mac_aero_mic::cld_fraction::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::mac_aero_mic::spa::internal_diagnostics_level\n    namelist_defaults::atmosphere_processes::physics::mac_aero_mic::p3::number_of_subcycles\n    namelist_defaults::atmosphere_processes::physics::rrtmgp::number_of_subcycles\n    namelist_defaults::atmosphere_processes::sc_export::number_of_subcycles\n$ ./atmchange homme::number_of_subcycles=10\nRegenerating /path/to/namelist_eamxx.xml. Manual edits will be lost.\n$ ./atmquery homme::number_of_subcycles\n    namelist_defaults::atmosphere_processes::homme::number_of_subcycles: 10\n</code></pre> <p>In some cases, the user may be interested in changing all nodes with a given name. In that case, you can use 'ANY' as a node name:</p> <pre><code>$ ./atmquery --grep number_of_subcycles\n    atmosphere_processes::number_of_subcycles: 1\n    sc_import::number_of_subcycles: 1\n    homme::number_of_subcycles: 1\n    physics::number_of_subcycles: 1\n    mac_aero_mic::number_of_subcycles: 24\n    tms::number_of_subcycles: 1\n    shoc::number_of_subcycles: 1\n    cld_fraction::number_of_subcycles: 1\n    spa::number_of_subcycles: 1\n    p3::number_of_subcycles: 1\n    rrtmgp::number_of_subcycles: 1\n    sc_export::number_of_subcycles: 1\n$ ./atmchange ANY::number_of_subcycles=3\nRegenerating /path/to/namelist_eamxx.xml. Manual edits will be lost.\n$ ./atmquery --grep number_of_subcycles\n    atmosphere_processes::number_of_subcycles: 3\n    sc_import::number_of_subcycles: 3\n    homme::number_of_subcycles: 3\n    physics::number_of_subcycles: 3\n    mac_aero_mic::number_of_subcycles: 3\n    tms::number_of_subcycles: 3\n    shoc::number_of_subcycles: 3\n    cld_fraction::number_of_subcycles: 3\n    spa::number_of_subcycles: 3\n    p3::number_of_subcycles: 3\n    rrtmgp::number_of_subcycles: 3\n    sc_export::number_of_subcycles: 3\n</code></pre> <p>In addition, \"ANY\" can be used in a \"scoped\" string, to limit the set of matches:</p> <pre><code>$ ./atmchange mac_aero_mic::ANY::number_of_subcycles=1\nRegenerating /path/to/namelist_eamxx.xml. Manual edits will be lost.\n$ ./atmquery --grep number_of_subcycles\n    atmosphere_processes::number_of_subcycles: 3\n    sc_import::number_of_subcycles: 3\n    homme::number_of_subcycles: 3\n    physics::number_of_subcycles: 3\n    mac_aero_mic::number_of_subcycles: 1\n    tms::number_of_subcycles: 1\n    shoc::number_of_subcycles: 1\n    cld_fraction::number_of_subcycles: 1\n    spa::number_of_subcycles: 1\n    p3::number_of_subcycles: 1\n    rrtmgp::number_of_subcycles: 3\n    sc_export::number_of_subcycles: 3\n</code></pre> <p>Since the XML file stores constraints on the parameter value (like its type or valid values), attempting to use the wrong type will cause an error:</p> <pre><code>$ ./atmquery --type se_ne\n    namelist_defaults::ctl_nl::se_ne: integer\n$ ./atmchange se_ne=hello\nERROR: Could not refine 'hello' as type 'integer':\n</code></pre> <p>There are three main types supported: integer, float, string, logical. When passing a string to <code>atmchange</code>, the script will try to interpret it according to the parameter type, and throw an error if that's not possible:</p> <ul> <li>For \"string\", anything works.</li> <li>For \"integer\", only digits are allowed, possibly with a negative sign in front;</li> <li>For \"float\", only digits are allowed, possibly with a negative sign in front and a decimal point;</li> <li>For \"logical\", only the strings \"true\" and \"false\" are allowed (case insensitive). There are two additional types supported: \"file\" and \"array(T)\", where \"T\" is any of the other supported types (but not another array):<ul> <li>\"file\" is used to inform CIME of the input files that have to be download   from E3SM data servers, like initial conditions files, or certain lookup tables.</li> <li>\"array(T)\" allows to specify a list of items (of the same type),   which will be parsed inside EAMxx as a <code>std::vector&lt;T&gt;</code>.</li> </ul> </li> </ul> <p>For type \"string\" and \"array(T)\", it is also possible to append to the currently stored value.</p> <pre><code>$ ./atmquery homme::compute_tendencies\n    namelist_defaults::atmosphere_processes::homme::compute_tendencies:\n        value: a, b\n        type: array(string)\n        valid values: []\n$ ./atmchange homme::compute_tendencies+=c\n$ ./atmquery homme::compute_tendencies --full\n    namelist_defaults::atmosphere_processes::homme::compute_tendencies\n        value: a, b, c\n        type: array(string)\n        valid values: []\n</code></pre>"},{"location":"EAMxx/user/model_configuration/#modifying-the-list-of-atmosphere-processes","title":"Modifying the list of atmosphere processes","text":"<p>The <code>atmchange</code> script can be used to change any of the runtime parameters of EAMxx. In particular, it can be used to add, remove, or reorder atmosphere processes. When adding an atmosphere process, we must first make sure that the defaults for that process are present in <code>namelist_defaults_eamxx.xml</code>. For instance, the default settings for the \"physics\" atmosphere process group include the following:</p> <pre><code>$ ./atmquery physics::atm_procs_list\n    namelist_defaults::atmosphere_processes::physics::atm_procs_list: mac_aero_mic,rrtmgp\n</code></pre> <p>where \"mac_aero_mic\" is itself an atmosphere process group, consisting of macrophysics, aerosols, and microphysics processes. If one wanted to add the \"cosp\" atmosphere process to this list, and change the number of its subcycles, it could do so via</p> <pre><code>$ ./atmchange physics::atm_procs_list+=cosp\n[...]\n$ ./atmchange cosp::number_of_subcycles=3\n</code></pre> <p>Notice that if we swapped the two commands, we would get an error, since the node \"cosp\" is not present in the XML generated from the defaults until we decide to add it.</p> <p>It is also possible to declare a new (empty) atmosphere process group, which can then be filled with valid atmosphere processes via subsequent calls to <code>atmchange</code>. The syntax to trigger this behavior consists in specifying a process name that begins and ends with an underscore:</p> <pre><code>./atmchange physics::atm_procs_list+=_my_group_\n</code></pre> <p>This adds a new process to the list of processes in \"physics\", called \"_my_group_\", and which is itself an atmosphere process group. Hence, we can then do</p> <pre><code>./atmchange _my_group_::atm_procs_list+=A,B\n</code></pre> <p>where A and B must be valid atmosphere process names (i.e., present in <code>namelist_defaults_eamxx.xml</code>) or be themselves new atmosphere process groups (i.e., beginning/ending with an underscore)</p> <p><code>atmchange</code> can also be used to completely change a list of atmosphere processes:</p> <pre><code>./atmchange physics::atm_procs_list=A,B,C\n</code></pre> <p>Notice that we used \"=\" instead of \"+=\", which means we will be overwriting the value, rather than appending. Any atmosphere process that was previously in the list but is no longer in it will be removed from the generated <code>namelist_defaults.xml</code> (and <code>eamxx_input.yaml</code>) files, along with all their nested parameters.</p>"},{"location":"EAMxx/user/model_configuration/#model-output","title":"Model Output","text":"<p>EAMxx allows the user to configure the desired model output via YAML files, with each YAML file associated to a different output stream (i.e., a file). In order to add an output stream, one needs to run <code>atmchange output_yaml_files+=/path/to/my/output/yaml</code> (more information on how to use <code>atmchange</code> can be found here). During the <code>buildnml</code> phase of the case management system, these YAML files will be copied into the RUNDIR/data folder. During this process, the files will be parsed, and any CIME-related variable will be resolved accordingly. Therefore, it is not advised to put the original YAML files in RUNDIR/data, since upon <code>buildnml</code> execution, all the CIME vars will no longer be present in the YAML file (replaced by their values), making it harder to tweak it, and even harder to share with other users/cases. Another consequence of this is that, much like <code>eamxx_input.yaml</code>, the user should not modify the generated YAML files in RUNDIR/data, since any modification will be lost on the next run of <code>buildnml</code> (e.g., during <code>case.submit</code>).</p>"},{"location":"EAMxx/user/model_configuration/#basic-output","title":"Basic output","text":"<p>The following is a basic example of an output request.</p> <pre><code>%YAML 1.1\n---\nfilename_prefix: my_output\naveraging_type: average\nmax_snapshots_per_file: 10\nfields:\n  physics:\n    field_names:\n      - T_mid\n      - qv\n  dynamics:\n    field_names:\n      - dp3d_dyn\n      - omega_dyn\noutput_control:\n  frequency: 6\n  frequency_units: nhours\n</code></pre> <p>Notice that lists can be equivalently specified in YAML as <code>field_names: [f1, f2, f3]</code>. The user can specify fields to be outputted from any of the grids on which they are available (although most fields are only available on ONE grid). In the example above, we requested fields from both the physics and dynamics grid. The meaning of the other parameters is as follows:</p> <ul> <li><code>averaging_type</code>: how the fields are integrated in time before being saved. Valid options are:<ul> <li><code>instant</code>: no integration, each time frame saved corresponds to   instantaneous values of the fields.</li> <li><code>average</code>/<code>max</code>/<code>min</code>: the fields undergo the corresponding operation   over the time interval since the last output step (as specified in the   <code>output_control</code> section).   In the case above, each snapshot saved to file corresponds to an average   of the output fields over 6h windows.</li> </ul> </li> <li><code>filename_prefix</code>: the prefix of the output file, which will be created in the run directory.<ul> <li>The full filename will be <code>$prefix.$avgtype.$frequnits_x$freq.$timestamp.nc</code>,   where <code>$timestamp</code> corresponds to the first snapshot saved in the file for   <code>instant</code> output, or the beginning of the first averaging window for the other   averaging types.</li> <li>If not set, it defaults to <code>$casename.eamxx.h</code>.</li> </ul> </li> <li><code>max_snapshots_per_file</code>: specifies how many time snapshots can be put in a file.<ul> <li>Once this number is reached, EAMxx will close the file and open a new one.</li> <li>If not set, it defaults to <code>-1</code>, signaling \"unlimited storage\".</li> </ul> </li> <li><code>frequency</code>: how many units of time are between two consecutive writes to file.<ul> <li>For <code>instant</code> output the fields are \"sampled\" at this frequency,   while for other averaging types the fields are \"integrated\"   in time over this window</li> </ul> </li> <li><code>frequency_units</code>: units of the output frequency.<ul> <li>Valid options are <code>nsteps</code> (the number of atmosphere time steps),   <code>nsecs</code>, <code>nmins</code>, <code>nhours</code>, <code>ndays</code>, <code>nmonths</code>, <code>nyears</code>.</li> </ul> </li> </ul>"},{"location":"EAMxx/user/model_configuration/#diagnostic-output","title":"Diagnostic output","text":"<p>In addition to the fields computed by EAMxx as part of the timestep, the user can request to output derived quantities, which will be computed on the fly by the I/O interface of EAMxx. There are two types of diagnostic outputs:</p> <ul> <li> <p>Quantities computed as a function of EAMxx fields</p> <ul> <li>These are simply physical quantities that EAMxx does not keep in   persistent storage.</li> <li>As of May 2024, the available derived quantities are (case sensitive):<ul> <li><code>Exner</code></li> <li><code>PotentialTemperature</code></li> <li><code>LiqPotentialTemperature</code></li> <li><code>dz</code></li> <li><code>z_int</code></li> <li><code>z_mid</code></li> <li><code>geopotential_int</code></li> <li><code>geopotential_mid</code></li> <li><code>AtmosphereDensity</code></li> <li><code>VirtualTemperature</code></li> <li><code>DryStaticEnergy</code></li> <li><code>SeaLevelPressure</code></li> <li><code>LiqWaterPath</code></li> <li><code>IceWaterPath</code></li> <li><code>VapWaterPath</code></li> <li><code>RainWaterPath</code></li> <li><code>RimeWaterPath</code></li> <li><code>ShortwaveCloudForcing</code></li> <li><code>LongwaveCloudForcing</code></li> <li><code>RelativeHumidity</code></li> <li><code>ZonalVapFlux</code></li> <li><code>MeridionalVapFlux</code></li> <li><code>precip_liq_surf_mass_flux</code></li> <li><code>precip_ice_surf_mass_flux</code></li> <li><code>precip_total_surf_mass_flux</code></li> <li><code>surface_upward_latent_heat_flux</code></li> <li><code>wind_speed</code></li> <li><code>AerosolOpticalDepth550nm</code></li> <li><code>NumberPath</code></li> <li><code>AeroComCld</code></li> </ul> </li> </ul> </li> <li> <p>Lower-dimensional slices of a field</p> <ul> <li>These are hyperslices of an existing field or of another diagnostic output.</li> <li>As of August 2023, given a field <code>X</code>, the available options are:<ul> <li><code>X_at_lev_N</code>: slice the field <code>X</code> at the <code>N</code>-th vertical level index.<ul> <li>Recall that in EAMxx <code>N = 0</code> corresponds to the model top.</li> </ul> </li> <li><code>X_at_model_bot</code>, <code>X_at_model_top</code>:   special case for top and bottom of the model.</li> <li><code>X_at_Ymb</code>, <code>X_at_YPa</code>, <code>X_at_YhPa</code>:   interpolates the field <code>X</code> at a vertical position specified by the   given pressure <code>Y</code>.<ul> <li>Available units are <code>mb</code> (millibar), <code>Pa</code>, and <code>hPa</code>.</li> </ul> </li> <li><code>X_at_Ym_above_Z</code>:   interpolates the field <code>X</code> at a vertical height of <code>Y</code> meters above   <code>Z</code>, with <code>Z = surface</code> or <code>Z = sealevel</code>.</li> </ul> </li> </ul> </li> </ul>"},{"location":"EAMxx/user/model_configuration/#remapped-output","title":"Remapped output","text":"<p>The following options can be used to to save fields on a different grid from the one they are computed on.</p> <ul> <li><code>horiz_remap_file</code>: a path to a map file (as produced by <code>ncremap</code>) between the grid where the fields are defined and a coarser grid.<ul> <li>EAMxx will use this to remap fields on the fly, allowing to reduce   the size of the output file.<ul> <li>Note: with this feature, the user can only specify fields   from a single grid.</li> </ul> </li> </ul> </li> <li><code>vertical_remap_file</code>: similar to the previous option, this map file is used to refine/coarsen fields in the vertical direction.</li> <li><code>IOGrid</code>: this parameter can be specified inside one of the grids sections, and will denote the grid (which must exist in the simulation) where the fields must be remapped before being saved to file.<ul> <li>This feature is really only used to save fields on the dynamics grid   without saving twice the DOFs at the interface of two spectral elements.</li> <li>E.g., for a scalar quantity defined only in the horizontal direction,   native output from the dynamics grid would produce arrays of length   <code>nelems * ngp * ngp</code>, where <code>ngp</code> is the number of Gauss points along   each axis in the 2D spectral element, and <code>nelems</code> is the number of   horizontal elements.</li> <li>However, due to continuity, the values on the Gauss points on the   element boundary must match the values on the neighboring element,   resulting in duplicated data.</li> <li>By remapping to a \"unique\" version of the dynamics grid   (which in EAMxx is referred to as \"physics_gll\"), we can save roughly   45% of storage.</li> <li>Note: this feature cannot be used along with the   horizontal/vertical remap.</li> </ul> </li> </ul>"},{"location":"EAMxx/user/model_configuration/#tendencies-output","title":"Tendencies output","text":"<p>It is also possible to request tendencies of fields that are updated by atmosphere processes, on a per-process basis (here, \"updated\" means that the field is both an input as well as an output of the atmosphere process). Since the term \"tendency\" can be used with slightly different connotations, we clarify what we mean by that when it comes to model output: if process P updates field A, by the tendency of A from process P we mean <code>(A_after_P - A_before_P) / dt</code>, where <code>dt</code> is the atmosphere timestep.</p> <p>As of May 2024, the user needs two things in order to get tendencies from a process. E.g., to get the tendencies of <code>T_mid</code> and <code>horiz_winds</code> from the process <code>shoc</code>, one needs to:</p> <ul> <li>Set <code>atmchange shoc::compute_tendencies=T_mid,horiz_winds</code>.</li> <li>Add <code>shoc_T_mid_tend</code> and <code>shoc_horiz_winds_tend</code> to the list of fields in the desired output YAML file.</li> </ul>"},{"location":"EAMxx/user/model_configuration/#additional-options","title":"Additional options","text":"<p>The YAML file shown at the top of this section, together with the remap options in the following section, covers most of the options used in a typical run. There are, however, particular use cases that require some less common options, which we list here (in parentheses, the location in the YAML file and the type of the parameter value).</p> <ul> <li><code>flush_frequency</code> (top-level list, <code>integer</code>)<ul> <li>This parameter can be used to specify how often the IO library   should sync the in-memory data to file.</li> <li>If not specified, the IO library is free to decide when it should flush   the data.</li> <li>This option can be helpful for debugging, in case a crash is occurring   after a certain number of steps, but before the IO library would   automatically flush to file.</li> </ul> </li> <li><code>floating_point_precision</code> (top-level list, <code>string</code>):<ul> <li>This parameter specifies the precision to be used for floating point   variables in the output file.</li> <li>By default, EAMxx uses single precision.</li> <li>Valid values are <code>single</code>, <code>float</code>, <code>double</code>, and <code>real</code>.<ul> <li>The first two are synonyms, while the latter resolves to <code>single</code>   or <code>double</code> depending on EAMxx CMake configuration parameter <code>EAMXX_DOUBLE_PRECISION</code>.</li> </ul> </li> </ul> </li> <li><code>file_max_storage_type</code> (top-level list, <code>string</code>):<ul> <li>This parameter determines how the capacity of the file is specified.<ul> <li>By default, it is set to <code>num_snapshots</code>, which makes EAMxx read <code>max_snapshots_per_file</code> (explained in the first section).</li> <li>However, the user can specify <code>one_year</code> or <code>one_month</code>, which will make EAMxx create one output file per year/month of simulation, fitting however many snapshots are needed in each file (depending on the output frequency).<ul> <li>If <code>one_year</code> or <code>one_month</code> are used, the option <code>max_snapshots_per_file</code> is ignored.</li> </ul> </li> </ul> </li> </ul> </li> <li><code>iotype</code> (top-level list, <code>string</code>):<ul> <li>This option allows the user to request a particular format for the   output file.</li> <li>The possible values are 'default', 'netcdf', 'pnetcdf' 'adios',   'hdf5', where 'default' means \"whatever is the PIO type from the case settings\".</li> </ul> </li> <li><code>save_grid_data</code> (<code>output_control</code> sub-list, <code>boolean</code>):<ul> <li>This option allows to specify whether grid data (such as <code>lat</code>/<code>lon</code>)   should be added to the output stream.</li> <li>By default, it is <code>true</code>.</li> </ul> </li> <li><code>skip_t0_output</code> (<code>output_control</code> sub-list, <code>boolean</code>):<ul> <li>This option is relevant only for <code>instant</code> output, for which fields are   also output at the case start time<ul> <li>I.e., after initialization but before the beginning of the first timestep).</li> </ul> </li> <li>By default it is set to <code>false</code>.</li> </ul> </li> <li>Restart Options:<ul> <li>When performing a restart, EAMxx attempts to restart every output   stream listed in the <code>output_yaml_files</code> atmosphere option   (which can be queried via <code>atmquery output_yaml_files</code>).</li> <li>The user can specify a few options, in order to tweak the restart behavior:<ul> <li><code>skip_restart_if_rhist_not_found</code> (<code>restart</code> sublist, boolean):     this parameter is <code>false</code> by default, but can be set     to <code>true</code> to make the model start the output stream anew     (as if this was an initial run) if the proper rhist     file name is not found in rpointer.atm. This allows to add     a new output stream after a restart.     NOTE: this option is more precisely needed when other streams MUST           be restarted, but the current one should be started from           scratch. If ALL streams should be started anew, you should           set RUN_TYPE=branch in the case XML settings instead.     scratch, as if this was an initial run.</li> <li><code>filename_prefix</code> (<code>restart</code> sub-list, <code>string</code>):<ul> <li>By default, this parameter is set to match the value of   <code>filename_prefix</code> from the top-level list.</li> <li>This can be set to a different value in case we want to restart   a previous simulation that was using a different filename prefix.</li> </ul> </li> <li><code>force_new_file</code> (<code>restart</code> sub-list, <code>boolean</code>):<ul> <li>This parameter allows to start a fresh new output file upon restarts.</li> <li>By default, is is set to <code>false</code>, so that EAMxx will attempt to   resume filling the last produced output file (if any, and if it   can accommodate more snapshots).</li> </ul> </li> </ul> </li> </ul> </li> </ul>"},{"location":"EAMxx/user/multi-instance-mvk/","title":"Multi-instance and NBFB testing capabilities","text":"<p>We adopt MVK testing for now.</p>"},{"location":"EAMxx/user/multi-instance-mvk/#mvk-testing","title":"MVK testing","text":"<p>In Multivariate Kolmogorov-Smirnov (MVK) test, an ensemble of multi-year runs with the 2 versions of the code to check that the climate statistics of important variables are unchanged between ensembles.</p> <p>For some background, see DOIs:</p> <pre><code>- 10.1145/3324989.3325724\n- 10.1145/3468267.3470572\n</code></pre>"},{"location":"EAMxx/user/multi-instance-mvk/#multi-instance-testing","title":"Multi-instance testing","text":"<p>See following link for background on the multi-instance capability in CIME.</p> <p>Link</p> <p>In SCREAM/EAMxx, it works in exactly the same except that the namelist file has a different name and location. Instead of user_nl_eam and atm_in for EAM, in SCREAM, we do not use user_nl_scream at all (even though it will be there) and we rely on run/data/scream_input.yaml.</p> <p>Thus, much like the original implementation in other components, the user must specify their choice of settings in the corresponding input files, namely scream_input.yaml_0001, and so on.</p>"},{"location":"EAMxx/user/multi-instance-mvk/#together","title":"Together","text":"<p>For MVK testing to work, it relies on the multi-instance capability. We use the default MVK test to instantiate a new MVKxx test in components/eamxx/cime_config/SystemTests. In the test definition, we must edit the scream_input.yaml specs.</p>"},{"location":"EAMxx/user/nudging/","title":"Nudging in EAMxx","text":"<p>Nudging is supported in EAMxx. Currently, it is possible to nudge EAMxx to the output from a different EAMxx run or to reanalysis. Nudging data can be on your model grid or an arbitrary coarser grid. Inline interpolating of finer-grid nudging data to a coarser model resolution isn't implemented yet but may be in the future.</p>"},{"location":"EAMxx/user/nudging/#data-to-nudge-towards","title":"Data to nudge towards","text":"<p>The user is expected to prepapre (and then use <code>atmchange</code> to point to) nudging data files that are compliant with EAMxx specification. In practice, this means that the data files must contain variable names known to EAMxx (only U, V, T_mid, and qv are supported now). The files can be specified with an explicit list or via pattern matching. The files must contain an arbitary global attribute <code>case_t0</code>, and it is recommended to be the same as the time dimension unit (the files must be time-dimensioned). The time dimension should be UNLIMITED. Finally, the dimension order must be such that <code>lev</code> is the last dimension, so most likely, the user must transpose the dimensions.</p>"},{"location":"EAMxx/user/nudging/#pressure-in-the-nudging-data","title":"Pressure in the nudging data","text":"<p>Pressure can be explicitly provided in the nudging data as time-varying <code>p_mid</code> corresponding to the option <code>TIME_DEPENDENT_3D_PROFILE</code> for <code>source_pressure_type</code>. Alternatively, the data can contain a time-invariant pressure variable <code>p_lev</code> corresponding to the option <code>STATIC_1D_VERTICAL_PROFILE</code> for <code>source_pressure_type</code>.</p>"},{"location":"EAMxx/user/nudging/#weighted-nudging-for-rrm-applications","title":"Weighted nudging for RRM applications","text":"<p>In regionally refined model applications, it is possible to use weighted nudging, for example, to avoid nudging the refined region. To achieve that, the user can use <code>atmchange</code> to set <code>use_nudging_weights</code> (boolean) and provide <code>nudging_weights_file</code> that has the weight to apply for nudging (for example, zeros in the refined region). Currently, weighted nudging is only supported if the user provides the nudging data at the target grid.</p>"},{"location":"EAMxx/user/nudging/#example-setup-current-as-of-april-2024","title":"Example setup (current as of April 2024)","text":"<p>To enable nudging as a process, one must declare it in the <code>atm_procs_list</code> runtime parameter.</p> <pre><code>./atmchange physics::atm_procs_list=\"mac_aero_mic,rrtmgp,cosp,nudging\"\n</code></pre> <p>The following options are needed to specify the nudging.</p> <pre><code>./atmchange nudging::nudging_filenames_patterns=\"/pathto/nudging_files/*.nc\" # can provide file name explicitly here instead (or multiple patterns)\n./atmchange nudging::source_pressure_type=TIME_DEPENDENT_3D_PROFILE # see section on pressure\n./atmchange nudging::nudging_fields=U,V # can include qv, T_mid as well\n./atmchange nudging::nudging_timescale=21600 # in seconds\n</code></pre> <p>To gain a deeper understanding of these parameters and options, please refer to code implementation of the nudging process.</p>"},{"location":"EAMxx/user/presentations/","title":"Presentations","text":"<p>In February 2025, the EAMxx team held a tutorial at the E3SM All-Hands meeting. The following presentations were given during the tutorial. They were edited for clarity and brevity.</p> <ol> <li>Running EAMxx</li> <li>Adding a process to EAMxx</li> </ol>"},{"location":"EAMxx/user/py2eamxx/","title":"PyEAMxx","text":"<p>PyEAMxx is currently under heavy development and may contain some rough edges. If you encounter any issues, please report them on the team on github discussions. Likewise, if you have questions or would like to request features, please post them on the github discussions.</p>"},{"location":"EAMxx/user/py2eamxx/#quick-start","title":"Quick Start","text":"<p>For now, the only way to use PyEAMxx is to either build it on your own or use our prebuilt conda binaries. We prefer for you to use the latter. In a conda environment, please use the following command to install it:</p> <pre><code>conda install -c mahf708 pyeamxx=0.0.2\n</code></pre> <p>It is recommended to use the latest version of PyEAMxx, which is currently 0.0.2. As you can see, it is a young package with a lot of potential. We do not guarantee that the API will remain stable, but we will try to document any changes as frequently as we could.</p>"},{"location":"EAMxx/user/py2eamxx/#examples","title":"Examples","text":"<p>We provide an example to demo calling the radiation process (RRTMGP). More examples are on the way. If you'd like to add your example, please feel free to submit a PR.</p>"},{"location":"EAMxx/user/py2eamxx/#rrtmgp","title":"RRTMGP","text":"<pre><code>from mpi4py import MPI\nimport pyeamxx\n\npyeamxx.init()\n\ndt = 1800\nt0_str = \"2020-10-10-00000\"\n\nic_file = \"/lcrc/group/e3sm/public_html/inputdata/atm/scream/init/screami_unit_tests_ne2np4L72_20220822.nc\"\nncols = 218\nnlevs = 72\npyeamxx.create_grids_manager(ncols,nlevs, ic_file)\n\nrad_dict = {\n    \"column_chunk_size\": 123,\n    \"active_gases\": [\"h2o\", \"co2\", \"o3\", \"n2o\", \"co\" , \"ch4\", \"o2\", \"n2\"],\n    \"orbital_year\": 1990,\n    \"log_level\": \"info\",\n    \"do_aerosol_rad\": False,\n    \"rrtmgp_coefficients_file_sw\": \"/lcrc/group/e3sm/data/inputdata/atm/scream/init/rrtmgp-data-sw-g112-210809.nc\",\n    \"rrtmgp_coefficients_file_lw\": \"/lcrc/group/e3sm/data/inputdata/atm/scream/init/rrtmgp-data-lw-g128-210809.nc\",\n    \"rrtmgp_cloud_optics_file_sw\": \"/lcrc/group/e3sm/data/inputdata/atm/scream/init/rrtmgp-cloud-optics-coeffs-sw.nc\",\n    \"rrtmgp_cloud_optics_file_lw\": \"/lcrc/group/e3sm/data/inputdata/atm/scream/init/rrtmgp-cloud-optics-coeffs-lw.nc\",\n}\n\nrad = pyeamxx.AtmProc(rad_dict, 'RRTMGP')\nrad.read_ic(ic_file)\nrad.initialize(t0_str)\n\nt = rad.get_field(\"T_mid\")\ntm = t.get()\n\nprint(tm[5,5], flush=True)\n\nrad.run(dt)\nrad.run(dt)\n\nprint(tm[5,5], flush=True)\n</code></pre>"},{"location":"EAMxx/user/python/","title":"Python support in EAMxx","text":"<p>EAMxx has some limited support for interfacing with external python code. In particular, we allow calling EAMxx C++ code from a python module, as well as calling python code from inside an EAMxx atmosphere process. The former is described in this page, while the latter is described in this page. The two cannot be used at the same time.</p> <p>NOTE: This feature is currently under development, so details may change in the future.</p>"},{"location":"EAMxx/user/rrm_eamxx/","title":"Running EAMxx with a Regionally Refined Mesh (RRM)","text":"<p>Running EAMxx with a RRM allows you run a select region of the globe at high resolution (i.e. 3 km) with the remainder of the globe at a lower resolution (i.e. 25 or 100 km).  This document will point you to the steps required and resources available to assist in developing and running a new RRM.</p>"},{"location":"EAMxx/user/rrm_eamxx/#choose-your-rrm","title":"Choose Your RRM","text":"<p>What region of the globe do you want to refine?  Your first step should be to check library of RRM grids/cases that have already been developed to potentially avoid duplicate work.  If you found a RRM that suits your needs, you can skip the next step (\"Generate Your RRM\").</p>"},{"location":"EAMxx/user/rrm_eamxx/#generate-your-rrm","title":"Generate Your RRM","text":"<p>Please refer to the offical E3SM guide for developing new atmosphere grids, which provides detailed guidance for developing your RRM.</p> <p>After you have made all the necessary files for your RRM, you will need to configure your code branch so that it knows about your new grid.  The steps required to do this are documented at the top of the library of RRM grids/cases page.</p>"},{"location":"EAMxx/user/rrm_eamxx/#make-your-initial-condition-file","title":"Make Your Initial Condition File","text":"<p>The easiest way to generate an initial condition is to use the HICCUP tool, which is a set of flexible and robust python routines to streamline the task of generating a new atmospheric initial condition for E3SM.  Otherwise, please see the step-by-step instuctions if you prefer to manually generate your initial condition.</p>"},{"location":"EAMxx/user/rrm_eamxx/#assemble-nudging-data-optional","title":"Assemble Nudging Data (Optional)","text":"<p>If you wish to nudge your simulation, assemble your nudging data in the format required by EAMxx.  Please refer to the nudging documentation.</p> <p>In the event that you only want to nudge a portion of your domain, then you will need to generate a nudging weights file.  A common use case for this is when you want the high-resolution region to remain free-running (unnudged) while nudging the coarse domain towards reanalysis or model data.  Please use this script as an example of how to generate your nudging weights file.</p>"},{"location":"EAMxx/user/rrm_eamxx/#run-your-rrm","title":"Run your RRM","text":"<p>Congratulations, you are now ready to run your EAMxx RRM.  If you are running your RRM in free running mode (not using any nudging) then you simply need to modify an existing EAMxx script and change the resolution to match the one you created for your RRM.</p> <p>If you are using nudging, then please see this example script of how to run a nudged EAMxx RRM run.  This example script uses the California 3-km RRM, which is on the master branch.</p>"},{"location":"EAMxx/user/diags/","title":"Online diagnostics","text":"<p>EAMxx has facilities to output optional diagnostics that are computed during runtime. These diagnostics are designed generically and composably, and are requestable by users.</p> <p>More details to follow.</p>"},{"location":"EAMxx/user/diags/conditional_sampling/","title":"Conditional sampling","text":"<p>The conditional sampling diagnostic allows you to extract field values where a specified condition is met, filling other locations with a default fill value. This is useful for analyzing field behavior under specific atmospheric conditions or at particular levels. The goal of the diagnostics is to enable you to discard unwanted data via other reductions, such as horizontal and vertical reductions (see \"Field contraction\" section of the docs).</p>"},{"location":"EAMxx/user/diags/conditional_sampling/#overview","title":"Overview","text":"<p>Conditional sampling creates a new field where:</p> <ul> <li>Values from the input field are preserved   where the condition is true</li> <li>Fill values (default: large number) are used   where the condition is false</li> </ul> <p>The general syntax is: <code>&lt;input&gt;_where_&lt;condition&gt;_&lt;operator&gt;_&lt;value&gt;</code></p>"},{"location":"EAMxx/user/diags/conditional_sampling/#supported-operators","title":"Supported operators","text":"Operator Aliases Description <code>eq</code> <code>==</code> Equal to <code>ne</code> <code>!=</code> Not equal to <code>gt</code> <code>&gt;</code> Greater than <code>ge</code> <code>&gt;=</code> Greater than or equal to <code>lt</code> <code>&lt;</code> Less than <code>le</code> <code>&lt;=</code> Less than or equal to"},{"location":"EAMxx/user/diags/conditional_sampling/#field-based-conditional-sampling","title":"Field-based conditional sampling","text":"<p>Compare the input field against another field at each grid point.</p> <p>Examples:</p> <ul> <li><code>T_mid_where_qv_gt_0.01</code></li> <li><code>p_mid_where_T_mid_le_273.15</code></li> <li><code>qv_where_p_mid_lt_50000</code></li> </ul>"},{"location":"EAMxx/user/diags/conditional_sampling/#level-based-conditional-sampling","title":"Level-based conditional sampling","text":"<p>Compare against the vertical level index (0-based indexing). Use the special condition field name <code>lev</code>.</p> <p>Examples:</p> <ul> <li><code>T_mid_where_lev_gt_5</code></li> <li><code>p_mid_where_lev_eq_0</code></li> <li><code>qv_where_lev_le_10</code></li> </ul>"},{"location":"EAMxx/user/diags/conditional_sampling/#count-based-conditional-sampling","title":"Count-based conditional sampling","text":"<p>Count the number of grid points where a condition is met. Use the special input field name <code>count</code>. The output will be <code>1.0</code> where the condition is satisfied and the fill value elsewhere. This is particularly useful when combined with horizontal or vertical reductions to count occurrences of specific conditions.</p> <p>Examples:</p> <ul> <li><code>count_where_qv_gt_0.01</code></li> <li><code>count_where_T_mid_le_273.15</code></li> <li><code>count_where_p_mid_lt_50000</code></li> <li><code>count_where_lev_gt_5</code></li> </ul>"},{"location":"EAMxx/user/diags/conditional_sampling/#caveats","title":"Caveats","text":"<ul> <li>For now, we only support 1D or 2D fields.   These include most fields of interest with the following layouts   (ncol,), (nlev,), (ncol,nlev).   Adding support for higher-dimensioned fields is straightforward,   but we will add it when requested.</li> <li>The condition and input fields must have the same layout   (except for level-based sampling). In level-based sampling,   the level index must be present in the field.</li> <li>The condition is provided as a triplet of information string   (<code>&lt;condition&gt;_&lt;operator&gt;_&lt;value&gt;</code>). We assume the user knows   the standard unit of the condition that is used internally   in EAMxx field manager (there is no way to specify it).</li> </ul>"},{"location":"EAMxx/user/diags/conditional_sampling/#example-configuration","title":"Example configuration","text":"<pre><code>%YAML 1.1\n---\nfilename_prefix: conditional_sampling_outputs\naveraging_type: instant\nfields:\n  physics_pg2:\n    field_names:\n      # Field-based conditional sampling\n      - T_mid_where_qv_gt_0.01\n      - p_mid_where_T_mid_le_273.15\n      - qv_where_p_mid_lt_50000\n      # Level-based conditional sampling  \n      - T_mid_where_lev_gt_5\n      - p_mid_where_lev_eq_0\n      - qv_where_lev_le_10\n      # Count-based conditional sampling\n      - count_where_qv_gt_0.01\n      - count_where_T_mid_le_273.15\n      - count_where_lev_gt_5\noutput_control:\n  frequency: 6\n  frequency_units: nhours\n</code></pre>"},{"location":"EAMxx/user/diags/field_contraction/","title":"Field contraction diagnostics","text":"<p>In EAMxx, we can automatically calculate field reductions across the horizontal columns and across the model vertical levels. We call these horizontal and vertical reductions. We can also automatically calculate zonal averages. We have experimental support for composing diagnostics; below, the horizontal and vertical reductions can be composed sequentially, but if using dp- or dz-weighted reductions, one must do the vertical reduction first.</p>"},{"location":"EAMxx/user/diags/field_contraction/#horizontal-reduction","title":"Horizontal reduction","text":"<p>We currently offer only one horizontal reduction \\(C\\), and it is defined as</p> \\[ C_{\\dots k} = \\sum_{i} w_{i} \\cdot F_{i \\dots k} \\] <p>where \\(F_\\text{i...k}\\) is the field at column \\(i\\) and level \\(k\\), and \\(w_{i}\\) is the weight at column \\(i\\). We note that the field \\(F\\) can have other dimensions (\\(\\dots\\)). The weight \\(w\\) is defined as the area fraction in column \\(i\\), that is, the area in column \\(i\\) divided by the total area in all columns.</p> <p>To select the horizontal reduction, you only need to suffix a field name <code>X</code> with <code>_horiz_avg</code> in the output requests.</p> Reduction Weight Description <code>X_horiz_avg</code> Area fraction Average across all columns"},{"location":"EAMxx/user/diags/field_contraction/#vertical-reduction","title":"Vertical reduction","text":"<p>We currently offer three vertical reductions \\(C\\), defined as</p> \\[ C_{\\dots} = \\sum_{k} w_{k} \\cdot F_{\\dots k} \\] <p>where \\(F_{\\dots k}\\) is the field at level \\(k\\), and \\(w_{k}\\) is the weight at level \\(k\\).</p> <p>To select the vertical reduction, you only need to suffix a field name <code>X</code> with <code>_vert_(avg|sum)_(dp|dz)_weighted</code> or <code>_vert_(avg|sum)</code> in the output yaml files.</p> Reduction Weight Description <code>X_vert_avg_dp_weighted</code> \\(\\Delta p_{k}\\) Average across all levels, weighted by \\(\\Delta p_{k}\\) <code>X_vert_sum_dp_weighted</code> \\(\\Delta p_{k}\\) Sum across all levels, weighted by \\(\\Delta p_{k}\\) <code>X_vert_avg_dz_weighted</code> \\(\\Delta z_{k}\\) Average across all levels, weighted by \\(\\Delta z_{k}\\) <code>X_vert_sum_dz_weighted</code> \\(\\Delta z_{k}\\) Sum across all levels, weighted by \\(\\Delta z_{k}\\) <code>X_vert_avg</code> 1 Average across all levels <code>X_vert_sum</code> 1 Sum across all levels <p>The supported weighting options for now are</p> <ul> <li><code>pseudo_density</code> field in EAMxx, \\(\\Delta p_{k}\\), in units of Pa;</li> <li><code>dz</code> field in EAMxx, \\(\\Delta z_{k}\\), in units of m;</li> <li>and no weighting, which is equivalent to using a weight of 1.</li> </ul> <p>In the case of <code>pseudo_density</code>, the weighting is scaled by 1/g, where g is the gravitational acceleration, in units of m/s\\(^2\\).</p> <p>It is important to note that in the case of dp- and dz-weighted reductions, the field provided to the reduction utility must be at least 2 in rank, e.g., (ncol, nlev).</p>"},{"location":"EAMxx/user/diags/field_contraction/#zonal-reduction","title":"Zonal reduction","text":"<p>We currently have a utility to calculate zonal averages online. To select the zonal average, you need to suffix a field name <code>X</code> with <code>_zonal_avg</code> and the number of bins <code>Y</code> as <code>_Y_bins</code>. All zonal averages are calculated using the area fraction in each bin as the weight.</p> <p>For 180 latitude bins, the bins are defined as follows: [-90, -89), [-89, -88), ..., [89, 90]. For 90 latitude bins, the bins are defined as follows: [-90, -88), [-88, -86), ..., [88, 90]. And so on...</p> Reduction Weight Description <code>X_zonal_avg_Y_bins</code> Area fraction Average across the zonal direction"},{"location":"EAMxx/user/diags/field_contraction/#example","title":"Example","text":"<pre><code>%YAML 1.1\n---\nfilename_prefix: monthly.outputs\naveraging_type: average\nmax_snapshots_per_file: 1\nfields:\n  physics_pg2:\n    field_names:\n      # in this example, we use T_mid in units of K\n      - T_mid_horiz_avg  # K\n      - T_mid_vert_avg_dp_weighted  # K\n      - T_mid_vert_sum_dp_weighted  # K * Pa * s / (m * m)\n      - T_mid_vert_avg_dz_weighted  # K\n      - T_mid_vert_sum_dz_weighted  # K * m\n      - T_mid_vert_avg  # K\n      - T_mid_vert_sum  # K\n      - T_mid_vert_sum_horiz_sum  # K\n      - T_mid_horiz_avg_vert_sum  # K\n      - T_mid_vert_sum_dz_weighted_horiz_avg  # K * m\n      - T_mid_vert_avg_dp_weighted_horiz_avg  # K\n      - T_mid_zonal_avg_180_bins  # K\n      - T_mid_zonal_avg_90_bins  # K\noutput_control:\n  frequency: 1\n  frequency_units: nmonths\n</code></pre>"},{"location":"ELM/","title":"The E3SM Land Model (ELM)","text":"<p>Some introductory text here</p> <ul> <li>The ELM User Guide explains how to control ELM when its running within E3SM and how to run in Coupler-bypass mode</li> <li>The ELM Developer Guide explains ELM data structures and how to develop new code.</li> <li>The ELM Technical Guide explains the science behind ELM's code</li> </ul>"},{"location":"ELM/dev-guide/","title":"Developer Guide","text":"<p>This guide contains information for developing ELM and MOSART.</p>"},{"location":"ELM/dev-guide/#_1","title":"Developer Guide","text":"<ul> <li>Testing development branches: Generating baselines and comparing new development against baselines</li> </ul>"},{"location":"ELM/dev-guide/testing/","title":"Testing","text":"<p>When a developer is ready to issue a PR to integrate their new developments into E3SM's <code>master</code> branch, they need to test their code development to ensure the new development does not introduce unexpected bugs. A land developer needs to atleast run the <code>e3sm_land_developer</code> test suite that involves following two steps: </p> <ul> <li>Step-1: Generate the baselines using the hash on <code>master</code> that was the starting point of the    development branch, and</li> <li>Step-2: Switch to the development branch and re-run the test suite to compare against    the baselines generated in Step-1.</li> </ul> <p>For the purpose of these document, let's assume the developer branch is <code>bishtgautam/lnd/emi-example</code>.</p>"},{"location":"ELM/dev-guide/testing/#step-1-generate-baselines","title":"Step-1: Generate Baselines","text":"<p>Find the starting hash on <code>master</code> by switching to the developer branch and looking at the Git graph.</p> <pre><code>cd &lt;e3sm-dir&gt;\n\n# Switch to your branch\ngit checkout bishtgautam/lnd/emi-example\n\n# Let's look at the graph\ngit log --oneline --decorate --graph\n* 9a2cd8459 (HEAD -&gt; bishtgautam/lnd/emi-example, origin/bishtgautam/lnd/emi-example) Updates the Stub EM code\n* d11fb8c52 Adds a readme and makefile for EMI Demo code\n* 15a0e4b8d Minor update to the EMI demo code\n* 63e2f6dcd Minor fix to ELM configure script\n* 551fc79cc Updates ELM stub and demo code to use CNCarbonStateType\n* 8c9d41f87 Adds code to exchange CNCarbonStateType\n* 0000ded51 Minor fix\n* 2baa4ebec Adds fixes to cmake\n* f77ae2cea Rename few cmake files\n* b48b66dd6 Adds a demo for a Stub EM\n* fa94aea0d Fixes length of variable to store name of EMI data\n* cca0e0be1 Adds capability to print all EMI Data in a list\n* beb1fe9ee Adds .gitignore files for EMI\n* 301acfe7a Renames ExternalModelInterfaceDataMod.F90\n* f0eb5b40b Renames ExternalModelInterfaceDataDimensionMod.F90\n* 076100882 Restructures ELM's EMI directory\n*   cfb7fc2b2 Merge branch 'qzhu-lbl/lnd/ch4_inundation_bugfix' (PR #2814)\n|\\\n| * ec99b1cb4 (origin/qzhu-lbl/lnd/ch4_inundation_bugfix)  - fix ch4 inundatation parameter read in bug\n* |   c59c98116 Merge branch 'darincomeau/mpaso/enable_eddystats' (PR #2821)\n|\\ \\\n| * | c21bb46a4 Turn on eddy stats for oEC60to30v3 and oEC60to30v3wLI ocn grids by default\n* | |   a2dd2fce5 Merge pull request #2811 from E3SM-Project/jayeshkrishna/pio2_cime_changes\n</code></pre> <p>The above Git graph tells us that <code>bishtgautam/lnd/emi-example</code> started with the <code>cfb7fc2b2</code> hash on the <code>master</code>. So, we will generate the baselines using <code>cfb7fc2b2</code>. Checkout <code>cfb7fc2b2</code> and update the submodels via:</p> <pre><code>git checkout cfb7fc2b2\nNote: checking out 'cfb7fc2b2'.\n\nYou are in 'detached HEAD' state. You can look around, make experimental\nchanges and commit them, and you can discard any commits you make in this\nstate without impacting any branches by performing another checkout.\n\nIf you want to create a new branch to retain commits you create, you may\ndo so (now or later) by using -b with the checkout command again. Example:\n\n  git checkout -b &lt;new-branch-name&gt;\n\nHEAD is now at cfb7fc2b2... Merge branch 'qzhu-lbl/lnd/ch4_inundation_bugfix' (PR #2814)\n\ngit submodule update --init\n</code></pre> <p>Now we will use <code>cime/scripts/create_test</code> to generate baseline for the <code>e3sm_land_developer</code> test suite.</p> <pre><code>cd cime/scripts\n</code></pre> <p>A few things that you need to decide at this stage include the directory location where the baselines will be saved, the name and ID for the baselines, the project allocation that you will use for running the simulation, if you would like to receive email notifications about tests, etc.</p> <pre><code># Define the directory to hold the baseline \nexport MY_BASELINE_DIR=/global/cscratch1/sd/gbisht/e3sm_baselines\n\n# Do you want to use a name for the baseline? \n# One choice could be the git hash that is being used to generate the baselines.\nexport BASELINE_NAME=cfb7fc2b2\n\n# Let's set TEST_ID to be same as BASELINE_NAME\nexport TEST_ID=${BASELINE_NAME}\n\n# If you are a member of E3SM, you could use 'e3sm' project allocation\nexport PROJECT=e3sm\n\n# Set your email\nexport MAIL_USER=&lt;your-mail@something&gt;\n</code></pre> <p>Use <code>./create_test --help</code> to get a complete list of arguments. Below are some additional useful arguments for <code>./create_test</code>:</p> <pre><code># Other arguments\n# -v         : Verbose option\n# -g         : Generate the baseline\n# -q         : If you want to use a particular job queue (e.g. 'debug' queue on NERSC)\n# --walltime : Specify the wall time for jobs (e.g. 30 min is max allowable for 'debug' queue on NERSC)\n# --mail-user: If you want to receive emails about your jobs\n# --mail-type: When to receive emails. Options are: never, all, begin, end, fail.\n# -j         : Number of parallel jobs\n</code></pre> <p>Now run the <code>e3sm_land_developer</code></p> <pre><code>./create_test e3sm_land_developer  \\\n--baseline-root ${MY_BASELINE_DIR} \\\n-b ${BASELINE_NAME}                \\\n-t ${TEST_ID}                      \\\n-q regular                         \\\n-p ${PROJECT}                      \\\n--walltime 00:30:00                \\\n--mail-user $MAIL_USER             \\\n--mail-type all                    \\\n-g                                 \\\n-v                                 \\\n-j 4\n</code></pre> <p>The cases would be named <code>*.G.*</code> to denote one is generating the baselines. It will take a while to compile all the cases and submit the code. It can take a long time (&gt;30mins) for the test suite to run. To avoid interrupting the test suite in the middle, one can run the test suite within a <code>screen</code> command. After the cases have been successfully compiled and submitted, you can check that  status of test by running the <code>cs.status.${TEST_ID}</code> file that was created in the scratch directory.</p>"},{"location":"ELM/dev-guide/testing/#step-2-compare-against-previously-generated-baselines","title":"Step-2: Compare against previously generated baselines","text":"<p>Now, switch to the development branch and be sure to update submodules.</p> <pre><code>cd &lt;e3sm-dir&gt;\ngit checkout bishtgautam/lnd/emi-example\nPrevious HEAD position was cfb7fc2b2... Merge branch 'qzhu-lbl/lnd/ch4_inundation_bugfix' (PR #2814)\nSwitched to branch 'bishtgautam/lnd/emi-example'\nYour branch is up-to-date with 'origin/bishtgautam/lnd/emi-example'.\n\n# Checkout the appropriate submodules\ngit submodule update --init\n</code></pre> <p>Again initialize few settings.</p> <pre><code>cd cime/scripts\n\n# Let's use the settings as the last time\nexport MY_BASELINE_DIR=/global/cscratch1/sd/gbisht/e3sm_baselines\n\n# IMPORTANT: One needs to use the same BASELINE_NAME as in Step-1 because one wants\n#            to compare against the baselines previously generated in Step-1.\nexport BASELINE_NAME=cfb7fc2b2\n\n# You can use the hash at the tip of your branch as the ID\nexport TEST_ID=9a2cd8459\n</code></pre> <p>Run the test suite and compare (via <code>-c</code>) against previously generated baselines.</p> <pre><code>./create_test e3sm_land_developer  \\\n--baseline-root ${MY_BASELINE_DIR} \\\n-b ${BASELINE_NAME}                \\\n-t ${TEST_ID}                      \\\n-q debug                           \\\n--walltime 00:30:00                \\\n--mail-user $MAIL_USER             \\\n--mail-type all                    \\\n-c                                 \\\n-v                                 \\\n-j 4\n</code></pre> <p>The cases would be named <code>*.C.*</code> to denote one is comparing against previously generated baselines. Similar to the last time, a new <code>cs.status.${TEST_ID}</code> would be created and you can check the status of test by running it.</p>"},{"location":"ELM/tech-guide/","title":"Physics of ELM","text":""},{"location":"ELM/tech-guide/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Shortwave Radiation: Shortwave radiation model</li> <li>TOP Parameterization: Parameterization of sub-grid topographical effects on solar radiation.</li> <li>Longwave Radiation: Longwave radiation model</li> </ul>"},{"location":"ELM/tech-guide/longwave_radiation/","title":"Overview","text":"<p>The longwave radiation module in ELM solves the amount of longwave radiation absorbed by the ground and the vegetation, and the amount of outgoing radiation to the atmosphere (Figure 1). The model represents the ground surface as a mixture of snow, soil, and standing surface water. The shaded and sunlit leaves are combined as a single leaf within the model. The incoming longwave atmosphere radiation, \\(L^\\downarrow_{atm}\\), is a boundary condition for the model.</p> <p></p> <p>Fig 1. Two-stream longwave radiation model for (a) non-vegetated and (b) vegetated surfaces.</p>"},{"location":"ELM/tech-guide/longwave_radiation/#governing-equations-for-non-vegetated-surfaces","title":"Governing Equations For Non-vegetated Surfaces","text":"<p>The emitted longwave radation from ground, \\(L^{\\uparrow}_g\\), is</p> \\[ \\begin{equation} L^{\\uparrow}_{g} = (1 - \\epsilon_g)L^\\downarrow_{atm} + \\epsilon_g \\sigma T_{g}^4 \\label{eq:lg_up_nonveg} \\end{equation} \\] <p>where \\(\\epsilon_g\\) is the emissivity of the ground, \\(\\sigma\\) is the Stefan-Boltzmann constant, and \\(T_g\\) is the ground temperature. The first term on the right-hand side represents the reflected atmospheric longwave radiation, while the second term represents the emitted longwave radiation by the ground. The emitted longwave radiation is computed as</p> \\[ \\begin{equation} \\epsilon_g \\sigma T_g^4 = \\epsilon_g \\sigma \\left[ f_{sno} T^4_{sno,top} + \\left( 1 - f_{sno} - f_{h2osfc}\\right) T^4_{soi,1} + f_{h2osfc} T^4_{h2osfc} \\right] \\label{eqn:tg} \\end{equation} \\] <p>where \\(T_{sno,top}\\), \\(T_{soi,1}\\) and \\(T_{h2osfc}\\) the temperature of the top snow layer, the first soil layer, and the standing surface water, respectively, and \\(f_{sno}\\) and \\(f_{h2osfc}\\) are fraction of snow and standing surface water. The ground emissivity is computed as the weighted average of soil and snow emissivity as</p> \\[ \\begin{equation} \\epsilon_g = \\epsilon_{soi} (1 - f_{sno}) + \\epsilon_{sno} f_{sno} \\end{equation} \\] <p>where \\(\\epsilon_{soi}\\) is 0.96 for soil, 0.97 for glacier, and 0.96 for wetland, while \\(\\epsilon_{sno}\\) is 0.97.</p> <p>The radiation absorbed by the ground, \\(\\overrightarrow{L}_g\\), is</p> \\[ \\begin{equation} \\overrightarrow{L}_g = \\epsilon_g \\sigma T_g^4 + \\epsilon_g L_{atm}^\\downarrow \\label{eqn:lg_net_nonveg} \\end{equation} \\]"},{"location":"ELM/tech-guide/longwave_radiation/#governing-equations-for-vegetated-surfaces","title":"Governing Equations For Vegetated Surfaces","text":"<p>The longwave radiation below the canopy, \\(L_v\\downarrow\\), is</p> \\[ \\begin{equation} L_v^\\downarrow = (1 - \\epsilon_v)L_{atm}^\\downarrow + \\epsilon_v \\sigma T_v^4 \\end{equation} \\] <p>where \\(\\epsilon_v\\) is the emissivity of the vegetation and \\(T_v\\) is the temperature of the canopy. The model assumes the sunlit and shaded leaves are at the same temperature. The first term on the right-hand side of the equation represents the transmitted atmospheric longwave radiation through the canopy and the second term represents the emitted longwave radiation by the canopy. The emissivity of the vegetation is</p> \\[ \\begin{equation} \\epsilon_v = 1 - \\exp\\left( {-(L+S)/\\bar{\\mu}} \\right) \\end{equation} \\] <p>The upwelling longwave radiation from the ground is</p> \\[ \\begin{eqnarray} L_g^\\uparrow &amp;=&amp; (1 - \\epsilon_g) L_v^\\downarrow + \\epsilon_g \\sigma T_g^4 \\nonumber\\\\[0.5em] &amp;=&amp; (1 - \\epsilon_g)(1 - \\epsilon_v)L_{atm}^\\downarrow + (1 - \\epsilon_g)\\epsilon_v \\sigma T_v^4 + \\epsilon_g \\sigma T_g^4 \\end{eqnarray} \\] <p>where the \\(T_g\\) is given by equation \\eqref{eqn:tg}.</p> <p>Lastly, the upwelling radiation from the top of the canopy to the atmosphere is</p> \\[ \\begin{eqnarray} L_{vg}^\\uparrow &amp;=&amp; (1 - \\epsilon_v) L_g^\\uparrow + \\epsilon_v \\sigma T_v^4 \\nonumber \\\\[0.5em] &amp;=&amp; (1 - \\epsilon_v) \\left[ (1 - \\epsilon_g) L_v^\\downarrow + \\epsilon_g \\sigma T_g^4 \\right] + \\epsilon_v \\sigma T_v^4 \\nonumber \\\\[0.5em] &amp;=&amp; (1 - \\epsilon_v) (1 - \\epsilon_g) L_v^\\downarrow + (1 - \\epsilon_v) \\epsilon_g \\sigma T_g^4 + \\epsilon_v \\sigma T_v^4 \\nonumber \\\\[0.5em] &amp;=&amp; (1 - \\epsilon_v) (1 - \\epsilon_g) \\left[ (1 - \\epsilon_v)L_{atm}^\\downarrow + \\epsilon_v \\sigma T_v^4 \\right] \\nonumber\\\\[0.5em] &amp; &amp; + \\epsilon_v \\sigma T_v^4 + (1 - \\epsilon_v) \\epsilon_g \\sigma T_g^4 \\nonumber\\\\[0.5em] &amp;=&amp; (1 - \\epsilon_v) (1 - \\epsilon_g) (1 - \\epsilon_v)L_{atm}^\\downarrow \\nonumber\\\\[0.5em] &amp; &amp; +(1 - \\epsilon_v) (1 - \\epsilon_g) \\epsilon_v \\sigma T_v^4 \\nonumber\\\\[0.5em] &amp; &amp; + \\epsilon_v \\sigma T_v^4 + (1 - \\epsilon_v) \\epsilon_g \\sigma T_g^4 \\end{eqnarray} \\] <p>The radiation absorbed by the vegetation, \\(\\overrightarrow{L}_{v}\\), with positive value towards the atmosphere, is</p> \\[ \\begin{eqnarray} \\overrightarrow{L}_v &amp; = &amp;  2 \\epsilon_v T_v^4 - \\epsilon_v L_g^\\uparrow - \\epsilon_v L_{atm}^\\downarrow \\nonumber\\\\[0.5em] &amp; = &amp; 2 \\epsilon_v T_v^4  - \\epsilon_v \\left[ (1 - \\epsilon_g)(1 - \\epsilon_v)L_{atm}^\\downarrow + (1 - \\epsilon_g)\\epsilon_v \\sigma T_v^4 + \\epsilon_g \\sigma T_g^4 \\right] \\nonumber\\\\[0.5em] &amp; &amp; - \\epsilon_v L_{atm}^\\downarrow \\nonumber\\\\[0.5em] &amp; = &amp; \\left[ 2 - \\epsilon_v (1 - \\epsilon_g)\\right] \\epsilon_v \\sigma T_v^4 - \\epsilon_v \\epsilon_g \\sigma T_g^4 - \\epsilon_v \\left[ 1 + (1 - \\epsilon_g)(1 - \\epsilon_v) \\right] L_{atm}^\\downarrow \\label{eq:net_lv} \\end{eqnarray} \\] <p>The radiation absorbed by the ground with a positive value towards the atmosphere is</p> \\[ \\begin{equation} \\overrightarrow{L_g} = \\epsilon_g \\sigma T_g^4 - \\epsilon_g L_{v}^\\downarrow \\label{eq:net_lg_veg1} \\end{equation} \\]"},{"location":"ELM/tech-guide/longwave_radiation/#temporal-discretization-of-ground-temperature","title":"Temporal Discretization of Ground Temperature","text":"<p>The three components of ground temperature (i.e. \\(T_{sno,1}\\), \\(T_{soi,1}\\) and \\(T_{h2osoi}\\)) that contribute to the upward longwave radiation at the ground are coupled to the temperature of deeper snow and soil layers. This coupling of the temporally discretized equation of the surface energy balance (that includes absorbed shortwave radiation, \\(\\overrightarrow{S}_{soi}\\), absorbed longwave radiation, sensible heat flux, \\(H_{soi}\\), latent heat flux, \\(\\lambda E_{soi}\\), and ground heat flux, \\(G\\)) with the spatio-temporally discretized equations of the vertical heat diffusion model within the snow and soil layers leads to complexity. This complexity is discussed in Section 7.3 of Bonan (2019)<sup>1</sup> and briefly summarized below.</p>"},{"location":"ELM/tech-guide/longwave_radiation/#non-vegetated-surface","title":"Non-vegetated Surface","text":"<p>For simplicity, let's consider the non-vegetated case in which snow and standing are absent. In such a case, the ground temperature is the temperature of the first soil layer i.e. \\(T_g = T_{soi,1}\\). At the current time step \\(n+1\\), the absorbed longwave radiation given by equation \\eqref{eqn:lg_net_nonveg} is a function of soil temperature at time \\(n+1\\), \\(T_{sol,1}^{n+1}\\), which is unknown. The ground heat flux at the top of the soil is given as</p> \\[ \\begin{eqnarray} G_{soi} &amp;=&amp; \\overrightarrow{S}_{soi} - \\overrightarrow{L}_g - H_{soi} - \\lambda E_{soi} \\nonumber\\\\[0.5em] &amp; = &amp; \\overrightarrow{S}_{soi} - \\epsilon_{soi} \\sigma T_{soi,1}^4 - \\epsilon_{soi}L_{atm}^\\downarrow - H_{soi} - \\lambda E_{soi} \\end{eqnarray} \\] <p>The vertical heat diffusion model in ELM uses the Crank-Nicholson temporal discretization method in which the fluxes between cells are computed as an average of the flux at \\(n\\)-th and \\((n+1)\\)-th time step. The top boundary heat flux (i.e. \\(G\\)) in ELM is computed only at \\((n+1)\\)-th time step and is linearized as</p> \\[ \\begin{eqnarray} G_{soi}^{n+1} &amp;=&amp; G_{soi}^{n} + \\dfrac{\\partial G}{\\partial T_{soi,1}} \\left(T_{soi,1}^{n+1} - T_{soi,1}^n\\right) \\nonumber \\\\[0.5em] &amp; = &amp; \\overrightarrow{S}_{soi} - \\left[ \\epsilon_{soi} \\sigma (T_{soi,1}^{n})^4 + 4 \\epsilon_{soi} \\sigma (T_{soi,1}^{n})^3 \\Delta T_{soi}^{n+1} + \\epsilon_{soi}L_{atm}^\\downarrow \\right] \\nonumber \\\\[0.5em] &amp; &amp; - \\left[ H_{soi}^n + \\dfrac{\\partial H}{\\partial T_{soi,1}} \\Delta T_{soi}^{n+1} \\right] \\nonumber\\\\[0.5em] &amp; &amp; - \\left[ \\lambda E_{soi}^n + \\dfrac{\\partial \\lambda E}{\\partial T_{soi,1}} \\Delta T_{soi}^{n+1} \\right] \\nonumber \\\\[0.5em] &amp; = &amp; \\overrightarrow{S}_{soi} - \\overrightarrow{L}_g^{n+1} - H_{soi}^{n+1} - \\lambda E_{soi}^{n+1} \\label{eqn:G_bc_discretized} \\end{eqnarray} \\] <p>Thus, the temporally discretized net absorbed longwave radiation in Equation \\eqref{eqn:G_bc_discretized} is</p> \\[ \\begin{equation} \\overrightarrow{L}_g^{n+1} = \\left[ \\epsilon_{soi} \\sigma (T_{soi,1}^{n})^4 + 4 \\epsilon_{soi} \\sigma (T_{soi,1}^{n})^3 \\Delta T_{soi}^{n+1} + \\epsilon_{soi}L_{atm}^\\downarrow \\right] \\label{eqn:lg_net_nonveg2} \\end{equation} \\] <p>Comparing Equation \\eqref{eqn:lg_net_nonveg} and \\eqref{eqn:lg_net_nonveg2}, one can interpret the second term on the right hand side, \\(4\\epsilon_{soi}\\sigma\\) (\\(T_{soi}^n)^3 \\Delta T^{n+1}\\), as an additional source of emitted longwave radiation. However, this term can only be computed after the vertical heat diffusion model is solved, i.e, after \\(\\Delta T_{soi}^{n+1}\\) is known. Furthermore, this additional longwave radiation source term is added to the upward longwave radiation to the atmosphere given by \\(L_g^\\uparrow\\) in equation \\eqref{eq:lg_up_nonveg).</p> <p>For the more general case, when snow and standing surface water are present on the ground, the temporally discretized net absorbed longwave radiation is</p> \\[ \\begin{equation} \\overrightarrow{L}_g^{n+1} = \\epsilon_{g} \\sigma (T_{g}^{n})^4 + 4 \\epsilon_{g} \\sigma (T_{g}^{n})^3 \\Delta T_{g}^{n+1} + \\epsilon_{soi}L_{atm}^\\downarrow \\label{eqn:lg_net_nonveg3} \\end{equation} \\]"},{"location":"ELM/tech-guide/longwave_radiation/#vegetated-surface","title":"Vegetated Surface","text":"<p>The same coupling of the surface ground energy flux equations and vertical heat diffusion model leads to a similar model complexity and the temporally discretized net longwave radiation for vegetated given by equation \\eqref{eq:net_lg_veg1} is</p> \\[ \\begin{equation} \\overrightarrow{L_g}^{n+1} = \\epsilon_g \\sigma (T_g^n)^4 + 4 \\epsilon_{g} \\sigma (T_{g}^{n})^3 \\Delta T_{g}^{n+1} - \\epsilon_g L_{v}^\\downarrow \\end{equation} \\] <p>The additional apparent emitted longwave radiation represented by the second term on the right hand side of the above equation is not absorbed by the canopy and directly sent upwards to the atmosphere by adding it in \\(L_{vg}^\\uparrow\\).</p>"},{"location":"ELM/tech-guide/longwave_radiation/#temporally-discretized-governing-equations","title":"Temporally Discretized Governing Equations","text":"<p>For the sake of completeness and clarity, we list below the temporally discretized longwave equations used in ELM.</p>"},{"location":"ELM/tech-guide/longwave_radiation/#non-vegetated-surfaces","title":"Non-vegetated Surfaces","text":"<p>The temporally discretized upwelling longwave radiation to the atmosphere and absorbed longwave radiation by the ground are</p> \\[ \\begin{eqnarray} L^{\\uparrow n+1}_{g} &amp;=&amp; (1 - \\epsilon_g)L^{\\downarrow n+1}_{atm} + \\epsilon_g \\sigma (T_{g}^{n})^4 + 4 \\epsilon_{g} \\sigma (T_{g}^{n})^3 \\Delta T_{g}^{n+1} \\\\[0.5em] \\overrightarrow{L}_g^{n+1} &amp;=&amp; \\epsilon_g \\sigma (T_g^n)^4 + \\epsilon_g L_{atm}^{\\downarrow n+1} + 4 \\epsilon_{g} \\sigma (T_{g}^{n})^3 \\Delta T_{g}^{n+1} \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/longwave_radiation/#vegetated-surfaces","title":"Vegetated Surfaces","text":"<p>When solving for \\(T_v^{n+1}\\), ELM uses a diagnostic heat model in which leaves have no heat capacity and the sum of net absorbed solar and longwave radiation must balance the latent and sensible heat energy. This leads to a nonlinear equation for the vegetation canopy temperature, which is solved iteratively. When the solution for vegetation temperature has been found after \\(k\\)-th iteration, \\(T_v^{n+1,k}\\), ELM uses a linear approximation of the non-linear term related to canopy temperature in the canopy emitted upward and downward longwave radiation equations. The linear approximation is as follows.</p> \\[ \\begin{equation} \\epsilon_v \\sigma_v (T_v^{n+1,k+1})^4 = \\epsilon_v \\sigma_v (T_v^{n+1,k})^4 + 4\\epsilon_v \\sigma_v (T_v^{n+1,k})^3 \\Delta T_v^{n+1,k} \\end{equation} \\] <p>The temporally discretized downward longwave radiation by leaves is</p> \\[ \\begin{equation} L_v^{\\downarrow n+1} = (1 - \\epsilon_v)L_{atm}^{\\downarrow n+1} + \\epsilon_v \\sigma (T_v^{n+1,k})^4 + 4 \\epsilon_v \\sigma (T_v^{n+1,k})^3 (\\Delta T_v^{n+1,k+1}) \\end{equation} \\] <p>The temporally discretized upward longwave from the canopy</p> \\[ \\begin{eqnarray} L_{vg}^{\\uparrow n+1} &amp;=&amp; (1 - \\epsilon_v) (1 - \\epsilon_g) (1 - \\epsilon_v)L_{atm}^{\\downarrow n+1} \\nonumber \\\\[0.5em] &amp; &amp; + (1 - \\epsilon_v) (1 - \\epsilon_g) \\epsilon_v \\sigma (T_v^{n+1,k})^4 \\nonumber\\\\[0.5em] &amp; &amp; + 4 (1 - \\epsilon_v) (1 - \\epsilon_g) \\epsilon_v \\sigma (T_v^{n+1,k})^3 (\\Delta T_v^{n+1,k+1}) \\nonumber\\\\[0.5em] &amp; &amp; + \\epsilon_v \\sigma (T_v^{n+1,k})^4 + 4 \\epsilon_v \\sigma (T_v^{n+1,k})^3 \\Delta T_v^{n+1,k+1} \\nonumber\\\\[0.5em] &amp; &amp; + (1 - \\epsilon_v) \\epsilon_g \\sigma (T_g^n)^4 \\end{eqnarray} \\] <p>The temporally discretized upward longwave from the canopy and ground to the atmosphere is</p> \\[ \\begin{equation} L^{\\uparrow n + 1} = L_{vg}^{\\uparrow n+1}  + 4 \\epsilon_g \\sigma (T_g^n)^3 (\\Delta T_g^{n+1}) \\end{equation} \\] <p>Note the \\(T_v\\) used in computing the net longwave radiation absorbed by the leaf given by equation \\eqref{eq:net_lv} is \\(T_v^{n+1,k}\\) and it is not adjusted after the solution for vegetation temperature is found.</p> <ol> <li> <p>Gordon Bonan. Climate change and terrestrial ecosystem modeling. Cambridge University Press, 2019.\u00a0\u21a9</p> </li> </ol>"},{"location":"ELM/tech-guide/shortwave_radiation/","title":"Overview","text":"<p>The main features of ELM shortwave radiation model are as follows:</p> <ul> <li>The shortwave radiation model in ELM computes the beam   (or direct) and diffuse radiation absorbed by the canopy   (i.e. sunlit and shaded leaves) and the ground,   the radiation reflected to the atmosphere, and surface   albedo.</li> <li>The model accounts for radiation in two bands: visible   (\\(&lt; 0.7\\mu\\)m) and near-infrared (\\(\\ge 0.7 \\mu\\)m).</li> <li>The model uses the two-stream approximation of   Dickenson 1983<sup>1</sup> and   Sellers 1985<sup>2</sup>.</li> <li>The model is a single-layer canopy model.</li> <li>Sunlit leaf absorbs unscattered direct radiation,   scattered direct radiation, and diffuse radiation.</li> <li>Shaded leaf absorbs scattered direct radiation and   diffuse radiation.</li> <li>Snow albedo and the shortwave radiative heating of each snowpack layer   is modeled using the hybrid SNICAR-AD model   of Dang et al. 2019<sup>3</sup>.</li> <li>The sub-grid impacts of topography on solar radiation   are parameterized using the approach of Hao et al. 2021   <sup>4</sup>.</li> </ul> <p>ELM's shortwave radiation model is similar to CLM4.5<sup>5</sup>, and its new features include the hybrid SNICAR-AD model for snow albedo and a parameterization for the sub-grid effects of topography on solar radiation.</p> <p>The outline of this chapter is as follows. First, the governing equations of the two-stream approximation of the radiative transfer model are presented. Second, the analytical solutions for the upward and downward diffuse radiation using the two-stream approximation are given. Third, the analytical solutions are used for the single-layer canopy configuration to compute the radiation absorbed by the canopy and ground and the radiation absorbed by the canopy for sunlit and shaded leaves. Fourth, the treatment of surface albedo is described. Fifth, the equations describing the total amount of solar radiation are presented.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#two-stream-approximation-radiative-transfer-model","title":"Two-Stream Approximation Radiative Transfer Model","text":"<p>At any level within the canopy, the upward/downward direct/diffuse radiation is transmitted and intercepted by the canopy. The intercepted radiation is scattered backward, scattered forward, and absorbed by the canopy. The diffuse radiative fluxes via the two-stream approximation are given as</p> \\[ \\begin{eqnarray} - \\dfrac{dI^{\\uparrow}}{d(L+S)} + [ 1 - (1 - \\beta)\\omega ] \\dfrac{1}{\\bar{\\mu}}I^{\\uparrow} - \\omega \\beta \\dfrac{1}{\\bar{\\mu}} I^{\\downarrow} = \\omega K_b \\beta_0 e^{-K(L+S)} \\label{eqn:dif_up} \\\\[0.5em]  \\dfrac{dI^{\\downarrow}}{d(L+S)} + [ 1 - (1 - \\beta)\\omega ] \\dfrac{1}{\\bar{\\mu}} I^{\\downarrow} - \\omega \\beta \\dfrac{1}{\\bar{\\mu}} I^{\\uparrow} = \\omega K_b (1 - \\beta_0) e^{-K(L+S)} \\label{eqn:dif_dn} \\end{eqnarray} \\] <p>where \\(I^{\\uparrow}\\) is the upward diffuse radiative flux per unit incident flux, \\(I^{\\downarrow}\\) is the downward diffuse radiative flux per unit incident flux, \\(K_b \\left( = G(\\mu)/\\mu \\right)\\) is the optical depth of direct radiation per unit leaf and stem area, \\(G(\\mu)\\) is the relative projected area of leaf and stem in the direction of \\(\\cos^{-1}(\\mu)\\), \\(\\mu\\) is the cosine of the solar zenith angle, \\(\\bar{\\mu} \\left( = 1/K_d \\right)\\) is the inverse of the optical depth of diffuse radiation per unit leaf and stem area, \\(\\omega\\) is the scattering coefficient, \\(\\beta\\) is the upscatter parameter for diffuse radiation, \\(\\beta_0\\) is the upscatter parameter for direct radiation, \\(L\\) is leaf area index, and \\(S\\) is stem area index.</p> <p>The equations \\eqref{eqn:dif_up}-\\eqref{eqn:dif_dn} includes the five optical parameters: \\(G(\\mu)\\), \\(\\bar{\\mu}\\), \\(\\omega\\), \\(\\beta\\), and \\(\\beta_0\\). The optical parameters dependent on wavelength band (\\(\\Lambda\\)) are \\(\\omega\\), \\(\\beta\\), and \\(\\beta_0\\). Next, we describe the computation of these optical parameters.</p> <p></p> <p>Fig 1. Two-stream approximation of (b) upward diffuse radiation, (b) downward diffuse radiation, and (c) downward direct radiation.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#projected-leaf-and-stem-area","title":"Projected leaf and stem area","text":"<p>ELM uses the Ross-Gourdriaan<sup>6</sup><sup>7</sup> function to compute the projection of leaf area in the direction of the solar radiation as:</p> \\[ \\begin{equation} G(\\mu) = \\phi_1 + \\phi_2 \\mu \\end{equation} \\] <p>with \\(\\phi_1 = 0.5 - 0.633 \\chi_\\ell - 0.366 \\chi^2_\\ell\\) and \\(\\phi_2 = 0.877 (1 - 2 \\phi_2)\\). The \\(\\chi_\\ell\\) is the Ross index or leaf/stem orientation index that is restricted to \\(-0.4 \\lt \\chi_\\ell \\lt 0.6\\). For vertical leaves, \\(\\chi_\\ell = -1\\) and \\(\\bar{\\theta} = 90^0\\). For horizontal leaves, \\(\\chi_\\ell = 1\\) and \\(\\bar{\\theta} = 0^0\\). For randomly spherically distributed leaves, \\(\\chi_\\ell = 0\\) and \\(\\bar{\\theta} = 60^0\\).</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#optical-depths","title":"Optical depths","text":"<p>The optical depth of direct radiation per unit leaf and stem area is given by</p> \\[ \\begin{equation} K_b = \\dfrac{G(\\mu)}{\\mu} \\end{equation} \\] <p>The optical depth of diffuse radiation per unit leaf and stem area is given by</p> \\[ \\begin{eqnarray} \\bar{\\mu} = \\int_0^1 \\dfrac{\\mu'}{G(\\mu')} d\\mu' = \\dfrac{1}{\\phi_1} \\left[ 1 - \\dfrac{\\phi_1}{\\phi_2}\\ln \\left( \\dfrac{\\phi_1 + \\phi_2}{\\phi_1} \\right) \\right] \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#scattering-coefficient","title":"Scattering coefficient","text":"<p>The scattering coefficient accounts for the presence or absence of snow on vegetation as</p> \\[ \\begin{equation} \\omega_\\Lambda = \\begin{cases} \\omega_\\Lambda^{veg} \\left( 1 - f_{wet}\\right) + \\omega_\\Lambda^{sno}f_{wet}, &amp; \\text{if snow is on the canopy}\\\\[0.5em] \\omega_\\Lambda^{veg}, &amp; \\text{otherwise} \\end{cases} \\end{equation} \\] <p>where the vegetation scattering coefficient, \\(\\omega_\\Lambda^{veg}\\), is the sum of reflectances and transmittances, each of which is given as weighted averages of leaf and stem values as</p> \\[ \\begin{eqnarray} \\omega_\\Lambda^{veg} &amp;=&amp; \\alpha_\\Lambda + \\tau_\\Lambda \\\\[0.5em]                      &amp;=&amp; \\alpha_\\Lambda^{leaf} w_{leaf} +                      \\alpha_\\Lambda^{stem} w_{stem}                      + \\tau_\\Lambda^{leaf} w_{leaf} +                      \\tau_\\Lambda^{stem} w_{stem}                      \\\\[0.5em]                      &amp;=&amp; \\alpha_\\Lambda^{leaf} \\left(                      \\dfrac{L}{L+S} \\right) +                      \\alpha_\\Lambda^{stem} \\left(                      \\dfrac{S}{L+S} \\right) \\nonumber\\\\                      &amp; &amp;+ \\tau_\\Lambda^{leaf} \\left(                      \\dfrac{L}{L+S} \\right) +                      \\tau_\\Lambda^{stem} \\left(                      \\dfrac{S}{L+S} \\right) \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#upscatter-for-diffuse-radiation","title":"Upscatter for diffuse radiation","text":"<p>The upscatter for diffuse radiation also accounts for the presence of snow on vegetation as</p> \\[ \\begin{equation} \\omega_\\Lambda \\beta_\\Lambda = \\begin{cases} \\omega_\\Lambda^{veg} \\beta_\\Lambda^{veg} \\left( 1 - f_{wet}\\right) + \\omega_\\Lambda^{sno} \\beta_\\Lambda^{sno} f_{wet}, &amp; \\text{if snow is on the canopy}\\\\[0.5em] \\omega_\\Lambda^{veg} \\beta_\\Lambda^{veg}, &amp; \\text{otherwise} \\end{cases} \\end{equation} \\] <p>where</p> \\[ \\begin{eqnarray} \\omega_\\Lambda^{veg} \\beta_\\Lambda^{veg} &amp;=&amp; \\dfrac{1}{2} \\left[ \\alpha_\\Lambda + \\tau_\\Lambda + (\\alpha_\\Lambda - \\tau_\\Lambda) \\cos^2\\bar{\\theta}\\right] \\nonumber \\\\[0.5em] &amp;=&amp; \\dfrac{1}{2} \\left[ \\alpha_\\Lambda + \\tau_\\Lambda + (\\alpha_\\Lambda - \\tau_\\Lambda) \\left( \\dfrac{1 + \\chi_\\ell}{2} \\right)^2\\right] \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#upscatter-for-direct-radiation","title":"Upscatter for direct radiation","text":"<p>The upscatter for direct radiation accounts for the presence of snow on vegetation as</p> \\[ \\begin{equation} \\omega_\\Lambda \\beta_{0,\\Lambda} = \\begin{cases} \\omega_\\Lambda^{veg} \\beta_{0,\\Lambda}^{veg} \\left( 1 - f_{wet}\\right) + \\omega_\\Lambda^{sno} \\beta_{0,\\Lambda}^{sno} f_{wet}, &amp; \\text{if snow is on the canopy}\\\\[0.5em] \\omega_\\Lambda^{veg} \\beta_{0,\\Lambda}^{veg}, &amp; \\text{otherwise} \\end{cases} \\end{equation} \\] <p>where</p> \\[ \\begin{eqnarray} \\omega_\\Lambda^{veg} \\beta_{0,\\Lambda}^{veg} &amp;=&amp; \\left(\\dfrac{1 + \\bar{\\mu}K}{\\bar{\\mu}K} \\right) a_s(\\mu)_\\Lambda \\nonumber \\\\[0.5em] &amp;=&amp; \\left(\\dfrac{1 + \\bar{\\mu}K}{\\bar{\\mu}K}\\right) \\dfrac{\\omega_\\Lambda^{veg}}{2} \\dfrac{G(\\mu)}{\\mu \\phi_2 + G(\\mu)} \\left[ 1 - \\dfrac{\\mu \\phi_1}{\\mu \\phi2 + G(\\mu)} \\ln \\left( \\dfrac{\\mu \\phi_1 + \\mu \\phi_2 + G(\\mu)}{\\mu \\phi1} \\right) \\right] \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#analytical-solutions-of-the-two-stream-approximation-radiative-transfer-model","title":"Analytical Solutions of the Two-Stream Approximation Radiative Transfer Model","text":"<p>The analytical solutions for upward and downward radiation at a depth equal to the cumulative leaf and stem area index, \\(\\kappa\\), were derived by Sellers (1985) for the two-stream approximation model given by equations \\eqref{eqn:dif_up}-\\eqref{eqn:dif_dn} under a set of prescribed boundary conditions.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#scattered-beam-radiation","title":"Scattered Beam Radiation","text":"<p>The following boundary conditions are used for the values of downward diffuse radiation per unit incident direct radiation at the top of the canopy (i.e., \\(\\kappa = 0\\)) and upward diffuse per unit incident direct radiation at the bottom of the canopy (i.e., \\(\\kappa = L + S\\)):</p> \\[ \\begin{eqnarray} I^{\\downarrow}_{b,\\Lambda}(\\kappa = 0) &amp;=&amp; 0 \\\\[0.5em] I^{\\uparrow}_{b,\\Lambda}(\\kappa = L + S) &amp;=&amp; \\alpha_{gb,\\Lambda} e^{-K(L+S)} + \\alpha_{gd}I^{\\downarrow}_{b,\\Lambda} \\end{eqnarray} \\] <p>with \\(\\alpha_{gb,\\Lambda}\\)  and \\(\\alpha_{gd,\\Lambda}\\) are the ground albedo for direct and diffuse radiation, respectively. Under such boundary conditions, the analytical solution of upward and downward diffuse radiation per unit incident direct radiation is</p> \\[ \\begin{eqnarray} I^{\\uparrow}_{b,\\Lambda}(\\kappa) &amp;=&amp; \\dfrac{h_1 e^{-K \\kappa}}{\\sigma} + h_2 e^{ -h \\kappa} + h_3 e^{h\\kappa} \\label{two_str_dir_up_eqn} \\\\[0.5em] I^{\\downarrow}_{b,\\Lambda}(\\kappa) &amp;=&amp; \\dfrac{h_4 e^{-K \\kappa}}{\\sigma} + h_5 e^{-h \\kappa} + h_6 e^{h\\kappa} \\label{two_str_dir_dn_eqn} \\end{eqnarray} \\] <p>It should be noted that \\(I^{\\uparrow}_{b,\\Lambda}(\\kappa = 0)\\) can be interpreted as surface albedo for the diffuse (or scattered) flux of beam radiation.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#diffuse-radiation","title":"Diffuse Radiation","text":"<p>The following boundary conditions are used for the values of downward diffuse radiation per unit incident diffuse radiation at the top of the canopy (i.e., \\(\\kappa = 0\\)) and upward diffuse per unit incident diffuse radiation at the bottom of the canopy (i.e., \\(\\kappa = L + S\\)):</p> \\[ \\begin{eqnarray} I^{\\downarrow}_{d,\\Lambda}(\\kappa = 0) &amp;=&amp; 1 \\\\[0.5em] I^{\\uparrow}_{d,\\Lambda}(\\kappa = L + S) &amp;=&amp; \\alpha_{gd}I^{\\downarrow}_{d,\\Lambda} \\end{eqnarray} \\] <p>Under such boundary conditions, the analytical solution of upward and downward diffuse radiation per unit incident diffuse radiation is</p> \\[ \\begin{eqnarray} I^{\\uparrow}_{d,\\Lambda}(\\kappa) &amp;=&amp; h_7 e^{ -h \\kappa} + h_8 e^{h\\kappa} \\label{two_str_dif_up_eqn} \\\\ I^{\\downarrow}_{d,\\Lambda}(\\kappa) &amp;=&amp; h_9 e^{ -h \\kappa} + h_{10} e^{h\\kappa} \\label{two_str_dif_dn_eqn} \\end{eqnarray} \\] <p>It should be noted that \\(I^{\\uparrow}_{d,\\Lambda}(\\kappa = 0)\\) can be interpreted as surface albedo for the diffuse (or scattered) flux of diffuse radiation.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#parameters-in-the-analytical-solutions","title":"Parameters in the Analytical Solutions","text":"<p>The parameters for the analytical equations \\eqref{two_str_dir_up_eqn}, \\eqref{two_str_dir_dn_eqn}, \\eqref{two_str_dif_up_eqn}, and \\eqref{two_str_dif_dn_eqn} are presented here.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#common-parameters","title":"Common Parameters","text":"<p>The parameters common to both the beam and diffuse radiation are:</p> \\[ \\begin{eqnarray} b &amp;=&amp; 1 - \\omega_\\Lambda + \\omega_\\Lambda \\beta_\\Lambda \\\\[0.5em] c &amp;=&amp; \\omega_\\Lambda \\beta_\\Lambda \\\\[0.5em] d &amp;=&amp; \\omega_\\Lambda \\bar{\\mu} K \\beta_{0,\\Lambda} \\\\[0.5em] f &amp;=&amp; \\omega_\\Lambda \\bar{\\mu} K (1 - \\beta_{0,\\Lambda}) \\\\[0.5em] h &amp;=&amp; \\dfrac{\\sqrt{b^2 - c^2}}{\\bar{\\mu}} \\\\[0.5em] \\sigma &amp;=&amp; (\\bar{\\mu} K)^2 + c^2 - b^2 \\\\[0.5em] s_1 &amp;=&amp; e^{-h(L+S)} \\\\[0.5em] s_2 &amp;=&amp; e^{-K(L+S)} \\\\[0.5em] \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#parameters-for-scattered-beam-radiation","title":"Parameters For Scattered Beam Radiation","text":"<p>The parameters for the beam radiation equations \\eqref{two_str_dir_up_eqn} - \\eqref{two_str_dir_dn_eqn} are:</p> \\[ \\begin{eqnarray} u_1 &amp;=&amp; b - c/\\alpha_{gb,\\Lambda} \\\\[0.5em] u_2 &amp;=&amp; b - c\\alpha_{gb,\\Lambda} \\\\[0.5em] u_3 &amp;=&amp; f - c\\alpha_{gb,\\Lambda} \\\\[0.5em] p_1 &amp;=&amp; b + \\bar{\\mu} h \\\\[0.5em] p_2 &amp;=&amp; b - \\bar{\\mu} h \\\\[0.5em] p_3 &amp;=&amp; b + \\bar{\\mu} K \\\\[0.5em] p_4 &amp;=&amp; b - \\bar{\\mu} K \\\\[0.5em] d_1 &amp;=&amp; \\dfrac{p_1(u_1 - \\bar{\\mu}h)}{s_1} - p_2 (u_1 + \\bar{\\mu}h)s_1 \\\\[0.5em] d_2 &amp;=&amp; \\dfrac{(u_2 + \\bar{\\mu}h)}{s_1} - (u_2 - \\bar{\\mu}h)s_1 \\\\[0.5em] h_1 &amp;=&amp; -d p_4 - c f \\\\[0.5em] h_2 &amp;=&amp; \\dfrac{1}{d_1} \\left[ \\left( d - \\dfrac{h_1}{\\sigma}p_3 \\right) \\dfrac{(u_1 - \\bar{\\mu}h)}{s_1} - p_2 \\left( d - c - \\dfrac{h_1}{\\sigma} (u_1 + \\bar{\\mu}K)\\right)s _2\\right] \\\\[0.5em] h_3 &amp;=&amp; \\dfrac{-1}{d_1} \\left[ \\left( d - \\dfrac{h_1}{\\sigma}p_3 \\right) \\dfrac{(u_1 + \\bar{\\mu}h)}{s_1} - p_1 \\left( d - c - \\dfrac{h_1}{\\sigma} (u_1 + \\bar{\\mu}K)\\right)s _2\\right] \\\\[0.5em] h_4 &amp;=&amp; -f p_3 - c d \\\\[0.5em] h_5 &amp;=&amp; \\dfrac{-1}{d_2} \\left[ \\left( \\dfrac{h_4(u_2 + \\bar{\\mu}h)}{\\sigma s_1} \\right) + \\left( u_3 - \\dfrac{h_4}{\\sigma} (u_2 - \\bar{\\mu}K) \\right)s_2 \\right] \\\\[0.5em] h_6 &amp;=&amp; \\dfrac{1}{d_2} \\left[ \\dfrac{h_4(u_2 + \\bar{\\mu}h)}{\\sigma}s_1 + \\left( u_3 - \\dfrac{h_4}{\\sigma} (u_2 - \\bar{\\mu}K) \\right)s_2 \\right] \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#parameters-for-diffuse-radiation","title":"Parameters For Diffuse Radiation","text":"<p>The parameters for the diffuse radiation equations \\eqref{two_str_dif_up_eqn} - \\eqref{two_str_dif_dn_eqn} are:</p> \\[ \\begin{eqnarray} u_1 &amp;=&amp; b - c/\\alpha_{gd,\\Lambda} \\\\[0.5em] u_2 &amp;=&amp; b - c\\alpha_{gd,\\Lambda} \\\\[0.5em] h_7 &amp;=&amp; \\dfrac{c(u_1 - \\bar{\\mu}h)}{d_1s_1} \\\\[0.5em] h_8 &amp;=&amp; \\dfrac{-c(u_1 - \\bar{\\mu}h)s_1}{d_1} \\\\[0.5em] h_9 &amp;=&amp; \\dfrac{(u_2 + \\bar{\\mu}h)}{d_2s_2} \\\\[0.5em] h_{10} &amp;=&amp; \\dfrac{-s_1(u_2 - \\bar{\\mu}h)}{d_2} \\\\[0.5em] \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#radiation-absorbed-by-sunlit-and-shaded-leaves","title":"Radiation Absorbed by Sunlit and Shaded Leaves","text":"<p>It is assumed that the shaded leaves only receive diffuse radiation, including scattered direct and diffuse radiation. In contrast, the sunlit leaves receive unscattered direct radiation, scattered direct radiation, and diffuse radiation. Given these assumptions, the radiation absorbed by shaded (\\(\\overrightarrow{I}_{\\ell}^{sha}\\)) and sunlit (\\(\\overrightarrow{I}_{\\ell}^{sun}\\)) leaves per unit shaded and sunlit leaf area at the cumulative leaf area index \\(\\kappa\\) is given as:</p> \\[ \\begin{eqnarray} \\overrightarrow{I}_{\\ell}^{sha} (\\kappa) &amp;=&amp; \\overrightarrow{I}_{\\ell b}(\\kappa) + \\overrightarrow{I}_{\\ell d}(\\kappa) \\label{eqn_sha_net_rad} \\\\[0.5em] \\overrightarrow{I}_{\\ell}^{sun} (\\kappa) &amp;=&amp; (1 - \\omega)K_b e^{-K_b\\kappa}I_{atm,b}^{\\downarrow} +  \\overrightarrow{I}_{\\ell b}(\\kappa) + \\overrightarrow{I}_{\\ell d}(\\kappa) \\label{eqn_sun_net_rad} \\end{eqnarray} \\] <p>where \\(\\overrightarrow{I}_{\\ell b}(\\kappa)\\) is the net absorbed beam radiation and \\(\\overrightarrow{I}_{\\ell d}(\\kappa)\\) is the net absorbed diffuse radiation. These net absorbed beam and diffuse radiation fluxes at the cumulative leaf area index \\(\\kappa\\) are given as:</p> \\[ \\begin{eqnarray} \\overrightarrow{I}_{\\ell b}(\\kappa) &amp;=&amp; \\left[ \\omega K_b e^{-K_b \\kappa} + \\dfrac{d(I_{b}^{\\uparrow} - I_b^{\\downarrow})}{d\\kappa} \\right] I_{atm,b}^\\downarrow \\\\[0.5em] \\overrightarrow{I}_{\\ell d}(\\kappa) &amp;=&amp; \\dfrac{d(I_d^\\uparrow - I_d^\\downarrow)}{d\\kappa} I_{d0}^\\downarrow \\end{eqnarray} \\] <p>The canopy level net absorbed beam and diffused fluxes (per unit ground area) are obtained by integrating equations \\eqref{eqn_sha_net_rad} - \\eqref{eqn_sun_net_rad} over the canopy profile while accounting for sunlit and shaded leaf fraction as</p> \\[ \\begin{eqnarray} \\overrightarrow{I}_c^{sha} &amp;=&amp; \\int_0^{L+S} \\overrightarrow{I}_{\\ell}^{sha}(\\kappa) \\left[ 1 - f_{sun}(\\kappa)\\right] d\\kappa = \\overrightarrow{I}_{cb}^{sha} + \\overrightarrow{I}_{cd}^{sha} \\\\[0.5em] \\overrightarrow{I}_c^{sun} &amp;=&amp; \\int_0^{L+S} \\overrightarrow{I}_{\\ell}^{sun}(\\kappa) f_{sun}(\\kappa) d\\kappa = \\overrightarrow{I}_{cb}^{sun} + \\overrightarrow{I}_{cd}^{sun} \\end{eqnarray} \\] <p>where \\(\\overrightarrow{I}_{cb}^{sha}\\) is the canopy level absorbed beam radiation by shaded leaves, \\(\\overrightarrow{I}_{cd}^{sha}\\) is the canopy level absorbed diffuse radiation by shaded leaves, \\(\\overrightarrow{I}_{cb}^{sun}\\) is the canopy level absorbed beam radiation by sunlit leaves, and \\(\\overrightarrow{I}_{cd}^{sun}\\) is the canopy level absorbed diffuse radiation by sunlit leaves. Furthermore, the total absorbed beam (or diffuse) radiation by the canopy must be the sum of absorbed beam (or diffuse) radiation by sunlit and shaded leaves as:</p> \\[ \\begin{eqnarray} \\overrightarrow{I}_{cb} &amp;=&amp; \\overrightarrow{I}_{cb}^{sha} + \\overrightarrow{I}_{cb}^{sun} \\label{eqn_can_b_conservation} \\\\[0.5em] \\overrightarrow{I}_{cd} &amp;=&amp; \\overrightarrow{I}_{cd}^{sha} + \\overrightarrow{I}_{cd}^{sun} \\label{eqn_can_d_conservation} \\end{eqnarray} \\] <p>The sunlit fraction of canopy, \\(f_{sun}\\), is given by</p> \\[ \\begin{equation} f_{sun}(\\kappa) = e^{-K_b \\kappa} \\label{eqn_sun} \\end{equation} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#single-layer-canopy-model-with-the-two-stream-approximation","title":"Single-Layer Canopy Model With the Two-Stream Approximation","text":"<p>ELM represents the canopy as a single layer with a sunlit and shaded leaf. The scattered beam and diffuse upward (or downward) radiation fluxes at the canopy top (or bottom) are given by substituting \\(\\kappa = 0\\) (or \\(\\kappa = L + S\\)) in equations \\eqref{two_str_dir_up_eqn} -- \\eqref{two_str_dir_dn_eqn} as</p> \\[ \\begin{eqnarray} I^{\\uparrow}_{b,\\Lambda}(\\kappa = 0) &amp;=&amp; \\dfrac{h_1 }{\\sigma} + h_2 + h_3 \\\\[0.5em] I^{\\downarrow}_{b,\\Lambda}(\\kappa = L+S) &amp;=&amp; \\dfrac{h_4 e^{-K (L+S)}}{\\sigma} + h_5 e^{ -h (L+S)} + h_6 e^{h (L+S)} \\nonumber \\\\ &amp;=&amp; \\dfrac{h_4 e^{-K (L+S)}}{\\sigma} + h_5 s_1 + \\dfrac{h_6}{s_1} \\\\ I^{\\uparrow}_{d,\\Lambda}(\\kappa = 0) &amp;=&amp; h_7 + h_8 \\\\[0.5em] I^{\\downarrow}_{d,\\Lambda}(\\kappa = L+S) &amp;=&amp; h_9 e^{ -h (L+S)} + h_{10} e^{h (L+S)} \\\\[0.5em] &amp;=&amp; h_9 s_1 + \\dfrac{h_{10}}{s_1} \\end{eqnarray} \\] <p></p> <p>Fig 2. Schematic representation of (a) direct beam radiation and (b) diffuse solar radiation through ELM's single-layer canopy and soil configuration.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#radiation-absorbed-by-canopy","title":"Radiation Absorbed By Canopy","text":"<p>The amount of beam and diffuse radiation absorbed per unit incident flux by the canopy can be computed as the difference between the incoming and outgoing radiation as</p> \\[ \\begin{eqnarray} \\overrightarrow{I}_{cb,\\Lambda} &amp;=&amp; 1 - I_{b,\\Lambda}^{\\uparrow} - \\left( 1 - \\alpha_{gd,\\Lambda}\\right) I_{b,\\Lambda}^{\\downarrow} - (1 - \\alpha_{gb,\\Lambda})e^{-K(L+S)} \\label{eqn_can_b_absorb} \\\\[0.5em] \\overrightarrow{I}_{cd,\\Lambda} &amp;=&amp; 1 - I_{d,\\Lambda}^\\uparrow - \\left( 1 - \\alpha_{gd,\\Lambda}\\right) I_{d,\\Lambda}^\\downarrow \\label{eqn_can_d_absorb} \\end{eqnarray} \\] <p>The upward and downward fluxes in the above equations are for \\(\\kappa = 0\\) and \\(\\kappa = L + S\\), respectively, and to simplify the notation, \\(\\kappa\\) has been omitted from the equations.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#radiation-absorbed-by-sunlit-and-shaded-leaves_1","title":"Radiation Absorbed By Sunlit and Shaded Leaves","text":"<p>Using analytical solutions of the two-stream approximation, Dai et al. 2004<sup>8</sup> provided analytical solutions for the radiation absorbed by the sunlit and shaded leaves presented below.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#sunlit-leaves","title":"Sunlit leaves","text":"<p>The analytical solution of the beam radiation absorbed by sunlit leaves is given as</p> \\[ \\begin{equation} \\overrightarrow{I}_{b, \\Lambda}^{sun} = \\left(1 - \\omega_\\Lambda \\right) \\left[ 1 - s_2 + \\dfrac{(a_1 + a_2)}{\\mu}\\right] \\end{equation} \\] <p>where the parameters are given as follows</p> \\[ \\begin{eqnarray} a_1 &amp;=&amp; \\dfrac{h_1}{\\sigma} \\left[ \\dfrac{1 - s_2^2}{2K}\\right] + h_2 \\left[ \\dfrac{1 - s_1 s_2}{K + h} \\right] + h_3 \\left[ \\dfrac{1 - s_2/s_1}{K - h} \\right] \\\\[0.5em] a_2 &amp;=&amp; \\dfrac{h_4}{\\sigma} \\left[ \\dfrac{1 - s_2^2}{2K}\\right] + h_5 \\left[ \\dfrac{1 - s_1 s_2}{K + h} \\right] + h_6 \\left[ \\dfrac{1 - s_2/s_1}{K - h} \\right] \\end{eqnarray} \\] <p>Using equation \\eqref{eqn_can_b_conservation}, the beam radiation absorbed by shaded leaves is computed as</p> \\[ \\begin{equation} \\overrightarrow{I}_{b, \\Lambda}^{sha} = \\overrightarrow{I}_{cb, \\Lambda} - \\overrightarrow{I}_{b, \\Lambda}^{sun} \\end{equation} \\] <p>where the first term on the right hand side is given by equation \\eqref{eqn_can_b_absorb}.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#shaded-leaves","title":"Shaded leaves","text":"<p>The analytical solution of the beam radiation absorbed by shaded leaves are given as</p> \\[ \\begin{equation} \\overrightarrow{I}_{d, \\Lambda}^{sun} = \\left[ \\dfrac{1 - \\omega_\\Lambda}{\\mu} \\right] (a_1 + a_2) \\end{equation} \\] <p>where the parameters are given as follows</p> \\[ \\begin{eqnarray} a_1 &amp;=&amp; h_7 \\left[ \\dfrac{1 - s_1 s_2}{K + h} \\right] + h_8 \\left[ \\dfrac{1 - s_2/s_1}{K - h} \\right] \\\\[0.5em] a_2 &amp;=&amp; h_9 \\left[ \\dfrac{1 - s_1 s_2}{K + h} \\right] + h_{10} \\left[ \\dfrac{1 - s_2/s_1}{K - h} \\right] \\end{eqnarray} \\] <p>Using equation \\eqref{eqn_can_b_conservation}, the beam radiation absorbed by shaded leaves is computed as</p> \\[ \\begin{equation} \\overrightarrow{I}_{d, \\Lambda}^{sha} = \\overrightarrow{I}_{cd, \\Lambda} - \\overrightarrow{I}_{d, \\Lambda}^{sha} \\end{equation} \\] <p>where the first term on the right hand side is given by equation \\eqref{eqn_can_d_absorb}.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#radiation-absorbed-by-ground","title":"Radiation Absorbed By Ground","text":"<p>The beam and diffuse radiation absorbed by the ground are computed as the difference of the incoming and the outgoing radiation.</p> \\[ \\begin{eqnarray} \\overrightarrow{I}_{gb,\\Lambda} &amp;=&amp; \\left( 1 - \\alpha_{gd,\\Lambda}\\right)I_{b,\\Lambda}^\\downarrow + \\left( 1 - \\alpha_{gb,\\Lambda}\\right)e^{-K(L+S)} \\label{eqn_g_b_absorb} \\\\[0.5em] \\overrightarrow{I}_{gd,\\Lambda} &amp;=&amp; \\left( 1 - \\alpha_{gd,\\Lambda}\\right)I_{d,\\Lambda}^\\downarrow \\label{eqn_g_d_absorb} \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#ground-albedos","title":"Ground Albedos","text":"<p>The direct beam ground albedo, \\(\\alpha_{gb,\\Lambda}\\), and diffuse ground albedo, \\(\\alpha_{gd,\\Lambda}\\), are weighted combination of \"soil\" and snow albedo as</p> \\[ \\begin{eqnarray} \\alpha_{gb,\\Lambda} &amp;=&amp; \\alpha_{b,\\Lambda}^{soi} (1 - f_{sno})  + \\alpha_{b,\\Lambda}^{sno} f_{sno} \\label{eqn_g_dir} \\\\[0.5em] \\alpha_{gd,\\Lambda} &amp;=&amp; \\alpha_{d,\\Lambda}^{soi} (1 - f_{sno})  + \\alpha_{d,\\Lambda}^{sno} f_{sno} \\label{eqn_g_dif} \\end{eqnarray} \\] <p>where \\(f_{sno}\\) is the snow fraction.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#soil-albedo","title":"Soil Albedo","text":"<p>The soil albedo for the various ELM landunits remains the same as in CLM4.5<sup>5</sup> are:</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#glacier-albedo","title":"Glacier Albedo","text":"\\[ \\begin{eqnarray} \\alpha_{b,vis}^{soi} = \\alpha_{d,vis}^{soi} = 0.6 \\\\[0.5em] \\alpha_{b,nir}^{soi} = \\alpha_{d,nir}^{soi} = 0.4 \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#lake-and-wetland-albedo","title":"Lake and Wetland Albedo","text":"<p>Under frozen conditions, the albedos are a function of the solar zenith angle \\(\\mu\\).</p> \\[ \\begin{equation} \\alpha_{b,\\Lambda}^{soi} = \\alpha_{d,\\Lambda}^{soi} = 0.05(\\mu + 0.15)^{-1} \\end{equation} \\] <p>Otherwise, the albedos are constant.</p> \\[ \\begin{eqnarray} \\alpha_{b,vis}^{soi} = \\alpha_{d,vis}^{soi} = 0.6 \\\\[0.5em] \\alpha_{b,nir}^{soi} = \\alpha_{d,nir}^{soi} = 0.4 \\end{eqnarray} \\]"},{"location":"ELM/tech-guide/shortwave_radiation/#bare-soil-albedo","title":"Bare Soil Albedo","text":"<p>Soil albedo varies with color class</p> \\[ \\begin{equation} \\alpha_{b,\\Lambda}^{soi} = \\alpha_{d,\\Lambda}^{soi} = (\\alpha_{sat,\\Lambda} + \\Delta) \\leq \\alpha_{dry,\\Lambda} \\end{equation} \\] <p>where \\(\\Delta\\) depends on the volumetric water content of the first soil layer, \\(\\theta_1\\), as \\(\\Delta = 0.11 - 0.4\\theta_1\\), and \\(\\alpha_{sat,\\Lambda}\\) and \\(\\alpha_{dry,\\Lambda}\\) are albedos for saturated and dry soil color classes.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#snow-albedo","title":"Snow Albedo","text":"<p>The hybrid SNICAR-AD model of Dang et al. (2019)<sup>3</sup> is used to compute snow albedo and the contribution of solar absorption to the heating of each snow layer.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#parameterization-for-sub-grid-effect-of-topographic-on-solar-radiation","title":"Parameterization for Sub-Grid Effect of Topographic on Solar radiation","text":"<p>The surface abedos given by equation \\eqref{eqn_g_dir} - \\eqn{eqn_g_dif} neglect topography by assuming a plane-parallel Earth. Hao et al. (2021)<sup>4</sup> developed a parameterization for sub-grid topographic effects on solar radiation that essentially modify the surface albedo by equation \\eqref{eqn_g_dir} - \\eqn{eqn_g_dif}. The section on TOP Parameterization presents a detailed description of the parameterization.</p>"},{"location":"ELM/tech-guide/shortwave_radiation/#solar-radiation-fluxes","title":"Solar Radiation Fluxes","text":"<p>Using the equations describing beam and diffuse radiation absorbed by the canopy (equations \\eqref{eqn_can_b_absorb} and \\eqref{eqn_can_b_absorb}) and ground (equations \\eqref{eqn_g_b_absorb} - \\eqref{eqn_g_d_absorb}) per unit incoming flux, the total absorbed radiation by canopy and ground is given by</p> \\[ \\begin{eqnarray} \\overrightarrow{S}_{c} &amp;=&amp; \\sum_\\Lambda \\left( S_{b,\\Lambda}^{atm, \\downarrow} \\overrightarrow{I}_{cb,\\Lambda} + S_{d,\\Lambda}^{atm\\downarrow} \\overrightarrow{I}_{cd,\\Lambda} \\right) \\\\[0.5em] \\overrightarrow{S}_{g} &amp;=&amp; S_{b,\\Lambda}^{atm, \\downarrow} e^{-K(L+S)} \\left( 1 - \\alpha_{gd,\\Lambda} \\right) +  \\sum_\\Lambda \\left( S_{b,\\Lambda}^{atm, \\downarrow} {I}_{cb,\\Lambda}^\\downarrow + S_{d,\\Lambda}^{atm\\downarrow} {I}_{cd,\\Lambda}^{\\downarrow} \\right) \\left(1 - \\alpha_{g,\\Lambda}\\right) \\end{eqnarray} \\] <p>where \\(S_{b,\\Lambda}^{atm, \\downarrow}\\) and \\(S_{d,\\Lambda}^{atm, \\downarrow}\\) are the downward beam direct and downward diffuse atmospheric flux, respectively.</p> <p>Additionally, the conservation of solar radiation in ELM is ensured by the following equation:</p> \\[ \\begin{equation} \\sum_\\Lambda \\left( S_{b,\\Lambda}^{sky,\\downarrow} + S_{b,\\Lambda}^{sky,\\downarrow}\\right) = \\overrightarrow{S}_{c} + \\overrightarrow{S}_{g} + \\sum_\\Lambda \\left( S_{b,\\Lambda}^{sky,\\downarrow} I_{b,\\Lambda}^\\uparrow + S_{d,\\Lambda}^{sky,\\downarrow} I_{d,\\Lambda}^\\uparrow \\right) \\end{equation} \\] <p>where the third term on the right hand side represents the reflected solar radiation to the atmosphere.</p> <p>The photosynthesis and transpiration processes of sunlit and shaded leaves depend on the solar radiation they absorbed in the visible waveband. The absorbed photosynthetically active (visible waveband) radiation per unit leaf area is given as:</p> \\[ \\begin{eqnarray} \\phi^{sun} &amp;=&amp; \\dfrac{S_{b,vis}^{atm, \\downarrow} \\overrightarrow{I}_{b,vis}^{sun} + S_{d,vis}^{atm, \\downarrow} \\overrightarrow{I}_{d,vis}^{sun} }{L_{sun}} \\\\[0.5em] \\phi^{sha} &amp;=&amp; \\dfrac{S_{b,vis}^{atm, \\downarrow} \\overrightarrow{I}_{b,vis}^{sha} + S_{d,vis}^{atm, \\downarrow} \\overrightarrow{I}_{d,vis}^{sha} }{L_{sha}} \\end{eqnarray} \\] <p>where \\(L^{sun}\\) and \\(L^{sha}\\) are the sunlit and shaded fraction of the canopy, respectively, and are computed using equation \\eqref{eqn_sun} as</p> \\[ \\begin{eqnarray} L^{sun} &amp;=&amp; \\dfrac{1 - e^{K(L+S)}}{K_b} \\\\[0.5em] L^{sha} &amp;=&amp; (L+S) - L^{sun} \\end{eqnarray} \\] <ol> <li> <p>Robert E Dickinson. Land surface processes and climate\u2014surface albedos and energy balance. In Advances in geophysics, volume 25, pages 305\u2013353. Elsevier, 1983.\u00a0\u21a9</p> </li> <li> <p>Piers J Sellers. Canopy reflectance, photosynthesis and transpiration. International journal of remote sensing, 6(8):1335\u20131372, 1985.\u00a0\u21a9</p> </li> <li> <p>Cheng Dang, Charles S Zender, and Mark G Flanner. Intercomparison and improvement of two-stream shortwave radiative transfer schemes in earth system models for a unified treatment of cryospheric surfaces. The Cryosphere, 13(9):2325\u20132343, 2019.\u00a0\u21a9\u21a9</p> </li> <li> <p>Dalei Hao, Gautam Bisht, Yu Gu, Wei-Liang Lee, Kuo-Nan Liou, and L Ruby Leung. A parameterization of sub-grid topographical effects on solar radiation in the e3sm land model (version 1.0): implementation and evaluation over the tibetan plateau. Geoscientific Model Development, 14(10):6273\u20136289, 2021. doi:https://doi.org/10.5194/gmd-14-6273-2021.\u00a0\u21a9\u21a9</p> </li> <li> <p>K. Oleson, D. Lawrence, G. Bonan, B. Drewniak, M. Huang, C. Koven, Z. M. Subin, and S. C. Swenson. Technical description of version 4.5 of the community land model (clm), ncar technical note. Technical Report NCAR/TN-503+ STR, National Center for Atmospheric Research (NCAR), Boulder, CO, USA, 2013. doi:https://doi.org/10.5065/D6RR1W7M.\u00a0\u21a9\u21a9</p> </li> <li> <p>Juhan Ross. Radiative transfer in plant communities. Vegetation and the Atmosphere 1, 1:13\u201355, 1975.\u00a0\u21a9</p> </li> <li> <p>Jan Goudriaan. Crop micrometeorology: a simulation study. Wageningen University and Research, 1977.\u00a0\u21a9</p> </li> <li> <p>Yongjiu Dai, Robert E Dickinson, and Ying-Ping Wang. A two-big-leaf model for canopy temperature, photosynthesis, and stomatal conductance. Journal of climate, 17(12):2281\u20132299, 2004.\u00a0\u21a9</p> </li> </ol>"},{"location":"ELM/tech-guide/top_solar_parameterization/","title":"TOP solar radiation parameterization","text":"<p>The TOP solar radiation parameterization in ELM accounts for the effects of sub-grid topography on solar radiation flux, including the shadow effects and multi-scattering between adjacent terrain<sup>1</sup>.</p>"},{"location":"ELM/tech-guide/top_solar_parameterization/#overview","title":"Overview","text":"<p>The incoming solar radiation for a flat surface is composed of direct radiation (\\(F_{dir}^{PP}\\)) from sun, diffuse radiation (\\(F_{dif}^{PP}\\)) from sky, and coupled radiation (\\(F_{couple}^{PP}\\)) that represents surface reflected radiation that is further reflected or scattered by atmospheric particles. ELM v1.0 and ELM v2.0 assume flat surfaces and account for \\(F_{dir}^{PP}\\) and \\(F_{dif}^{PP}\\), while neglecting \\(F_{couple}^{PP}\\). The solar radiation scheme of ELM v1.0 and ELM v2.0 uses the two-stream approximations<sup>2</sup>. In contrast, the incoming solar radiation parametrization of Lee et al. 2011<sup>3</sup> over mountainous regions includes five components (illustrated in Fig. 1):</p> <ol> <li>direct flux (\\(F_{dir}^{TOP}\\)) represents photons that are transmitted from the sun to the ground surface without encountering any reflection or scattering,</li> <li>the direct-reflected flux (\\(F_{rdir}^{TOP}\\)) represents photons that are not scattered photons reflected by surrounding terrain,</li> <li>diffuse flux (\\(F_{dif}^{TOP}\\)) represents photons that are scattered by atmospheric particles but are not reflected by the ground surface,</li> <li>diffuse-reflected flux (\\(F_{rdif}^{TOP}\\)) represents scattered photons reflected by surrounding terrain, and</li> <li>coupled flux (\\(F_{couple}^{TOP}\\)) represents remaining photons that are reflected multiple times or scattered by ground surface and atmospheric particles.</li> </ol> <p></p> <p>Fig 1.: A schematic diagram of the five components of incoming solar radiation over mountains adapted from Lee et al. 2011<sup>3</sup>. The components of incoming solar radiation included are (1) direct flux, (2) diffuse flux, (3) direct-reflected flux, (4) diffuse-reflected flux, and (5) coupled flux. Local solar zenith angle (\u03b8), sky view factor (\\(V_d\\)), and terrain configuration factor (\\(C_T\\)) are also marked.</p> <p>\\(F_{dir}^{TOP}\\) is different from \\(F_{dir}^{PP}\\) because of the adjustment of solar illumination geometry and shadowing effects. \\(F_{dif}^{PP}\\) is different from \\(F_{dif}^{TOP}\\) because the sky hemisphere is occluded by adjacent terrain. Lee et al. 2011<sup>3</sup> used the radiation fluxes over flat surfaces (i.e., \\(F_{dir}^{PP}\\) and \\(F_{dif}^{PP}\\)) to calculate the radiation fluxes over mountainous terrain based on sub-grid topographic factors. The relative deviation (\\(f_{dir}\\)) of direct flux between flat surfaces and mountains under the same atmospheric condition is defined as follows</p> \\[ \\label{eqn_fdir} f_{dir} = \\frac{F_{dir}^{TOP} - F_{dir}^{PP}}{F_{dir}^{PP}} \\] <p>The relative deviation (\\(f_{rdir}\\)) of direct-reflected flux over mountains to direct flux over flat surfaces is defined as follows:</p> \\[ \\label{eqn_frdir} f_{rdir} = \\frac{F_{rdir}^{TOP}}{F_{dir}^{PP}} \\] <p>Similarly, the relative deviations (\\(f_{dif}\\) and \\(f_{rdif}\\)) of diffuse and diffuse-reflected fluxes are expressed as follows:</p> \\[ \\label{eqn_fdif} f_{dif} = \\frac{F_{dif}^{TOP} - F_{dif}^{PP}}{F_{dir}^{PP}} \\] \\[ \\label{eqn_frdif} f_{rdif} = \\frac{F_{rdif}^{TOP}}{F_{dif}^{PP}} \\]"},{"location":"ELM/tech-guide/top_solar_parameterization/#multiple-linear-regression-model-of-lee-et-al-2011","title":"Multiple Linear Regression Model of Lee et al. (2011)","text":"<p>In theory, these four relative deviations (i.e., \\(f_{dir}\\), \\(f_{rdir}\\), \\(f_{dif}\\) and \\(f_{rdif}\\)) depend on solar illumination geometry and sub-grid topographic distribution. Based on a series of 3D Monte Carlo photon tracing simulations, Lee et al. 2011(@lee2011parameterization) built a multiple linear regression parameterization to predict these four relative deviations well. The parameterization of Lee et al. 2011(@lee2011parameterization) uses four variables that include the standard deviation of elevation (\\(\\sigma_h\\)) within a grid cell, grid-averaged values of cosine of the local solar incident angle (\\(\\mu\\)), sky view factor (\\(\\overline{V_d}\\)), and terrain configuration factor (\\(\\overline{C_T}\\)). Lee et al. 2011<sup>3</sup> parameterization is given as follows:</p> \\[\\begin{bmatrix} f_{dir} \\\\ f_{dif} \\\\ f_{rdir} \\\\ f_{rdif} \\end{bmatrix} = \\mathbf{A} \\cdot \\begin{bmatrix} \\overline{\\mu} \\\\ \\sigma_h \\\\ \\overline{V_d} \\\\ \\overline{C_T} \\\\ 1 \\end{bmatrix} \\label{eqn_linear_reg} \\] <p>where \\(\\mathbf{A}\\) represents the fitted parameter matrix, which was obtained based on the data generated by the 3D Monte Carlo simulations. The sky view factor (\\(V_d\\)) represents the portion of visible sky limited by surrounding terrain<sup>4</sup>, while the terrain configuration factor (\\(C_T\\)), the counterpart of the sky viewfactor, represents the portion of surrounding terrain which is visible to the ground target<sup>5</sup>. For an unobstructed infinite slope with the slope of \\(\\alpha\\) and aspect of \\(\\beta\\) and a given solar illumination geometry (i.e., solar zenith angle, \\(SZA\\), and solar azimuth angle, \\(SAA\\)), the cosine of the local solar incident angle (\\(\\mu\\)) can be calculated by</p> \\[ \\mu = \\cos(SZA) \\cos(\\alpha) + \\sin(SZA) \\sin(\\alpha) \\cos(SAA-\\beta) \\] <p>The \\(SZA\\) and \\(SAA\\) are assumed to be constant within a grid cell, but \\(\\alpha\\) and \\(\\beta\\) vary within a grid cell. The grid cell average solar incident angle, \\(\\overline{\\mu}\\), can be expressed as follows:</p> \\[ \\begin{eqnarray} \\overline{\\mu} &amp;=&amp; \\overline{\\cos(SZA) \\cos(\\alpha)} + \\overline{\\sin(SZA) \\sin(\\alpha) \\cos(SAA-\\beta)} \\nonumber \\\\ &amp;=&amp; \\cos(SZA)  \\overline{\\cos(\\alpha)} + \\sin(SZA) \\cos(SAA) + \\overline{\\sin(\\alpha) \\cos(\\beta)} + \\nonumber \\\\ &amp; &amp; \\sin(SZA) \\sin(SAA) + \\overline{\\sin(\\alpha) \\sin(\\beta)} \\end{eqnarray} \\] <p>where overlines represent grid-averaged values. To further improve the regression parameterization, \\(\\mu\\), \\(V_d\\), and \\(C_T\\) are normalized by \\(\\cos(\\alpha)\\). The land surface albedo is adjusted, instead of modifying incoming solar radiation, to maintain the surface energy conservation and the consistency between the surface and the first levels of atmosphere above the surface (Lee et al., 2015). Specifically, to keep the absorbed solar radiation of the ground surface unchanged, Lee et al. (2015) built the relationship between direct (\\(\\alpha_{dir}^{TOP}\\)) and diffuse (\\(\\alpha_{dif}^{TOP}\\)) albedo over mountains and those (\\(\\alpha_{dir}^{PP}\\) and \\(\\alpha_{dif}^{PP}\\)) over flat surfaces as follows:</p> \\[ \\begin{eqnarray} F_{dir}^{PP} (1 - \\alpha_{dir}^{TOP}) &amp;=&amp; (F_{dir}^{TOP} + F_{rdir}^{TOP})(1 - \\alpha_{dir}^{PP}) \\label{eqn_fdir_pp} \\\\ F_{dif}^{PP} (1 - \\alpha_{dif}^{TOP}) &amp;=&amp; (F_{dif}^{TOP} + F_{rdif}^{TOP})(1 - \\alpha_{dif}^{PP}) \\label{eqn_fdif_pp} \\end{eqnarray} \\] <p>Substituting Eqns \\eqref{eqn_fdir}-\\eqref{eqn_frdif} into Eqs \\eqref{eqn_fdir_pp}-\\eqref{eqn_fdif_pp} leads to</p> \\[ \\begin{eqnarray} \\alpha_{dir}^{TOP} &amp;=&amp; 1 - (1 + f_{dir} + f_{rdir}) (1 - \\alpha_{dir}^{PP}) \\label{eqn_alb_dir_top} \\\\ \\alpha_{dif}^{TOP} &amp;=&amp; 1 - (1 + f_{dif} + f_{rdif}) (1 - \\alpha_{dif}^{PP}) \\label{eqn_alb_dif_top} \\end{eqnarray} \\] <p>The parameterizations represented by Eqs. \\eqref{eqn_linear_reg}, \\eqref{eqn_alb_dir_top}, and \\eqref{eqn_alb_dif_top} are implemented in ELM to account for the sub-grid topographic effects on solar radiation fluxes.</p> <ol> <li> <p>Dalei Hao, Gautam Bisht, Yu Gu, Wei-Liang Lee, Kuo-Nan Liou, and L Ruby Leung. A parameterization of sub-grid topographical effects on solar radiation in the e3sm land model (version 1.0): implementation and evaluation over the tibetan plateau. Geoscientific Model Development, 14(10):6273\u20136289, 2021. doi:https://doi.org/10.5194/gmd-14-6273-2021.\u00a0\u21a9</p> </li> <li> <p>K. Oleson, D. Lawrence, G. Bonan, B. Drewniak, M. Huang, C. Koven, Z. M. Subin, and S. C. Swenson. Technical description of version 4.5 of the community land model (clm), ncar technical note. Technical Report NCAR/TN-503+ STR, National Center for Atmospheric Research (NCAR), Boulder, CO, USA, 2013. doi:https://doi.org/10.5065/D6RR1W7M.\u00a0\u21a9</p> </li> <li> <p>Wei-Liang Lee, KN Liou, and Alex Hall. Parameterization of solar fluxes over mountain surfaces for application to climate models. Journal of Geophysical Research: Atmospheres, 2011. doi:https://doi.org/10.1029/2010JD014722.\u00a0\u21a9\u21a9\u21a9\u21a9</p> </li> <li> <p>Klemen Zak\u0161ek, Kristof O\u0161tir, and \u017diga Kokalj. Sky-view factor as a relief visualization technique. Remote sensing, 3(2):398\u2013415, 2011. doi:https://doi.org/10.3390/rs3020398.\u00a0\u21a9</p> </li> <li> <p>Jeff Dozier and James Frew. Rapid calculation of terrain parameters for radiation modeling from digital elevation data. IEEE Transactions on geoscience and remote sensing, 28(5):963\u2013969, 1990. doi:https://doi.org/10.1109/36.58986.\u00a0\u21a9</p> </li> </ol>"},{"location":"ELM/user-guide/","title":"ELM User's Guide","text":"<p>This User's Guide describes how to set up and run ELM.</p>"},{"location":"ELM/user-guide/#steps-to-build-and-run-elm","title":"Steps to build and run ELM","text":"<p>A step-by-step instruction on how to run fully coupled E3SM can be found here. Here we describe running ELM driven by atmospheric forcings provided via the data atmosphere (DATM) model for configurations that are used in the E3SM water cycle v3 campaign.</p> <p>The water cycle campaigns of E3SM v1 and v2 used ELM's satellite phenology mode (SP-mode) in which a prescribed leaf area index is used in ELM. However, the E3SM v3 water cycle campaign uses an interactive phenology by including an active biogeochemistry (BGC) cycle in ELM. Additionally, a parameterization of sub-grid topographical effects on solar radiation is included within ELM.</p>"},{"location":"ELM/user-guide/#scientifically-supported-compsets","title":"Scientifically supported compsets","text":"<p>The land-only compsets are referred to as \"I\"-compset and are supported for the following time periods: pre-industrial (1850) and historical transient (20TR). Additionally, multiple atmospheric forcing datasets can be used to drive the ELM simulations. The supported compsets are:</p> <ol> <li><code>I1850GSWCNPRDCTCBCTOP</code>: Pre-industrial ELM simulation using atmospheric forcings from GSWP3 reanalysis dataset</li> <li><code>I20TRGSWCNPRDCTCBCTOP</code>: Historical ELM simulation using GSWP atmospheric forcings with time varying greenhouse gas forcing and land use, land cover dataset (year 1850-2014).</li> </ol> <p>The E3SM coupler output forcings are most commonly used as an offline land model spinup step, in preparation for a fully-coupled E3SM experiment.</p>"},{"location":"ELM/user-guide/#supported-grid","title":"Supported grid","text":"<p>The <code>r05_r05</code> is the supported grid resolution for performing offline ELM simulation.</p>"},{"location":"ELM/user-guide/#customizing-runs","title":"Customizing runs","text":"<p>Few useful changes to <code>user_nl_elm</code></p>"},{"location":"ELM/user-guide/#changing-monthly-output-file","title":"Changing monthly output file","text":"<p>ELM by default outputs monthly history file in <code>*elm.h0.**.nc</code> files that include many variables (&gt;200). At times, many of the default output variables may not be of interest, thus one could remove all default variables (via <code>hist_empty_htapes</code>) and only include select variables (via <code>hist_fincl1</code>) to the monthly history files by</p> <pre><code>   &amp;elm_inparm\n     hist_empty_htapes = .true.\n     hist_fincl1 = 'TG', 'TV', 'FSA'\n   /\n</code></pre>"},{"location":"ELM/user-guide/#saving-additional-output-files","title":"Saving additional output files","text":"<p>ELM can output additional history files (such as <code>*elm.h1.*.nc</code>, <code>*elm.h2.*.nc</code>) that have different temporal averaging (e.g. daily, hourly, every model timestep) via <code>hist_nhtfrq</code> where</p> <ul> <li><code>-24</code> corresponds to daily average</li> <li><code>-1</code> corresponds to hourly average</li> <li><code>0</code> corresponds to monthly average</li> <li><code>1</code> corresponds to each model time step</li> </ul> <p>The number of time slices in these additional files can be controlled vai <code>hist_mfilt</code>.</p> <pre><code>   &amp;elm_inparm\n     hist_fincl2 = 'TG'\n     hist_fincl3 = 'TV'\n     hist_fincl4 = 'TG', 'TV', 'FSA'\n     hist_nhtfrq = 0, -24, -1, 1\n     hist_mfilt  = 12, 30, 24, 48\n   /\n</code></pre> <p>Using the above-mentioned settings:</p> <ul> <li>Each <code>*.elm.h1.*.nc</code> will include 30 daily average values of <code>TG</code></li> <li>Each <code>*.elm.h2.*.nc</code> will include 24 hourly average values of <code>TV</code></li> <li>Each <code>*.elm.h3.*.nc</code> will include 48 values of <code>TG</code>, <code>TV</code>, and <code>FSA</code> at   each model time step, which is typically is 30 min.</li> </ul>"},{"location":"ELM/user-guide/#running-with-fates","title":"Running with FATES","text":"<p>FATES can be run in various modes with ELM through the use of namelist settings. The FATES User's Guide section on namelist options provides guidance on enabling these different FATES run modes.</p>"},{"location":"ELM/user-guide/#create-land-surface-dataset","title":"Create land surface dataset","text":"<p>A new surface dataset for ELM is generated using <code>mksurfdata_map</code> and the notes about it are available here</p>"},{"location":"ELM/user-guide/#generate-land-initial-condition","title":"Generate land initial condition","text":"<p>Initial ELM condition can be generated using <code>interpinic</code> and the notes about it are available here.</p>"},{"location":"ELM/user-guide/fates/","title":"FATES","text":"<p>FATES (Functionally Assembled Terrestrial Ecosystem Simulator) is a numerical terrestrial ecosystem model hat can be utilized as a component with various host land models such as ELM.  It is incorporated as an external module, the development of which is primarily supported by the Department of Energy\u2019s Office of Science, through the Next Generation Ecosystem Experiment - Tropics (NGEE-T) project.</p> <p>The FATES code is hosted online through a github repository at https://github.com/NGEET/fates.</p>"},{"location":"ELM/user-guide/fates/#technical-document","title":"Technical Document","text":"<p>The full FATES documentation detailing the scientific underpinnings of the model can be found in the FATES Technical Document hosted on ReadTheDocs.</p>"},{"location":"ELM/user-guide/fates/#users-and-developers-guide","title":"User's and Developer's Guide","text":"<p>The FATES team also provides a User's guide and a Developer's guide also hosted on ReadTheDocs.  Both guides and the technical documentation can be reached from the top level User's Guide</p>"},{"location":"ELM/user-guide/interpinic/","title":"Creating an ELM initial condition file","text":"<p>An ELM initial condition (IC) file can be created by remapping an existing IC file from one resolution to another using the <code>interpinic</code>, located at <code>components/elm/tools/interpinic</code>. An ELM IC file is in the same format as an ELM restart file. The composet of the remapped IC file will be the same as that of the input IC file. So, for a new ELM SP-mode IC file, use an ELM input file corresponding to the SP-mode.</p> <p>The steps involved in creating a new IC files are as follows:</p> <ol> <li>Identifying an input ELM IC or restart file that will be remapped.</li> <li>Obtaining an ELM restart file at the new resolution.</li> <li>Compiling <code>interpinic</code> on the machine of interest.</li> <li>Running <code>interpinic</code> to perform the interpolation.</li> </ol> <p>The notes below provide an example of creating 1850 ELM IC file for the NARRM grid using E3SM v3 LR piControl from year = 0101. These notes are provided for Chrysalis.</p>"},{"location":"ELM/user-guide/interpinic/#1-identification-of-the-input-elm-ic-file","title":"1. Identification of the input ELM IC file","text":"<p>The identified input land condition file for this case is the following:</p> <pre><code>/lcrc/group/e3sm2/ac.golaz/E3SMv3/v3.LR.piControl/archive/rest/0101-01-01-00000/v3.LR.piControl.elm.r.0101-01-01-00000.nc\n</code></pre>"},{"location":"ELM/user-guide/interpinic/#2-obtaining-an-elm-restart-file","title":"2. Obtaining an ELM restart file","text":"<p>Using an existing NARRM land IC and making a copy of it</p> <pre><code>cd components/elm/tools/interpinic\n\ncp /lcrc/group/e3sm/data/inputdata/lnd/clm2/initdata_map/elmi.v3-NARRM.northamericax4v1pg2_r025_IcoswISC30E3r5.1870-01-01-00000.c20240704.nc \\\nelmi.v3-NARRM.northamericax4v1pg2_r025_IcoswISC30E3r5.1850-01-01-00000.c`date \"+%Y%m%d\"`.nc\n</code></pre>"},{"location":"ELM/user-guide/interpinic/#3-compiling-interpinic","title":"3. Compiling <code>interpinic</code>","text":"<pre><code># Load relevant modules\ncd &lt;e3sm-dir&gt;\neval $(./cime/CIME/Tools/get_case_env)\n\n# change directory\ncd components/elm/tools/interpinic/src\n\nexport USER_LDFLAGS=\"-L$NETCDF_C_DIR/lib -lnetcdf -L$NETCDF_F_DIR/lib -lnetcdff  -L$HDF5_DIR/lib -lhdf5\"\n\nUSER_FC=ifort LIB_NETCDF=\"`nc-config --flibs`\" INC_NETCDF=\"`nf-config --includedir`\" make VERBOSE=1\n\ncd ../\n</code></pre>"},{"location":"ELM/user-guide/interpinic/#4-run-interpinic","title":"4. Run <code>interpinic</code>","text":"<p>The <code>interpinic</code> can then be run via the following batch job (e.g., <code>remap.r025_RRSwISC6to18E3r4.1850.batch</code>) to generate the initial condition.</p> <pre><code>&gt;cat remap.r025_RRSwISC6to18E3r4.1850.batch\n\n#!/bin/sh\n#SBATCH  --job-name=remap\n#SBATCH  --nodes=1\n#SBATCH  --exclusive\n#SBATCH  --time 24:00:00\n#SBATCH  -p slurm\n#SBATCH  --account esmd\n\n# Load relevant modules.\ncd &lt;e3sm-dir&gt;\neval $(./cime/CIME/Tools/get_case_env)\n\n# Change dir to `interpinic`\ncd components/elm/tools/interpinic/\n\nsrun -n 1 ./interpinic \\\n-i /lcrc/group/e3sm2/ac.golaz/E3SMv3/v3.LR.piControl/archive/rest/0101-01-01-00000/v3.LR.piControl.elm.r.0101-01-01-00000.nc \\\n-o elmi.v3-NARRM.northamericax4v1pg2_r025_IcoswISC30E3r5.1850-01-01-00000.c20240903.nc\n</code></pre>"},{"location":"ELM/user-guide/surface_dataset/","title":"Creating an ELM surface dataset","text":"<p>The notes describe the steps in creating an ELM surface dataset at 0.5x0.5 resolution for 1950 on Perlmutter.</p>"},{"location":"ELM/user-guide/surface_dataset/#1-load-the-appropriate-modules","title":"1. Load the appropriate modules","text":"<pre><code>cd &lt;e3ms-dir&gt;\neval $(./cime/CIME/Tools/get_case_env)\n</code></pre>"},{"location":"ELM/user-guide/surface_dataset/#2-compile-mksurfdata_map","title":"2. Compile <code>mksurfdata_map</code>","text":"<pre><code>cd components/elm/tools/mksurfdata_map/src/\n\nmake clean\nexport USER_LDFLAGS=\"-L$NETCDF_DIR/lib -lnetcdf -lnetcdff -lnetcdf_intel\"\nexport USER_LDFLAGS=$USER_LDFLAGS\" -L$HDF5_DIR/lib -lhdf5 -lhdf5_fortran -lhdf5_hl_intel -lhdf5hl_fortran_intel\"\n\nUSER_FC=ifort LIB_NETCDF=\"`nc-config --flibs`\" INC_NETCDF=\"`nf-config --includedir`\" make VERBOSE=1\n</code></pre>"},{"location":"ELM/user-guide/surface_dataset/#build-the-namelist","title":"Build the namelist","text":"<p>This step assumes that the resolution for which the new surface dataset is being created is a supported resolution. If the surface dataset is being created for an unsupported resolution, 16 mapping files will have to be created to map the raw datasets onto this unsupported resolution. The <code>namelist</code> file with default number of glaciers (equal to zero) can be generated as:</p> <pre><code>cd ../\n\nRES=0.5x0.5\nYR=1950\nDIN_LOC_ROOT=/global/cfs/cdirs/e3sm/inputdata\n\n./mksurfdata.pl -res $RES -years $YR -d -dinlc $DIN_LOC_ROOT\n</code></pre> <p>An example of generating the namelist for 0.25 deg (<code>r025</code>) resolution for 1980 with 10 glacier layers is as follows:</p> <pre><code>RES=r025\nYR=1980\nDIN_LOC_ROOT=/global/cfs/cdirs/e3sm/inputdata\n\n./mksurfdata.pl -res $RES -years $YR -d -dinlc $DIN_LOC_ROOT -glc_nec 10\n</code></pre>"},{"location":"ELM/user-guide/surface_dataset/#run-mksurfdata_map-via-an-interactive-job","title":"Run <code>mksurfdata_map</code> via an interactive job","text":"<pre><code>salloc --nodes 1 --qos interactive --time 01:00:00 --constraint cpu --account e3sm\n\nsrun -n 1 ./mksurfdata_map &lt; namelist\n</code></pre>"},{"location":"MOSART/","title":"Model for Scale Adaptive River Transport (MOSART)","text":"<p>MOSART is the river model of E3SM. It routes the runoff genrated by ELM and provides freshwater input to the ocean model.</p> <ul> <li>The MOSART User Guide explains how to control MOSART when its running within E3SM</li> <li>The MOSART Developer Guide explains MOSART data structures and how to develop new code.</li> <li>The MOSART Technical Guide explains the science behind MOSART's code</li> </ul>"},{"location":"MOSART/dev-guide/","title":"MOSART Developer's Guide","text":"<p>This guide provides MOSART data structures and how to develop new code for MOSART.</p> <p>Coming soon...</p>"},{"location":"MOSART/tech-guide/","title":"MOSART Technical Guide","text":"<p>This guide provides scientific and technical details about MOSART.</p>"},{"location":"MOSART/tech-guide/#physics","title":"Physics","text":"<p>MOSART is a one-dimension river transport model that is designed for river routing at local, regional, and global scales (Li et al., 2013). Its primary function is to supply freshwater inputs to ocean models within coupled Earth System Models.</p> <p>MOSART divides each spatial unit, such as a latitude/longitude grid or a sub-basin, into three hydrologic categories: hillslopes, tributaries, and a main channel (see figure below). The hillslopes receive runoff and send into tributaries, which then converge into a single main channel. This main channel connects adjacent upstream and downstream units through the river network. MOSART simplifies the multiple tributaries within a spatial unit into a single hypothetical sub-network channel, which has a transport capacity equivalent to all combined tributaries.</p> <p></p> <ul> <li> <p>Hillslope Routing: Within each spatial unit, surface runoff is directed as overland flow to the sub-network channel, while subsurface runoff enters the sub-network channel directly.</p> </li> <li> <p>Sub-network Channel Routing: This channel aggregates water from the hillslopes, routes it through the channel system, and discharges it into the main channel.</p> </li> <li> <p>Main Channel Routing: The main channel collects water from the sub-network channel and any inflow from upstream spatial units, eventually discharging the accumulated water downstream to the next spatial unit or directly to the ocean.</p> </li> </ul>"},{"location":"MOSART/tech-guide/#parameters","title":"Parameters","text":""},{"location":"MOSART/tech-guide/#main-parameters-required-in-the-mosart-parameter-file","title":"Main parameters required in the MOSART parameter file","text":"Variable Name Description [unit] fdir Flow direction [unitless] lat Latitude at cell center [degree] lon Longitude at cell center [degree] frac fraction of the unit draining to the outlet [0-1] rslp main channel slope [unitless] rlen main channel length [m] tslp mean tributary channel slope averaged through the unit [unitless] area local drainage area [m^2] areaTotal total upstream drainage area, local unit included; multi flow direction [m^2] areaTotal2 total upstream drainage area, local unit included; single flow direction [m^2] rdep bankfull depth of main channel [m] rwid bankfull width of main channel [m] rwid0 floodplain width linked to main channel [m] gxr drainage density [m^-1] hslp topographic slope [unitless] twid bankfull width of local tributaries [m] nr Manning''s roughness coefficient for main channel flow [unitless] nt Manning''s roughness coefficient for tributary channel flow [unitless] nh Manning''s roughness coefficient for overland flow [unitless]"},{"location":"MOSART/tech-guide/#parameters-required-by-additional-mosart-features","title":"Parameters required by additional MOSART features","text":"<p>Coming soon.</p>"},{"location":"MOSART/user-guide/","title":"MOSART User's Guide","text":"<p>This guide describes how to set up and run MOSART.</p>"},{"location":"MOSART/user-guide/#steps-to-build-and-run-mosart","title":"Steps to build and run MOSART","text":"<p>A step-by-step instruction on how to run fully coupled E3SM can be found here. Here we describe running MOSART driven by runoff forcings provided via the data land mode(DLND). Although the default runoff forcing is predefined by the DLND compsets, the users is able to use other runoff forcing to drive MOSART.</p> <p>MOSART in the water cycle campaigns of E3SM v1, v2, and v3 was.</p>"},{"location":"MOSART/user-guide/#scientifically-supported-compsets","title":"Scientifically supported compsets","text":"<p>The mosart-only compsets are supported for multiple runoff forcing datasets that covers different domains and time periods:</p> <ol> <li><code>RMOSQIAN</code>: A 57-year (1948-2004, no leap year) global Qian runoff forcings. The native resolutions are 192*288 at daily time scale. The path to the stream file is <code>$input_data_dir/lnd/dlnd7/hcru_hcru/QIAN.daily.1948-2004.nc</code></li> <li><code>RMOSGPCC</code>: A one-year (1979) global GPCC runoff forcing. The native resoultions are 192*288 at daily time scale. The path to the stream file is <code>$input_data_dir/lnd/dlnd7/hcru_hcru/GPCC.daily.nc</code></li> <li><code>RMOSNLDAS</code>: A one-year (1975) CLM runoff forcing for NLDAS domain (North America between 25N and 53N) and spatial resolution (1/8th degree). The time scale is 3-hourly. The path to the stream file is <code>$input_data_dir/lnd/dlnd7/NLDAS/mosart_nldas_hist_1975.clm2.h1.1975-01-01-00000.nc</code>.</li> </ol>"},{"location":"MOSART/user-guide/#supported-grid","title":"Supported grid","text":"<p>The <code>r05_r05</code>, <code>NLDAS_NLDAS</code>, and <code>MOS_USRDAT</code> are the supported grid resolutions for performing offline MOSART simulations.</p>"},{"location":"MOSART/user-guide/#user-defined-runoff-forcing","title":"User-defined runoff forcing","text":"<p>Once the case is created based on the above compsets. The users can create a <code>user_dlnd.streams.txt</code> file in the <code>case_scripts</code> directory following the format below:</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;file id=\"stream\" version=\"1.0\"&gt;\n&lt;dataSource&gt;\n  GENERIC\n&lt;/dataSource&gt;\n&lt;domainInfo&gt;\n  &lt;variableNames&gt;\n    time     time\n    lon      lon\n    lat      lat\n  &lt;/variableNames&gt;\n  &lt;filePath&gt;\n    /path/to/forcing/file\n  &lt;/filePath&gt;\n  &lt;fileNames&gt;\n    Runoff_forcing.nc\n  &lt;/fileNames&gt;\n&lt;/domainInfo&gt;\n&lt;fieldInfo&gt;\n   &lt;variableNames&gt;\n    QDRAI     rofsub\n    QOVER     rofsur\n   &lt;/variableNames&gt;\n   &lt;filePath&gt;\n    /path/to/forcing/file\n   &lt;/filePath&gt;\n   &lt;fileNames&gt;\n    Runoff_forcing.nc\n   &lt;/fileNames&gt;\n   &lt;offset&gt;\n    0\n   &lt;/offset&gt;\n&lt;/fieldInfo&gt;\n&lt;/file&gt;\n</code></pre>"},{"location":"MOSART/user-guide/#customizing-runs","title":"Customizing runs","text":"<p>For default river routing simulation in MOSART (i.e. natural flow routing), one parameter file defined by <code>frivinp_rtm</code> is required. The geographic domain and spatial resolution must match the domain defined in the simulation case. Additional parameter/input files will be needed for some extra features.</p>"},{"location":"MOSART/user-guide/#output-variables-and-frequency","title":"Output variables and frequency","text":"<p>MOSART by default outputs monthly history file in <code>*mosart.h0.**.nc</code> files that include all key variables. User could choose to output additional history files (such as <code>*mosart.h1.*.nc</code>, <code>*mosart.h2.*.nc</code>) that have different temporal averaging (e.g. daily, hourly, every model timestep) via <code>rtmhist_nhtfrq</code> where</p> <ul> <li><code>-24</code> corresponds to daily average</li> <li><code>-1</code> corresponds to hourly average</li> <li><code>0</code> corresponds to monthly average</li> <li><code>1</code> corresponds to each model time step</li> </ul> <p>The number of time slices in these additional files can be controlled vai <code>rtmhist_mfilt</code>.</p> <pre><code>   &amp;mosart_inparm\n     rtmhist_fincl2 = 'FLOODPLAIN_FRACTION'\n     rtmhist_fincl3 = 'RIVER_DISCHARGE_OVER_LAND_LIQ'\n     rtmhist_nhtfrq = 0, -24, -1\n     rtmhist_mfilt  = 12, 30, 24\n   /\n</code></pre> <p>Using the above-mentioned settings:</p> <ul> <li>Each <code>*.mosart.h1.*.nc</code> will include 30 daily average values of <code>FLOODPLAIN_FRACTION</code></li> <li>Each <code>*.mosart.h2.*.nc</code> will include 24 hourly average values of <code>RIVER_DISCHARGE_OVER_LAND_LIQ</code></li> </ul>"},{"location":"MOSART/user-guide/#additional-options","title":"Additional options","text":"<p>The table below lists avaiable options defined by users through <code>user_nl_mosart</code>.</p> Flag Name Description <code>routingmethod</code> <code>1</code> for kenematic wave routing (default); <code>2</code> for diffusion wave routing <code>wrmflag</code> <code>.true.</code> for active water management; <code>.false.</code> for no water management (default) <code>inundflag</code> <code>.true.</code> for active flood inundation; <code>.false.</code> for no flood inundation (default) <code>sediflag</code> <code>.true.</code> for active sediment transport; <code>.false.</code> for no sediment transport (default) <code>heatflag</code> <code>.true.</code> for active heat transport; <code>.false.</code> for no heat transport (default)"},{"location":"MOSART/user-guide/#additional-mosart-features","title":"Additional MOSART features","text":"<p>There are some options only made available for specific features. They can be defined through <code>user_nl_mosart</code>.</p>"},{"location":"MOSART/user-guide/#water-management","title":"Water management","text":"<ul> <li> <p>Parameter file: when water management is active, one additional parameter file <code>parafile</code> is required. This file defines the location and specifics for the dams/reservoirs simulated in this scheme.</p> </li> <li> <p><code>damconstructionflag</code>: <code>0</code> - dam always exist; <code>1</code> - dam construction year is considered.</p> </li> <li> <p><code>externaldemandflag</code>: <code>0</code> - no external water demand for the WM scheme; <code>1</code> - external water demand files are required.</p> </li> <li> <p>Note if <code>externaldemandflag</code> is set to <code>1</code>, paths to monthly water demand files are requried in the <code>usr_nl_mosart</code> file through <code>demandpath = '/path/to/demand/files/</code>.</p> </li> </ul>"},{"location":"MOSART/user-guide/#flood-inundation","title":"Flood inundation","text":"<ul> <li> <p><code>opt_eleprof</code>: <code>1</code> - use actural elevation profiles derived from DEM; <code>2</code> - use hypothetical elevation profile.</p> </li> <li> <p>Note if <code>opt_eleprof</code> is set to <code>1</code>, the elevation profile data must be included in the MOSART parameter file.</p> </li> </ul>"},{"location":"MOSART/user-guide/#sediment-transport","title":"Sediment transport","text":"<ul> <li>If sediment feature is activated, D50 data must be included in the MOSART parameter file. In addition, <code>rof_sed = .true.</code> has to be defined in <code>./user_nl_cpl</code> to allow sediment flux passing into the river model through the coupler.</li> </ul>"},{"location":"MPAS-Ocean/","title":"Model for Prediction Across Scales-Ocean","text":"<p>The Model for Prediction Across Scales-Ocean (MPAS-Ocean) is the ocean component of the Energy Exascale Earth System Model (E3SM), developed by the U.S. Department of Energy.</p> <ul> <li>The MPAS-Ocean User Guide explains how to run and customize MPAS-Ocean within E3SM.</li> <li>The MPAS-Ocean Developer Guide explains MPAS-Ocean data structures and how to write new code.</li> <li>The MPAS-Ocean Technical Guide explains the science behind MPAS-Ocean.</li> </ul>"},{"location":"MPAS-Ocean/dev-guide/","title":"MPAS-Ocean Developer Guide","text":"<p>The E3SM developer guide may be found at https://e3sm.org/model/running-e3sm/developing-e3sm/.</p> <p>The MPAS developers guide is at https://mpas-dev.github.io/files/documents/MPAS-DevelopersGuide.pdf.</p>"},{"location":"MPAS-Ocean/tech-guide/","title":"MPAS-Ocean Technical Guide","text":"<p>This Technical Guide describes the governing equations, physics, and numerical discretizations of MPAS-Ocean.</p>"},{"location":"MPAS-Ocean/tech-guide/#guides-design-documents-and-documentation","title":"Guides, Design Documents, and documentation","text":"<p>MPAS-Ocean may be run as either a stand-alone model, or within the E3SM coupled earth system model. The MPAS-Ocean code for both stand-alone and coupled is housed in the repository https://github.com/E3SM-Project/E3SM within the directory <code>components/mpas-ocean</code>. The stand-alone executable may be built within that directory using the make command with the required libraries, as described in Chapter 1 of the User's Guide.</p> <p>The MPAS-Ocean User's Guide provides a description of the MPAS Framework in Part I, the Governing equations for MPAS-Ocean in Chapter 8, and describes the physics behind each term and parameterization in chapter 11.</p> <p>All new features are created with design documents. The location of these documents have moved over the years, but can still be found in these locations:</p> <ol> <li>MPAS Documents repository</li> <li>E3SM repository MPAS-Ocean docs</li> <li>Documents for the new Omega model are similar to MPAS-Ocean and may be found in the Omega documentation.</li> </ol> <p>All test cases are housed in the Compass repository and, more recently, the Polaris repository. The corresponding documentation is housed in the Compass docs and Polaris docs pages.</p>"},{"location":"MPAS-Ocean/tech-guide/#publications","title":"Publications","text":"<p>Beyond the documentation, there are many publications that describe the inner workings of MPAS-Ocean:</p> <p>Ringler, T., Petersen, M., Higdon, R.L., Jacobsen, D., Jones, P.W., Maltrud, M., 2013. A multi-resolution approach to global ocean modeling. Ocean Modelling 69, 211-232.</p> <p>Petersen, M.R., D.W. Jacobsen, T.D. Ringler, M.W. Hecht, M.E. Maltrud, Evaluation of the arbitrary Lagrangian\u2013Eulerian vertical coordinate method in the MPAS-Ocean model, Ocean Modelling, Volume 86, February 2015, Pages 93-113, ISSN 1463-5003.</p> <p>Petersen, M. R., Asay\u2010Davis, X. S., Berres, A. S., Chen, Q., Feige, N., Hoffman, M. J., et al. (2019). An evaluation of the ocean and sea ice climate of E3SM using MPAS and interannual CORE\u2010II forcing. Journal of Advances in Modeling Earth Systems, 11, 1438\u2013 1458.</p>"},{"location":"MPAS-Ocean/user-guide/","title":"MPAS-Ocean Quick Start","text":"<p>This MPAS-Ocean Quick Start Guide describes how to set up and run MPAS-Ocean within E3SM. More details can be found in the MPAS-Ocean User's Guide, as well as instructions on running the stand-alone ocean model.</p>"},{"location":"MPAS-Ocean/user-guide/#steps-to-build-and-run-mpas-ocean","title":"Steps to build and run MPAS-Ocean","text":"<p>Step-by-step instructions on how to run E3SM can be found at https://docs.e3sm.org/running-e3sm-guide.</p> <p>This MPAS-Ocean Quick Start guide provides the additional information to run configurations that are not fully-coupled (e.g. C-case: active ocean only; G-case: active ocean and sea ice) within E3SM. This is done by changing the compset. Certain parameters, including the mesh, namelist parameters, input data files, and output file specifcations can also be modified. These are described below as ways to customize runs.</p> <p>Templates of 1-month example E3SM run-scripts for a G-case and C-case are provided. Key information for the user to modify includes:</p> <ul> <li><code>MACHINE</code> and <code>PROJECT</code> if applicable</li> <li>Paths for code repository in <code>CODE_ROOT</code> and case directory in <code>CASE_ROOT</code>, which includes the run directory for output.</li> <li>Simulation compsets, resolution and name (see below)</li> <li>Wallclock duration in <code>WALLTIME</code> and simulation duration with <code>STOP_OPTION</code> and <code>STOP_N</code>.</li> </ul> <p>Additional runscript examples can be found here for v3.LR.</p>"},{"location":"MPAS-Ocean/user-guide/#scientifically-supported-compsets-and-meshes","title":"Scientifically supported compsets and meshes","text":""},{"location":"MPAS-Ocean/user-guide/#compsets","title":"Compsets","text":"<p>The compsets below are typical ocean and sea ice-focused compsets supported by E3SM:</p> <p><code>GMPAS-JRA1p5</code> - Active ocean-sea ice configuration forced by data atmosphere based on JRA55 v1.5 (covers 63 years, 1958-2020)</p> <p><code>GMPAS-IAF</code> - Active ocean-sea ice configuration forced by data atmosphere based on CORE-II (covers 62 years, 1948-2009)</p> <p><code>GMPAS-JRA1p5-DIB-DISMF</code> - Active ocean-sea ice configuration forced by JRA55 v1.5 atmosphere (as above), with data iceberg and data ice-shelf melt</p> <p><code>GMPAS-JRA1p5-DIB-PISMF</code> - Active ocean-sea ice configuration forced by JRA55 v1.5 atmosphere (as above), with data iceberg and prognostic ice-shelf melt</p> <p><code>CMPASO-JRA1p4</code> - Active ocean configuration forced by data atmosphere based on JRA55 v1.4 (covers 61 years, 1958-2018)</p> <p><code>CMPASO-IAF</code> - Active ocean configuration forced by data atmosphere based on CORE-II (covers 62 years, 1948-2009)</p> <p>Additional compsets can be found in the mpas-ocean <code>config_compsets.xml</code>. Note that the fully coupled compsets and their aliases can be found in the cime allactive <code>config_compsets.xml</code>. For more information on the schemes used within MPAS-Ocean, refer to the MPAS-Ocean User's Guide.</p> <p>A full list of Compsets in the current repository can be listed using</p> <pre><code>cd cime/scripts\n./query_config --compsets\n</code></pre>"},{"location":"MPAS-Ocean/user-guide/#meshes","title":"Meshes","text":"<p>Some supported meshes for G- and C-cases include:</p> <p><code>TL319_IcoswISC30E3r5</code> - Icosahedral 30 km mesh with ice shelves cavities (wISC), E3SMv3 (E3) revision r5, TL319 is the grid for JRA.</p> <p><code>T62_IcoswISC30E3r5</code> - Icosahedral 30 km mesh with ice shelves cavities (wISC), E3SMv3 (E3) revision r5, T62 is the grid for CORE-II.</p> <p><code>T62_oQU240</code> - Quasi uniform 2-degree ocean mesh, to be used with CORE-II only. Good for rapid testing, used in nightly testing not production runs.  This grid is not scientifically validated .</p> <p>Note: the mesh should be consistent with the compset (e.g. JRA vs CORE). Additional mesh information can be found here.</p> <p>A full list of Meshes in the current repository can be listed using</p> <pre><code>cd cime/scripts\n./query_config --grids\n</code></pre>"},{"location":"MPAS-Ocean/user-guide/#customizing-runs","title":"Customizing runs","text":""},{"location":"MPAS-Ocean/user-guide/#namelist-changes","title":"Namelist changes","text":"<p>Without additional input, E3SM will generate the namelist file <code>mpaso_in</code> in the run directory using the default values for the compset and mesh requested. Namelist parameters can be changed from default values by modifying the <code>user_nl_mpaso</code> file, found in the <code>case_scripts</code> directory. This is done by entering <code>[namelist option] = [changed value]</code> as separate lines in the <code>user_nl_mpaso</code> file. All other options will remain defaults. These changes can be added at run time and will take effect in the next submission.</p> <p>Refer to the MPAS-Ocean User's Guide (Chapter 10) for a comprehensive description of the namelist parameters and the options that they correspond to. Namelist options may also be found in the code repository in the file <code>components/mpas-ocean/src/Registry.xml</code> for general flags, <code>components/mpas-ocean/src/tracer_groups/Registry_*.xml</code> for specific tracer group flags, and <code>components/mpas-ocean/src/analysis_members/Registry_*.xml</code> for analysis member flags.</p>"},{"location":"MPAS-Ocean/user-guide/#example-of-a-namelist-change-via-user_nl_mpaso","title":"Example of a namelist change via <code>user_nl_mpaso</code>","text":"<pre><code> config_GM_closure = 'constant'\n config_gm_constant_kappa = 900\n config_time_integrator = 'split_explicit'\n config_am_timeseriesstatsmonthly_compute_interval = '00-00-01_00:00:00'\n</code></pre> <p>In this example, the namelist changes include changing the eddy closure (first 2 options for the type of closure and a parameter value), switching the time integration scheme, and modifying an analysis member (in this case, the interval from which the monthly analysis member is computed).</p> <p>Reminder: <code>user_nl_mpaso</code> can be empty. All options not specified are defaults (given the compset and mesh). Some options (like interior restoring) require extra fields to be present in the input file.  </p>"},{"location":"MPAS-Ocean/user-guide/#configuring-input-and-output-for-mpas-ocean","title":"Configuring input and output for MPAS-Ocean","text":"<p>The reading and writing of model fields in MPAS is handled by user-configurable streams. A stream represents a fixed set of model fields, together with dimensions and attributes, that are all written or read together to or from the same file or set of files. They are used for reading initial conditions, for writing and reading restart fields, and for writing additional model history fields. Streams are defined in XML configuration files that are created at build time for each model core. The name of this XML file for the ocean core is <code>streams.ocean</code> (the sea ice has a similar <code>streams.seaice</code>). Importantly, the stream file is generated in the run directory during the <code>./case.setup</code> step, but changes made into the run directory will not take effect. To make changes to the output fields, copy the <code>streams.ocean</code> file from the run directory into the<code>case_scripts/SourceMods/src.mpaso/</code> directory. Changes to the stream file made into the <code>SourceMods</code> sub-directory will take effect on the next case submission (there is no need to re-compile after making modifications to the XML file). Alternatively, changes to the streams file can be made directly in the code in <code>components/mpas-ocean/cime_config/buildnml</code>.</p>"},{"location":"MPAS-Ocean/user-guide/#checking-initial-conditions","title":"Checking initial conditions","text":"<p>Key information to check regarding the input data typically include:</p> <pre><code>&lt;immutable_stream name=\"mesh\"\n                  type=\"none\"\n                  io_type=\"pnetcdf\"\n                  filename_template=\"/lcrc/group/e3sm/data/inputdata/ocn/mpas-o/IcoswISC30E3r5/mpaso.IcoswISC30E3r5.20231120.nc\"\n/&gt;\n&lt;immutable_stream name=\"input\"\n                  type=\"input\"\n                  io_type=\"pnetcdf\"\n                  input_interval=\"initial_only\"\n                  filename_template=\"/lcrc/group/e3sm/data/inputdata/ocn/mpas-o/IcoswISC30E3r5/mpaso.IcoswISC30E3r5.20231120.nc\"\n/&gt;\n</code></pre> <p>The <code>mesh</code> filename points to the mesh file used. The <code>input</code> filename points to the file containing the ocean initial conditions (if the run type is <code>initial</code>). The streams file can be large, it is often useful to rely on the search function to navigate it. For larger meshes (millions of horizontal cells) the flag <code>io_type=\"pnetcdf\"</code> must be changed to <code>io_type=\"pnetcdf,cdf5\"</code>.</p>"},{"location":"MPAS-Ocean/user-guide/#checking-and-modifying-the-output-data","title":"Checking and modifying the output data","text":"<p>By default, MPAS-Ocean will output a set of monthly-averaged variables. The streams file can be modified to include additional variables in the existing output files, produce additional output files, or change the output frequency (e.g. high frequency files shifting between daily or 5-daily frequencies).</p> <p>The XML file is organized into blocks describing each stream. Typical streams for output include:</p> <p><code>timeSeriesStatsMonthlyOutput</code> - monthly averaged output</p> <p><code>highFrequencyOutput</code> - high frequency snapshots (not averaged) output with frequency <code>output_interval</code></p> <p>Under each block header is the list of variables (individual variables, variable structure, or variable arrays) that will be output within the relevant stream.</p>"},{"location":"MPAS-Ocean/user-guide/#example-workflow-for-modifying-the-output-fields","title":"Example workflow for modifying the output fields","text":"<ul> <li>copy the <code>streams.ocean</code> file from the run directory to the <code>SourceMods</code> directory (see above)</li> <li>identify the variable name for the variable of interest. You can find the variable name by searching the ocean Registry.xml (in the <code>src</code> directory) or Registry_package.xml in the <code>tracer</code> and <code>analysis_member</code> sub-directories. Note whether the variable of interest is included within a <code>var_array</code> or a <code>var_struct</code>.</li> <li>identify the output stream of interest (e.g. monthly averages, high frequency, others). You can search for a stream name, known output filename, or output interval.</li> <li>check whether the variable of interest is included in the <code>streams.ocean</code> file. Search for the <code>var name</code>, or the <code>var_array</code> and <code>var_struct</code> if applicable. If it is, copy the variable line from other streams into the stream of interest. If it is not included, copy it from the Registry.xml.</li> <li>check whether the relevant stream is turned on. This includes checking that <code>output_interval</code> in the stream header is not <code>None</code>.</li> <li>make further modifications: e.g. you can modify the <code>output_interval</code> for the high-frequency stream. If you are turning on a new stream, remove unnecessary variables from the stream.</li> </ul>"},{"location":"MPAS-Ocean/user-guide/#excerpts-from-a-streamsocean-file","title":"Excerpts from a <code>streams.ocean</code> file","text":"<pre><code>&lt;stream name=\"timeSeriesStatsMonthlyOutput\"\n        type=\"output\"\n        precision=\"single\"\n        io_type=\"pnetcdf\"\n        useMissingValMask=\"true\"\n        filename_template=\"GMPAS-JRA.TL319_IcoswISC30E3r5.anvil.mpaso.hist.am.timeSeriesStatsMonthly.$Y-$M-$D.nc\"\n        filename_interval=\"00-01-00_00:00:00\"\n        reference_time=\"01-01-01_00:00:00\"\n        output_interval=\"00-01-00_00:00:00\"\n        clobber_mode=\"truncate\"\n        packages=\"timeSeriesStatsMonthlyAMPKG\"\n        runtime_format=\"single_file\"&gt;\n\n    &lt;var name=\"daysSinceStartOfSim\"/&gt;\n    &lt;var name=\"binBoundaryMerHeatTrans\"/&gt;\n    &lt;var name=\"binBoundaryZonalMean\"/&gt;\n    &lt;var name=\"ssh\"/&gt;\n    &lt;var_struct name=\"tracers\"/&gt;\n    &lt;var name=\"velocityMeridional\"/&gt;\n    &lt;var name=\"velocityZonal\"/&gt;\n    &lt;var name=\"layerThickness\"/&gt;\n...\n&lt;/stream&gt;\n</code></pre> <pre><code>&lt;stream name=\"highFrequencyOutput\"\n        type=\"output\"\n        precision=\"single\"\n        io_type=\"pnetcdf\"\n        filename_template=\"GMPAS-JRA.TL319_IcoswISC30E3r5.anvil.mpaso.highFrequencyOutput.$Y-$M-$D_$h.$m.$s.nc\"\n        filename_interval=\"00-01-00_00:00:00\"\n        reference_time=\"01-01-01_00:00:00\"\n        output_interval=\"00-00-05_00:00:00\"\n        clobber_mode=\"truncate\"\n        packages=\"highFrequencyOutputAMPKG\"&gt;\n\n    &lt;var name=\"xtime\"/&gt;\n    &lt;var name=\"daysSinceStartOfSim\"/&gt;\n    &lt;var_array name=\"activeTracersAtSurface\"/&gt;\n    &lt;var_array name=\"activeTracersAt250m\"/&gt;\n    &lt;var_array name=\"activeTracersAtBottom\"/&gt;\n    &lt;var name=\"kineticEnergyAtSurface\"/&gt;\n    &lt;var name=\"kineticEnergyAt250m\"/&gt;\n    &lt;var name=\"relativeVorticityAt250m\"/&gt;\n    &lt;var name=\"ssh\"/&gt;\n    &lt;var name=\"pressureAdjustedSSH\"/&gt;\n    &lt;var name=\"boundaryLayerDepth\"/&gt;\n    &lt;var name=\"dThreshMLD\"/&gt;\n    &lt;var name=\"tThreshMLD\"/&gt;\n    &lt;var name=\"columnIntegratedSpeed\"/&gt;\n    &lt;var name=\"barotropicSpeed\"/&gt;\n    &lt;var name=\"landIceFreshwaterFlux\"/&gt;\n    &lt;var name=\"pressureAdjustedSSH\"/&gt;\n    &lt;var name=\"atmosphericPressure\"/&gt;\n&lt;/stream&gt;\n</code></pre> <p>A more comprehensive description of the streams options can be found in Chapter 6 of the MPAS-Ocean User's Guide.</p>"},{"location":"MPAS-seaice/","title":"The E3SM Sea Ice Model (MPAS-seaice)","text":"<p>MPAS-seaice is an unstructured-mesh sea-ice model that uses the Modeling for Prediction Across Scales (MPAS) framework, allowing enhanced horizontal resolution in regions of interest. MPAS-seaice incorporates many of the methods used in the Los Alamos CICE sea-ice model, but adapted to the Spherical Centroidal Vornoi Tesselation (SCVT) meshes used by the MPAS framework.</p> <ul> <li>The MPAS-seaice User's Guide outlines the MPAS Framework, on which MPAS-seaice is built, and Icepack, the column physics submodule in MPAS-seaice, and it provides guidance for controlling MPAS-seaice within E3SM.</li> <li>The MPAS-seaice Technical Guide describes the mesh and major physics components underlying MPAS-seaice code and its coupling to E3SM.</li> <li>The MPAS-seaice Developer's Guide provides additional information relevant for model development, including the Icepack interface and development/testing scripts.</li> </ul>"},{"location":"MPAS-seaice/#icepack","title":"Icepack","text":"<p>MPAS-seaice incorporates the Icepack software package for sea ice column physics, developed by the CICE Consortium, as a submodule. Icepack documentation. provides a complete description of the column physics and instructions for using Icepack as a standalone model. The source code for this documentation is maintained in E3SM's Icepack fork (navigate to the desired branch, then to doc/source/, etc).  This is the documentation associated with the latest Icepack version that has been merged into E3SM, plus any documentation changes made within E3SM itself. This documentation is fully rendered in E3SM's Icepack readthedocs.</p> <p>Guidance for developing Icepack documentation includes instructions for building the readthedocs documentation yourself.</p>"},{"location":"MPAS-seaice/#mpas-seaice-code-structure","title":"MPAS-seaice code structure","text":"<p>Some MPAS-seaice functionality is sourced from the MPAS Framework: <code>E3SM/components/mpas-framework</code>.  In particular, see <code>E3SM/components/mpas-framework/core_seaice</code>.</p> <p>Code structure within the <code>mpas-seaice/</code>component-level directory:</p> Directories Function <code>bld</code> namelist configuration files <code>cime_config</code> build and configuration scripts <code>docs</code> this documentation <code>driver</code> coupling modules <code>src</code> source code for the model physics and output <code>src/analysis_members</code> source code for model output <code>src/icepack</code> link to the icepack submodule <code>src/model_forward</code> top-level mpas-seaice modules <code>src/shared</code> dynamics and general-purpose modules (e.g. mesh, constants) <code>testing</code> testing scripts"},{"location":"MPAS-seaice/references/","title":"References","text":"<p>Bitz, C. M., and W. H. Lipscomb (1999). An energy-conserving thermodynamic model of sea ice, Journal of Geophysical Research: Oceans, 104(C7), 15,669\u201315,677, doi: 10.1029/1999JC900100.</p> <p>Briegleb, B. P., and B. Light (2007). A Delta-Eddington multiple scattering parameterization for solar radiation in the sea ice component of the Community Climate Sys- tem Model, Tech. Rep. NCAR/TN-472+STR, National Center for Atmospheric Research, Boulder, Colorado USA.</p> <p>Dang, C., C. S. Zender, and M. G. Flanner (2019). Intercomparison and improvement of two-stream shortwave radiative transfer schemes in earth system models for a unified treatment of cryospheric surfaces. The Cryosphere, 13:2325\u20132343. doi:10.5194/tc-13-2325-2019.</p> <p>Dasgupta, G. (2003). Interpolants within convex polygons: Wachpress' shape functions. Journal of Aerospace Engineering, 16, 1\u20138. https://doi.org/10.1061/(ASCE)0893-1321(2003)16:1(1)</p> <p>Dukowicz, J. K., &amp; Baumgardner, J. R. (2000). Incremental remapping as a transport/advection algorithm. Journal of Computational Physics, 160(1), 318\u2013335. https://doi.org/10.1006/jcph.2000.6465</p> <p>Dunavant, D. A. (1985). High degree efficient symmetrical Gaussian quadrature rules for the triangle. International Journal for Numerical Methods in Engineering, 21(6), 1129\u20131148. https://doi.org/10.1002/nme.1620210612</p> <p>Flocco, D., D. L. Feltham, and A. K. Turner (2010). Incorporation of a physically based melt pond scheme into the sea ice component of a climate model, Journal of Geophysi- cal Research: Oceans, 115(C8), doi:10.1029/2009JC005568, C08012.</p> <p>Golaz, J.-C., Caldwell, P. M.,\u2028Van Roekel, L. P., Petersen, M. R., Tang, Q., Wolfe, J. D., et al. (2019). The DOE E3SM coupled model version 1: Overview and evaluation at\u2028standard resolution. Journal of Advances in Modeling Earth\u2028Systems, 11, 2089\u20132129. https://doi.org/10.1029/2018MS001603</p> <p>Golaz, J.-C., Van Roekel, L. P., Zheng, X., Roberts, A. F., Wolfe, J. D., Lin, W., et al. (2022). The DOE E3SM Model version 2: Overview of the physical model and initial model evaluation. Journal of Advances in Modeling Earth Systems, 14, e2022MS003156. https://doi.org/10.1029/2022MS003156</p> <p>Hibler, W. D. III (1979). A dynamic thermodynamic sea ice model. Journal of Physical Oceanography, 9(4), 815\u2013846. https://doi.org/10.1175/1520-0485(1979)009&lt;0815:ADTSIM&gt;2.0.CO;2</p> <p>Holland, M. M., D. A. Bailey, B. P. Briegleb, B. Light, and E. Hunke (2012). Improved sea ice shortwave radiation physics in CCSM4: The impact of melt ponds and aerosols on arctic sea ice, Journal of Climate, 25(5), 1413\u20131430, doi:10.1175/JCLI-D-11-00078.1.</p> <p>Hunke, E., et al. (2018). CICE-Consortium/Icepack. Zenodo. https://doi.org/10.5281/zenodo.1213462</p> <p>Hunke, E. C., &amp; Dukowicz, J. K. (1997). An elastic-viscous-plastic model for sea ice dynamics. Journal of Physical Oceanography, 27(9), 1849\u20131867. https://doi.org/10.1175/1520-0485(1997)027&lt;1849:AEVPMF&gt;2.0.CO;2</p> <p>Hunke, E. C., &amp; Dukowicz, J. K. (2002). The elastic-viscous-plastic sea ice dynamics model in general orthogonal curvilinear coordinates on a sphere\u2014Incorporation of metric terms. Monthly Weather Review, 130(7), 1848\u20131865.</p> <p>Hunke, E. C., Hebert, D. A., &amp; Lecomte, O. (2013). Level-ice melt ponds in the Los Alamos sea ice model, CICE. Ocean Modelling, 71, 26\u201342. https://doi.org/10.1016/j.ocemod.2012.11.008</p> <p>Lipscomb, W. H. (2001). Remapping the thickness distribution in sea ice models, Journal of Geophysical Research: Oceans, 106(C7), 13,989\u201314,000, doi:10.1029/2000JC000518.</p> <p>Lipscomb, W. H., &amp; Hunke, E. C. (2004). Modeling sea ice transport using incremental remapping. Monthly Weather Review, 132(6), 1341\u20131354.</p> <p>Lipscomb, W. H., Hunke, E. C., Maslowski, W., &amp; Jakacki, J. (2007). Ridging, strength, and stability in high-resolution sea ice models. Journal of Geophysical Research, 112. C03S91. https://doi.org/10.1029/2005JC003355</p> <p>Lipscomb, W. H., &amp; Ringler, T. D. (2005). An incremental remapping transport scheme on a spherical geodesic grid. Monthly Weather Review, 133(8), 2335\u20132350. https://doi.org/10.1175/MWR2983.1</p> <p>Turner, A. K., and E. C. Hunke (2015). Impacts of a mushy-layer thermodynamic ap- proach in global sea-ice simulations using the CICE sea-ice model, Journal of Geophys- ical Research: Oceans, 120(2), 1253\u20131275, doi:10.1002/2014JC010358.</p> <p>Turner, A. K., E. C. Hunke, and C. M. Bitz (2013). Two modes of sea-ice gravity drainage: A parameterization for large-scale modeling, Journal of Geophysical Research: Oceans, 118(5), 2279\u20132294, doi:10.1002/jgrc.20171.</p> <p>Turner, A. K., Lipscomb, W. H., Hunke, E. C., Jacobsen, D. W., Jeffery, N., Engwirda, D., Ringer, T. D., Wolfe, J. D. (2021). MPAS-seaice (v1.0.0): Sea-ice dynamics on unstructured Voronoi meshes. Geoscientific Model Development Discussions, 1\u201346. https://doi.org/10.5194/gmd-2021-355</p>"},{"location":"MPAS-seaice/dev-guide/","title":"Developer's Guide","text":"<p>Development of the MPAS-seaice component should follow the general procedures outlined by the E3SM project.</p> <p>Development Guide for E3SM Code Development Guide for E3SM Documentation</p>"},{"location":"MPAS-seaice/dev-guide/#configuration-controls","title":"Configuration Controls","text":"<p>MPAS-seaice is controlled using namelist options.  Namelist files for E3SM runs are found in <code>E3SM/components/mpas-seaice/bld/namelist_files/</code>.  However, the values in these files are drawn from the Registry, following the convention of all MPAS components. Registry files are used directly for stand-alone MPAS-seaice runs, and E3SM scripts pass information from them into E3SM's namelist files when a PR is merged.  E3SM's namelist files need to be changed for development purposes.  It's easiest to change all of them when needed, to keep them consistent, taking care not to unintentionally change standalone MPAS-seaice configurations.</p>"},{"location":"MPAS-seaice/dev-guide/#mpas-framework","title":"MPAS Framework","text":"<p>MPAS-seaice is built on the MPAS Framework.</p> <p>The MPAS Framework provides the foundation for a generalized geophysical fluid dynamics model on unstructured spherical and planar meshes. On top of the framework, implementations specific to the modeling of a particular physical system (e.g., sea ice, ocean) are created as MPAS cores. The MPAS design philosophy is to leverage the efforts of developers from the various MPAS cores to provide common framework functionality with minimal effort, allowing MPAS core developers to focus on development of the physics and features relevant to their application.</p> <p>The framework code includes shared modules for fundamental model operation. Significant capabilities include:</p> <ul> <li>Description of model data types. MPAS uses a handful of fundamental Fortran derived types for basic model functionality. Core-specific model variables are handled through custom groupings of model fields called pools, for which custom access routines exist. Core-specific variables are defined in XML syntax in a Registry, and the framework parses the Registry, defines variables, and allocates memory as needed.</li> <li>Mesh specification. MPAS requires 36 fields to fully describe the mesh used in a simulation. These include the position, area, orientation, and connectivity of all cells, edges, and vertices in the mesh. The mesh specification can flexibly describe both spherical and planar meshes. For more information about the meshes, see the Users Guide.</li> <li>Distributed memory parallelization and domain decomposition. The MPAS Framework provides needed routines for exchanging information between processors in a parallel environment using Message Passing Interface (MPI). This includes halo updates, global reductions, and global broadcasts. MPAS also supports decomposing multiple domain blocks on each processor to optimize model performance by minimizing transfer of data from disk to memory. Shared memory parallelization through OpenMP is also supported, but the implementation is left up to each core.</li> <li>Parallel input and output capabilities. MPAS performs parallel input and output of data from and to disk through the commonly used libraries of NetCDF, Parallel NetCDF (pnetcdf), and Parallel Input/Output (PIO). The Registry definitions control which fields can be input and/or output, and a framework \"streams\" functionality provides run-time configuration of what fields are to be written to what file name and at what frequency through an XML streams file. The MPAS framework includes additional functionality specific to providing a flexible model restart capability.</li> <li>Advanced timekeeping. MPAS uses a customized version of the timekeeping functionality of the Earth System Modeling Framework (ESMF), which includes a robust set of time and calendar tools used by many Earth System Models (ESMs). This allows explicit definition of model epochs in terms of years, months, days, hours, minutes, seconds, and fractional seconds and can be set to three different calendar types: Gregorian, Gregorian no leap, and 360 day. This flexibility helps enable multi-scale physics and simplifies coupling to ESMs. To manage the complex date/time types that ensue, MPAS framework provides routines for arithmetic of time intervals and the definition of alarm objects for handling events (e.g., when to write output, when the simulation should end).</li> <li>Run-time configurable control of model options. Model options are configured through namelist files that use standard Fortran namelist file format, and input/output are configured through streams files that use XML format. Both are completely adjustable at run time.</li> <li>Online, run-time analysis framework. A system for defining analysis of model states during run time, reducing the need for post-processing and model output.</li> </ul> <p>Additionally, a number of shared operators exist to perform common operations on model data. These include geometric operations (e.g., length, area, and angle operations on the sphere or the plane), interpolation (linear, barycentric, Wachspress, radial basis functions, spline), vector and tensor operations (e.g., cross products, divergence), and vector reconstruction (e.g., interpolating from cell edges to cell centers). Most operators work on both spherical and planar meshes.</p>"},{"location":"MPAS-seaice/dev-guide/#coupling-of-mpas-seaice-within-e3sm","title":"Coupling of MPAS-seaice within E3SM","text":"<p>Several files within MPAS-SI control the coupling of fields between MPAS-SI and other E3SM components via the coupler. A list of all variables being passed to and from MPAS-SI can be found in <code>components/mpas-seaice/driver/mpassi_cpl_indices.F</code>. Variables named with the prefix <code>x2i</code> are passed from the coupler to MPAS-SI, variables with the prefix <code>i2x</code> are passed from MPAS-SI to the coupler. For example, all coupled variables are named with the following convention: <code>index_i2x_Si_ithick</code> refers to a state variable of ice (<code>Si</code>) that gets passed from MPAS-SI to the coupler (<code>i2x</code>) for the ice thickness (<code>ithick</code>). <code>index_x2i_So_t</code> refers to an ocean state variable (<code>So</code>) passed from the the coupler to MPAS-SI (<code>x2i</code>) for ocean temperature (<code>t</code>).</p>"},{"location":"MPAS-seaice/dev-guide/#icepack","title":"Icepack","text":"<p>For changes to Icepack, please consult the CICE Consortium's recommendations for code contributions.</p> <p>To access the column physics in Icepack, MPAS-seaice uses methods defined in <code>icepack_intfc.F90</code>. The 'init' and 'query' methods are used to set and retrieve Icepack values. A 'write' method is also available for documenting these values. MPAS-seaice follows the 'icepack_warnings' methodology where <code>icepack_warnings_aborted</code> is checked and <code>icepack_warnings_flush</code> is called after every call to an Icepack method. It does not directly \u201cuse\u201d Icepack data, accessing Icepack data only through these interfaces.</p> <p>Basic Icepack development can be done in standalone mode using Icepack's testing scripts, directly in the submodule branch in MPAS-seaice. We recommend that Icepack developments be thoroughly tested within E3SM's coupled framework throughout the development process, including fully coupled simulations.</p>"},{"location":"MPAS-seaice/dev-guide/#e3sm-polar-developer-script","title":"E3SM-Polar-Developer Script","text":"<p>To accelerate early development stages, a script is available for configuring and testing MPAS-seaice (including the Icepack submodule) in D compsets, which have the sea ice component active and data models for the other components.</p>"},{"location":"MPAS-seaice/dev-guide/#view-helpful-information-including-default-values-for-duration-configuration-etc","title":"View helpful information, including default values for duration, configuration, etc","text":"<pre><code>git clone git@github.com:E3SM-Project/SimulationScripts.git\ncd SimulationScripts/archive/PolarGroup\n./E3SM-Polar-Developer.sh -h\n</code></pre> <p>For debugging E3SM, search the script for 'debug' and follow the instructions.</p> <p>The following examples describe how to use the script for development in Icepack.  Similar procedures could be used for any MPAS-SI physics development.</p>"},{"location":"MPAS-seaice/dev-guide/#set-up-and-run-baselines","title":"Set up and run baselines","text":"<p>Create a file containing modified namelist options. The file <code>nset01.nlk</code> in this example turns off the <code>snicar_ad</code> radiation scheme.</p> <pre><code>$ less nset01.nlk\n[mpassi]\nconfig_use_snicar_ad = {.false.}\n</code></pre> <p>Notes:</p> <ul> <li>A .nlk file without any config settings will create a baseline using default settings.</li> </ul> <p>Fetch E3SM (choose any name for the directory baselines01):</p> <pre><code>./E3SM-Polar-Developer.sh -s baselines01 -f git@github.com:E3SM-Project/E3SM\n</code></pre> <p>Set up a new case and build it:</p> <pre><code>./E3SM-Polar-Developer.sh -s baselines01 -k nset01.nlk -e -n -b\n</code></pre> <p>Submit:</p> <pre><code>./E3SM-Polar-Developer.sh -s baselines01 -k nset01.nlk -e -q\n</code></pre> <p>Examine the diagnostic output:</p> <pre><code>./E3SM-Polar-Developer.sh -s baselines01 -k nset01.nlk -e -a -v\n</code></pre>"},{"location":"MPAS-seaice/dev-guide/#set-up-a-sandbox-for-model-development-to-be-compared-with-the-baselines","title":"Set up a sandbox for model development, to be compared with the baselines","text":"<p>Fetch E3SM (choose any name for the directory newdev01):</p> <pre><code>./E3SM-Polar-Developer.sh -s newdev01 -f git@github.com:E3SM-Project/E3SM\n</code></pre> <p>Create a new development branch:</p> <pre><code>cd ~/E3SM-Polar/code/newdev01\ngit branch newbranch\ngit checkout newbranch\n</code></pre> <p>Set up a new case and build it:</p> <pre><code>./E3SM-Polar-Developer.sh -s newdev01 -k nset01.nlk -e -n -b\n</code></pre> <p>Develop and test... Build/compile:</p> <pre><code>./E3SM-Polar-Developer.sh -s newdev01 -k nset01.nlk -e -b\n</code></pre> <p>Submit:</p> <pre><code>./E3SM-Polar-Developer.sh -s newdev01 -k nset01.nlk -e -q\n</code></pre> <p>Examine the diagnostic output:</p> <pre><code>./E3SM-Polar-Developer.sh -s newdev01 -k nset01.nlk -e -a -v\n</code></pre> <p>Compare with the baselines case directory (use your D3 baselines directory):</p> <pre><code>./E3SM-Polar-Developer.sh -s newdev01 -k nset01.nlk -a D3.nset01.baselines01.master.E3SM-Project.anvil -v\n</code></pre>"},{"location":"MPAS-seaice/dev-guide/#make-changes-in-icepack-and-pr-to-the-consortium","title":"Make changes in Icepack and PR to the Consortium","text":"<p>We recommend PR\u2019ing Icepack changes first to the Consortium then to E3SM\u2019s icepack fork, in order to keep the repositories in sync and to ensure the changes are robust outside of E3SM.  Some changes to Icepack require extensive changes to the driver code (e.g. MPAS-seaice or CICE), making this process challenging.  Contact the CICE Consortium to discuss and identify a collaborative path forward.</p> <p>First, create a baseline (standalone) Icepack test suite using the E3SM icepack fork or, if the Consortium code is different, using Consortium icepack main (see Consortium documentation.)</p> <p>Similarly test your branch of Icepack within E3SM and compare with the baseline. When satisfied with E3SM testing, PR to Consortium icepack main:</p> <pre><code>git remote add consortium git@github.com:cice-consortium/icepack.git\ngit pull consortium main\n</code></pre> <p>Fix conflicts if needed, then</p> <pre><code>git add ...\ngit commit -m \"update from cice-consortium main\"\n</code></pre> <p>Continue testing. When satisfied,</p> <pre><code>git push origin branch\n</code></pre> <p>Create a PR from branch to cice-consortium/icepack -b main.</p> <p>Once the PR has been tested and merged into the main Icepack codebase, a new PR is submitted to E3SM.</p> <p>More extensive documentation of this workflow tool used for the Icepack merge project is available here.</p>"},{"location":"MPAS-seaice/dev-guide/#cice-qc-quality-control-testing","title":"CICE-QC Quality Control Testing","text":"<p>Example to run a CICE-QC comparison between two E3SM simulations with changes to the sea ice component.</p>"},{"location":"MPAS-seaice/dev-guide/#set-up-and-run-simulations-to-be-compared","title":"Set up and run simulations to be compared","text":"<pre><code>cd ~/SimulationScripts/archive/PolarGroup/\n</code></pre> <p>Create a <code>.nlk</code> file with namelist changes to include the thickness analysis member. Include changes to namelist values needed in both the baseline and the test here, if desired (append the last 3 lines here to the end of your standard D-case test .nlk).</p> <pre><code>$ less qcbase.nlk\n[mpassi]\nconfig_AM_thicknesses_enable = {.true.}\nconfig_AM_thicknesses_compute_on_startup = {.true.}\nconfig_AM_thicknesses_write_on_startup = {.true.}\n</code></pre> <p>Use test script to clone E3SM, and create a sandbox</p> <pre><code>./E3SM-Polar-Developer.sh -s qcbaseline -f git@github.com:E3SM-Project/E3SM\n</code></pre> <p>Edit <code>~/E3SM-Polar/code/qcbaseline/components/mpas-seaice/cime_config/buildnml</code> to change:</p> <pre><code>lines.append('        output_interval=\"none\"&gt;')\n</code></pre> <p>to</p> <pre><code>lines.append('        output_interval=\"00-00-01_00:00:00\"&gt;')\n</code></pre> <p>for <code>stream name=\u201coutput\u201d</code> and add</p> <pre><code>lines.append('    &lt;var name=\"iceThicknessCell\"/&gt;')\n</code></pre> <p>a few lines below that:</p> <pre><code>            lines.append('&lt;stream name=\"output\"')\n            lines.append('        type=\"output\"')\n            lines.append('        io_type=\"{}\"'.format(ice_pio_typename))\n            lines.append('        filename_template=\"{}.mpassi{}.hist.$Y-$M-$D_$\nS.nc\"'.format(casename, inst_string))\n            lines.append('        filename_interval=\"00-01-00_00:00:00\"')\n            lines.append('        clobber_mode=\"truncate\"')\n            lines.append('        reference_time=\"01-01-01_00:00:00\"')\n-           lines.append('        output_interval=\"none\"&gt;')\n+           lines.append('        output_interval=\"00-00-01_00:00:00\"&gt;')\n            lines.append('')\n            lines.append('    &lt;stream name=\"mesh\"/&gt;')\n            lines.append('    &lt;var name=\"xtime\"/&gt;')\n            lines.append('    &lt;var name=\"daysSinceStartOfSim\"/&gt;')\n            lines.append('    &lt;var name=\"iceAreaCell\"/&gt;')\n            lines.append('    &lt;var name=\"iceVolumeCell\"/&gt;')\n            lines.append('    &lt;var name=\"snowVolumeCell\"/&gt;')\n+           lines.append('    &lt;var name=\"iceThicknessCell\"/&gt;')\n            lines.append('    &lt;var name=\"uVelocityGeo\"/&gt;')\n            lines.append('    &lt;var name=\"vVelocityGeo\"/&gt;')\n            lines.append('')\n            lines.append('&lt;/stream&gt;')\n</code></pre> <p>Build and run baseline case for 5 years (60 months):</p> <pre><code>./E3SM-Polar-Developer.sh -s qcbaseline -k qcbase.nlk -e -d60 -nb\n./E3SM-Polar-Developer.sh -s qcbaseline -k qcbase.nlk -e -d60 -q\n</code></pre> <p>Copy the thickness analysis member changes into your development directory:</p> <pre><code>cd ~/E3SM-Polar/code/newdev01/components/mpas-seaice/cime_config/\ncp ~/E3SM-Polar/code/qcbaseline/components/mpas-seaice/cime_config/buildnml .\n</code></pre> <p>If your development case adds namelist parameters, add the thickness analysis member to your .nlk file as above. This example uses the default configuration.</p> <p>Build and run the development case:</p> <pre><code>cd ~/SimulationScripts/archive/PolarGroup/\n./E3SM-Polar-Developer.sh -s newdev01 -k qcbase.nlk -e -d60 -nb\n./E3SM-Polar-Developer.sh -s newdev01 -k qcbase.nlk -e -d60 -q\n</code></pre>"},{"location":"MPAS-seaice/dev-guide/#run-qc-comparison","title":"Run QC comparison","text":"<pre><code>cd ~/E3SM-Polar/code/newdev01/components/mpas-seaice/testing/cice-qc\n</code></pre> <p>See README.md.  This example is for anvil.</p> <p>Edit <code>job_script.cice-qc.anvil</code> to export (insert your username)</p> <pre><code>BASE = /lcrc/group/e3sm/[username]/E3SM-Polar/D12.qcbase.emc.qcbaseline.master.E3SM-Project.anvil/run.k000/\nTEST = /lcrc/group/e3sm/[username]/E3SM-Polar/D12.qcbase.emc.newdev01.branch.E3SM-Project.anvil/run.k000\n</code></pre> <p>Submit QC test. Test results will be in the file <code>qc_log.txt</code>.</p> <pre><code>sbatch job_script.qc-testing-mpassi.anvil\nless qc_log.txt\n</code></pre> <p>Example of desired result:</p> <pre><code>Running QC test on the following directories:\n  /lcrc/group/e3sm/ac.eclare/E3SM-Polar/D12.qcbase.emc.qcbaseline.master.E3SM-Project.anvil/run.k000/\n  /lcrc/group/e3sm/ac.eclare/E3SM-Polar/D12.qcbase.emc.newdev01.branch.E3SM-Project.anvil/run.k000\nNumber of files: 61\n2 Stage Test Passed\nQuadratic Skill Test Passed for Northern Hemisphere\nQuadratic Skill Test Passed for Southern Hemisphere\n</code></pre>"},{"location":"MPAS-seaice/dev-guide/#generate-statistics-from-the-cice-qc-runs","title":"Generate statistics from the CICE-QC runs","text":"<p>This only works if the .nlk filename is the same for both cases.  If comparing only namelist changes within MPAS-seaice, use the <code>./E3SM-Polar-Developer.sh</code> script with a single .nlk file that includes each option.</p> <pre><code>cd ~/SimulationScripts/archive/PolarGroup/\n$ ./E3SM-Polar-Developer.sh -s qcbaseline -k qcbase.nlk -e -d60 -a D12.qcbase.emc.newdev01.branch.E3SM-Project.anvil -v\n</code></pre>"},{"location":"MPAS-seaice/dev-guide/#create-comparison-plots","title":"Create comparison plots","text":"<p>To generate MPAS-Analysis plots from the CICE-QC runs and compare:</p> <p>Copy the scripts in the file MPAS-Analysis_scripts.zip to anvil or chrysalis.</p> <p>Edit each script for your run names, directories, etc (search for 'echmod' to find settings used for a QC comparison)</p> <p>Edit and submit (on chrysalis) the job script 3 times, once for icepack, once for column, and finally for the comparison.</p> <p>Browse the html output by navigating to the location indicated by <code>htmlSubdirectory</code> in the comparison script, e.g. <code>https://web.lcrc.anl.gov/public/e3sm/diagnostic_output/ac.eclare/icepack-testing/D12.qcPR19.emc.qcPR19.snicar_active.eclare108213.anvil/mpas_analysis_output/</code></p>"},{"location":"MPAS-seaice/tech-guide/","title":"Technical Guide","text":""},{"location":"MPAS-seaice/tech-guide/#primary-documentation-for-mpas-seaice","title":"Primary documentation for MPAS-seaice","text":"<p>See complete citations in References.</p> <p>E3SM v1 Overview: Golaz et al., JAMES 2019</p> <p>MPAS-seaice v1: Turner et al., GMD Discussions, 2021.</p> <p>E3SM v2 Overview: Golaz et al., JAMES 2022</p> <p>Icepack: Full documentation for E3SM's version of Icepack can be found in E3SM's Icepack readthedocs.  The most up-to-date documentation from the CICE Consortium's main Icepack repository is here.</p> <p>A comprehensive paper describing MPAS-seaice is in preparation.</p>"},{"location":"MPAS-seaice/tech-guide/#meshes","title":"Meshes","text":"<p>MPAS-Seaice is the sea ice component of E3SMv1. MPAS-Seaice and MPAS-Ocean share identical meshes, but MPAS-Seaice uses B-grid discretizations (Arakawa &amp; Lamb, 1977) with sea ice concentration, volume, and tracers defined at cell centers and velocity defined at cell vertices.</p> <p>The MPAS mesh system requires the definition of seven elements.  These seven elements are composed of two types of cells, two types of lines, and three types of points.  These elements can be defined on either the plane or the surface of the sphere.  The two types of cells form two meshes, a primal mesh composed of Voronoi regions and a dual mesh composed of Delaunay triangles.  Each corner of a primal mesh cell is uniquely associated with the \"center\" of a dual mesh cell and vice versa. The boundary of a given primal mesh cell is composed of the set of lines that connect the centers of the dual mesh cells.  Similarly, the boundary of a given dual mesh cell is composed of the set of lines that connect the center points of the associated primal mesh cells. A line segment that connects two primal mesh cell centers is uniquely associated with a line seqment that connects two dual mesh cell centers.  We assume that these two line seqments cross and are orthogonal.  Since the two line seqments crossing are othogonal, they form a convenient local coordinate system for each edge.  Figure: Sample from an MPAS mesh showing the primal mesh (solid lines), the dual mesh (dashed), and velocity components aligned with a locally Cartesian coordinate system (east/north).</p>"},{"location":"MPAS-seaice/tech-guide/#velocity-and-stresses","title":"Velocity and Stresses","text":"<p>Velocity components at cell vertices are not aligned with the mesh, as in sea ice models with structured meshes and quadrilateral cells. Instead, the velocity components are aligned with a spherical coordinate system that is locally Cartesian, eastwards (u) and northwards (v), irrespective of the orientation of edges joining that vertex. Such a definition, however, would result in a convergence of v components at the geographic North Pole and strong metric terms in the velocity solution. Consequently, in addition, these definitions of u and v are rotated so that their pole lies on the geographical equator at 0 deg longitude.</p> <p>Velocities are determined by solving the sea ice momentum equation (Hibler, 1979; Hunke &amp; Dukowicz, 1997). During coupled simulations the ocean model provides the ocean surface tilt term; the only other term that depends on the properties of the horizontal grid is the divergence of internal stress.  Therefore only this stress term must be adapted for use on MPAS meshes.  Otherwise the velocity solver is identical to that in CICE\u2019s standard EVP approach. Determination of the divergence of the internal stress can be broken down into three stages:</p> <ol> <li> <p>The strain rate tensor is determined from the velocity field.</p> </li> <li> <p>The stress tensor at a point is determined, through a constitutive relation, from the strain rate tensor at that point.</p> </li> <li> <p>The divergence of this stress tensor is calculated.</p> </li> </ol> <p>Two schemes to calculate the strain rate tensor and the divergence of internal stress on MPAS meshes are implemented in MPAS-Seaice, a variational scheme based on that used in CICE (Hunke and Dukowicz, 2002), and a weak scheme that uses the line integral forms of the symmetric gradient and divergence operators. The variational scheme is based on the fact that over the entire domain, \u03a9, and ignoring boundary effects, the total work done by the internal stress is equal to the dissipation of mechanical energy. Instead of the bilinear basis functions used by CICE, MPAS-Seaice uses Wachspress basis functions (Dasgupta, 2003), which are integrated with the quadrature rules of Dunavant (1985).</p>"},{"location":"MPAS-seaice/tech-guide/#horizontal-transport-of-ice-area-fraction-and-tracers","title":"Horizontal Transport of Ice Area Fraction and Tracers","text":"<p>Horizontal transport of ice concentration, volume, and tracers is achieved with an incremental remapping (IR) scheme similar to that described in Dukowicz and Baumgardner (2000), Lipscomb and Hunke (2004), and Lipscomb and Ringler (2005).  For MPAS-Seaice the IR scheme was generalized to work on either the standard MPAS mesh (hexagons and other n-gons of varying sizes, with a vertex degree of 3, or a quadrilateral mesh with a vertex degree of 4 as in CICE. Since MPAS meshes are unstructured, the IR scheme had to be rewritten from scratch. Most of the code is mesh-agnostic, but a small amount of code is specific to quad meshes. The transport equations describe conservation of quantities such as volume and energy.  Fractional ice area (also known as sea ice concentration) is a mass-like quantity whose transport equation forms the basis for all other transported quantities in the model.  In particular, ice volume is the product of ice area and thickness; therefore thickness is treated as a tracer on ice area, transported with the continuity equation for conservation of volume. Likewise, snow depth is carried as a tracer on ice area via a conservation of snow volume equation.  Ice thickness and snow depth are referred to as \u201ctype 1\u201d tracers (carried directly on ice area). Ice and snow enthalpy in each vertical layer are type 2 tracers, carried on ice and snow volume. When run with advanced options (e.g., active melt ponds and biogeochemistry), MPAS-Seaice advects tracers up to type 3. Thus, the mass-like field (area) is the \u201cparent field\u201d for type 1 tracers; type 1 tracers are parents of type 2; and type 2 tracers are parents of type 3.  Sources and sinks of mass and tracers (e.g., ice growth and melting) are treated separately from transport.</p> <p>The transport time step is limited by the requirement that trajectories projected backward from vertices are confined to the cells sharing the vertex (i.e., 3 cells for the standard MPAS mesh and 4 for the quad mesh). This is what is meant by incremental as opposed to general remapping. For highly divergent velocity fields, the maximum time step may have to be reduced by a factor of 2 to ensure that trajectories do not cross. The incremental remapping algorithm consists of the following steps:</p> <ol> <li>Given mean values of the ice area and tracer fields in each grid cell and thickness category, construct linear approximations of these fields. Limit the field gradients to preserve mono- tonicity.</li> <li>Given ice velocities at grid cell vertices, identify departure regions for the transport across each cell edge. Divide these departure regions into triangles and compute the coordinates of the triangle vertices.</li> <li>Integrate the area and tracer fields over the departure triangles to obtain the area, volume, and other conserved quantities transported across each cell edge.</li> <li>Given these transports, update the area and tracers.</li> </ol> <p>Since all fields are transported by the same velocity field, the second step is done only once per time step. The other steps are repeated for each field.</p> <p>With advanced physics and biogeochemistry (BGC) options, MPAS-Seaice can be configured to include numerous tracer fields, each of which is advected in every thickness category, and many of which are defined in each vertical ice or snow layer. In order to accommodate different tracer combinations and make it easy to add new tracers, the tracer fields are organized in a linked list that depends on which physics and BGC packages are active. The list is arranged with fractional ice area first, followed by the type 1 tracers, type 2 tracers, and finally type 3 tracers. In this way, values computed for parent tracers are always available when needed for computations involving child tracers.</p>"},{"location":"MPAS-seaice/tech-guide/#column-physics","title":"Column Physics","text":"<p>Because of the strong thermal gradients between the (cold) atmosphere and (relatively warm) oceans in polar regions, a large portion of the physics in sea ice models can be described in a vertical column, without reference to neighboring grid cells. MPAS-Seaice shares the same column physics code as CICE through the Icepack library (Hunke et al., 2018), which is maintained by the CICE Consortium. This code includes several options for simulating sea ice thermodynamics, mechanical redistribution (ridging) and associated area and thickness changes. In addition, the model supports a number of tracers, including thickness, enthalpy, ice age, first-year ice area, deformed ice area and volume, melt ponds, snow properties and biogeochemistry.</p> <p>Icepack is implemented in MPAS-seaice as a git submodule. Icepack consists of three independent parts, the column physics code, the Icepack driver that supports stand-alone testing of the column physics code, and the Icepack scripts that build and test the Icepack model.  E3SM uses only the column physics code, which is called for each ocean grid cell.  Icepack\u2019s own driver and testing scripts are used when preparing new developments to be merged back to the CICE Consortium\u2019s Icepack repository.</p> <p>Icepack includes sophisticated vertical physics and biogeochemical schemes, which include vertical thermodynamics schemes (Bitz and Lipscomb, 1999; Turner et al., 2013; Turner and Hunke, 2015), melt-pond parameterizations (Flocco et al., 2010; Hunke et al., 2013), a delta-Eddington radiation scheme (Briegleb and Light, 2007; Holland et al., 2012a), schemes for transport in thickness space (Lipscomb, 2001), and representations of mechanical redistribution (Lipscomb et al., 2007).</p> <p>Full documentation for E3SM's version of Icepack can be found in E3SM's Icepack readthedocs.  The most up-to-date documentation from the CICE Consortium's main Icepack repository is here.</p>"},{"location":"MPAS-seaice/tech-guide/#thermodynamics","title":"Thermodynamics","text":"<p>In its default configuration, MPAS-Seaice uses the \u201cmushy layer\u201d vertical thermodynamics scheme of Turner et al. (2013) and Turner and Hunke (2015).  The mushy layer formulation describes the sea ice as a two-phase system of crystalline, fresh ice and liquid brine. Enthalpy depends on temperature and salinity, all of which are prognostic variables.  The mushy layer equations are derived from conservation of energy, conservation of salt, an ice-brine liquidus relation that determines the temperature- and salinity-dependent phase, and Darcy flow through a porous medium to describe the vertical movement of brine within the ice.  When or where the ice is cold, brine pockets are isolated from each other, but warmer temperatures cause the brine pockets to expand and connect into vertical channels in which meltwater, seawater, biology and nutrients may move through the ice.</p>"},{"location":"MPAS-seaice/tech-guide/#melt-ponds","title":"Melt Ponds","text":"<p>MPAS-seaice uses the level-ice melt pond scheme of Hunke et al. (2013). The ponds are carried as tracers on the level (undeformed) ice area of each thickness category, thus limiting their spatial extent based on the simulated sea ice topography. This limiting is meant to approximate the horizontal drainage of melt water into depressions in ice floes. The ponds evolve according to physically based process descriptions, assuming a thickness-area ratio for changes in pond volume. Melt pond processes include addition of liquid water from rain, melting snow and melting surface ice, drainage of pond water when its weight pushes the ice surface below sea level or when the ice interior becomes permeable, and refreezing of the pond water. If snow falls after a layer of ice has formed on the ponds, the snow may block sunlight from reaching the ponds below. When melt water forms with snow still on the ice, the water is assumed to infiltrate the snow. If there is enough water to fill the air spaces within the snowpack, then the pond becomes visible above the snow, thus decreasing the albedo and ultimately causing the snow to melt faster. The albedo also decreases as snow depth decreases, and thus a thin layer of snow remaining above a pond-saturated layer of snow will have a lower albedo than if the melt water were not present. Level-ice melt ponds are \u201cvirtual\u201d in the sense that rain and meltwater is sent to the ocean immediately, and the tracers are only used thereafter to adjust the radiative calculations as if the ponds were present.  The delta-Eddington radiative transfer scheme must be active for this purpose.</p>"},{"location":"MPAS-seaice/tech-guide/#radiation","title":"Radiation","text":"<p>The Delta-Eddington radiation scheme of Briegleb &amp; Light (2007) has been updated to the Dang et al. (2019) SNICAR-AD model, to ensure radiative consistency across all snow surfaces in E3SM, including on land, ice sheets and sea ice. The SNICAR-AD radiative transfer code includes five-band snow single-scattering properties, two-stream Delta-Eddington approximation with the adding\u2013doubling technique, and parameterization for correcting the near-infrared (NIR) snow albedo biases when solar zenith angle exceeds 75 degrees (Dang et al., 2019).</p>"},{"location":"MPAS-seaice/tech-guide/#snow","title":"Snow","text":"<p>A new snow-on-sea-ice morphology has been added to E3SMv2 that includes the effects of wind redistribution: losses to leads and meltponds, and the piling of snow against ridges. Snow grain radius, now a prognosed tracer field on sea ice, evolves according to temperature gradient and wet snow metamorphism and feeds back to the SNICAR-AD radiative model up to a dry maximum of 2800 \u03bcm. Fresh snow falls at a grain radius of 54.5 \u03bcm, and five vertical snow layers replace the previous single snow layer atop each of the five sea ice thickness categories retained from E3SMv1.</p> <p>A paper describing the advanced snow physics is in preparation.</p>"},{"location":"MPAS-seaice/tech-guide/#biogeochemistry","title":"Biogeochemistry","text":"<p>Icepack incorporates a comprehensive biogeochemistry component that includes two aerosol options, water isotopes, and a full suite of vertically resolved biogeochemical tracers.  The complexity of the ecosystem can be specified in Icepack\u2019s configuration settings and namelist flags. The biogeochemistry component is thoroughly documented in the Icepack documentation linked above.</p>"},{"location":"MPAS-seaice/tech-guide/#coupling-of-mpas-seaice-within-e3sm","title":"Coupling of MPAS-seaice within E3SM","text":"<p>This description is taken from the v1 overview paper (Golaz et al. 2019).  Refer to that paper for further information.  Coupling of the sea ice component to the ocean takes advantage of z star ocean coordinates and is a departure from the coupling of CICE and POP (Parallel Ocean Program) in CESM1. The weight of sea ice contributes to the ocean's barotropic mode, notably affecting the free surface over continental shelves. In shallow water depths at or less than the floating ice draft, the weight passed to the ocean model is limited to prevent evacuation of the underlying liquid column. When frazil ice forms in the ocean model, the volume of newly formed crystals is passed to the sea ice model with a fixed salinity of 4 PSU, rather than exchanging a freezing potential as in other models. Future versions of E3SM will permit progressive brine drainage to the ocean from the mushy layer physics used in MPAS-Seaice. For E3SMv1, brine drainage occurs internally in MPAS-Seaice for thermodynamic calculations, but for the sake of freshwater coupling, the ocean model only receives mass fluxes back from melted sea ice at the fixed salinity that it originally passed to its cryospheric counterpart (4 PSU). The ocean temperature immediately under the ice is the same as the liquid phase in the lowest layer of the sea ice model and is not fixed at \u22121.8 \u25e6C as is typical of previous generation coupled models. For the current version, we have addressed these long-standing ocean-ice coupling issues identified by the modeling community: explicit sea ice mass and salt exchange, a pressure force of the ice on the ocean, a basal sea ice temperature consistent with the ocean model's equation of state, and resolved inertial oscillations.</p> <p>This paragraph, taken from the v2 overview paper (Golaz et al. 2022), describes changes since v1.  The most significant improvement to the sea ice climate since E3SMv1 was achieved with coupling changes associated with mushy-layer thermodynamics. Whereas the basal temperature of the ice was held fixed at -1.8\u25e6C in E3SMv1, the new version of the model assumes the mushy liquidus basal temperature from the sea ice as described by Turner\u00a0&amp; Hunke (2015). Conversion of frazil ice from MPAS-Ocean with a fixed reference salinity of 4 PSU to the mushy layer now conserves to computational accuracy over a 500-year control integration. This was achieved by exchanging additional mass between the upper ocean and sea ice model to accommodate an assumed 25% mushy liquid content, assumed from heat and mass transferred adiabatically from the MPAS-Ocean frazil scheme active from a depth of 100 m. In addition to achieving perfect heat and mass conservation between sea ice and ocean models, this improvement greatly reduces a negative sea ice thickness bias in the summer Arctic reported by Golaz et al. (2019) for E3SMv1; it only minimally impacts Southern Ocean sea ice mass that was better simulated as compared to northern hemisphere sea ice in E3SMv1. Note that E3SM does not use virtual ice-ocean fluxes, but instead full mass and heat flux exchange consistent with a Boussinesq ocean model. Radiative coupling with the atmosphere still integrates across just two bands (visible and NIR) separated at 700nm, which does not fully exploit the five-band capability available in the delta-Eddington scheme.</p>"},{"location":"MPAS-seaice/tech-guide/#prescribed-ice-mode","title":"Prescribed Ice Mode","text":"<p>E3SM also includes a prescribed-extent ice mode for MPAS-SeaIce based the CESM implementation. This mode is needed for Atmospheric Model Intercomparison Project (AMIP) style simulations where a full prognostic sea ice model is not desired but sea ice surface fluxes, albedos, snow depth, and surface temperature are needed by the atmosphere model. These fields are calculated by the vertical thermodynamics module of the sea ice component. The prescribed-ice mode is intended for atmosphere sensitivity experiments and does not conserve energy or mass. In this mode, sea ice thermodynamics is active but sea ice dynamics are disabled, and at each time step ice area and thickness are reset to specified values. Ice area is interpolated in time and space from an input data set, while ice thickness in grid cells containing sea ice is set to 2 m in the Northern hemisphere and 1 m in the Southern hemisphere. During each area and thickness adjustment, snow volume preserves the snow thickness prognosed in the previous time step. Snow temperatures are reset to the surface temperature, as prognosed in the previous time step, while ice temperatures are set so that the ice temperature gradient is linear, with the ice temperature at the top equal to the prognosed surface temperature, and equal to the sea freezing temperature at the base of the ice. The vertical ice salinity profile is reset to the profile from Bitz &amp; Lipscomb (1999). The prescribed-ice mode implemented in MPAS-SeaIce can now replace that in CICE in such configurations, but CICE continues to be used for those requiring exceptional computational efficiency.</p>"},{"location":"MPAS-seaice/user-guide/","title":"User's Guide","text":"<p>Guidance for using E3SM is available from E3SM's public web site.</p>"},{"location":"MPAS-seaice/user-guide/#configuring-mpas-seaice","title":"Configuring MPAS-seaice","text":"<p>MPAS-seaice is controlled using namelist options.</p> <ul> <li>Default namelist values are found in <code>E3SM/components/mpas-seaice/bld/namelist_files/namelist_defaults_mpassi.xml</code>.</li> <li>Namelist options are defined in <code>E3SM/components/mpas-seaice/bld/namelist_files/namelist_definitions_mpassi.xml</code>, including type, category (<code>seaice_model</code>), group, valid values and a brief description. Each namelist variable is defined in an <code>entry</code> element.  The content of the element is the documentation of how the variable is used.  Other aspects of the variable's definition are expressed as attributes of the <code>entry</code> element.</li> <li>Users can change namelist options from defaults by entering <code>[namelist option] = [changed value]</code> as separate lines in the <code>user_nl_mpassi</code> file in the case directory.</li> <li>Some namelist values or combinations are not allowed and will generate warnings and often abort the code.  The consistency checks for using MPAS-seaice within E3SM are in <code>mpas_seaice_initialize</code> (subroutines <code>seaice_check_configs_coupled</code>, <code>seaice_check_constants_coupled</code>), and those specific to Icepack can be found in subroutine <code>check_column_package_configs</code> in <code>mpas_seaice_icepack.F</code>.</li> </ul> <p>Related namelist variables are grouped according to their application.</p> Namelist Groups Relevant application <code>seaice_model</code> general options <code>io</code> input/output <code>decomposition</code> mesh parallelization <code>restart</code> restarting the code <code>dimensions</code> column physics dimensions (layers, categories) <code>initialize</code> initialization <code>use_sections</code> turn entire parameterizations on and off <code>forcing</code> forcing for standalone configurations <code>velocity_solver</code> algorithms for solving the dynamics (velocity and stress) equations <code>advection</code> advection <code>column_package</code> general column package software configurations <code>biogeochemistry</code> biogeochemistry <code>shortwave</code> radiation <code>snow</code> advanced snow physics <code>meltponds</code> melt pond parameterization flags and parameters <code>thermodynamics</code> basic thermodynamics <code>itd</code> ice thickness distribution <code>floesize</code> floe size distribution <code>ridging</code> mechanical redistribution <code>atmosphere</code> atmospheric boundary layer and coupling <code>ocean</code> oceanic boundary layer and coupling <code>diagnostics</code> diagnostic output <code>prescribed_ice</code> for testing atmosphere simulations"},{"location":"MPAS-seaice/user-guide/#icepack","title":"Icepack","text":"<p>Full documentation for E3SM's version of Icepack can be found in E3SM's Icepack readthedocs.  The most up-to-date documentation from the CICE Consortium's main Icepack repository is here.</p> <p>The MPAS-seaice driver for Icepack is</p> <p><code>E3SM/components/mpas-seaice/src/shared/mpas_seaice_icepack.f</code></p> <p>and the mapping between the names of Icepack's namelist options and those in MPAS-seaice can be found in subroutine <code>init_icepack_package_configs</code> (see the argument list for calls to subroutine <code>icepack_init_parameters</code> and comments at the end of <code>init_icepack_package_configs</code>.</p>"},{"location":"MPAS-seaice/user-guide/#configuring-model-input-and-output","title":"Configuring Model Input and Output","text":"<p>The reading and writing of model fields in MPAS is handled by user-configurable streams. A stream represents a fixed set of model fields, together with dimensions and attributes, that are all written or read together to or from the same file or set of files. Besides these default streams, users may define new streams to, e.g., write certain diagnostic fields at a higher temporal frequency than the usual model history fields.</p> <p>Streams are defined in XML configuration files that are created at build time for each model core. The name of this XML file is simply \u2018streams.\u2019 suffixed with the name of the core. For example, the streams for the sea-ice core are defined in a file named \u2018streams.seaice\u2019. An XML stream file may further reference other text files that contain lists of the model fields that are read or written in each of the streams defined in the XML stream file.</p> <p>The stream file can be modified by copying the <code>streams.seaice</code> file (generated during <code>./case.setup</code>) from the run directory to the case directory under <code>SourceMods/src.mpassi/</code>, and making changes to the stream file there. Changes to the stream file will take effect on the next case submission. Alternatively, changes to the streams file can be made directly in the code in <code>components/mpas-seaice/cime_config/buildnml</code>.</p> <p>Two classes of streams exist in MPAS: immutable streams and mutable streams. Immutable streams are those for which the set of fields that belong to the stream may not be modified at model run-time; however, it is possible to modify the interval at which the stream is read or written, the filename template describing the files containing the stream on disk, and several other parameters of the stream. In contrast, all aspects of mutable streams, including the set of fields that belong to the stream, may be modified at run-time. The motivation for the creation of two stream classes is the idea that an MPAS core may not function correctly if certain fields are not read in upon model start-up or written to restart files, and it is therefore not reasonable for users to modify this set of required fields at run-time. An MPAS core developer may choose to implement such streams as immutable streams. Since fields may not be added to an immutable stream at run-time, new immutable streams may not be defined at run-time, and the only type of new stream that may be defined at run-time is the mutable stream type.</p>"},{"location":"dev-guide/","title":"Development Guide","text":"<p>Development of E3SM is carefully planned and tied to goals in the proposals that fund work on E3SM.</p>"},{"location":"dev-guide/#code-development","title":"Code development","text":"<p>Most code development occurs within one component and developers should consult the relevant component's development guide.</p> <p>More information on code development.</p> <ul> <li>Development Big Picture</li> <li>Getting Started</li> <li>Development Reference</li> </ul>"},{"location":"dev-guide/#creating-new-input","title":"Creating new input","text":"<p>E3SM's public input data directory contains initial and boundary conditions for many cases. Creating new initial or boundary conditions typically starts with creating a new grid.</p> <ul> <li>Adding Support for New Grids</li> </ul>"},{"location":"dev-guide/adding-grid-support/","title":"Adding Support for New Grids","text":"<ul> <li>Atmosphere Grid Overview                 </li> <li>Grid Description File Overview           </li> <li>Step-by-Step Guide to Support a New Grid </li> </ul>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-grid-types/","title":"Types of Grid Description Files","text":"<ul> <li> <p>Exodus file: ex. \"ne4.g\".   This is a netcdf file following Exodus conventions.  It gives the corner locations of all elements on the sphere and their connectivity.  It is independent of the polynomial order used inside the element (\"np\").  This file is used by TempestRemap (TR) to generate mapping files.  The polynomial order is a command line option and the GLL nodes are internally generated by TR.  </p> </li> <li> <p>SCRIP file:  ex. \"ne4pg2.scrip.nc\".   This file contains a description of the atmosphere physics grid in the format used by the original incremental remap tool SCRIP.  It is used for most output and also used to generate mapping files between components and for post-processing of most output.</p> </li> </ul> <p>Less common \u201cGLL\u201d metadata files needed for specialized purposes:</p> <ul> <li> <p>\"dual grid\" SCRIP file:  ex. \"ne4np4_scrip.nc\".   This file contains a SCRIP format description of the GLL grid.  It includes the locations of the GLL nodes and artificial bounding polygons around those nodes.   Ideally the spherical area of each polygon will match the GLL weight (\"exact GLL areas\"), but not all tools can achieve exact areas.  Inexact areas does not impact the accuracy of the resulting mapping algorithm, it just means that mass will not be exactly conserved by the mapping algorithm. These files are often problematic to generate, so it is advised to avoid using workflows that require this. This was previously needed in E3SMv2 configurations by the cube_to_target topography dataset generation tool, but effort has been made to eliminate this requirement. It was also historically used in E3SMv1 to create ocean/atm mapping files (exact GLL areas was important here to conserve fluxes).</p> </li> <li> <p>\"latlon\" file: ex. \"ne4np4_latlon.nc\".   This file contains a list of all the GLL nodes in the mesh (in latitude/longitude coordinates).   The list of GLL nodes must be in the the internal HOMME global id ordering, matching the ordering used in EAM GLL grid output.   It also contains the connectivity of the GLL subcell grid. This file is no longer needed for any E3SM workflow.</p> </li> <li> <p>\"pentagons\" file: ex. \"ne30np4_pentagons.nc\". These files represent a mostly outdated approach of dealing with data on the np4 grid. While the np4 grid provides a spectral element representation of data with weights on GLL nodes, the term \"dual grid\" refers to a finite volume approximation of the same data by constructing polygons around each GLL node such that the cell area matches the weight of each node. The word \"pentagons\" was used because that is the most number of sides used by the polygons. These files are increasingly difficult to generate as the global resolution becomes finer because the polygon construction is a costly iterative process. Some tools to generate these files were either the NCL code <code>HOMME2SCRIP.ncl</code> or the matlab code <code>dualgridgenerate.m</code>. These types of files are no longer needed for any E3SM workflow, although some of these files can still be found in the E3SM data repository.</p> </li> </ul>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/","title":"Adding Support for New Grids","text":"<p>The purpose of this guide is to outline all the necessary steps for running E3SM on a new grid for the atmosphere and land components. The process is similar for uniform and regionally refined grids, although regionally refined cases will likely require some special considerations which will be noted where appropriate.</p> <p>If you wish to add a new ocean and sea-ice mesh you will need to use the compass tool to generate the mesh and dynamically adjusted initial condition. This procedure is detailed in a separate tutorial: https://mpas-dev.github.io/compass/latest/tutorials/dev_add_rrm.html</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/#step-by-step-guide","title":"Step-by-Step Guide","text":"<ol> <li>Generate a new grid<ol> <li>Generate a uniform grid file                       </li> <li>Generate a RRM grid file                           </li> </ol> </li> <li>Generate mapping files                                 </li> <li>Generate domain files                                  </li> <li>Generate a topography file                             </li> <li>Generate atmospheric initial condition                 </li> <li>Generate land input data (fsurdat)                   </li> <li>Generate land initial condition (finidat)            </li> <li>Generate a dry deposition file (depends on use case) </li> <li>Add new grid configuration to E3SM                     </li> </ol>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/","title":"Add New Grid Configuration to E3SM","text":"<p>In addition to generating input data to support a new grid, several modifications to XML files are required before E3SM can run with the grid. However, the specific changes will depend on how the grid will be used. The intended model configuration for the new grid will change which files need to be modified. For instance, a grid intended for aquaplanet experiments does not require as many changes as a historical AMIP-style run.</p> <p>The guidelines here are meant to outline various possible changes the user should consider when adding support for a new grid for the land and/or atmosphere. This document cannot be exhaustive, and it is important that the user understands the changes they are making. It is often useful to use a pre-existing grid configuration as a template. Note that the guidelines here are only relevant for \"horizontal\" grids in the atmosphere and/or land. Additional considerations are needed to support a new vertical grid in the atmosphere, which is a topic not currently covered here.</p> <p>When setting up a new grid for the atmosphere and/or land model, you will need to edit some or all of these files:</p> <ul> <li><code>cime_config/config_grids.xml</code></li> <li><code>components/eam/bld/config_files/horiz_grid.xml</code></li> <li><code>components/eam/bld/namelist_files/namelist_defaults_eam.xml</code></li> <li><code>components/eam/bld/namelist_files/namelist_definition.xml</code></li> <li><code>components/elm/bld/namelist_files/namelist_definition.xml</code></li> <li><code>components/elm/bld/namelist_files/namelist_defaults.xml</code></li> </ul>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#mono-grid-vs-bi-grid-vs-tri-grid","title":"Mono-Grid vs Bi-Grid vs Tri-Grid","text":"<p>The mono-bi-tri grid options in E3SM can be confusing, but it is important to understand what these terms mean when adding a new grid to E3SM. At the surface these terms mean that the whole model is either using a single grid for all componennt models, or a combination of 2 or 3 grids shared among the component models. Note that mono-grid and bi-grid terms often ignore that the river model needs to be on its own regular lat-lon grid.</p> <p>In practice, \"bi\" and \"tri\" grids are most commonly used and the main difference between them comes down to whether the land surface model shares a grid with the atmosphere or not. The component coupler is responsible for facilitating communication between component models, primarily through fluxes, and so mapping files are needed to support a combination of different grids. E3SMv3 uses a tri-grid configuration for production simulations.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#grid-naming-conventions","title":"Grid Naming Conventions","text":""},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#atmosphere","title":"Atmosphere","text":"<p>The atmosphere grid name should always indicate the base \"ne\" value and whether the physgrid is being used, usually by adding \".pg2\" at the end. For a regionally refined mesh (RRM) the grid name should always start with <code>ne0</code> followed a descriptive string that includes the region being refined and the degree of refinement.</p> <p>Example: <code>ne0np4_northamerica_30x4v1.pg2</code></p> <p>Note that this example differs from how the North American grid is currently named as <code>ne0np4_northamericax4v1.pg2</code>, which indicates a <code>4x</code> refinement, but does not indicate the base resolution, which is useful to know. The more informative grid name <code>ne0np4_northamerica_30x4v1.pg2</code> makes it clear that  unrefined regions are consistent with <code>ne30pg2</code>.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#river-or-land-in-tri-grid","title":"River (or Land in tri-grid)","text":"<p>For a rectilinear lat-lon grid used by the land and/or river models the grid name should start with \"r\" and typically use spacing less than one degree, so they indicate the nominal grid spacing, starting with \"0\" and omitting the decimal.</p> <p>Examples: <code>r05</code> is 0.5 degree spacing and <code>r0125</code> is 1/8 or 0.125 degree spacing.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#grid-aliases","title":"Grid Aliases","text":"<p>Grid aliases are short strings used to represent the complete set of grids used in the model configuration. For a mono-grid the convention is that the grid alias is the base mesh written twice to indicate that both atmosphere/land and ocean/sea-ice models are on the same grid. A mono-grid is typically only used for idealized simulations such as aqua planet and RCE, but can also be used for F-compsets if the CICE sea-ice model is used in place of the MPAS sea-ice model (MPASSI).</p> <p>Example: <code>ne30pg2_ne30pg2</code></p> <p>Bi-grid options should indicate two different grids used for atmosphere/land and ocean/sea-ice models.</p> <p>Example: <code>ne30pg2_IcoswISC30E3r5</code></p> <p>Tri-grid options should indicate three different grids used for atmosphere, land, and ocean/sea-ice models, with the land grid appearing in the middle.</p> <p>Example: <code>ne30pg2_r05_IcoswISC30E3r5</code></p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#grid-longnames","title":"Grid longnames","text":"<p>For any combination of grids, the full grid definition has a long form representation that spells out the grid in more detail.</p> <p>Example:</p> <pre><code>  alias: ne4pg2_ne4pg2\n\n  longname: a%ne4np4.pg2_l%ne4np4.pg2_oi%ne4np4.pg2_r%r05_g%null_w%null_z%null_m%oQU240\n  non-default grids are: atm:ne4np4.pg2  lnd:ne4np4.pg2  ocnice:ne4np4.pg2  rof:r05  glc:null  wav:null  \n  mask is: oQU240\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#defining-a-new-atmosphere-grid-for-eam","title":"Defining a New Atmosphere Grid for EAM","text":"<p>When defining a new atmosphere grid, information needs to be provided on how the grid is constructed.</p> <p>To define a new atmosphere grid a line must be added to <code>components/eam/bld/config_files/horiz_grid.xml</code> that indicates the number of elements and physics columns. In the lines below for <code>ne30np4</code> (without the physgrid) and <code>ne30pg2</code> (with the physgrid) you can see the value of <code>ne</code> is the same (number of elements along a cube edge), but the number of physics columns is different.</p> <pre><code>&lt;horiz_grid dyn=\"se\"    hgrid=\"ne30np4\"      ncol=\"48602\"   csne=\"30\"  csnp=\"4\" npg=\"0\" /&gt;\n&lt;horiz_grid dyn=\"se\"    hgrid=\"ne30np4.pg2\"  ncol=\"21600\"   csne=\"30\"  csnp=\"4\" npg=\"2\" /&gt;\n</code></pre> <p>An explanation of how to calculate the number of physics columns can be found here: Atmosphere Grid Overview.</p> <p>For a grid with regional refinement, follow the conventions of other grids in this file. There is no formula to calculate the number of columns for RRM grids, but the value can be obtained from the grid files used for mapping.</p> <pre><code>&lt;horiz_grid dyn=\"se\" hgrid=\"ne0np4_antarcticax4v1.pg2\"        ncol=\"48836\"  csne=\"0\" csnp=\"4\" npg=\"2\" /&gt;\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#defining-a-new-land-grid-for-elm","title":"Defining a New Land Grid for ELM","text":"<p>If you are creating a new grid that will be used by the land model the grid name needs to be added to the list <code>valid_values</code> associated with the <code>res</code> entry in the file <code>components/elm/bld/namelist_files/namelist_definition.xml</code> that holds the definition of namelist variables used by the land model.</p> <pre><code>&lt;entry id=\"res\" type=\"char*30\" category=\"default_settings\"\n       group=\"default_settings\"\n       valid_values=\n\"512x1024,360x720cru,128x256,64x128,...\"&gt;\nHorizontal resolutions\nNote: 0.1x0.1, 0.5x0.5, 5x5min, 10x10min, 3x3min and 0.33x0.33 are only used for ELM tools\n&lt;/entry&gt;\n</code></pre> <p>Simply add the name of your new grid to the list of <code>valid_values</code>.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#using-new-grids-in-default-namelists","title":"Using New Grids in Default Namelists","text":"<p>Each new grid will likely need various new default parameter values to be specified. These parameters can be set for individual simulations by editing the <code>user_nl_*</code> files in the case directory, but for these to become defaults any time the grid is used then new defaults need to be specified.</p> <p>The lists below show namelist parameters that may need to be specified for a new grid. The creator of a new grid is responsible for understanding these parameters and deciding when new defaults are appropriate.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#atmosphere-namelist-parameters","title":"Atmosphere Namelist Parameters","text":"<ul> <li><code>drydep_srf_file</code>     - Data file for surface aerosol deposition</li> <li><code>bnd_topo</code>            - Surface topography (smoothed for target grid)</li> <li><code>mesh_file</code>           - HOMME np4 mesh file (exodus format)</li> <li><code>se_tstep</code>            - HOMME time step [seconds]</li> <li><code>dt_remap_factor</code>     - HOMME vertical remap factor</li> <li><code>dt_tracer_factor</code>    - HOMME tracer advection factor</li> <li><code>hypervis_subcycle_q</code> - HOMME tracer hyperviscosity factor</li> </ul>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#land-namelist-parameters","title":"Land Namelist Parameters","text":"<ul> <li><code>fsurdat</code>             - Surface data file</li> <li><code>finidat</code>             - Land model initial condition file</li> <li><code>flanduse_timeseries</code> - Time-evolving land-use data file</li> </ul>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#defining-a-new-grid-for-cime","title":"Defining a new grid for CIME","text":"<p>The CIME Case Control system will configure a case according to the component set and grid alias you specify with the <code>--res</code> argument. As part of that configuration, CIME needs to know how to translate the grid alias and set the paths for domain and mapping files used by the grid so the model can find them at runtime.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#adding-a-new-grid-alias","title":"Adding a New Grid Alias","text":"<p>Grid aliases are defined in <code>cime_config/config_grids.xml</code>. Below is an example grid alias for the <code>ne30pg2_r05_IcoswISC30E3r5</code> grid used in E3SMv3 production simulations.</p> <pre><code>    &lt;model_grid alias=\"ne30pg2_r05_IcoswISC30E3r5\"&gt;\n      &lt;grid name=\"atm\"&gt;ne30np4.pg2&lt;/grid&gt;\n      &lt;grid name=\"lnd\"&gt;r05&lt;/grid&gt;\n      &lt;grid name=\"ocnice\"&gt;IcoswISC30E3r5&lt;/grid&gt;\n      &lt;grid name=\"rof\"&gt;r05&lt;/grid&gt;\n      &lt;grid name=\"glc\"&gt;null&lt;/grid&gt;\n      &lt;grid name=\"wav\"&gt;null&lt;/grid&gt;\n      &lt;mask&gt;IcoswISC30E3r5&lt;/mask&gt;\n    &lt;/model_grid&gt;\n</code></pre> <p>Add a similar block for your new grid.  Aliases must be unique within <code>config_grids.xml</code></p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#domain-files","title":"Domain Files","text":"<p>Domain files are needed for each grid and are specified in the <code>&lt;domains&gt;</code> section of <code>cime_config/config_grids.xml</code>. The default domain files are grouped by the atmosphere grid. The section for the typical <code>ne30pg2</code> grid looks as follows:</p> <pre><code>    &lt;domain name=\"ne30np4.pg2\"&gt;\n      &lt;nx&gt;21600&lt;/nx&gt;\n      &lt;ny&gt;1&lt;/ny&gt;\n      ...\n      &lt;file grid=\"atm|lnd\" mask=\"IcoswISC30E3r5\"&gt;$DIN_LOC_ROOT/share/domains/domain.lnd.ne30pg2_IcoswISC30E3r5.231121.nc&lt;/file&gt;\n      &lt;file grid=\"ice|ocn\" mask=\"IcoswISC30E3r5\"&gt;$DIN_LOC_ROOT/share/domains/domain.ocn.ne30pg2_IcoswISC30E3r5.231121.nc&lt;/file&gt;\n      ...\n      &lt;desc&gt;ne30np4.pg2 is Spectral Elem 1-deg grid w/ 2x2 FV physics grid per element:&lt;/desc&gt;\n    &lt;/domain&gt;\n</code></pre> <p>Notice the ellipses <code>...</code> are used here to omit all entries that are not relevant to the <code>ne30pg2_r05_IcoswISC30E3r5</code> grid. Also, note that all of these paths are relative to the input data path set as <code>DIN_LOC_ROOT</code> which has a default for each machine. See Generating Domain Files for information about creating domain files.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/add-grid-config/#coupler-mapping-files","title":"Coupler Mapping Files","text":"<p>The mapping files used by the component coupler to communicate fluxes between the component models must be specified in the <code>&lt;gridmaps&gt;</code> section of <code>cime_config/config_grids.xml</code>. These are organized for specific pairs of grids, such that tri-grids will require multiple sections. The entries relevant for <code>ne30pg2_r05_IcoswISC30E3r5</code> are shown below.</p> <pre><code>    &lt;gridmap atm_grid=\"ne30np4.pg2\" ocn_grid=\"IcoswISC30E3r5\"&gt;\n      &lt;map name=\"ATM2OCN_FMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_IcoswISC30E3r5_traave.20231121.nc&lt;/map&gt;\n      &lt;map name=\"ATM2OCN_VMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_IcoswISC30E3r5_trbilin.20231121.nc&lt;/map&gt;\n      &lt;map name=\"ATM2OCN_SMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_IcoswISC30E3r5-nomask_trbilin.20231121.nc&lt;/map&gt;\n      &lt;map name=\"OCN2ATM_FMAPNAME\"&gt;cpl/gridmaps/IcoswISC30E3r5/map_IcoswISC30E3r5_to_ne30pg2_traave.20231121.nc&lt;/map&gt;\n      &lt;map name=\"OCN2ATM_SMAPNAME\"&gt;cpl/gridmaps/IcoswISC30E3r5/map_IcoswISC30E3r5_to_ne30pg2_traave.20231121.nc&lt;/map&gt;\n      &lt;map name=\"ATM2ICE_FMAPNAME_NONLINEAR\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_IcoswISC30E3r5_trfvnp2.20231121.nc&lt;/map&gt;\n      &lt;map name=\"ATM2OCN_FMAPNAME_NONLINEAR\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_IcoswISC30E3r5_trfvnp2.20231121.nc&lt;/map&gt;\n    &lt;/gridmap&gt;\n</code></pre> <pre><code>    &lt;gridmap atm_grid=\"ne30np4.pg2\" lnd_grid=\"r05\"&gt;\n      &lt;map name=\"ATM2LND_FMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_r05_traave.20231130.nc&lt;/map&gt;\n      &lt;map name=\"ATM2LND_FMAPNAME_NONLINEAR\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_r05_trfvnp2.230516.nc&lt;/map&gt;\n      &lt;map name=\"ATM2LND_SMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_r05_trbilin.20231130.nc&lt;/map&gt;\n      &lt;map name=\"LND2ATM_FMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_r05_to_ne30pg2_traave.20231130.nc&lt;/map&gt;\n      &lt;map name=\"LND2ATM_SMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_r05_to_ne30pg2_traave.20231130.nc&lt;/map&gt;\n    &lt;/gridmap&gt;\n</code></pre> <pre><code>    &lt;gridmap atm_grid=\"ne30np4.pg2\" rof_grid=\"r05\"&gt;\n      &lt;map name=\"ATM2ROF_FMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_r05_traave.20231130.nc&lt;/map&gt;\n      &lt;map name=\"ATM2ROF_FMAPNAME_NONLINEAR\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_r05_trfvnp2.230516.nc&lt;/map&gt;\n      &lt;map name=\"ATM2ROF_SMAPNAME\"&gt;cpl/gridmaps/ne30pg2/map_ne30pg2_to_r05_trbilin.20231130.nc&lt;/map&gt;\n    &lt;/gridmap&gt;\n</code></pre> <p>Note that all of these paths are relative to the input data path set as <code>DIN_LOC_ROOT</code> which has a default for each machine. Mapping files can be created with the ncremap utility in NCO</p> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/","title":"Generate a RRM Grid File with SQuadGen","text":"<p>There are three ways to create a regionally refined grid file for E3SM using SQuadGen, which are outlined below.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/#using-a-png-image-file","title":"Using a PNG Image File","text":"<p>The most common is to create a grayscale <code>.png</code> image file with the correct aspect ratio that defines one or more refinement areas.</p> <p>The input PNG is a grayscale representation of a regular latitude-longitude grid (i.e. equiangular projection) with the level of shading determining the level of refinement: white for the coarse grid and black where maximum refinement is desired.  Shades of gray can be used to impose intermediate levels of refinement.  To determine the refinement region on the cubed-sphere mesh, each volume on the cubed-sphere grid is sampled from the PNG image to determine the desired level of refinement on that grid.  The transition region is then built around each refinement region using \"paving\" tiles, with optional smoothing of edges.</p> <p>Once the PNG file is created it can be used to generate the new exodus file. The example below creates a 3x refinement based on the ne30 grid that, which it typically used for production runs.</p> <pre><code>./SQuadGen --refine_file ${GRIDNAME}.png --resolution 30 --refine_level 3 --refine_type LOWCONN --smooth_type SPRING --smooth_dist 3 --smooth_iter 20 --output ${DATA_PATH}/${GRIDNAME}.g\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/#creating-the-png-file-with-an-image-editor","title":"Creating the PNG file with an image editor","text":"<p>It is often useful to start with a background image that already has the correct aspect ratio and is centered on 0 degrees longitude. The following PNG image (with base grid ne16) can be used as a template for drawing your refinement region so that grid lines are parallel to cubed-sphere arcs. This PNG file can be set as a background image in an editor like Photoshop or GIMP.</p> <p></p> <p>The refined region is then drawn on top of this image in a separate layer.  You can set the transparency between layers at, i.e. 50% with the grayscale image in front of the template.  When you are ready to save the image, you can change the transparency to 0% and export the image as a PNG.</p> <p>If a different \"base grid\" image is desired with more or less detail, this can be generated with:</p> <pre><code>./SQuadGen --resolution &lt;ne&gt; --output base_grid.g\n</code></pre> <p>where <code>ne</code> is your desired base grid resolution.  The grid image can then be plotted with the <code>gridplot.ncl</code> script that is included with SQuadGen. Alternatively, PyNGL is a python replacement for NCL that also has good support for plotting unstructured meshes (despite being in \"maintenance mode\").</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/#creating-the-png-file-with-a-python-script","title":"Creating the PNG file with a python script","text":"<p>The previous method of using an image editor can be somewhat cumbersome and inaccurate. Scripted generation of the refinement region is possible with python.</p> <p>In the first example below a SCRIP format grid file is used so that individual elements can be shaded, but this method was intended for the cell shading capability of PyNGL. The SCRIP file used in these examples can be generated with 3 simple TempestRemap commands:</p> <pre><code>NE=30\nGenerateCSMesh --alt --res ${NE} --file ${GRID_FILE_PATH}/ne${NE}.g\nGenerateVolumetricMesh --in ${GRID_FILE_PATH}/ne${NE}.g --out ${GRID_FILE_PATH}/ne${NE}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${GRID_FILE_PATH}/ne${NE}pg2.g --out ${GRID_FILE_PATH}/ne${NE}pg2_scrip.nc\n</code></pre> <p>For other plotting libraries it may be preferrable to use an equiangular SCRIP grid file, which can be generated with a simple NCO command. Here is an example of a 1 degree grid:</p> <pre><code>ncremap -G ttl=Equi-Angular grid 1x1 degree, dimensions 180x360, cell edges on Poles/Equator and Prime Meridian/Date Line#latlon=180,360#lat_typ=uni#lon_typ=grn_wst -g /Users/zender/data/grids/cmip6_180x360_scrip.nc\n</code></pre> <p>Below is some example python code to generate a \"feathered\" refined region around a given central point. The resulting numpy array can then be plotted with your preferred plotting library (ex. matplotlib, pyngl)</p> generate_RRM_png_feathered.py <pre><code>import os, ngl, numpy as np, xarray as xr\ntarget_lat, target_lon = 39.7392, 360-104.9903 # Denver, CO\n#-------------------------------------------------------------------------------\nscrip_ds = xr.open_dataset(os.getenv('HOME')+'/E3SM/data_grid/ne30pg2_scrip.nc')\nncol = len(scrip_ds['grid_area'])\ndeg_to_rad,rad_to_deg = np.pi/180., 180./np.pi\n#-------------------------------------------------------------------------------\n# method for calculating the length of great circle arcs\ndef calc_great_circle_distance(lat1,lat2,lon1,lon2):\n  ''' input should be in degrees '''\n  dlon = lon2 - lon1\n  cos_dist = np.sin(lat1*deg_to_rad)*np.sin(lat2*deg_to_rad) + \\\n             np.cos(lat1*deg_to_rad)*np.cos(lat2*deg_to_rad)*np.cos(dlon*deg_to_rad)\n  # print( str(cos_dist.min()) +\"   \"+ str(cos_dist.max()) )\n  cos_dist = np.where(cos_dist&gt; 1.0, 1.0,cos_dist)\n  cos_dist = np.where(cos_dist&lt;-1.0,-1.0,cos_dist)\n  dist = np.arccos( cos_dist )\n  return dist\n#-------------------------------------------------------------------------------\n# method for defining a feathered refinement region\ndef define_refinement( ncol, dmin, dmax,\n                      target_lat, target_lon,\n                      center_lat, center_lon,\n                      refine_level):\n  # loop through all points and calculate distance to center\n  # NOTE - distance units are in radians (max value = pi)\n  for n in range(ncol):\n    d = calc_great_circle_distance(target_lat, center_lat[n] ,target_lon, center_lon[n])\n    if d&lt;=dmin:            refine_level[n] = 1\n    if d&gt;dmin and d&lt;=dmax: refine_level[n] = ( dmax - d ) / ( dmax - dmin )\n    if d&gt;dmax:             refine_level[n] = 0\n  return refine_level\n#-------------------------------------------------------------------------------\n# define refinement regions - distance thesholds in radians\nmin_threshold =  1*deg_to_rad\nmax_threshold = 10*deg_to_rad\nrefine_level = np.zeros(ncol)\n# define continuous refinement based on distance\ndefine_refinement( ncol, min_threshold, max_threshold,\n                 target_lat, target_lon,\n                 scrip_ds['grid_center_lat'].values,\n                 scrip_ds['grid_center_lon'].values,\n                 refine_level )\n#-------------------------------------------------------------------------------\n# create PNG image using PyNGL\nwkres = ngl.Resources()\nnpix = 4096; wkres.wkWidth,wkres.wkHeight=npix,npix\nwkres.wkForegroundColor = [1.,1.,1.]\nwkres.wkBackgroundColor = [1.,1.,1.]\nwks = ngl.open_wks('png',fig_file,wkres)\n# Create custom colormap\nnum_clr = 50\nfill_clr = np.zeros((num_clr,3))\nfor n in range(num_clr): fill_clr[n,:] = float(n) / float(num_clr)\n# define plot resources\nres = ngl.Resources()\nres.nglDraw               = False\nres.nglFrame              = False\nres.tmXTOn                = False\nres.tmXBOn                = False\nres.tmYLOn                = False\nres.tmYROn                = False\nres.cnFillOn              = True\nres.cnLinesOn             = False\nres.cnLineLabelsOn        = False\nres.cnInfoLabelOn         = False\nres.mpGridAndLimbOn       = False\nres.mpPerimOn             = False\nres.mpOutlineBoundarySets = 'NoBoundaries'\nres.lbLabelBarOn          = False\nres.cnFillPalette         = fill_clr\nres.tfPolyDrawOrder = 'PreDraw'\nres.sfXArray      = scrip_ds['grid_center_lon'].values\nres.sfYArray      = scrip_ds['grid_center_lat'].values\n#-------------------------------------------------------------------------------\n# Use Raster fill mode instead of cell fill\nres.cnFillMode          = 'RasterFill'\nplot = ngl.contour_map(wks,refine_level,res)\n#-------------------------------------------------------------------------------\n# use pre-draw polygon to fill in white areas near poles\n#-------------------------------------------------------------------------------\ngsres             = ngl.Resources()\ngsres.gsFillColor = 'black'\ngsres.gsEdgesOn   = False\npy = [ -89.9,  89.9, 89.9,-89.9, -89.9]\npx = [ 360. , 360. ,  0. ,  0. , 360. ]\nngl.polygon(wks, plot, px, py, gsres)\n#-------------------------------------------------------------------------------\nngl.draw(plot)\nngl.frame(wks)\nngl.end()\n#-------------------------------------------------------------------------------\n# crop white space from png file\nif os.path.isfile(f'{fig_file}.png') :\n  cmd = f'convert -trim +repage {fig_file}.png {fig_file}.png'\n  os.system(cmd)\n  os.system(cmd) # second call helps remove gray lines at edge\n  # if npix = 4096:\nelse:\n  raise FileNotFoundError(f'\\n{fig_file}.png does not exist?!\\n')\n#-------------------------------------------------------------------------------\n# apply gaussian blur\nfrom PIL import Image, ImageFilter\nimage = Image.open(f'{fig_file}.png')\nfor n in range(nsmooth): image = image.filter(ImageFilter.GaussianBlur(radius=6))\nimage = image.save(f'{fig_file}.png')\n#-------------------------------------------------------------------------------\nprint(); print(f'  {fig_file}.png'); print()\n#-------------------------------------------------------------------------------\n</code></pre> <p>The next example creates a refinement region based on land fraction.</p> generate_RRM_png_landfrac.py <pre><code>import os, ngl, numpy as np, xarray as xr\nrefine_level = 1\nnsmooth      = 4\nland_data_file = 'inputdata/atm/cam/topo/USGS-gtopo30_0.9x1.25_remap_c051027.nc'\nds = xr.open_dataset(land_data_file)\nlat = ds['lat']\nlon = ds['lon']\nlandfrac = ds['LANDFRAC']\nnlat,nlon = len(lat),len(lon)\n#-------------------------------------------------------------------------------\n# switch to center data on prime meridian\nlon_tmp = np.zeros(nlon)\nlon_tmp[:int(nlon/2)] = lon[-int(nlon/2):].values - 360.\nlon_tmp[int(nlon/2):] = lon[ :int(nlon/2)].values\nlon = xr.DataArray(lon_tmp,dims={'lon':lon})\nlandfrac_tmp = np.zeros(landfrac.shape)\nlandfrac_tmp[:,:int(nlon/2)] = landfrac[:,-int(nlon/2):].values\nlandfrac_tmp[:,int(nlon/2):] = landfrac[:, :int(nlon/2)].values\nlandfrac = xr.DataArray(landfrac_tmp,dims={'lat':lat,'lon':lon})\n#-------------------------------------------------------------------------------\n# mask out anarctica\nfor j in range(nlat):\n  if lat[j]&lt;-60: landfrac[j,:] = 0.0\n#-------------------------------------------------------------------------------\n# Apply 2D smoothing to feather edges at coastlines\nif nsmooth&gt;0:\n  for s in range(nsmooth):\n    tmp = np.copy(landfrac)\n    for j in range(1,nlat-2):\n      for i in range(nlon):\n        im1 = nlon-1 if i==0      else i-1\n        ip1 = 0      if i==nlon-1 else i+1\n        smooth_y  = ( 0.25*tmp[j-1,i  ] + 0.5*tmp[j,i] + 0.25*tmp[j+1,i  ] )\n        smooth_x  = ( 0.25*tmp[j  ,im1] + 0.5*tmp[j,i] + 0.25*tmp[j  ,ip1] )\n        smooth_d1 = ( 0.25*tmp[j-1,im1] + 0.5*tmp[j,i] + 0.25*tmp[j+1,ip1] )\n        smooth_d2 = ( 0.25*tmp[j-1,ip1] + 0.5*tmp[j,i] + 0.25*tmp[j+1,im1] )\n        landfrac[j,i] = ( smooth_y + smooth_x + smooth_d1 + smooth_d2 ) / 4.\n  for j in range(nlat):\n    for i in range(nlon):\n      if landfrac[j,i]&lt;0.8: landfrac[j,i] = 0.0\n#-------------------------------------------------------------------------------\n# Generate image of refined region using MPL\nfig = plt.figure(figsize=(36/4,18/4))\nax = fig.add_subplot(1,1,1)\ncs = ax.contourf(lon, lat, landfrac, levels=[0.0,0.5,1.0],colors=['#000000','#FFFFFF','#FFFFFF'])\nax.xaxis.set_major_locator(plt.NullLocator())\nax.yaxis.set_major_locator(plt.NullLocator())\nfig.tight_layout()\nplt.axis('off')\nplt.savefig(refine_png_file,pad_inches=0,bbox_inches='tight')\nprint(f'\\nrefine_png_file: {refine_png_file}\\n')\n#-------------------------------------------------------------------------------\n# more smoothing via gaussian blur from the pillow package\nfrom PIL import Image, ImageFilter\nimage = Image.open(f'{refine_png_file}')\nfor n in range(nsmooth): image = image.filter(ImageFilter.GaussianBlur(radius=3))\nimage = image.save(f'{refine_png_file}')\n#-------------------------------------------------------------------------------\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/#using-a-refinement-map","title":"Using a Refinement Map","text":"<p>If <code>--loadcsrefinementmap</code> is specified the refinement map will be reloaded from a previously generated refine_map.dat file.  This option allows for manual editing of the cubed-sphere refine map.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/#using-rectangular-patches","title":"Using Rectangular Patches","text":"<p>SQuadGen can now be used with the <code>--refine_rect</code> argument to define rectangular patches on the fly without the need for an image file. This argument takes the latitude and longitude corner locations that define the quadralateral, as well as the desirec refinement level:</p> <pre><code>--refine_rect \"&lt;lon0&gt;,&lt;lat0&gt;,&lt;lon1&gt;,&lt;lat1&gt;,&lt;refinement level&gt;\"\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-RRM-grid-file/#a-note-on-testing-rrm-quality","title":"A Note on testing RRM Quality","text":"<p>RRM \"quality\" can be measured with the \u201cMax Dinv-based element distortion\u201d metric.  This will be printed in the log file for standalone HOMME or EAM simulations and can be obtained from the log files during the topography generation process.  </p> <p>This metric measures how distorted the elements become in the mesh transition region.  It is the ratio of the two singular values of the 2x2 derivative matrix of the element map to the unit square, representing the ration of the largest length scale to the smallest length scale.  </p> <p>A grid of perfect quadrilaterals will have a value of 1.0.  The equal-angle cubed-sphere grid has a value of 1.7.   A high quality regionally refined grid will have a value less than 4.  With a high quality grid, usually one can run with the timesteps used in a uniform grid with matching fine resolution.  RRM grids with a value &gt; 4 may require smaller timesteps for stability.   Very large values indicate a problem with the grid and it should be redesigned.</p> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-atm-initial-condition/","title":"Generate Atmospheric Initial Condition","text":"<p>Warning</p> <p>This page is still under construction</p> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-dry-deposition/","title":"Generate a Dry Deposition File","text":"<p>Atmospheric dry deposition of aerosols at the surface depends on certain surface properties, such as soil type. In some cases these calculations can be handled in the land model and passed to the atmosphere through the coupler. However, with modal areosols this method is not adequate and we must recalculate these fields in the atmosphere (see subroutine <code>interp_map</code> in <code>components/eam/src/chemistry/mozart/mo_drydep.F90</code>).</p> <p>For unstructured grids it was determined to create this offline interpolation tool rather than generalize the subroutine interp_map.</p> <p>Be sure to activate the E3SM unified environment when performing the steps below.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-dry-deposition/#map-file-generation","title":"Map File Generation","text":"<p>The destination atmosphere grid file should be on the \"pg2\" grid. These grid files are easily generated with three TempestRemap commands as follows:</p> <pre><code>NE=30\nGenerateCSMesh --alt --res ${NE} --file ${GRID_ROOT}/ne${NE}.g\nGenerateVolumetricMesh --in ${GRID_ROOT}/ne${NE}.g --out ${GRID_ROOT}/ne${NE}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${GRID_ROOT}/ne${NE}pg2.g --out ${GRID_ROOT}/ne${NE}pg2_scrip.nc\n</code></pre> <p>The map file used to generate atmsrf files can be created a few different ways. For a typical E3SM configuration we recommend using a conservative, monotone map. Here is an example command that can be used to generate one (as of NCO version 5.2.2)</p> <pre><code>SRC_GRID=${DIN_LOC_ROOT}/../mapping/grids/1x1d.nc\nDST_GRID=${GRID_ROOT}/ne${NE}pg2_scrip.nc\nMAP_FILE=${MAP_ROOT}/map_1x1_to_ne${NE}pg2_traave.nc\nncremap -5 -a traave --src_grd=${SRC_GRID} --dst_grd=${DST_GRID} --map_file=${MAP_FILE}\n</code></pre> <p>For RRM grids the last two commands would be used on the exodus file produced by SQuadGen (See the Adding Support for New Grids tutorial for more information.).</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-dry-deposition/#generating-a-new-dry-desposition-file-atmsrf","title":"Generating a New Dry Desposition File (atmsrf)","text":"<pre><code>VEGE_FILE=${DIN_LOC_ROOT}/atm/cam/chem/trop_mozart/dvel/regrid_vegetation.nc\nSOIL_FILE=${DIN_LOC_ROOT}/atm/cam/chem/trop_mozart/dvel/clim_soilw.nc\n\npython ~/E3SM/mkatmsrffile.py --map_file=${MAP_FILE} --vegetation_file=${VEGE_FILE} --soil_water_file=${SOIL_FILE} --output_root=${atmsrf_root} --dst_grid=ne${NE}pg2 --date-stamp=20240613\n</code></pre> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-lnd-initial-condition/","title":"Generate Land Initial Condition (finidat)","text":"<p>Warning</p> <p>This page is still under construction</p> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-lnd-input-data/","title":"Generate Land Input Data (fsurdat)","text":"<p>Warning</p> <p>This page is still under construction</p> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-mapping-files/","title":"Generate mapping files","text":"<p>In order to pass data between different components at runtime, a set of mapping files between each component is generated offline.</p> <p>See Recommended Mapping Procedures for E3SM Atmosphere Grids for a discussion of different remap algorithms and when to use each.</p> <p>TempestRemap and ESMF are the backends that generate the mapping weights, but this is all nicely encapsulated using ncremap. Tempest is the preferred method for creating mapping files. ncremap will call TempestRemap or ESMF depending on the algorithm argument and input file types. If exodus files are provided (i.e. <code>*.g</code>) then TempestRemap commands will be used. The ESMF tools are adequate for making atmosphere-only-type component sets for E3SM, but this tool is less conservative than TempestRemap. If you are making grids for a coupled run, then TempestRemap should be used wherever possible. Currently, TempestRemap has trouble with masked grids, such those that are needed for land data generation, so ESMF is still required for certain tasks.</p> <p>Note</p> <p>This page is still under construction</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-mapping-files/#activate-the-e3sm-unified-env","title":"Activate the E3SM Unified Env","text":"<p>Perlmutter (NERSC):</p> <pre><code>source /global/common/software/e3sm/anaconda_envs/load_latest_e3sm_unified_pm-cpu.sh\n</code></pre> <p>Chrysalis (LCRC):</p> <pre><code>source /lcrc/soft/climate/e3sm-unified/load_latest_e3sm_unified_chrysalis.sh\n</code></pre> <p>For unsupported machines you may need to build the unified environment:</p> <pre><code>conda install -c conda-forge -c e3sm e3sm-unified\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-mapping-files/#specify-the-input-data-path","title":"Specify the Input Data Path","text":"<p>Perlmutter (NERSC):</p> <p>Chrysalis (LCRC):</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-mapping-files/#create-mapping-files","title":"Create Mapping Files","text":"<p>ncremap provides a convient</p> <p>We can use ncremap to generate ALL the needed mapping files between two grids, in this example the ne4 atmosphere and the oQU240 ocean grid (for the moment, we will put the land on the same grid as the atmosphere):</p> <pre><code>atm_grid_file=ne4.g\nocn_grid_file=/global/cfs/cdirs/e3sm/inputdata/cpl/gridmaps/oQU240/ocean.QU.240km.scrip.151209.nc\ncd ${output_root} &amp;&amp; ncremap -P mwf -s $ocn_grid_file -g $atm_grid_file --nm_src=oQU240 --nm_dst=ne4np4 --dt_sng=20181114\n</code></pre> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/","title":"Generate a Topography File","text":"<p>Topography needs to be interpolated from a high resolution dataset, and then doctored a bit to allow the model to run stably with the new topography. More information can be found in the following paper:  </p> <p>P.H. Lauritzen, J.T. Bacmeister, P.F. Callaghan, M. Taylor,  NCAR_Topo (v1.0): NCAR global model topography generation software for unstructured grids, Geosci. Model Dev., 8, 3975-3986, 2015.</p> <p>Typically, input topography data generation for E3SM starts with a high resolution source dataset (<code>USGS-topo-cube3000.nc</code>). This is a high-resolution topography dataset on a 3km cubed sphere grid derived from 1 km resolution source data.  This file is located in the CESM inputdata server here.</p> <p>For target resolutions of 3 km or finer it is recommended to use an even higher resolution source dataset (<code>USGS-topo-cube12000.nc</code>), which was created by Jishi Zhang in 2024. This file has a resolution of 750m created from a  500m/250m USGS GMTED2010 source DEM dataset (see here for more information).</p> <p>For testing the topography workflow the mapping between the ne3000 data is too burdensome, so a ne90pg1 (i.e. 1-degree) version of this data was created to allow efficient testing. This file can be found on various supported machines at <code>${DIN_LOC_ROOT}/atm/cam/hrtopo/USGS-topo-cube90.nc</code>.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#data-processing-requirements","title":"Data Processing Requirements","text":"<p>The workflow to generate topography data for the atmosphere model must address the following requirements:</p> <ul> <li>The dycore needs surface geopotential (<code>phi_s</code>) at GLL nodes (np4)</li> <li>The physics needs various things at FV cell centers (pg2)<ul> <li>surface geopotential (<code>phi_s</code>)</li> <li>sub-grid variance of topography (<code>SGH</code> and <code>SGH30</code>)</li> <li>Land area fraction (<code>LANDFRAC</code>)</li> </ul> </li> <li>The np4 to pg2 map of <code>phi_s</code> data must be equal to the FV <code>phi_s</code> data</li> <li>HOMME's smoothing operator must be used on <code>phi_s</code> for stability</li> </ul>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#topography-smoothing","title":"Topography Smoothing","text":"<p>Smoothing of the input surface geopotential (<code>phi_s</code>) is an essential step to ensure numerical stability of the atmospheric dynamics, but the smoothing much be done in a way that is consistent with the internal Laplacian used by the HOMME dycor. To accomplish this we use <code>homme_tool</code>, which is a standalone build of the HOMME dycor.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#building-homme_tool","title":"Building homme_tool","text":"<p>Note</p> <p>homme_tool is not routinely tested on all supported machines, and the build can be broken without anyone noticing. If you encounter problems building homme_tool please reach out on the e3sm_help slack channel and include a detailed description of the error and the commands you used to produce the error.</p> <p>Building <code>homme_tool</code> is a critical preliminary step to the topography generation workflow described below. The build process requires the user to select the appropriate cmake file that contains machine-specific settings (see <code>mach_file</code> below).</p> <pre><code># Set the machine specific environment\ncd ${e3sm_root}/components/homme\n\n# load the appropriate machine environment\neval $(${e3sm_root}/cime/CIME/Tools/get_case_env)\n\n# Specify machine configuration file\nmach_file=${e3sm_root}/components/homme/cmake/machineFiles/pm-cpu.cmake\n# mach_file=${e3sm_root}/components/homme/cmake/machineFiles/chrysalis.cmake\n\ncmake -C ${mach_file} \\\n-DBUILD_HOMME_THETA_KOKKOS=FALSE \\\n-DBUILD_HOMME_PREQX_KOKKOS=FALSE \\\n-DHOMME_ENABLE_COMPOSE=FALSE \\\n-DHOMME_BUILD_EXECS=FALSE \\\n-DBUILD_HOMME_TOOL=TRUE \\\n-DBUILD_HOMME_WITHOUT_PIOLIBRARY=FALSE \\\n-DPREQX_PLEV=26 \\\n${e3sm_root}/components/homme\n\nmake -j4 homme_tool\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#sub-grid-topography-variations","title":"Sub-Grid Topography Variations","text":"<p>Certain physics calculations in the atmosphere require a characterization of the unresolved topography. This is provided in the input data as <code>SGH</code> and <code>SGH30</code>. These quantities need to be calculated by the <code>cube_to_target</code> tool that is included in the E3SM source  code. Similar to <code>homme_tool</code>, this tool can often be broken when the user goes to use it. Luckily, this tool is much simpler with fewer dependencies. Nevertheless, it is good to make sure the tools builds successfully before creating a new topography file.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#building-cube_to_target","title":"Building cube_to_target","text":"<p>The following commands were working on both Perlmutter/NERSC and Chrysalis/LCRC machines as of 2025.</p> <pre><code>cd ${e3sm_root}/components/eam/tools/topo_tool/cube_to_target\n\neval $(${e3sm_root}/cime/CIME/Tools/get_case_env)\n\nmake\n</code></pre> <p>Note</p> <p>You can safely ignore compiler warnings that look like <code>Warning: Rank mismatch...</code>. These are a result of how we interface with the netcdf fortran routines, but fixing the warnings by switching from <code>#include &lt;netcdf.inc&gt;</code> to <code>use netcdf</code> can lead to other problems on certain machines.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#step-by-step-topography-generation","title":"Step-by-Step Topography Generation","text":"<p>Note</p> <p>Copying and pasting the relevant steps below is an easy way to step through the blocks of commands. Alternatively, a batch script is provided below that can be used to execute all steps at once in a batch job.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#activate-the-e3sm-unified-env","title":"Activate the E3SM Unified Env","text":"<p>Perlmutter (NERSC):</p> <pre><code>source /global/common/software/e3sm/anaconda_envs/load_latest_e3sm_unified_pm-cpu.sh\n</code></pre> <p>Chrysalis (LCRC):</p> <pre><code>source /lcrc/soft/climate/e3sm-unified/load_latest_e3sm_unified_chrysalis.sh\n</code></pre> <p>For unsupported machines you may need to build the unified environment:</p> <pre><code>conda install -c conda-forge -c e3sm e3sm-unified\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#specify-source-and-target-resolution","title":"Specify Source and Target Resolution","text":"<p>We will environement variables to specify the source and target grid resolutions based on the \"ne\" value of the cubed sphere grid (\"ne\" is the number of elements along a cube edge). A Typical use case will be mapping data from <code>ne3000pg1</code> to a chosen target resolution, in this case <code>ne30</code>:</p> <pre><code>NE_SRC=3000\nNE_DST=30\n</code></pre> <p>For testing use a special <code>ne90pg1</code> dataset:</p> <pre><code>NE_SRC=90\nNE_DST=4\n</code></pre> <p>Note</p> <p>For grids with regional refinement (RRM) there is no corresponding \"ne\" value - so a slightly modified workflow is needed. This entails modifying the grid file generation step, and then modifying topo and map file paths to accomodate the new RRM grid name.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#specify-file-paths","title":"Specify File Paths","text":"<p>First we need to set some enviroment variables that point to various \"root\" directories where we will be writing and/or reading files. It</p> <pre><code>e3sm_root=?    # path to E3SM source\ngrid_root=?    # path to write grid files\nmap_root=?     # path to write map files\ntopo_root=?    # path to write new topo files\nDIN_LOC_ROOT=? # path to E3SM inputdata\n</code></pre> <p>Example path settings:</p> <ul> <li> <p>Perlmutter (NERSC):</p> <pre><code>e3sm_root=${SCRATCH}/tmp_e3sm_src # make sure this contains an up-to-date clone of E3SM\ngrid_root=${SCRATCH}/e3sm_scratch/files_grid\nmap_root=${SCRATCH}/e3sm_scratch/files_map\ntopo_root=${SCRATCH}/e3sm_scratch/files_topo\nDIN_LOC_ROOT=/global/cfs/cdirs/e3sm/inputdata\n</code></pre> </li> <li> <p>Chrysalis (ANL/LCRC):</p> <pre><code>SCRATCH=/lcrc/group/e3sm/${USER}/scratch/chrys\ne3sm_root=${SCRATCH}/tmp_e3sm_src # make sure this contains an up-to-date clone of E3SM\ngrid_root=${SCRATCH}/files_grid\nmap_root=${SCRATCH}/files_map\ntopo_root=${SCRATCH}/files_topo\nDIN_LOC_ROOT=/lcrc/group/e3sm/data/inputdata\n</code></pre> </li> </ul> <p>Make sure the root directories exist:</p> <pre><code>mkdir -p ${grid_root} ${map_root} ${topo_root}\nls -ld ${grid_root} ${map_root} ${topo_root} ${e3sm_root} ${DIN_LOC_ROOT}\n</code></pre> <p>Now specify all the files that we will need for, including map files and temporary topo data.</p> <pre><code>timestamp=$(date +%Y%m%d)\ntopo_file_0=${DIN_LOC_ROOT}/atm/cam/hrtopo/USGS-topo-cube${NE_SRC}.nc\ntopo_file_1=${topo_root}/tmp_USGS-topo_ne${NE_DST}np4.nc\ntopo_file_2=${topo_root}/tmp_USGS-topo_ne${NE_DST}np4_smoothedx6t.nc\ntopo_file_3=${topo_root}/USGS-topo_ne${NE_DST}np4_smoothedx6t_${timestamp}.nc\n\nmap_file_src_to_np4=${map_root}/map_ne${NE_SRC}pg1_to_ne${NE_DST}np4_fv2se_flx.nc\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#create-grid-files","title":"Create Grid Files","text":"<pre><code># Grid for source high res topo\nGenerateCSMesh --alt --res ${NE_SRC}  --file ${grid_root}/exodus_ne${NE_SRC}.g\nConvertMeshToSCRIP --in ${grid_root}/exodus_ne${NE_SRC}.g  --out ${grid_root}/scrip_ne${NE_SRC}pg1.nc\n\n# Grid for target EAM grid\nGenerateCSMesh --alt --res ${NE_DST} --file ${grid_root}/exodus_ne${NE_DST}.g\nGenerateVolumetricMesh --in ${grid_root}/exodus_ne${NE_DST}.g --out ${grid_root}/exodus_ne${NE_DST}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${grid_root}/exodus_ne${NE_DST}pg2.g --out ${grid_root}/scrip_ne${NE_DST}pg2.nc\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#create-map-files","title":"Create Map Files","text":"<p>Warning</p> <p>This step can potentially take a very long time - several hours for each map file in some cases! The use of <code>--mpi_nbr=32</code> will leverage parallelization via <code>mbtemptest</code> to dramatically reduce the time to generate mapping files, but this may not work on all machines. Feel free to experiment with a different number of tasks to optimize for the machine you are using. You can also drop this argument entirely if it is causing problems, but be sure to plan for hours of execution time.</p> <p>Note</p> <p>If you see an error from these <code>ncremap</code> commands that looks like: <code>srun: error: Job request does not match any supported policy.</code> and you are on a login node then you will need to either launch an interactive compute node or use a batch job script.</p> <pre><code># Create map from source to target np4 \nncremap ${MAP_ARGS} -a fv2se_flx \\\n--src_grd=${grid_root}/scrip_ne${NE_SRC}pg1.nc  \\\n--dst_grd=${grid_root}/exodus_ne${NE_DST}.g \\\n--map_file=${map_file_src_to_np4} \\\n--tmp_dir=${map_root}\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#remap-topograpy","title":"Remap Topograpy","text":"<p>The first command here will essentially create a copy of the source data, which is needed later on when calculating SGH.</p> <pre><code># Map high-res topo to target np4 grid\nncremap -m ${map_file_src_to_np4} -i ${topo_file_0} -o ${topo_file_1}\n\n# Compute phi_s on the target np4 grid\nncap2 -O -s 'PHIS=terr*9.80616' ${topo_file_1} ${topo_file_1}\n\n# rename the column dimension to be \"ncol\"\nncrename -d grid_size,ncol ${topo_file_1}\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#apply-smoothing","title":"Apply Smoothing","text":"<p>Make sure <code>homme_tool</code> has been built following the instructions above.</p> <pre><code>cd ${e3sm_root}/components/homme\neval $(${e3sm_root}/cime/CIME/Tools/get_case_env)\n\ncat &lt;&lt;EOF &gt; input.nl\n&amp;ctl_nl\nmesh_file = \"${grid_root}/exodus_ne${NE_DST}.g\"\nsmooth_phis_p2filt = 0\nsmooth_phis_numcycle = 6 ! v2/v3 uses 12/6 for more/less smoothing\nsmooth_phis_nudt = 4e-16\nhypervis_scaling = 2\nse_ftype = 2 ! actually output NPHYS; overloaded use of ftype\n/\n&amp;vert_nl\n/\n&amp;analysis_nl\ntool = 'topo_pgn_to_smoothed'\ninfilenames = '${topo_file_1}', '${topo_file_2}'\n/\nEOF\n\nmpirun -np 8 ${e3sm_root}/components/homme/src/tool/homme_tool &lt; input.nl\n\n# rename output file to remove \"1.nc\" suffix\nmv ${topo_file_2}1.nc ${topo_file_2}\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#compute-sgh","title":"Compute SGH","text":"<pre><code>${e3sm_root}/components/eam/tools/topo_tool/cube_to_target/cube_to_target \\\n  --target-grid ${grid_root}/scrip_ne${NE_DST}pg2.nc \\\n  --input-topography ${topo_file_0} \\\n  --smoothed-topography ${topo_file_2} \\\n  --output-topography ${topo_file_3}\n\n# Append the GLL phi_s data to the output of step 4.\nncks -A ${topo_file_2} ${topo_file_3}\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#clean-up-temporary-files","title":"Clean up Temporary Files","text":"<pre><code>rm ${topo_root}/tmp_USGS-topo_ne${NE_DST}*\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-topo-file/#batch-script-to-streamline-all-steps","title":"Batch script to streamline all steps","text":"<p>Running through all the steps above can be tedious and time-consuming. The batch scripts below include all these steps as well as batch system directives. The only step that is omitted is building homme_tool, since its better to do this manually in case problems arise.</p> <p>Here is a check list of things to do before submitting this script:</p> <ul> <li>Build <code>homme_tool</code></li> <li>Build <code>cube_to_target</code></li> <li>Update batch allocation code (i.e. <code>--account</code>)</li> <li>Update batch job wallclock time (i.e. <code>--time</code>)</li> <li>Update paths at the top of the batch script</li> <li>Comment out any sections that were completed in advance (i.e. grid and map file creation)</li> </ul> <p>To submit the slurm batch job use <code>sbatch &lt;script&gt;</code></p> batch_topo_slurm_lcrc.sh <pre><code>#!/bin/bash\n#SBATCH --account=e3sm\n#SBATCH --job-name=generate_topo\n#SBATCH --output=slurm-%x-%j.out\n#SBATCH --time=24:00:00\n#SBATCH --nodes=1\n#SBATCH --mail-type=END,FAIL\n#---------------------------------------------------------------------------\n# Make sure all these lines are correct for the machine\nsource /lcrc/soft/climate/e3sm-unified/load_latest_e3sm_unified_chrysalis.sh\n# Specify source and target resolutions\nNE_SRC=3000 ; NE_DST=30\n# NE_SRC=90 ; NE_DST=30 # low-res grid combination for testing\n# Specify time stamp for creation date\ntimestamp=$(date +%Y%m%d)\n# Specify E3SM source code path - preferably a fresh clone\nSCRATCH=/lcrc/group/e3sm/${USER}/scratch/chrys\ne3sm_root=${SCRATCH}/tmp_e3sm_src\n# Specify root paths\ngrid_root=${SCRATCH}/files_grid\nmap_root=${SCRATCH}/files_map\ntopo_root=${SCRATCH}/files_topo\nDIN_LOC_ROOT=/lcrc/group/e3sm/data/inputdata\n# argument for ncremap to select TempestRemap or mbtempest backend\nMAP_ARGS=\n# MAP_ARGS+=\"--mpi_nbr=32\"\n#---------------------------------------------------------------------------\n# Stop script execution on error\nset -e\n# ANSI color codes for highlighting terminal output\nRED='\\033[0;31m' ; GRN='\\033[0;32m' CYN='\\033[0;36m' ; NC='\\033[0m'\n# start timer for entire script\nstart=`date +%s`\n#---------------------------------------------------------------------------\n# Specify topo file names - including temporary files that will be deleted\ntopo_file_0=${DIN_LOC_ROOT}/atm/cam/hrtopo/USGS-topo-cube${NE_SRC}.nc\ntopo_file_1=${topo_root}/tmp_USGS-topo_ne${NE_DST}np4.nc\ntopo_file_2=${topo_root}/tmp_USGS-topo_ne${NE_DST}np4_smoothedx6t.nc\ntopo_file_3=${topo_root}/USGS-topo_ne${NE_DST}np4_smoothedx6t_${timestamp}.nc\n# Specify map file name\nmap_file_src_to_np4=${map_root}/map_ne${NE_SRC}pg1_to_ne${NE_DST}np4_fv2se_flx.nc\n#---------------------------------------------------------------------------  \n# print some useful things\necho --------------------------------------------------------------------------------\necho --------------------------------------------------------------------------------\necho\necho   NE_SRC              = $NE_SRC\necho   NE_DST              = $NE_DST\necho\necho   e3sm_root           = $e3sm_root\necho   grid_root           = $grid_root\necho   map_root            = $map_root\necho   topo_root           = $topo_root\necho   DIN_LOC_ROOT        = $DIN_LOC_ROOT\necho\necho   topo_file_0         = $topo_file_0\necho   topo_file_1         = $topo_file_1\necho   topo_file_2         = $topo_file_2\necho   topo_file_3         = $topo_file_3\necho\necho   map_file_src_to_np4 = $map_file_src_to_np4\necho\necho --------------------------------------------------------------------------------\necho --------------------------------------------------------------------------------\n#---------------------------------------------------------------------------\n# Make sure paths exist\nmkdir -p ${grid_root} ${map_root} ${topo_root}\nif [ ! -d ${DIN_LOC_ROOT} ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${DIN_LOC_ROOT} ; fi\nif [ ! -d ${e3sm_root}    ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${e3sm_root} ; fi\nif [ ! -d ${grid_root}    ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${grid_root} ; fi\nif [ ! -d ${map_root}     ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${map_root} ; fi\nif [ ! -d ${topo_root}    ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${topo_root} ; fi\n#---------------------------------------------------------------------------\n# set to echo commands\nset -x\n#---------------------------------------------------------------------------\n# Create grid for source high res topo\nGenerateCSMesh --alt --res ${NE_SRC} --file ${grid_root}/exodus_ne${NE_SRC}.g\nConvertMeshToSCRIP --in ${grid_root}/exodus_ne${NE_SRC}.g  --out ${grid_root}/scrip_ne${NE_SRC}pg1.nc\n# Create grid for target EAM grid\nGenerateCSMesh --alt --res ${NE_DST} --file ${grid_root}/exodus_ne${NE_DST}.g\nGenerateVolumetricMesh --in ${grid_root}/exodus_ne${NE_DST}.g --out ${grid_root}/exodus_ne${NE_DST}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${grid_root}/exodus_ne${NE_DST}pg2.g --out ${grid_root}/scrip_ne${NE_DST}pg2.nc\n#---------------------------------------------------------------------------\n# Create map from source to target np4\ntime ncremap ${MAP_ARGS} -a fv2se_flx \\\n  --src_grd=${grid_root}/scrip_ne${NE_SRC}pg1.nc \\\n  --dst_grd=${grid_root}/exodus_ne${NE_DST}.g \\\n  --map_file=${map_file_src_to_np4} \\\n  --tmp_dir=${map_root}\n#---------------------------------------------------------------------------\n# Remap high-res topo to target np4 grid\nncremap -m ${map_file_src_to_np4} -i ${topo_file_0} -o ${topo_file_1}\n# Compute phi_s on the target np4 grid\nncap2 -O -s 'PHIS=terr*9.80616' ${topo_file_1} ${topo_file_1}\n# rename the column dimension to be \"ncol\"\nncrename -d grid_size,ncol ${topo_file_1}\n#---------------------------------------------------------------------------\n# Apply Smoothing\ncd ${e3sm_root}/components/homme\neval $(${e3sm_root}/cime/CIME/Tools/get_case_env)\n# Create namelist file for HOMME\ncat &lt;&lt;EOF &gt; input.nl\n&amp;ctl_nl\nmesh_file = \"${grid_root}/exodus_ne${NE_DST}.g\"\nsmooth_phis_p2filt = 0\nsmooth_phis_numcycle = 6 ! v2/v3 uses 12/6 for more/less smoothing\nsmooth_phis_nudt = 4e-16\nhypervis_scaling = 2\nse_ftype = 2 ! actually output NPHYS; overloaded use of ftype\n/\n&amp;vert_nl\n/\n&amp;analysis_nl\ntool = 'topo_pgn_to_smoothed'\ninfilenames = '${topo_file_1}', '${topo_file_2}'\n/\nEOF\n# run homme_tool for topography smoothing\nsrun -n 8 ${e3sm_root}/components/homme/src/tool/homme_tool &lt; input.nl\n# rename output file to remove \"1.nc\" suffix\nmv ${topo_file_2}1.nc ${topo_file_2}\n#---------------------------------------------------------------------------\n# Compute SGH with cube_to_target\n${e3sm_root}/components/eam/tools/topo_tool/cube_to_target/cube_to_target \\\n  --target-grid ${grid_root}/scrip_ne${NE_DST}pg2.nc \\\n  --input-topography ${topo_file_0} \\\n  --smoothed-topography ${topo_file_2} \\\n  --output-topography ${topo_file_3}\n# Append the GLL phi_s data to the output\nncks -A ${topo_file_2} ${topo_file_3}\n#---------------------------------------------------------------------------\n# Clean up Temporary Files\nrm ${topo_root}/tmp_USGS-topo_ne${NE_DST}*\n#---------------------------------------------------------------------------\n# stop echoing commands\nset +x\n#---------------------------------------------------------------------------\n# Check that final topo output file was created\nif [ ! -f ${topo_file_3} ]; then\n  echo\n  echo -e ${RED} Failed to create topography file - Errors ocurred ${NC}\n  echo\nelse\n  echo\n  echo -e ${GRN} Sucessfully created new topography file  ${NC}\n  echo $topo_file_3\n  echo\nfi\n#---------------------------------------------------------------------------\n# Indicate overall run time for this script\nend=`date +%s`\nruntime_sc=$(( end - start ))\nruntime_mn=$(( runtime_sc/60 ))\nruntime_hr=$(( runtime_mn/60 ))\necho -e    ${CYN} overall runtime: ${NC} ${runtime_sc} seconds / ${runtime_mn} minutes / ${runtime_hr} hours\necho\n#---------------------------------------------------------------------------\n</code></pre> batch_topo_slurm_nersc.sh <pre><code>#!/bin/bash\n#SBATCH --account=e3sm\n#SBATCH --constraint=cpu\n#SBATCH --qos=regular\n#SBATCH --job-name=generate_topo\n#SBATCH --output=slurm-%x-%j.out\n#SBATCH --time=24:00:00\n#SBATCH --nodes=1\n#SBATCH --mail-type=END,FAIL\n#---------------------------------------------------------------------------\n# Make sure all these lines are correct for the machine\nsource /global/common/software/e3sm/anaconda_envs/load_latest_e3sm_unified_pm-cpu.sh\n# Specify source and target resolutions\nNE_SRC=3000 ; NE_DST=30\n# NE_SRC=90 ; NE_DST=30 # low-res grid combination for testing\n# Specify time stamp for creation date\ntimestamp=$(date +%Y%m%d)\n# Specify E3SM source code path - preferably a fresh clone\ne3sm_root=${SCRATCH}/tmp_e3sm_src\n# Specify root paths\ngrid_root=${SCRATCH}/files_grid\nmap_root=${SCRATCH}/files_map\ntopo_root=${SCRATCH}/files_topo\nDIN_LOC_ROOT=/global/cfs/cdirs/e3sm/inputdata\n# argument for ncremap to select TempestRemap or mbtempest backend\nMAP_ARGS=\n# MAP_ARGS+=\"--mpi_nbr=32\"\n#---------------------------------------------------------------------------\n# Stop script execution on error\nset -e\n# ANSI color codes for highlighting terminal output\nRED='\\033[0;31m' ; GRN='\\033[0;32m' CYN='\\033[0;36m' ; NC='\\033[0m'\n# start timer for entire script\nstart=`date +%s`\n#---------------------------------------------------------------------------\n# Specify topo file names - including temporary files that will be deleted\ntopo_file_0=${DIN_LOC_ROOT}/atm/cam/hrtopo/USGS-topo-cube${NE_SRC}.nc\ntopo_file_1=${topo_root}/tmp_USGS-topo_ne${NE_DST}np4.nc\ntopo_file_2=${topo_root}/tmp_USGS-topo_ne${NE_DST}np4_smoothedx6t.nc\ntopo_file_3=${topo_root}/USGS-topo_ne${NE_DST}np4_smoothedx6t_${timestamp}.nc\n# Specify map file name\nmap_file_src_to_np4=${map_root}/map_ne${NE_SRC}pg1_to_ne${NE_DST}np4_fv2se_flx.nc\n#---------------------------------------------------------------------------  \n# print some useful things\necho --------------------------------------------------------------------------------\necho --------------------------------------------------------------------------------\necho\necho   NE_SRC              = $NE_SRC\necho   NE_DST              = $NE_DST\necho\necho   e3sm_root           = $e3sm_root\necho   grid_root           = $grid_root\necho   map_root            = $map_root\necho   topo_root           = $topo_root\necho   DIN_LOC_ROOT        = $DIN_LOC_ROOT\necho\necho   topo_file_0         = $topo_file_0\necho   topo_file_1         = $topo_file_1\necho   topo_file_2         = $topo_file_2\necho   topo_file_3         = $topo_file_3\necho\necho   map_file_src_to_np4 = $map_file_src_to_np4\necho\necho --------------------------------------------------------------------------------\necho --------------------------------------------------------------------------------\n#---------------------------------------------------------------------------\n# Make sure paths exist\nmkdir -p ${grid_root} ${map_root} ${topo_root}\nif [ ! -d ${DIN_LOC_ROOT} ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${DIN_LOC_ROOT} ; fi\nif [ ! -d ${e3sm_root}    ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${e3sm_root} ; fi\nif [ ! -d ${grid_root}    ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${grid_root} ; fi\nif [ ! -d ${map_root}     ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${map_root} ; fi\nif [ ! -d ${topo_root}    ]; then echo -e ${RED}ERROR directory does not exist:${NC} ${topo_root} ; fi\n#---------------------------------------------------------------------------\n# set to echo commands\nset -x\n#---------------------------------------------------------------------------\n# Create grid for source high res topo\nGenerateCSMesh --alt --res ${NE_SRC} --file ${grid_root}/exodus_ne${NE_SRC}.g\nConvertMeshToSCRIP --in ${grid_root}/exodus_ne${NE_SRC}.g  --out ${grid_root}/scrip_ne${NE_SRC}pg1.nc\n# Create grid for target EAM grid\nGenerateCSMesh --alt --res ${NE_DST} --file ${grid_root}/exodus_ne${NE_DST}.g\nGenerateVolumetricMesh --in ${grid_root}/exodus_ne${NE_DST}.g --out ${grid_root}/exodus_ne${NE_DST}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${grid_root}/exodus_ne${NE_DST}pg2.g --out ${grid_root}/scrip_ne${NE_DST}pg2.nc\n#---------------------------------------------------------------------------\n# Create map from source to target np4\ntime ncremap ${MAP_ARGS} -a fv2se_flx \\\n  --src_grd=${grid_root}/scrip_ne${NE_SRC}pg1.nc \\\n  --dst_grd=${grid_root}/exodus_ne${NE_DST}.g \\\n  --map_file=${map_file_src_to_np4} \\\n  --tmp_dir=${map_root}\n#---------------------------------------------------------------------------\n# Remap high-res topo to target np4 grid\nncremap -m ${map_file_src_to_np4} -i ${topo_file_0} -o ${topo_file_1}\n# Compute phi_s on the target np4 grid\nncap2 -O -s 'PHIS=terr*9.80616' ${topo_file_1} ${topo_file_1}\n# rename the column dimension to be \"ncol\"\nncrename -d grid_size,ncol ${topo_file_1}\n#---------------------------------------------------------------------------\n# Apply Smoothing\ncd ${e3sm_root}/components/homme\neval $(${e3sm_root}/cime/CIME/Tools/get_case_env)\n# Create namelist file for HOMME\ncat &lt;&lt;EOF &gt; input.nl\n&amp;ctl_nl\nmesh_file = \"${grid_root}/exodus_ne${NE_DST}.g\"\nsmooth_phis_p2filt = 0\nsmooth_phis_numcycle = 6 ! v2/v3 uses 12/6 for more/less smoothing\nsmooth_phis_nudt = 4e-16\nhypervis_scaling = 2\nse_ftype = 2 ! actually output NPHYS; overloaded use of ftype\n/\n&amp;vert_nl\n/\n&amp;analysis_nl\ntool = 'topo_pgn_to_smoothed'\ninfilenames = '${topo_file_1}', '${topo_file_2}'\n/\nEOF\n# run homme_tool for topography smoothing\nsrun -n 8 ${e3sm_root}/components/homme/src/tool/homme_tool &lt; input.nl\n# rename output file to remove \"1.nc\" suffix\nmv ${topo_file_2}1.nc ${topo_file_2}\n#---------------------------------------------------------------------------\n# Compute SGH with cube_to_target\n${e3sm_root}/components/eam/tools/topo_tool/cube_to_target/cube_to_target \\\n  --target-grid ${grid_root}/scrip_ne${NE_DST}pg2.nc \\\n  --input-topography ${topo_file_0} \\\n  --smoothed-topography ${topo_file_2} \\\n  --output-topography ${topo_file_3}\n# Append the GLL phi_s data to the output\nncks -A ${topo_file_2} ${topo_file_3}\n#---------------------------------------------------------------------------\n# Clean up Temporary Files\nrm ${topo_root}/tmp_USGS-topo_ne${NE_DST}*\n#---------------------------------------------------------------------------\n# stop echoing commands\nset +x\n#---------------------------------------------------------------------------\n# Check that final topo output file was created\nif [ ! -f ${topo_file_3} ]; then\n  echo\n  echo -e ${RED} Failed to create topography file - Errors ocurred ${NC}\n  echo\nelse\n  echo\n  echo -e ${GRN} Sucessfully created new topography file  ${NC}\n  echo $topo_file_3\n  echo\nfi\n#---------------------------------------------------------------------------\n# Indicate overall run time for this script\nend=`date +%s`\nruntime_sc=$(( end - start ))\nruntime_mn=$(( runtime_sc/60 ))\nruntime_hr=$(( runtime_mn/60 ))\necho -e    ${CYN} overall runtime: ${NC} ${runtime_sc} seconds / ${runtime_mn} minutes / ${runtime_hr} hours\necho\n#---------------------------------------------------------------------------\n</code></pre> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-uniform-grid-file/","title":"Generate a new Grid File","text":"<p>In order to generate mapping files between a new atmosphere grid and the surface component grids, we need a file that describes the new grid. TempestRemap is our preferred tool for grid file generation because it can handle the spectral element grids used by the atmosphere dycore. The initial grid file will be saved in an \"exodus\" file with a <code>.g</code> extension (see Types of Grid Description Files for more info). TempestRemap can be installed via conda.</p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-uniform-grid-file/#generating-a-standard-exodus-grid-file","title":"Generating a Standard Exodus Grid File","text":"<p>Once TempestRemap is in our environment we can easily generate an exodus file by calling TempestRemap directly:</p> <pre><code>GenerateCSMesh --alt --res 4 --file ne4.g\n</code></pre>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-uniform-grid-file/#generating-a-regionally-refined-grid-file","title":"Generating a Regionally Refined Grid File","text":"<p>For a regionally refined mesh (RRM) SQuadGen is used to define the refined area(s). This tutorial includes details and examples of using SQuadGen to generate RRM grid files.</p> <p>The naming convention for RRM grid files should follow:</p> <pre><code>&lt;refined_area_name&gt;_&lt;base_resolution&gt;x&lt;refinement_level&gt;.g\n</code></pre> <p>For example, for a RRM with 4x refinement from ne30 to ne120 over CONUS, we should use the convention conus_ne30x4.g (note that existing meshes may have used the old naming convention <code>&lt;area of refinement&gt;x&lt;refinement level&gt;v&lt;version&gt;.g</code>, but future meshes should use the new naming convention).</p> <p>The Exodus file contains only information about the position of the spectral element on the sphere. For SE aware utilities such as TempestRemap, they can use the polynomial order and the reference element map to fill in necessary data such as the locations of the nodal GLL points. For non-SE aware utilities, we need additional meta data, described in the next section.  </p>"},{"location":"dev-guide/adding-grid-support/adding-grid-support-step-by-step-guide/generate-uniform-grid-file/#generating-a-pg2-scrip-grid-file","title":"Generating a \"pg2\" SCRIP Grid File","text":"<p>Starting in E3SMv2 the physics calculations and standard history output use a finite volume (FV) \"pg2\" grid. Online mapping within the component coupler between the atmosphere and surface components requires FV-to-FV type maps, and generating these maps will require a grid file for pg2 grid. These are easily generated with TempestRemap commands as follows:</p> <pre><code>NE=30\nGenerateCSMesh --alt --res ${NE} --file ${GRID_FILE_PATH}/ne${NE}.g\nGenerateVolumetricMesh --in ${GRID_FILE_PATH}/ne${NE}.g --out ${GRID_FILE_PATH}/ne${NE}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${GRID_FILE_PATH}/ne${NE}pg2.g --out ${GRID_FILE_PATH}/ne${NE}pg2_scrip.nc\n</code></pre> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"generate_domain_files/","title":"Generating Domain Files","text":"<p>Domain files are needed at runtime by the coupler, data models, and land model. The land model uses the mask to determine where to run and the coupler use the land fraction to merge fluxes from multiple surface types to the atmosphere above them.</p> <p>Domain files are created from a conservative, monotone mapping file from the ocean grid (where the mask is defined) to the atmosphere grid.</p>"},{"location":"generate_domain_files/#environment","title":"Environment","text":"<p>The new domain generation tool requires a few special packages, such as xarray, numba, and itertools. These are all included in the E3SM unified environment: https://e3sm.org/resources/tools/other-tools/e3sm-unified-environment/</p> <p>Alternatively, a simple conda environment can be created with the following command:</p> <pre><code>conda create --name example_env --channel conda-forge xarray numpy numba scikit-learn netcdf4\n</code></pre>"},{"location":"generate_domain_files/#map-file-generation","title":"Map File Generation","text":"<p>The map file used to generate the domain files can be created a few different ways. For a typical E3SM configuration we recommend using a conservative, monotone map. Here is an example command that can be used to generate one (as of NCO version 5.2.2)</p> <pre><code>ncremap -5 -a traave --src_grd=${OCN_GRID} --dst_grd=${ATM_GRID} --map_file=${MAP_FILE}\n</code></pre> <p>Note that existing ocean grid files can be found in the inputdata repository: <code>inputdata/ocn/mpas-o/&lt;ocn_grid_name&gt;/</code></p> <p>The atmosphere grid file should be on the \"pg2\" grid. These grid files are easily generated with three TempestRemap commands as follows:</p> <pre><code>NE=30\nGenerateCSMesh --alt --res ${NE} --file ${GRID_FILE_PATH}/ne${NE}.g\nGenerateVolumetricMesh --in ${GRID_FILE_PATH}/ne${NE}.g --out ${GRID_FILE_PATH}/ne${NE}pg2.g --np 2 --uniform\nConvertMeshToSCRIP --in ${GRID_FILE_PATH}/ne${NE}pg2.g --out ${GRID_FILE_PATH}/ne${NE}pg2_scrip.nc\n</code></pre> <p>For RRM grids the last two commands would be used on the exodus file produced by SQuadGen (See the Adding Support for New Grids tutorial for more information.).</p>"},{"location":"generate_domain_files/#running-the-domain-generation-tool","title":"Running the Domain Generation Tool","text":"<p>Below is a typical example of how to invoke the domain generation tool from the command line:</p> <pre><code>NE=30\nMAP_FILE=${MAP_FILE_ROOT}/map_oEC60to30v3_to_ne${NE}pg2_traave.20240313.nc\npython generate_domain_files_E3SM.py -m ${MAP_FILE} -o oEC60to30v3 -l ne${NE}pg2 --date-stamp=9999 --output-root=${OUTPUT_ROOT}\n</code></pre> <p>Back to step-by-step guide for Adding Support for New Grids</p>"},{"location":"user-guide/","title":"User Guide","text":"<p>E3SM is not just one earth system model but a modeling system that allows many different configurations of atmosphere, ocean, land and other components with both full model and data model options. Also, the configurations of model components can run at different resolutions.  Some configurations can run easily on a laptop.  Other's require the most powerful supercomputers.</p> <p>Using the model requires first deciding what configuration to use and creating a case with that configuration. The configuration options are managed by the Case Control System (CCS) within the Community Infrastructure for Modeling the Earth (CIME).</p> <p>Before reading the rest of this guide, you should become familiar with cases, compsets and grids by reading the Case Control System Basic Usage</p> <p>A step-by-step guide for running E3SM with a run script is available.</p>"},{"location":"user-guide/#supported-coupled-compsets","title":"Supported Coupled Compsets","text":"<p>A fully coupled compset is one which has active components for at least the atmosphere, ocean, land surface, ocean and sea-ice all interacting.  Each compset is associated with a specific forcing condition. Coupled compsets in E3SM are developed  for three science-driven simulation campaigns:  water cycle change and impacts, human-earth system feedbacks, and polar processes, sea-level rise and coastal impacts. The standard coupled configurations -- which consist of prognostic atmosphere, land, river, ocean and sea-ice components -- form the base physical coupled system and are mainly designed for <code>water cycle change and impacts</code> simulation campaign. Below list the standard configuration compsets supported in the current version of E3SM:</p> Compset alias Description <code>WCYCL1850</code> Standard configuration with pre-industrial climatological forcings <code>WCYCL1850-4xCO2</code> Same as <code>WCYCL1850</code> except with abrupt (then persistent) 4xCO2 forcing. <code>WCYCL1850-1pctCO2</code> Same as <code>WCYCL1850</code> except with 1 percent per year increase of CO2 concentration <code>WCYCL1950</code> Standard configuration with perpetual 1950 forcings <code>WCYCL20TR</code> Standard configuration with prescribed transient forcings over the historical period (1850-2014) <code>WCYCLSSP245</code> Standard configuration with prescribed SSP-245 forcings <code>WCYCLSSP370</code> Standard configuration with prescribed SSP-370 forcings <code>WCYCLSSP585</code> Standard configuration with prescribed SSP-585 forcings Compsets for single-forcings simulations of the historical period (1850-2014) <code>WCYCL20TR-GHG</code> Greenhouse gases only configuration (<code>GHGs</code>) <code>WCYCL20TR-aer</code> Anthropogenic aerosols and precursors only configuration (<code>aer</code>) <code>WCYCL20TR-xGHG-xaer</code> All forcings except GHGs and aer (<code>solar irradiance, stratospheric ozone and volcanic emissions, land use land cover</code>) <code>WCYCL20TR-xaer</code> All forcings except aer (<code>GHGs, solar irradiance, stratospheric ozone and volcanic emissions, land use land cover</code>) <code>WCYCL20TR-nat</code> Natural-only configuration (<code>solar irradiance, stratospheric volcanic emissions, land use land cover</code>) <code>WCYCL20TR-ozone</code> Stratospheric ozone only configuration <code>WCYCL20TR-lulc</code> Land use land cover only configuration <code>WCYCL20TR-volc</code> Stratospheric volcanic emissions only configuration <p>The table below specifies which forcing category is fixed at 1850 conditions and which are allowed to vary over the historical period for each of the historical (\"20TR\") compsets including the single-forcing compsets.</p> Compset alias GHGs Aerosol &amp; precursors Oxidants Ozone (CI &amp; Linoz) Volcano Solar Land Use &amp; ndep/popdensa <code>WCYCL20TR</code> varying varying varying varying varying varying varying <code>WCYCL20TR-GHG</code> varying 1850 1850 1850 1850 1850 1850 <code>WCYCL20TR-aer</code> 1850 varying varying 1850 1850 1850 1850 <code>WCYCL20TR-xGHG-xaer</code> 1850 1850 1850 varying varying varying varying <code>WCYCL20TR-xaer</code> varying 1850 1850 varying varying varying varying <code>WCYCL20TR-nat</code> 1850 1850 1850 1850 varying varying 1850 <code>WCYCL20TR-ozone</code> 1850 1850 1850 varying 1850 1850 1850 <code>WCYCL20TR-lulc</code> 1850 1850 1850 1850 1850 1850 varying <code>WCYCL20TR-volc</code> 1850 1850 1850 1850 varying 1850 1850 <ul> <li><sub> Volcano refers to stratospheric volcanic SO2 emissions; 1850 for Volcano refers to background (average) stratospheric volcanic emissions used in pre-industrial control experiments</sub></li> </ul> <ul> <li><sub> Oxidants always follow Aerosol &amp; precursors for fixed or varying.</sub></li> </ul> <p>The compsets for the other two science simulation campaigns are being finalized, with additional components and/or features. The compset naming follows the same convention, e.g., <code>CRYO1850</code> and <code>CRYO1850-4xCO2</code> are with prognostic ice-shelf melt fluxes for the <code>polar processes</code> simulation campaign.</p> <p>Compsets are also available for standalone component model configurations, See the User Guides for the components for more information.</p>"},{"location":"user-guide/#supported-resolution","title":"Supported resolution","text":"<p>Currently two grid sets are supported for the above compsets, including a nominal low-resosluton confiuguration and one regionally refined mesh. Additional regionally refined meshes and a high-resolution grid will become available in the near future.</p> Grid Alias Description ne30pg2_r05_IcoswISC30E3r5 For this grid set, the atmosphere is on the ne30pg2 cubed-sphere mesh with approximately 100km resolution, the land and river are on a 0.5deg x 0.5deg structured grid, and the ocean and sea ice are on a hexagonal mesh dervied from the dual of a 30km resolution icosahedral mesh with ice shelf cavities (wISC) around Antarctica. northamericax4v1pg2_r025_IcoswISC30E3r5 The atmosphere for this grid set uses North America regionally refined mesh from about 110 km down to 25 km over the refined region. The land and river are on 0.25deg x 0.25deg structured grid. The ocean and sea ice are on the same icosahedral mesh as for <code>ne30pg2_r05_IcoswISC30E3r5</code>."},{"location":"user-guide/#input-data","title":"Input data","text":"<p>Inputdata for coupled compsets at component model levels are the same as for the standalone component configurations for a given forcing scenario (e.g., <code>1850</code> for the pre-industrial period,  <code>20TR</code> for the historical period, <code>2010</code> for present-day condition, and <code>SSPs</code> for Shared Socioeconomic Pathways). Between the coupled compsets, the differences are in the prescribed solar forcing, volcanic emissions, atmospheric forcing data, and land use and land cover. The required inputdata for the pre-industrial and the historical periods as well as the present-day condition are described in the EAM User's Guide and the ELM's User's Guide. Below are the prescribed forcing data for the SSP scenarios.</p>"},{"location":"user-guide/#ssp245-forcing-data","title":"SSP245 forcing data","text":""},{"location":"user-guide/#ssp370-forcing-data","title":"SSP370 forcing data","text":""},{"location":"user-guide/#ssp585-forcing-data","title":"SSP585 forcing data","text":""},{"location":"user-guide/ssp245-forcings/","title":"SSP245 Forcing data","text":"<p>These are the prescribed inputdata specifically for the SSP245 scenario, in place of the files for the historical period.</p>"},{"location":"user-guide/ssp245-forcings/#solar-constant","title":"Solar constant","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/solar/Solar_1850-2299_input4MIPS_c20181106.nc</code></p>"},{"location":"user-guide/ssp245-forcings/#greenhouse-gas-concentrations","title":"Greenhouse gas concentrations","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/ggas/GHG_CMIP_SSP245-1-2-1_Annual_Global_2015-2500_c20200807.nc</code></p>"},{"location":"user-guide/ssp245-forcings/#elevated-external-forcings","title":"Elevated external forcings","text":"<pre><code>NO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_NO2_aircraft_vertical_2015-2100_1.9x2.5_c20240219.nc \nSO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_so2_volc_elev_2015-2100_c240331.nc \nSOAG0       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_SOAG0_elev_2015-2100_1.9x2.5_c20240219.nc \nbc_a4       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_bc_a4_elev_2015-2100_c200716.nc \nnum_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_num_a1_elev_2015-2100_c200716.nc \nnum_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_num_a2_elev_2015-2100_c200716.nc \nnum_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_num_a4_elev_2015-2100_c200716.nc \npom_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_pom_a4_elev_2015-2100_c200716.nc \nso4_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_so4_a1_elev_2015-2100_c200716.nc \nso4_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_so4_a2_elev_2015-2100_c200716.nc \n</code></pre>"},{"location":"user-guide/ssp245-forcings/#surface-emissions","title":"Surface emissions","text":"<pre><code>C2H4        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_C2H4_surface_2015-2100_1.9x2.5_c20240219.nc \nC2H6        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_C2H6_surface_2015-2100_1.9x2.5_c20240219.nc \nC3H8        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_C3H8_surface_2015-2100_1.9x2.5_c20240219.nc \nCH2O        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_CH2O_surface_2015-2100_1.9x2.5_c20240219.nc \nCH3CHO      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_CH3CHO_surface_2015-2100_1.9x2.5_c20240219.nc \nCH3COCH3    \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_CH3COCH3_surface_2015-2100_1.9x2.5_c20240219.nc \nCO          \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_CO_surface_2015-2100_1.9x2.5_c20240219.nc \nISOP        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240219.nc \nISOP_VBS    \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240219.nc \nC10H16      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_MTERP_surface_2015-2100_1.9x2.5_c20240219.nc \nNOX         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_NO_surface_2015-2100_1.9x2.5_c20240219.nc \nDMS         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DMSflux.1850-2100.1deg_latlon_conserv.POPmonthlyClimFromACES4BGC_c20160727.nc\nSO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_so2_surf_2015-2100_c200716.nc \nSOAG0       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/emissions-cmip6_ssp245_e3sm_SOAG0_surf_2015-2100_1.9x2.5_c20240219.nc \nbc_a4       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_bc_a4_surf_2015-2100_c200716.nc \nnum_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_num_a1_surf_2015-2100_c200716.nc \nnum_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_num_a2_surf_2015-2100_c200716.nc \nnum_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_num_a4_surf_2015-2100_c200716.nc \npom_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_pom_a4_surf_2015-2100_c200716.nc \nso4_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_so4_a1_surf_2015-2100_c200716.nc \nso4_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP245_ne30/cmip6_ssp245_mam4_so4_a2_surf_2015-2100_c200716.nc \nE90         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/emissions_E90_surface_1750-2101_1.9x2.5_c20231222.nc \n</code></pre>"},{"location":"user-guide/ssp245-forcings/#prescribed-oxidant-for-aerosol-chemistry","title":"Prescribed oxidant for aerosol chemistry","text":"<p><code>$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/oxid/oxid_SSP245_1.9x2.5_L70_1849-2101_c20240228.nc</code></p>"},{"location":"user-guide/ssp245-forcings/#stratospheric-ozone-linoz-and-chlorine-loading-data","title":"Stratospheric ozone (linoz) and chlorine loading data","text":"<pre><code>\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/Linoz_Chlorine_Loading_CMIP6_Hist_SSP245_0003-2503_c20200808.nc\n\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/linv3_1849-2101_CMIP6_Hist_SSP245_10deg_58km_c20230705.nc\n</code></pre>"},{"location":"user-guide/ssp245-forcings/#land-use-and-land-cover","title":"Land use and land cover","text":"<p><code>\\$DIN_LOC_ROOT/lnd/clm2/surfdata_map/landuse.timeseries_0.5x0.5_ssp2_rcp45_simyr2015-2100_c240408.nc</code></p>"},{"location":"user-guide/ssp370-forcings/","title":"SSP370 Forcing data","text":"<p>These are the prescribed inputdata specifically for the SSP370 scenario, in place of the files for the historical period.</p>"},{"location":"user-guide/ssp370-forcings/#solar-constant","title":"Solar constant","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/solar/Solar_1850-2299_input4MIPS_c20181106.nc</code></p>"},{"location":"user-guide/ssp370-forcings/#greenhouse-gas-concentrations","title":"Greenhouse gas concentrations","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/ggas/GHG_CMIP_SSP370-1-2-1_Annual_Global_2015-2500_c20210509.nc</code></p>"},{"location":"user-guide/ssp370-forcings/#elevated-external-forcings","title":"Elevated external forcings","text":"<pre><code>NO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_NO2_aircraft_vertical_2015-2100_1.9x2.5_c20240208.nc \nSO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so2_volc_elev_2015-2100_c240331.nc \nSOAG0       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_SOAG0_elev_2015-2100_1.9x2.5_c20240208.nc \nbc_a4       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_bc_a4_elev_2015-2100_c210216.nc \nnum_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a1_elev_2015-2100_c210216.nc \nnum_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a2_elev_2015-2100_c210216.nc \nnum_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a4_elev_2015-2100_c210216.nc \npom_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_pom_a4_elev_2015-2100_c210216.nc \nso4_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a1_elev_2015-2100_c210216.nc \nso4_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a2_elev_2015-2100_c210216.nc \n</code></pre>"},{"location":"user-guide/ssp370-forcings/#surface-emissions","title":"Surface emissions","text":"<pre><code>C2H4        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_C2H4_surface_2015-2100_1.9x2.5_c20240208.nc \nC2H6        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_C2H6_surface_2015-2100_1.9x2.5_c20240208.nc \nC3H8        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_C3H8_surface_2015-2100_1.9x2.5_c20240208.nc \nCH2O        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CH2O_surface_2015-2100_1.9x2.5_c20240208.nc \nCH3CHO      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CH3CHO_surface_2015-2100_1.9x2.5_c20240208.nc \nCH3COCH3    \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CH3COCH3_surface_2015-2100_1.9x2.5_c20240208.nc \nCO          \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_CO_surface_2015-2100_1.9x2.5_c20240208.nc \nISOP        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240208.nc \nISOP_VBS    \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240208.nc \nC10H16      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_MTERP_surface_2015-2100_1.9x2.5_c20240208.nc \nNOX         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_NO_surface_2015-2100_1.9x2.5_c20240208.nc \nDMS         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DMSflux.1850-2100.1deg_latlon_conserv.POPmonthlyClimFromACES4BGC_c20160727.nc\nSO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so2_surf_2015-2100_c210216.nc \nSOAG0       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/emissions-cmip6_ssp370_e3sm_SOAG0_surf_2015-2100_1.9x2.5_c20240208.nc \nbc_a4       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_bc_a4_surf_2015-2100_c210216.nc \nnum_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a1_surf_2015-2100_c210216.nc \nnum_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a2_surf_2015-2100_c210216.nc \nnum_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_num_a4_surf_2015-2100_c210216.nc \npom_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_pom_a4_surf_2015-2100_c210216.nc \nso4_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a1_surf_2015-2100_c210216.nc \nso4_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP370_ne30/cmip6_ssp370_mam4_so4_a2_surf_2015-2100_c210216.nc \nE90         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/emissions_E90_surface_1750-2101_1.9x2.5_c20231222.nc \n</code></pre>"},{"location":"user-guide/ssp370-forcings/#prescribed-oxidant-for-aerosol-chemistry","title":"Prescribed oxidant for aerosol chemistry","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/oxid/oxid_SSP370_1.9x2.5_L70_1849-2101_c20240228.nc</code></p>"},{"location":"user-guide/ssp370-forcings/#stratospheric-ozone-linoz-and-chlorine-loading-data","title":"Stratospheric ozone (linoz) and chlorine loading data","text":"<pre><code>\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/Linoz_Chlorine_Loading_CMIP6_Hist_SSP370_0003-2503_c20210202.nc\n\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/linv3_1849-2101_CMIP6_Hist_SSP370_10deg_58km_c20230705.nc\n</code></pre>"},{"location":"user-guide/ssp370-forcings/#land-use-and-land-cover","title":"Land use and land cover","text":"<p><code>\\$DIN_LOC_ROOT/lnd/clm2/surfdata_map/landuse.timeseries_0.5x0.5_ssp3_rcp70_simyr2015-2100_c240308.nc</code></p>"},{"location":"user-guide/ssp585-forcings/","title":"SSP585 Forcing data","text":"<p>These are the prescribed inputdata specifically for the SSP585 scenario, in place of the files for the historical period.</p>"},{"location":"user-guide/ssp585-forcings/#solar-constant","title":"Solar constant","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/solar/Solar_1850-2299_input4MIPS_c20181106.nc</code></p>"},{"location":"user-guide/ssp585-forcings/#greenhouse-gas-concentrations","title":"Greenhouse gas concentrations","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/ggas/GHG_CMIP_SSP585-1-2-1_Annual_Global_2015-2500_c20190310.nc</code></p>"},{"location":"user-guide/ssp585-forcings/#elevated-external-forcings","title":"Elevated external forcings","text":"<pre><code>NO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_NO2_aircraft_vertical_2015-2100_1.9x2.5_c20240304.nc \nSO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_so2_volc_elev_2015-2100_c240331.nc \nSOAG0       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_SOAG0_elev_2015-2100_1.9x2.5_c20240304.nc \nbc_a4       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_bc_a4_elev_2015-2100_c190828.nc \nnum_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_num_a1_elev_2015-2100_c190828.nc \nnum_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_num_a2_elev_2015-2100_c190828.nc \nnum_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_num_a4_elev_2015-2100_c190828.nc \npom_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_pom_a4_elev_2015-2100_c190828.nc \nso4_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_so4_a1_elev_2015-2100_c190828.nc \nso4_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_so4_a2_elev_2015-2100_c190828.nc \n</code></pre>"},{"location":"user-guide/ssp585-forcings/#surface-emissions","title":"Surface emissions","text":"<pre><code>C2H4        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_C2H4_surface_2015-2100_1.9x2.5_c20240304.nc \nC2H6        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_C2H6_surface_2015-2100_1.9x2.5_c20240304.nc \nC3H8        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_C3H8_surface_2015-2100_1.9x2.5_c20240304.nc \nCH2O        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_CH2O_surface_2015-2100_1.9x2.5_c20240304.nc \nCH3CHO      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_CH3CHO_surface_2015-2100_1.9x2.5_c20240304.nc \nCH3COCH3    \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_CH3COCH3_surface_2015-2100_1.9x2.5_c20240304.nc \nCO          \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_CO_surface_2015-2100_1.9x2.5_c20240304.nc \nISOP        \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240304.nc \nISOP_VBS    \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_ISOP_surface_2015-2100_1.9x2.5_c20240304.nc \nC10H16      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_MTERP_surface_2015-2100_1.9x2.5_c20240304.nc \nNOX         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_NO_surface_2015-2100_1.9x2.5_c20240304.nc \nDMS         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/DMSflux.1850-2100.1deg_latlon_conserv.POPmonthlyClimFromACES4BGC_c20160727.nc\nSO2         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_so2_surf_2015-2100_c190828.nc \nSOAG0       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/emissions-cmip6_ssp585_e3sm_SOAG0_surf_2015-2100_1.9x2.5_c20240304.nc \nbc_a4       \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_bc_a4_surf_2015-2100_c190828.nc \nnum_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_num_a1_surf_2015-2100_c190828.nc \nnum_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_num_a2_surf_2015-2100_c190828.nc \nnum_a3      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_num_a4_surf_2015-2100_c190828.nc \npom_a4      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_pom_a4_surf_2015-2100_c190828.nc \nso4_a1      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_so4_a1_surf_2015-2100_c190828.nc \nso4_a2      \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/emis/CMIP6_SSP585_ne30/cmip6_ssp585_mam4_so4_a2_surf_2015-2100_c190828.nc \nE90         \\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/emissions_E90_surface_1750-2101_1.9x2.5_c20231222.nc \n</code></pre>"},{"location":"user-guide/ssp585-forcings/#prescribed-oxidant-for-aerosol-chemistry","title":"Prescribed oxidant for aerosol chemistry","text":"<p><code>\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart_aero/oxid/oxid_SSP585_1.9x2.5_L70_2014-2101_c20240228.nc</code></p>"},{"location":"user-guide/ssp585-forcings/#stratospheric-ozone-linoz-and-chlorine-loading-data","title":"Stratospheric ozone (linoz) and chlorine loading data","text":"<pre><code>\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/Linoz_Chlorine_Loading_CMIP6_Hist_SSP585_0003-2503_c20190414.nc\n\\$DIN_LOC_ROOT/atm/cam/chem/trop_mozart/ub/linv3_1849-2101_CMIP6_Hist_SSP585_10deg_58km_c20230705.nc\n</code></pre>"},{"location":"user-guide/ssp585-forcings/#land-use-and-land-cover","title":"Land use and land cover","text":"<p><code>\\$DIN_LOC_ROOT/lnd/clm2/surfdata_map/landuse.timeseries_0.5x0.5_ssp5_rcp85_simyr2015-2100_c240408.nc</code></p>"}]}