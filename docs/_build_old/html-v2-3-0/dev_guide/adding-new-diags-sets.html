

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Add Diagnostic Sets to E3SM Diagnostics &mdash; E3SM Diags  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Prepare a Release" href="releasing-e3sm-diags.html" />
    <link rel="prev" title="Developer Guide" href="index.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> E3SM Diags
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">E3SM Diagnostics Package v2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input-data-requirement.html">Input Data Requirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickguides/index.html">Quick Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config-run.html">Configuration and Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="../defining-parameters.html">Defining Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../available-parameters.html">Available Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../colormaps.html">Colormaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../add-new-diagnostics.html">How to Add New Diagnostics Runs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to Add Diagnostic Sets to E3SM Diagnostics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-example-diagnostics-set">The Example Diagnostics Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-in-the-parameters">Adding In The Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#letting-the-parameter-class-be-used">Letting The Parameter Class Be Used</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-in-the-parser">Adding In The Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#letting-the-parser-class-be-used">Letting The Parser Class Be Used</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-in-the-driver">Adding In The Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-in-the-config-file-for-the-default-diagnostics">Adding In The Config File For The Default Diagnostics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-in-derived-variables">Adding In Derived Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-this-file">Installing This File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-in-the-plotting">Adding In The Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-the-viewer">Adding The Viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-it-all-together-and-running-on-cori-at-nersc">Putting It All Together And Running On Cori At NERSC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#some-examples-to-run">Some Examples To Run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="releasing-e3sm-diags.html">How to Prepare a Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-new-env.html">Creating a New Environment from Scratch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to E3SM Diags</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">E3SM Diags</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>How to Add Diagnostic Sets to E3SM Diagnostics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/dev_guide/adding-new-diags-sets.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-add-diagnostic-sets-to-e3sm-diagnostics">
<h1>How to Add Diagnostic Sets to E3SM Diagnostics<a class="headerlink" href="#how-to-add-diagnostic-sets-to-e3sm-diagnostics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>When planning to expand the current diagnostic sets, efforts have
been made to structure the <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> code base in a more modularized
and expandable fashion. The developers will be able to add new
diagnostic sets easily and cleanly. This guide documents the essential
steps for guiding users to add custom diagnostics by providing
an example. If a user has a streamlined Python script for a
complete analysis, from reading in files, data manipulation,
computation, and visualization, it should be straightforward
to take the below steps to add the analysis to <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code>.</p>
<p>In this document, we will explain by example the process
of adding a diagnostics set into <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code>.
Some of the current diagnostics sets in <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> are
<a class="reference external" href="../../../sample_output/modTS_vs_modTS_3years/viewer/index.html">the different kinds of plots seen here</a>.
If you have any questions or issues regarding this,
please make a Github issue on the e3sm_diags repo.</p>
<p>First off, to develop, you must have an
<a class="reference internal" href="../install.html#dev-env"><span class="std std-ref">e3sm_diags development environment installed</span></a>.</p>
<p>Below are the components needed to add new diags:</p>
<p>1. <strong>Parameters:</strong> A set of variables that a user uses to define things pertaining
to a diagnostics run. These can be anything, from the path of the reference/test
data to parameters related to the plots created. As a reference,
<a class="reference internal" href="../available-parameters.html"><span class="doc">look here for existing parameters and their description</span></a>.</p>
<p>2. <strong>Driver:</strong> The main code which takes a set of parameters and does the
diagnostics, including reading in data files, manipulating data sets, computing metrics,
and getting the data ready to be carried over to the plotting function.</p>
<p>3. <strong>Adding Default Diagnostics:</strong> Though users can choose what variables they
want to run diags on, we need to provide default variables.
Adding in derived variables is also covered in this guide.</p>
<p>4. <strong>Plot:</strong> A script which takes the output from the driver
and creates the plots.</p>
<p>5. <strong>Viewer:</strong> For a given plotset, create the htmls that host
the output of the plotting.</p>
</div>
<div class="section" id="the-example-diagnostics-set">
<h2>The Example Diagnostics Set<a class="headerlink" href="#the-example-diagnostics-set" title="Permalink to this headline">¶</a></h2>
<p>Say we have a diagnostics set that will simply take the difference between
some reference data and some test data (ex. regular lat-lon grid data in
climatology annual mean). Let’s call it <code class="docutils literal notranslate"><span class="pre">diff_diags</span></code>.
<strong>From this point on,</strong> <cite>‘diff_diags’</cite> <strong>is the name of this diagnostics set.</strong></p>
</div>
<div class="section" id="adding-in-the-parameters">
<h2>Adding In The Parameters<a class="headerlink" href="#adding-in-the-parameters" title="Permalink to this headline">¶</a></h2>
<p>All of diagnostics sets in <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> share a set of core parameters,
which can be changed during runtime. The <strong>default values</strong> for these
parameters are defined in the
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/blob/master/acme_diags/parameter/core_parameter.py">acme_diags/parameter/core_parameter.py</a>
folder.
<a class="reference internal" href="../available-parameters.html"><span class="doc">On the documentation website, there is more information explaining what each one does</span></a>.</p>
<p>First, open <code class="docutils literal notranslate"><span class="pre">acme_diags/parameter/core_parameter.py</span></code> and edit <code class="docutils literal notranslate"><span class="pre">self.sets</span></code> to include <code class="docutils literal notranslate"><span class="pre">'diff_diags'</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;zonal_mean_xy&#39;</span><span class="p">,</span> <span class="s1">&#39;zonal_mean_2d&#39;</span><span class="p">,</span> <span class="s1">&#39;meridional_mean_2d&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lat_lon&#39;</span><span class="p">,</span> <span class="s1">&#39;polar&#39;</span><span class="p">,</span> <span class="s1">&#39;area_mean_time_series&#39;</span><span class="p">,</span> <span class="s1">&#39;cosp_histogram&#39;</span><span class="p">,</span>
    <span class="s1">&#39;diff_diags&#39;</span><span class="p">,]</span>
</pre></div>
</div>
</div></blockquote>
<p>This ensures that when the user wants to run all of the plotsets,
the new one you made is included.</p>
<p>Now to make things more interesting, we want to add parameters
that are <strong>just specific to this plotset</strong>. Say we have parameters
called <code class="docutils literal notranslate"><span class="pre">projection</span></code> and <code class="docutils literal notranslate"><span class="pre">central_lon</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">projection</span></code> changes the plot the that specific projection.
The only values we support for now are <code class="docutils literal notranslate"><span class="pre">'mercator'</span></code>, <code class="docutils literal notranslate"><span class="pre">'platecarree'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'miller'</span></code>.
The default value is <code class="docutils literal notranslate"><span class="pre">'platecarree'</span></code>.
For more information regarding these projections, <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/crs/projections.html">see here</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">central_lon</span></code> changes the central point of the plot. It’s <code class="docutils literal notranslate"><span class="pre">180</span></code> be default.</p></li>
</ul>
<p>In the <code class="docutils literal notranslate"><span class="pre">acme_diags/parameter</span></code> directory, create a file called <code class="docutils literal notranslate"><span class="pre">diff_diags_parameter.py</span></code>.
Below is the code for it.</p>
<p><strong>When you create your own plotset, please change the name of the class.</strong>
In this case, the name of the class in <code class="docutils literal notranslate"><span class="pre">DiffDiagsParameter</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.core_parameter</span> <span class="kn">import</span> <span class="n">CoreParameter</span>


<span class="k">class</span> <span class="nc">DiffDiagsParameter</span><span class="p">(</span><span class="n">CoreParameter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;platecarree&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">central_lon</span> <span class="o">=</span> <span class="mi">180</span>

    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Make sure that the core parameters are also valid.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">check_values</span><span class="p">()</span>
        <span class="c1"># Check that the user inputted values are valid.</span>
        <span class="n">valid_projections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;mercator&#39;</span><span class="p">,</span> <span class="s1">&#39;platecarree&#39;</span><span class="p">,</span>
            <span class="s1">&#39;miller&#39;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_projections</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Your projection (</span><span class="si">{}</span><span class="s2">) isn&#39;t a valid value in: </span><span class="si">{}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">valid_projections</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">central_lon</span> <span class="o">&lt;=</span> <span class="mi">360</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;central_lon must be between 0 and 360 inclusive.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that we have a definition for the <code class="docutils literal notranslate"><span class="pre">check_values()</span></code> function.
This function makes sure that the user has inputted correct values for the parameters.
<strong>This function is optional and isn’t required.</strong></p>
<p>Also note that this Parameter class inherits from the <code class="docutils literal notranslate"><span class="pre">CoreParameter</span></code>,
which contains the core parameters that all plotsets use. This means that
<strong>this plotset will use all of the core parameters, in addition to the</strong>
<strong>set-specific ones define in the</strong> <code class="docutils literal notranslate"><span class="pre">DiffDiagsParameter</span></code>.</p>
<div class="section" id="letting-the-parameter-class-be-used">
<h3>Letting The Parameter Class Be Used<a class="headerlink" href="#letting-the-parameter-class-be-used" title="Permalink to this headline">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">acme_diags/parameter/__init__.py</span></code> and edit it like so.
Please read the comments.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.core_parameter</span> <span class="kn">import</span> <span class="n">CoreParameter</span>
<span class="kn">from</span> <span class="nn">.zonal_mean_2d_parameter</span> <span class="kn">import</span> <span class="n">ZonalMean2dParameter</span>
<span class="c1"># First, import the new Parameter class.</span>
<span class="kn">from</span> <span class="nn">.diff_diags_parameter</span> <span class="kn">import</span> <span class="n">DiffDiagsParameter</span>

<span class="n">SET_TO_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;zonal_mean_xy&#39;</span><span class="p">:</span> <span class="n">CoreParameter</span><span class="p">,</span>
    <span class="s1">&#39;zonal_mean_2d&#39;</span><span class="p">:</span> <span class="n">ZonalMean2dParameter</span><span class="p">,</span>
    <span class="s1">&#39;meridional_mean_2d&#39;</span><span class="p">:</span> <span class="n">CoreParameter</span><span class="p">,</span>
    <span class="s1">&#39;lat_lon&#39;</span><span class="p">:</span> <span class="n">CoreParameter</span><span class="p">,</span>
    <span class="s1">&#39;polar&#39;</span><span class="p">:</span> <span class="n">CoreParameter</span><span class="p">,</span>
    <span class="s1">&#39;cosp_histogram&#39;</span><span class="p">:</span> <span class="n">CoreParameter</span><span class="p">,</span>
    <span class="s1">&#39;area_mean_time_series&#39;</span><span class="p">:</span> <span class="n">CoreParameter</span><span class="p">,</span>
    <span class="c1"># For the diff_diags plotset, we want to use the</span>
    <span class="c1"># below Parameter class.</span>
    <span class="s1">&#39;diff_diags&#39;</span><span class="p">:</span> <span class="n">DiffDiagsParameter</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="adding-in-the-parser">
<h3>Adding In The Parser<a class="headerlink" href="#adding-in-the-parser" title="Permalink to this headline">¶</a></h3>
<p>Notice that in the <a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/tree/master/acme_diags/parameter">acme_diags/parameter</a>
folder, we have the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">core_parameter.py</span></code>, where <code class="docutils literal notranslate"><span class="pre">CoreParameter</span></code> is located.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zonal_mean_2d_parameter.py</span></code>, where <code class="docutils literal notranslate"><span class="pre">ZonalMean2dParameter</span></code> is located.</p>
<ul>
<li><p>This container parameters specific to the <code class="docutils literal notranslate"><span class="pre">'zonal_mean_2d'</span></code> plotset.</p></li>
<li><p>Again, since <code class="docutils literal notranslate"><span class="pre">ZonalMean2dParameter</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">CoreParameter</span></code>,
it’ll use all of the core parameters, in addition to it’s set-specific ones.</p></li>
</ul>
</li>
</ul>
<p><strong>Every Parameter object needs a corresponding Parser object.</strong>
The Parser is the command line parser which can take in the parameters
as command line arguments. The users have the option to run <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code>
via the command line. For example, this is done for the provenance, which
is the command shown in the bottom for each webpage with a plot.
One can reproduce or fine tune a single diagnostic by using the provenance command line.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">acme_diags/parser</span></code> directory, create a file called <code class="docutils literal notranslate"><span class="pre">diff_diags_parser.py</span></code>.
Below is the code for it. Some points:</p>
<ul>
<li><p>Like how the <code class="docutils literal notranslate"><span class="pre">DiffDiagsParameter</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">CoreParameter</span></code>, our parser
<code class="docutils literal notranslate"><span class="pre">DiffDiagsParser</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">CoreParser</span></code>.</p></li>
<li><p>Remember to change the name of your class accordingly based on your plotset name.</p></li>
<li><p>Please read the comments as well and implement the changes.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.core_parser</span> <span class="kn">import</span> <span class="n">CoreParser</span>
<span class="c1"># We need to import the corresponding Parameter object.</span>
<span class="kn">from</span> <span class="nn">acme_diags.parameter.diff_diags_parameter</span> <span class="kn">import</span> <span class="n">DiffDiagsParameter</span>


<span class="k">class</span> <span class="nc">DiffDiagsParser</span><span class="p">(</span><span class="n">CoreParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;parameter_cls&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We want this Parser to create objects of type DiffDiagsParameter.</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parameter_cls</span><span class="o">=</span><span class="n">DiffDiagsParameter</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">load_default_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1"># This has &#39;-p&#39; and &#39;--parameter&#39; reserved.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_default_args</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

        <span class="c1"># The parameters unique to DiffDiagsParameter are added here.</span>
        <span class="c1"># For more information about adding arguments to the parser,</span>
        <span class="c1"># please search how to add arguments to Python&#39;s argument parser.</span>
        <span class="c1"># The way is exactly the same.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--projection&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The type of the projection &#39;</span>
            <span class="o">+</span> <span class="s1">&#39;used when plotting.&#39;</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--central_lon&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;central_lon&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The central longitude of the plot.&#39;</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="letting-the-parser-class-be-used">
<h3>Letting The Parser Class Be Used<a class="headerlink" href="#letting-the-parser-class-be-used" title="Permalink to this headline">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">acme_diags/parser/__init__.py</span></code> and edit it like so.
Please read the comments.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.core_parser</span> <span class="kn">import</span> <span class="n">CoreParser</span>
<span class="kn">from</span> <span class="nn">.zonal_mean_2d_parser</span> <span class="kn">import</span> <span class="n">ZonalMean2dParser</span>
<span class="c1"># First, import the new Parser class.</span>
<span class="kn">from</span> <span class="nn">.diff_diags_parser</span> <span class="kn">import</span> <span class="n">DiffDiagsParser</span>


<span class="n">SET_TO_PARSER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;zonal_mean_xy&#39;</span><span class="p">:</span> <span class="n">CoreParser</span><span class="p">,</span>
    <span class="s1">&#39;zonal_mean_2d&#39;</span><span class="p">:</span> <span class="n">ZonalMean2dParser</span><span class="p">,</span>
    <span class="s1">&#39;meridional_mean_2d&#39;</span><span class="p">:</span> <span class="n">CoreParser</span><span class="p">,</span>
    <span class="s1">&#39;lat_lon&#39;</span><span class="p">:</span> <span class="n">CoreParser</span><span class="p">,</span>
    <span class="s1">&#39;polar&#39;</span><span class="p">:</span> <span class="n">CoreParser</span><span class="p">,</span>
    <span class="s1">&#39;cosp_histogram&#39;</span><span class="p">:</span> <span class="n">CoreParser</span><span class="p">,</span>
    <span class="s1">&#39;area_mean_time_series&#39;</span><span class="p">:</span> <span class="n">CoreParser</span><span class="p">,</span>
    <span class="c1"># For the diff_diags plotset, we want to use the</span>
    <span class="c1"># below Parser class.</span>
    <span class="s1">&#39;diff_diags&#39;</span><span class="p">:</span> <span class="n">DiffDiagsParser</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="adding-in-the-driver">
<h2>Adding In The Driver<a class="headerlink" href="#adding-in-the-driver" title="Permalink to this headline">¶</a></h2>
<p>The driver is the main code which takes in a single Parameter object and does the diagnostics.
For each plotset, its corresponding driver is located in the
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/tree/master/acme_diags/driver">acme_diags/driver</a>
folder. Please refer to these existing drivers, and if you need help creating
your driver, create a Github issue.</p>
<p><strong>This part of the code varies greatly based on the analysis.</strong>
<strong>There’s no set way to do this.</strong></p>
<p>However, to get a variable based on the user’s parameters (<code class="docutils literal notranslate"><span class="pre">reference_data_path</span></code>,
<code class="docutils literal notranslate"><span class="pre">test_data_path</span></code>, and more) and the way <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> input data is structured
(how the obs are named, the file naming conventions of the model files, etc.)
using the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> class is <strong>highly recommended</strong>.</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">diff_diags_driver.py</span></code> below uses it.</p></li>
<li><p>It’s located in <a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/blob/master/acme_diags/driver/utils/dataset.py">acme_diags/driver/utils/dataset.py</a>.</p></li>
<li><p>With only two lines of code, here’s how you get the variable PRECT from the test data with ANN climatology ran on it.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">prect_climo</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get_climo_variable</span><span class="p">(</span><span class="s1">&#39;PRECT&#39;</span><span class="p">,</span> <span class="s1">&#39;ANN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>You can also get time-series data as well:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">prect_time_series</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get_timeseries_variable</span><span class="p">(</span><span class="s1">&#39;PRECT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>In <code class="docutils literal notranslate"><span class="pre">acme_diags/driver</span></code>, create a file called <code class="docutils literal notranslate"><span class="pre">diff_diags_driver.py</span></code>.
<strong>Each Driver must have a</strong> <code class="docutils literal notranslate"><span class="pre">run_diags()</span></code> <strong>function which takes in a single Parameters object.</strong>
<strong>It also must return that Parameters object as well at the end of all of the for-loops.</strong></p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">acme_diags.driver</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">acme_diags.metrics</span> <span class="kn">import</span> <span class="n">min_cdms</span><span class="p">,</span> <span class="n">max_cdms</span><span class="p">,</span> <span class="n">mean</span>
<span class="c1"># The below will be defined in a future section.</span>
<span class="kn">from</span> <span class="nn">acme_diags.plot.cartopy</span> <span class="kn">import</span> <span class="n">diff_diags_plot</span>

<span class="k">def</span> <span class="nf">run_diag</span><span class="p">(</span><span class="n">parameter</span><span class="p">):</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">variables</span>
    <span class="n">seasons</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">seasons</span>

    <span class="n">test_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ref_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">seasons</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">test_var</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get_climo_variable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">)</span>
            <span class="n">ref_var</span> <span class="o">=</span> <span class="n">ref_data</span><span class="o">.</span><span class="n">get_climo_variable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">)</span>

            <span class="c1"># Only needed because our viewer (the final step)</span>
            <span class="c1"># displays this data.</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">viewer_descr</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">test_var</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>

            <span class="c1"># Regrid towards the lower resolution of the two</span>
            <span class="c1"># variables for calculating the difference.</span>
            <span class="c1"># The regrid_tool and regrid_method have default values.</span>
            <span class="n">test_var_reg</span><span class="p">,</span> <span class="n">ref_var_reg</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">regrid_to_lower_res</span><span class="p">(</span>
                <span class="n">test_var</span><span class="p">,</span> <span class="n">ref_var</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">regrid_tool</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">regrid_method</span><span class="p">)</span>

            <span class="n">diff</span> <span class="o">=</span> <span class="n">test_var_reg</span> <span class="o">-</span> <span class="n">ref_var_reg</span>

            <span class="c1"># We want to compute some metrics to plot as well.</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_cdms</span><span class="p">(</span><span class="n">diff</span><span class="p">)),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_cdms</span><span class="p">(</span><span class="n">diff</span><span class="p">)),</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
            <span class="p">}</span>

            <span class="c1"># This part will be defined in a forthcoming section.</span>
            <span class="n">diff_diags_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span>

    <span class="c1"># Don&#39;t forget this.</span>
    <span class="k">return</span> <span class="n">parameter</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="adding-in-the-config-file-for-the-default-diagnostics">
<h2>Adding In The Config File For The Default Diagnostics<a class="headerlink" href="#adding-in-the-config-file-for-the-default-diagnostics" title="Permalink to this headline">¶</a></h2>
<p>When the user selects a certain number of plotsets to run, their
parameters are combined with default parameters for that plot set.
These are defined in
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/tree/master/acme_diags/driver/default_diags">acme_diags/driver/default_diags/</a>.
For the each plotset, we have two default files, one for <code class="docutils literal notranslate"><span class="pre">model_vs_model</span></code> runs and one for <code class="docutils literal notranslate"><span class="pre">model_vs_obs</span></code> runs.
The type of file used is determined by the <code class="docutils literal notranslate"><span class="pre">run_type</span></code> parameter in <code class="docutils literal notranslate"><span class="pre">CoreParameter</span></code>, which is <code class="docutils literal notranslate"><span class="pre">'model_vs_obs'</span></code> by default.</p>
<p>Create a file <code class="docutils literal notranslate"><span class="pre">diff_diags_model_vs_obs.cfg</span></code> in the directory with the below contents.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="c1">#]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;diff_diags&quot;</span><span class="p">]</span>
<span class="n">case_id</span> <span class="o">=</span> <span class="s2">&quot;GPCP_v2.2&quot;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NEW_PRECT&quot;</span><span class="p">]</span>
<span class="n">ref_name</span> <span class="o">=</span> <span class="s2">&quot;GPCP_v2.2&quot;</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">,</span> <span class="s2">&quot;DJF&quot;</span><span class="p">,</span> <span class="s2">&quot;MAM&quot;</span><span class="p">,</span> <span class="s2">&quot;JJA&quot;</span><span class="p">,</span> <span class="s2">&quot;SON&quot;</span><span class="p">]</span>
<span class="n">diff_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="p">[</span><span class="c1">#]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;diff_diags&quot;</span><span class="p">]</span>
<span class="n">case_id</span> <span class="o">=</span> <span class="s2">&quot;SST_CL_HadISST&quot;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SST&quot;</span><span class="p">]</span>
<span class="n">ref_name</span> <span class="o">=</span> <span class="s2">&quot;HadISST_CL&quot;</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">,</span> <span class="s2">&quot;DJF&quot;</span><span class="p">,</span> <span class="s2">&quot;MAM&quot;</span><span class="p">,</span> <span class="s2">&quot;JJA&quot;</span><span class="p">,</span> <span class="s2">&quot;SON&quot;</span><span class="p">]</span>
<span class="n">diff_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="p">[</span><span class="c1">#]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;diff_diags&quot;</span><span class="p">]</span>
<span class="n">case_id</span> <span class="o">=</span> <span class="s2">&quot;CERES-EBAF-TOA-v2.8&quot;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SOLIN&quot;</span><span class="p">]</span>
<span class="n">ref_name</span> <span class="o">=</span> <span class="s2">&quot;ceres_ebaf_toa_v2.8&quot;</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">,</span> <span class="s2">&quot;DJF&quot;</span><span class="p">,</span> <span class="s2">&quot;MAM&quot;</span><span class="p">,</span> <span class="s2">&quot;JJA&quot;</span><span class="p">,</span> <span class="s2">&quot;SON&quot;</span><span class="p">]</span>
<span class="n">diff_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>You must make sure the <code class="docutils literal notranslate"><span class="pre">sets</span></code> parameter in each section (a section starts with <code class="docutils literal notranslate"><span class="pre">[#]</span></code>) is <code class="docutils literal notranslate"><span class="pre">[&quot;diff_diags&quot;]</span></code>.</p>
<p>In the above file, we have three sections. The result of this are three <code class="docutils literal notranslate"><span class="pre">DiffDiagsParameter</span></code> objects.
The user-inputted parameters will be added to each of these three objects.
Once combined with the user’s input, each of the Parameter objects has the valid parameters to run the software.
Each is passed in to the <code class="docutils literal notranslate"><span class="pre">run_diags()</span></code> function in <code class="docutils literal notranslate"><span class="pre">diff_diags_driver.py</span></code> automatically.</p>
<div class="section" id="adding-in-derived-variables">
<h3>Adding In Derived Variables<a class="headerlink" href="#adding-in-derived-variables" title="Permalink to this headline">¶</a></h3>
<p>This part only needs to be done if new variables are added for you new plotset.</p>
<p>A set of variables are defined in e3sm_diags in
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/blob/master/acme_diags/derivations/acme.py">acme_diags/derivations/acme.py</a>.
Notice that in the above file, we had a variable <code class="docutils literal notranslate"><span class="pre">NEW_PRECT</span></code>.
It’s a new and derived variable, composed of two or more variables.
In this case, <code class="docutils literal notranslate"><span class="pre">NEW_PRECT</span></code> is composed of <code class="docutils literal notranslate"><span class="pre">PRECT</span></code> and <code class="docutils literal notranslate"><span class="pre">PRECL</span></code>.
<a class="reference internal" href="../add-new-diagnostics.html"><span class="doc">Read more about derived variables here</span></a>.</p>
<p>Open <a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/blob/master/acme_diags/derivations/acme.py">acme_diags/derivations/acme.py</a>
and add the function below. It handles what to do when we have <code class="docutils literal notranslate"><span class="pre">NEW_PRECT</span></code> as a variable.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_prect</span><span class="p">(</span><span class="n">precc</span><span class="p">,</span> <span class="n">precl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Total precipitation flux = convective + large-scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">precc</span> <span class="o">+</span> <span class="n">precl</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="s2">&quot;mm/day&quot;</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Total precipitation rate (convective + large-scale)&quot;</span>
    <span class="k">return</span> <span class="n">var</span>
</pre></div>
</div>
</div></blockquote>
<p>We need to make sure that this function is actually called.
In the <code class="docutils literal notranslate"><span class="pre">derived_variables</span></code> dictionary in <code class="docutils literal notranslate"><span class="pre">acme_diags/derivations/acme.py</span></code>, add the following entry.
It’s basically the same as <code class="docutils literal notranslate"><span class="pre">PRECT</span></code>, but with the <code class="docutils literal notranslate"><span class="pre">new_prect()</span></code> function being called.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">derived_variables</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;NEW_PRECT&#39;</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">([</span>
        <span class="c1"># This variable is &#39;PRECT&#39; in newer versions of the obs data.</span>
        <span class="c1"># So we just get the variable and don&#39;t do anything.</span>
        <span class="p">((</span><span class="s1">&#39;PRECT&#39;</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">prect</span><span class="p">:</span> <span class="n">prect</span><span class="p">),</span>
        <span class="c1"># This variable is &#39;pr&#39; in older versions of the obs data.</span>
        <span class="p">((</span><span class="s1">&#39;pr&#39;</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">pr</span><span class="p">:</span> <span class="n">qflxconvert_units</span><span class="p">(</span><span class="n">rename</span><span class="p">(</span><span class="n">pr</span><span class="p">))),</span>
        <span class="c1"># In the model data, it&#39;s composed of PRECC and PRECL.</span>
        <span class="p">((</span><span class="s1">&#39;PRECC&#39;</span><span class="p">,</span> <span class="s1">&#39;PRECL&#39;</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">precc</span><span class="p">,</span> <span class="n">precl</span><span class="p">:</span> <span class="n">new_prect</span><span class="p">(</span><span class="n">precc</span><span class="p">,</span> <span class="n">precl</span><span class="p">))</span>
    <span class="p">]),</span>
    <span class="c1"># Below is the old stuff. Don&#39;t insert the below.</span>
    <span class="s1">&#39;PRECT&#39;</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">([</span>
        <span class="p">((</span><span class="s1">&#39;pr&#39;</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">pr</span><span class="p">:</span> <span class="n">qflxconvert_units</span><span class="p">(</span><span class="n">rename</span><span class="p">(</span><span class="n">pr</span><span class="p">))),</span>
        <span class="p">((</span><span class="s1">&#39;PRECC&#39;</span><span class="p">,</span> <span class="s1">&#39;PRECL&#39;</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">precc</span><span class="p">,</span> <span class="n">precl</span><span class="p">:</span> <span class="n">prect</span><span class="p">(</span><span class="n">precc</span><span class="p">,</span> <span class="n">precl</span><span class="p">))</span>
    <span class="p">]),</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="installing-this-file">
<h3>Installing This File<a class="headerlink" href="#installing-this-file" title="Permalink to this headline">¶</a></h3>
<p>Open <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> in the root of this directory and add the following, somewhere before <code class="docutils literal notranslate"><span class="pre">data_files</span></code> is initialized.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">diff_diags_files</span> <span class="o">=</span> <span class="n">get_all_files_in_dir</span><span class="p">(</span><span class="s1">&#39;acme_diags/driver/default_diags&#39;</span><span class="p">,</span> <span class="s1">&#39;diff_diags*&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Now modify <code class="docutils literal notranslate"><span class="pre">data_files</span></code> like below.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INSTALL_PATH</span><span class="p">,</span> <span class="s1">&#39;area_mean_time_series&#39;</span><span class="p">),</span>
<span class="n">area_mean_time_series</span>
<span class="p">),</span>
<span class="c1"># We added in the below.</span>
<span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INSTALL_PATH</span><span class="p">,</span> <span class="s1">&#39;diff_diags&#39;</span><span class="p">),</span>
<span class="n">diff_diags_files</span>
<span class="p">),</span>
<span class="c1"># The above was added in.</span>
<span class="p">(</span><span class="n">INSTALL_PATH</span><span class="p">,</span>
<span class="p">[</span><span class="s1">&#39;acme_diags/driver/acme_ne30_ocean_land_mask.nc&#39;</span><span class="p">,</span>
<span class="s1">&#39;misc/e3sm_logo.png&#39;</span>
<span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Every time you make a change to</strong> <code class="docutils literal notranslate"><span class="pre">diff_diags_model_vs_obs.cfg</span></code> <strong>and do a run, make sure you run</strong>
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">.</span></code> <strong>as explained in the “Putting It All Together And Running On Cori At NERSC” section.</strong>
<strong>This is because when running the software, these files are obtained from where they’re installed.</strong></p>
</div>
</div>
<div class="section" id="adding-in-the-plotting">
<h2>Adding In The Plotting<a class="headerlink" href="#adding-in-the-plotting" title="Permalink to this headline">¶</a></h2>
<p>Data created in the driver needs to be carried over and needs to be plotted
using the plotting script. In our case, we only want to plot the <code class="docutils literal notranslate"><span class="pre">diff</span></code> data.
Other plotsets, like <code class="docutils literal notranslate"><span class="pre">lat_lon</span></code>, plot more data.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">acme_diags/plot/cartopy/</span></code>, create a file called <code class="docutils literal notranslate"><span class="pre">diff_diags_plot.py</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plot()</span></code> function is what the driver, <code class="docutils literal notranslate"><span class="pre">diff_diags_driver.py</span></code> will call.
<strong>Again, the code for this varies greatly based on the actual plot set.</strong>
In this script, we’re using the <code class="docutils literal notranslate"><span class="pre">projection</span></code> and <code class="docutils literal notranslate"><span class="pre">central_lon</span></code> parameters.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="k">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">cartopy.mpl.ticker</span> <span class="kn">import</span> <span class="n">LongitudeFormatter</span><span class="p">,</span> <span class="n">LatitudeFormatter</span>
<span class="kn">from</span> <span class="nn">acme_diags.plot</span> <span class="kn">import</span> <span class="n">get_colormap</span>
<span class="kn">from</span> <span class="nn">acme_diags.driver.utils.general</span> <span class="kn">import</span> <span class="n">get_output_dir</span>


<span class="k">def</span> <span class="nf">add_cyclic</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">var</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="p">(</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">,</span> <span class="s1">&#39;coe&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_ax_size</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="o">.</span><span class="n">inverted</span><span class="p">())</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">height</span>
    <span class="n">width</span> <span class="o">*=</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span>
    <span class="n">height</span> <span class="o">*=</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span>
    <span class="k">return</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
    <span class="c1"># Create figure, projection</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;mercator&#39;</span><span class="p">:</span>
        <span class="n">proj_cls</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span>
    <span class="k">elif</span> <span class="n">parameter</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;platecarree&#39;</span><span class="p">:</span>
        <span class="n">proj_cls</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span>
    <span class="k">elif</span> <span class="n">parameter</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;miller&#39;</span><span class="p">:</span>
        <span class="n">proj_cls</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Miller</span>

    <span class="n">central_lon</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">central_lon</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">proj_cls</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_lon</span><span class="p">)</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">asma</span><span class="p">())</span>

    <span class="c1"># Contour levels</span>
    <span class="n">clevels</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">diff_levels</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0e8</span><span class="p">]</span> <span class="o">+</span> <span class="n">clevels</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1.0e8</span><span class="p">]</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>

    <span class="n">panel</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1691</span><span class="p">,</span> <span class="mf">0.6810</span><span class="p">,</span> <span class="mf">0.6465</span><span class="p">,</span> <span class="mf">0.2258</span><span class="p">)</span>
    <span class="c1"># Contour plot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
    <span class="c1"># ax = fig.add_axes(panel[n], projection=proj)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">get_colormap</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">diff_colormap</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">proj_cls</span><span class="p">(),</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                    <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                    <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">diff_title</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">diff_title</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mf">11.5</span><span class="p">})</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">359.99</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">proj_cls</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">proj_cls</span><span class="p">())</span>
    <span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span>
        <span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">number_format</span><span class="o">=</span><span class="s1">&#39;.0f&#39;</span><span class="p">)</span>
    <span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># Color bar</span>
    <span class="n">cbax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
        <span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.6635</span><span class="p">,</span> <span class="n">panel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0215</span><span class="p">,</span> <span class="mf">0.0326</span><span class="p">,</span> <span class="mf">0.1792</span><span class="p">))</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbax</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">get_ax_size</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">cbax</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mf">9.0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">maxval</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%5.2f</span><span class="s2">&quot;</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="k">elif</span> <span class="n">maxval</span> <span class="o">&lt;</span> <span class="mf">100.0</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%5.1f</span><span class="s2">&quot;</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%6.1f</span><span class="s2">&quot;</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mf">9.0</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Min, Mean, Max</span>
    <span class="n">plotSideTitle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mf">9.5</span><span class="p">}</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.6635</span><span class="p">,</span> <span class="n">panel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2107</span><span class="p">,</span>
            <span class="s2">&quot;Max</span><span class="se">\n</span><span class="s2">Mean</span><span class="se">\n</span><span class="s2">Min&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">plotSideTitle</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.7635</span><span class="p">,</span> <span class="n">panel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2107</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="se">\n</span><span class="si">%.2f</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span>
            <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">plotSideTitle</span><span class="p">)</span>


    <span class="c1"># Figure title</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">parameter</span><span class="o">.</span><span class="n">main_title</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">main_title</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># Save figure</span>
    <span class="c1"># Get the filename that the user has passed in and display that.</span>
    <span class="c1"># When running in a container, the paths are modified.</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_output_dir</span><span class="p">(</span><span class="s1">&#39;diff_diags&#39;</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span>
        <span class="n">ignore_container</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot saved in: &#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="adding-the-viewer">
<h2>Adding The Viewer<a class="headerlink" href="#adding-the-viewer" title="Permalink to this headline">¶</a></h2>
<p>Each plotset needs to have webpages generated for it that allow users to look at the resultant figures.
In <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code>, each of the plotset is <strong>mapped to a function that takes in all of the Parameter objects</strong>
<strong>for that plotset, then creates the webpages and returns a</strong> <code class="docutils literal notranslate"><span class="pre">(display_name,</span> <span class="pre">url)</span></code> <strong>tuple of strings</strong>.</p>
<p>First in <a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/tree/master/acme_diags/viewer">acme_diags/viewer/</a>
create a file <code class="docutils literal notranslate"><span class="pre">diff_diags_viewer.py</span></code> paste in the below code.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">add_header</span><span class="p">,</span> <span class="n">h1_to_h3</span>
<span class="kn">from</span> <span class="nn">.default_viewer</span> <span class="kn">import</span> <span class="n">create_metadata</span>
<span class="kn">from</span> <span class="nn">cdp.cdp_viewer</span> <span class="kn">import</span> <span class="n">OutputViewer</span>


<span class="k">def</span> <span class="nf">create_viewer</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a set of parameters for a the diff_diags set,</span>
<span class="sd">    create a single webpage.</span>

<span class="sd">    Return the title and url for this page.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">viewer</span> <span class="o">=</span> <span class="n">OutputViewer</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">root_dir</span><span class="p">)</span>

    <span class="c1"># The name that&#39;s displayed on the viewer.</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;Diff Diagnostics&#39;</span>
    <span class="n">set_name</span> <span class="o">=</span> <span class="s1">&#39;diff_diags&#39;</span>
    <span class="c1"># The title of the colums on the webpage.</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Plot&#39;</span><span class="p">]</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">add_page</span><span class="p">(</span><span class="n">display_name</span><span class="p">,</span> <span class="n">short_name</span><span class="o">=</span><span class="n">set_name</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">seasons</span><span class="p">:</span>
                <span class="n">viewer</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">))</span>
                <span class="c1"># Adding the description for this var to the current row.</span>
                <span class="c1"># This was obtained and stored in the driver for this plotset.</span>
                <span class="n">viewer</span><span class="o">.</span><span class="n">add_col</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">viewer_descr</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>

                <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">season</span><span class="p">)</span>
                <span class="c1"># We need to make sure we have relative paths, and not absolute ones.</span>
                <span class="c1"># This is why we don&#39;t use get_output_dir() as in the plotting script</span>
                <span class="c1"># to get the file name.</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">case_id</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="n">viewer</span><span class="o">.</span><span class="n">add_col</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">is_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plot&#39;</span><span class="p">,</span>
                    <span class="n">meta</span><span class="o">=</span><span class="n">create_metadata</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">generate_page</span><span class="p">()</span>
    <span class="n">add_header</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">url</span><span class="p">),</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="n">h1_to_h3</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">display_name</span><span class="p">,</span> <span class="n">url</span>
</pre></div>
</div>
</div></blockquote>
<p>Now make sure that this <code class="docutils literal notranslate"><span class="pre">create_viewer()</span></code> function is actually called.
Open <code class="docutils literal notranslate"><span class="pre">acme_diags/viewer/main.py</span></code> and edit <code class="docutils literal notranslate"><span class="pre">SET_TO_VIEWER</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the newly created module.</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">diff_diags_viewer</span>

<span class="n">SET_TO_VIEWER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lat_lon&#39;</span><span class="p">:</span> <span class="n">default_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="s1">&#39;polar&#39;</span><span class="p">:</span> <span class="n">default_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="s1">&#39;zonal_mean_xy&#39;</span><span class="p">:</span> <span class="n">default_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="s1">&#39;zonal_mean_2d&#39;</span><span class="p">:</span> <span class="n">zonal_mean_2d_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="s1">&#39;meridional_mean_2d&#39;</span><span class="p">:</span> <span class="n">default_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="s1">&#39;cosp_histogram&#39;</span><span class="p">:</span> <span class="n">default_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="s1">&#39;area_mean_time_series&#39;</span><span class="p">:</span> <span class="n">area_mean_time_series_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
    <span class="c1"># Add the below:</span>
    <span class="s1">&#39;diff_diags&#39;</span><span class="p">:</span> <span class="n">diff_diags_viewer</span><span class="o">.</span><span class="n">create_viewer</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>We use the CDP Viewer to create the webpages.
<strong>This is not needed! Use whatever you want to create the webpages.</strong>
Just make sure that your function that’s mapped to the plotset in <code class="docutils literal notranslate"><span class="pre">SET_TO_VIEWER</span></code>:</p>
<ul class="simple">
<li><p>Takes the <code class="docutils literal notranslate"><span class="pre">root_dir</span></code> (where the user wants the results outputted, so the <code class="docutils literal notranslate"><span class="pre">results_dir</span></code> parameter)
and <code class="docutils literal notranslate"><span class="pre">parameters</span></code> (a list of Parameter objects for your plotset) as arguments.</p></li>
<li><p>Returns a tuple <code class="docutils literal notranslate"><span class="pre">(display_name,</span> <span class="pre">url)</span></code>, where <code class="docutils literal notranslate"><span class="pre">display_name</span></code> is the name
displayed in the index and <code class="docutils literal notranslate"><span class="pre">url</span></code> is the URL of the webpage.</p></li>
</ul>
</div>
<div class="section" id="putting-it-all-together-and-running-on-cori-at-nersc">
<h2>Putting It All Together And Running On Cori At NERSC<a class="headerlink" href="#putting-it-all-together-and-running-on-cori-at-nersc" title="Permalink to this headline">¶</a></h2>
<p>Go to the root of the repo where <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is located and run:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="some-examples-to-run">
<h3>Some Examples To Run<a class="headerlink" href="#some-examples-to-run" title="Permalink to this headline">¶</a></h3>
<p>We are running <code class="docutils literal notranslate"><span class="pre">e3sm_diags</span></code> via the API. If you’re not familar with running
the software that way, please see <span class="xref std std-doc">this document</span>.</p>
<p>Also, the paths to the reference and test data are for Cori at NERSC.
If on another machine, please change your paths accordingly.</p>
<p>Also, make sure to make sure your <code class="docutils literal notranslate"><span class="pre">results_dir</span></code> parameter is valid.</p>
<div class="section" id="running-without-any-set-specific-parameters">
<h4>Running Without Any Set-Specific Parameters<a class="headerlink" href="#running-without-any-set-specific-parameters" title="Permalink to this headline">¶</a></h4>
<p>Call this script <code class="docutils literal notranslate"><span class="pre">run_diff_diags_demo.py</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">acme_diags.parameter.core_parameter</span> <span class="kn">import</span> <span class="n">CoreParameter</span>
<span class="kn">from</span> <span class="nn">acme_diags.run</span> <span class="kn">import</span> <span class="n">runner</span>

<span class="n">param</span> <span class="o">=</span> <span class="n">CoreParameter</span><span class="p">()</span>

<span class="n">param</span><span class="o">.</span><span class="n">reference_data_path</span> <span class="o">=</span> <span class="s1">&#39;/global/cfs/cdirs/e3sm/acme_diags/obs_for_e3sm_diags/climatology/&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">test_data_path</span> <span class="o">=</span> <span class="s1">&#39;/global/cfs/cdirs/e3sm/acme_diags/test_model_data_for_acme_diags/climatology/&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;20161118.beta0.FC5COSP.ne30_ne30.edison&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">]</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;/global/cfs/cdirs/e3sm/www/shaheen2/runs_with_api&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;diff_diags_demo&#39;</span><span class="p">)</span>

<span class="n">runner</span><span class="o">.</span><span class="n">sets_to_run</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;diff_diags&#39;</span><span class="p">]</span>
<span class="n">runner</span><span class="o">.</span><span class="n">run_diags</span><span class="p">([</span><span class="n">param</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
<p>Run it like so:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_diff_diags_demo</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="running-with-set-specific-parameters">
<h4>Running With Set-Specific Parameters<a class="headerlink" href="#running-with-set-specific-parameters" title="Permalink to this headline">¶</a></h4>
<p>Call this script <code class="docutils literal notranslate"><span class="pre">run_diff_diags_demo_specific.py</span></code>.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">acme_diags.parameter.core_parameter</span> <span class="kn">import</span> <span class="n">CoreParameter</span>
<span class="kn">from</span> <span class="nn">acme_diags.parameter.diff_diags_parameter</span> <span class="kn">import</span> <span class="n">DiffDiagsParameter</span>
<span class="kn">from</span> <span class="nn">acme_diags.run</span> <span class="kn">import</span> <span class="n">runner</span>

<span class="n">param</span> <span class="o">=</span> <span class="n">CoreParameter</span><span class="p">()</span>

<span class="n">param</span><span class="o">.</span><span class="n">reference_data_path</span> <span class="o">=</span> <span class="s1">&#39;/global/cfs/cdirs/e3sm/acme_diags/obs_for_e3sm_diags/climatology/&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">test_data_path</span> <span class="o">=</span> <span class="s1">&#39;/global/cfs/cdirs/e3sm/acme_diags/test_model_data_for_acme_diags/climatology/&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">test_name</span> <span class="o">=</span> <span class="s1">&#39;20161118.beta0.FC5COSP.ne30_ne30.edison&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">]</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;/global/cfs/cdirs/e3sm/www/shaheen2/runs_with_api&#39;</span>
<span class="n">param</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;diff_diags_demo_specific&#39;</span><span class="p">)</span>

<span class="c1"># Set specific parameters.</span>
<span class="n">diff_diags_param</span> <span class="o">=</span> <span class="n">DiffDiagsParameter</span><span class="p">()</span>
<span class="n">diff_diags_param</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;miller&#39;</span>
<span class="n">diff_diags_param</span><span class="o">.</span><span class="n">central_lon</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">runner</span><span class="o">.</span><span class="n">sets_to_run</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;diff_diags&#39;</span><span class="p">]</span>
<span class="c1"># We&#39;re passing in this new object as well, in</span>
<span class="c1"># addtion to the CoreParameter object.</span>
<span class="n">runner</span><span class="o">.</span><span class="n">run_diags</span><span class="p">([</span><span class="n">param</span><span class="p">,</span> <span class="n">diff_diags_param</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
<p>Run it like so:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_diff_diags_demo_specific</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div></blockquote>
<p>The ticks on the plot won’t match the newly changed <code class="docutils literal notranslate"><span class="pre">central_lon</span></code> but whatever.
This is just an example.</p>
</div>
<div class="section" id="running-with-your-own-diags">
<h4>Running With Your Own Diags<a class="headerlink" href="#running-with-your-own-diags" title="Permalink to this headline">¶</a></h4>
<p>Create a file <code class="docutils literal notranslate"><span class="pre">diags.cfg</span></code>.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="c1">#]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;diff_diags&quot;</span><span class="p">]</span>
<span class="n">case_id</span> <span class="o">=</span> <span class="s2">&quot;CERES-EBAF-TOA-v2.8&quot;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ALBEDOC&quot;</span><span class="p">]</span>
<span class="n">ref_name</span> <span class="o">=</span> <span class="s2">&quot;ceres_ebaf_toa_v2.8&quot;</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">,</span> <span class="s2">&quot;DJF&quot;</span><span class="p">,</span> <span class="s2">&quot;MAM&quot;</span><span class="p">,</span> <span class="s2">&quot;JJA&quot;</span><span class="p">,</span> <span class="s2">&quot;SON&quot;</span><span class="p">]</span>
<span class="n">diff_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>


<span class="p">[</span><span class="c1">#]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;diff_diags&quot;</span><span class="p">]</span>
<span class="n">case_id</span> <span class="o">=</span> <span class="s2">&quot;CERES-EBAF-TOA-v2.8&quot;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RESTOM&quot;</span><span class="p">]</span>
<span class="n">ref_name</span> <span class="o">=</span> <span class="s2">&quot;ceres_ebaf_toa_v2.8&quot;</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">]</span>
<span class="n">diff_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>

<span class="p">[</span><span class="c1">#]</span>
<span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;diff_diags&quot;</span><span class="p">]</span>
<span class="n">case_id</span> <span class="o">=</span> <span class="s2">&quot;CERES-EBAF-TOA-v2.8&quot;</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;FLUT&quot;</span><span class="p">]</span>
<span class="n">ref_name</span> <span class="o">=</span> <span class="s2">&quot;ceres_ebaf_toa_v2.8&quot;</span>
<span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ANN&quot;</span><span class="p">]</span>
<span class="n">diff_levels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Run it again with the same <code class="docutils literal notranslate"><span class="pre">run_diff_diags_demo_specific.py</span></code> previously defined.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">run_diff_diags_demo_specific</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">d</span> <span class="n">diags</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="releasing-e3sm-diags.html" class="btn btn-neutral float-right" title="How to Prepare a Release" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Developer Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, E3SM

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>