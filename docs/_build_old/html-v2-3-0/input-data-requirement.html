

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Input Data Requirement &mdash; E3SM Diags  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Quick Guides" href="quickguides/index.html" />
    <link rel="prev" title="E3SM Diagnostics Package v2" href="index.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> E3SM Diags
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">E3SM Diagnostics Package v2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Input Data Requirement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preprocessing-steps">Preprocessing Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickguides/index.html">Quick Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="config-run.html">Configuration and Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="defining-parameters.html">Defining Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="available-parameters.html">Available Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="colormaps.html">Colormaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="add-new-diagnostics.html">How to Add New Diagnostics Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to E3SM Diags</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">E3SM Diags</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Input Data Requirement</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/input-data-requirement.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="input-data-requirement">
<h1>Input Data Requirement<a class="headerlink" href="#input-data-requirement" title="Permalink to this headline">¶</a></h1>
<p>For <strong>versions ealier than v1.6.0</strong>, e3sm_diags runs with seasonal and annual mean climatology datasets generated using NCO. The E3SM output on native grid needs to be regridded/remapped first and split to climo files. (The program can not read h0 files directly) For instance, the usual way to generate climatology files (produce monthly + seasonal + annual climos from monthly input files) is to use ncclimo (a NCO operator) as follows:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">ncclimo</span> <span class="pre">-s</span> <span class="pre">start_yr</span> <span class="pre">-e</span> <span class="pre">end_yr</span> <span class="pre">-c</span> <span class="pre">run_id</span> <span class="pre">-i</span> <span class="pre">drc_in</span> <span class="pre">-o</span> <span class="pre">drc_out</span> <span class="pre">-r</span> <span class="pre">map_fl</span> <span class="pre">-O</span> <span class="pre">drc_rgr</span> <span class="pre">-a</span> <span class="pre">sdd</span> <span class="pre">--no_amwg_links</span></code> for EAM output.</p>
</div></blockquote>
<p>A short summary of the most common options is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-a: type of DJF average. Either -a scd (default) or -a sdd. scd means seasonally continuous December. The first month used will be Dec of the year before the start year you specify with -s. sdd means seasonally discontinuous December. The first month used will be Jan of the specified start year.
-C: Climatology mode. Either &quot;mth&quot; (default, and for monthly input files) or &quot;ann&quot; (for annual input files).
-c: caseid, i.e., simulation name. For input files like famipc5_ne30_v0.3_00001.cam.h0.1980-01.nc, specify &quot;-c famipc5_ne30_v0.3_00001&quot;. The &quot;.cam.&quot; and &quot;.h0.&quot; bits are added to the filenames internally by default, and can be modified via the &quot;-m mdl_nm&quot; and &quot;-h hst_nm&quot; switches if needed. See comments in ncclimo for documentation.
-e: end year (example: 2000). Unless the optional flag &quot;-a sdd&quot; is specified, the last month used will be Nov of the specified end year. If &quot;-a sdd&quot; is specified, the last month will be Dec of the specified end year.
-h: history file volume that separates the model name from the date in the input file name. Default is &quot;h0&quot;.  Other common values are &quot;h1&quot; and &quot;h&quot;.
-i: directory containing all netcdf files to be used for input to this code.
-m: model type. Default is &quot;cam&quot;. Other options are &quot;clm2&quot;, &quot;ocn&quot;, &quot;ice&quot;, &quot;cism&quot;, &quot;cice&quot;, &quot;pop&quot;.
-o: directory where computed native grid climo files will be placed. Regridded climos will also be placed here unless a separate directory for them is specified with -O (NB: capital &quot;O&quot;)
-O: directory where regridded climo files will be placed.
-s: start year (example: 1980). The first month used will be Dec of the year before the start year you specify (example Dec 1979 to allow for contiguous DJF climos). If &quot;-a sdd&quot; is specified, the first month used will be Jan of the specified start year.
-v: variable list, e.g., FSNT,AODVIS,PREC.? (yes, regular expressions work so this expands to PRECC,PRECL,PRECSC,PRECSL)
</pre></div>
</div>
<p>Please see instructions on
<a class="reference external" href="https://acme-climate.atlassian.net/wiki/spaces/SIM/pages/31129737/Generate+Regrid+and+Split+Climatologies+climo+files+with+ncclimo+and+ncremap">Generate, Regrid, and Split Climatologies (climo files) with ncclimo and ncremap</a>. The NCO documentation can be found <a class="reference external" href="http://nco.sourceforge.net/nco.html#ncclimo">here</a>.</p>
<p>To be readable by e3sm_diags, the resulting climatology filenames should remain their NCO sytle, i.e.,starting with simulation name and the season name, e.g., <code class="docutils literal notranslate"><span class="pre">20161118.beta0.F1850COSP.ne30_ne30.edison_ANN_climo.nc</span></code>.</p>
<p><strong>Note</strong>, the program searches files based on simulation name and season name, the input directory (test_data_path) should only contain the re-gridded/post_processed data for one run. If you have multiple climatology files generated with the same simulation (i.e., climo over different time period), please place each set of climatology files in individual folders.</p>
<p><strong>Beginning version v1.6.0</strong>, the software can also run with time-series datasets (i.e., multiple years included in one file for each variable). Before running the program, the raw model output should be ran through NCO, which created the time-series files. Below is an example to reshape a series of input files into outputs that are continuous timeseries of each variable taken from all input files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>drc_in=/scratch2/scratchdirs/golaz/ACME_simulations/20161117.beta0.A_WCYCL1850S.ne30_oEC_ICG.edison/run
map_fl=${DATA}/maps/map_ne30np4_to_fv129x256_aave.20150901.nc

# Read list from file
ls $drc_in/*cam.h0.0[012]??* &gt; input_list
ncclimo --dbg=0 --yr_srt=1 --yr_end=250 --var=FSNT,AODVIS --map=$map_fl --drc_out=$drc_out --drc_rgr=$drc_rgr &lt; input_list
# Pipe list to stdin
cd $drc_in
ls *cam.h0.0[012]??* | ncclimo --dbg=0 --yr_srt=1 --yr_end=250 --var=FSNT,AODVIS --map=$map_fl --drc_out=$drc_out --drc_rgr=$drc_rgr
# List as positional arguments
ncclimo --var=FSNT,AODVIS --yr_srt=1 --yr_end=250 --map=$map_fl --drc_out=$drc_out --drc_rgr=$drc_rgr $drc_in/*cam.h0.0[012]??*.nc
# Read directory
ncclimo --var=T,Q,RH --yr_srt=1 --yr_end=250 --drc_in=$drc_in --map=$map_fl --drc_out=$drc_out --drc_rgr=$drc_rgr
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">map_ne30np4_to_fv129x256_aave.20150901.nc</span></code> is an example mapping files we are using. For more mapping files available for e3sm, please refer to <a class="reference external" href="https://web.lcrc.anl.gov/public/e3sm/mapping/grids/">https://web.lcrc.anl.gov/public/e3sm/mapping/grids/</a>.</p>
<p>The output is a collection of per-variable timeseries such as <code class="docutils literal notranslate"><span class="pre">FSNT_YYYYMM_YYYYMM.nc</span></code>, <code class="docutils literal notranslate"><span class="pre">AODVIS_YYYYMM_YYYYMM.nc</span></code>, etc. The output is split into segments each containing no more than ypf_max (default 50) years-per-file, e.g., <code class="docutils literal notranslate"><span class="pre">FSNT_000101_005012.nc</span></code>, <code class="docutils literal notranslate"><span class="pre">FSNT_005101_009912.nc</span></code>, <code class="docutils literal notranslate"><span class="pre">FSNT_010001_014912.nc</span></code>, etc.</p>
<p>If you are using time series from CMIP style files, the model data file names must follow the naming conventions as follows, where you have
<code class="docutils literal notranslate"><span class="pre">&lt;variable&gt;_&lt;start_yr&gt;01_&lt;end_yr&gt;12.nc</span></code>. Ex: renaming <code class="docutils literal notranslate"><span class="pre">tas_Amon_CESM1-CAM5_historical_r1i2p1_196001-201112.nc</span></code> to <code class="docutils literal notranslate"><span class="pre">tas_196001_201112.nc</span></code>.</p>
<p>All of the variables should be in the same directory. Please refer to the test data format available on NERSC (/global/cfs/cdirs/e3sm/acme_diags/test_model_data_for_acme_diags/time-series/) for examples.</p>
<div class="section" id="preprocessing-steps">
<h2>Preprocessing Steps<a class="headerlink" href="#preprocessing-steps" title="Permalink to this headline">¶</a></h2>
<p>Some diagnostic sets require preprocessing steps. See
<a class="reference external" href="https://github.com/E3SM-Project/e3sm_diags/blob/master/examples/tutorials/postprocessing_E3SM_data_for_e3sm_diags.sh">this script</a>
for postprocessing E3SM data (i.e., preprocessing for E3SM Diags).</p>
<ul>
<li><p>QBO: monthly <code class="docutils literal notranslate"><span class="pre">U</span></code> (if different start_year and end_year are wanted for test/ref,
the number of years need to remain the same)</p></li>
<li><p>Streamflow: monthly <code class="docutils literal notranslate"><span class="pre">RIVER_DISCHARGE_OVER_LAND_LIQ</span></code> and <code class="docutils literal notranslate"><span class="pre">areatotal2</span></code>.
Example for splitting mosart timeseries files using latest NCO
(NCO 4.9.6 includes the <code class="docutils literal notranslate"><span class="pre">--var_xtr</span></code> option, which can be used to specify the extra variables to include in
timeseries that the splitter produces):</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd ${drc_in}; ls *mosart.h0.20*nc | ncclimo --var_xtr=areatotal2 -v RIVER_DISCHARGE_OVER_LAND_LIQ --yr_srt=2000 --yr_end=2014 --drc_in=$drc_in --drc_out=$drc
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Diurnal Cycle: seasonal/annual mean diurnal cycle climo
Example for Compy:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

source /share/apps/E3SM/conda_envs/load_latest_e3sm_unified.sh

# Low-res Compy simulations
drc_in=/compyfs/zhen797/E3SM_simulations/20201027.alpha5_v1p-1.amip.ne30pg2_r05_oECv3.compy/archive/atm/hist

drc_out=/qfs/people/zhan429/postprocess_scripts/diurnal_climo/native
drc_rgr=/qfs/people/zhan429/postprocess_scripts/diurnal_climo/rgr
caseid=20201027.alpha5_v1p-1.amip.ne30pg2_r05_oECv3.compy.eam.h4

cd ${drc_in};ls ${caseid}*{1980..2014}*.nc | ncclimo --clm_md=hfc --caseid=$caseid -v PRECT --ypf=1 --yr_srt=1980 --yr_end=2014 --drc_out=${drc_out} -O $drc_rgr --map=/qfs/people/zender/data/maps/map_ne30pg2_to_cmip6_180x360_aave.20200201.nc
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="quickguides/index.html" class="btn btn-neutral float-right" title="Quick Guides" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="E3SM Diagnostics Package v2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, E3SM

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>