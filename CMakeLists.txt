PROJECT(HOMME C CXX Fortran)
INCLUDE(FortranCInterface)

CMAKE_MINIMUM_REQUIRED(VERSION 2.8)
SET(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)

OPTION(BUILD_HOMME_SWEQX ""   ON)
OPTION(BUILD_HOMME_SWIM  ""  OFF)

SET(NUM_POINTS_default   4  CACHE   STRING    "Default number of POINTS (NP) in the element (default value is 4)")
SET(NUM_CELLS_default    4  CACHE   STRING    "Default number of CELLS (NC*NC) in each element (default value is 4)")
SET(NUM_PLEV_default     1  CACHE   STRING    "Default number of POINTS (PLEV) in each element (default value is 1)")
SET(NUM_TRACERS_default  1  CACHE   STRING    "Default number of TRACERS (NTRAC) (default value is 1)")

IF ("${HOMME_ARCH}" STREQUAL "Linux")
  SET(_Linux ON)
  MESSAGE(STATUS "Configuring for Linux")
ELSEIF("${HOMME_ARCH}" STREQUAL "Darwin")
  SET(_Darwin ON)
  MESSAGE(STATUS "Configuring for Darwin")
ENDIF()

IF (NOT DEFINED NUM_POINTS) 
  SET(NUM_POINTS ${NUM_POINTS_default} CACHE STRING "")
ENDIF()
IF (NOT DEFINED NUM_CELLS) 
  SET(NUM_CELLS ${NUM_CELLS_default} CACHE STRING "")
ENDIF()
IF (NOT DEFINED NUM_PLEV) 
  SET(NUM_PLEV ${NUM_PLEV_default} CACHE STRING "")
ENDIF()
IF (NOT DEFINED NUM_TRACERS) 
  SET(NUM_TRACERS ${NUM_TRACERS_default} CACHE STRING "")
ENDIF()

MESSAGE(STATUS "Build options:")
MESSAGE(STATUS "-- num points (NP) set to... ${NUM_POINTS}")
MESSAGE(STATUS "-- num cells (NC) set to... ${NUM_CELLS}")
MESSAGE(STATUS "-- num points (PLEV) set to... ${NUM_PLEV}")
MESSAGE(STATUS "-- num tracers (NTRAC) set to... ${NUM_TRACERS}")

FIND_PACKAGE(BLAS REQUIRED)
FIND_PACKAGE(LAPACK REQUIRED)
FIND_PACKAGE(Netcdf REQUIRED)
FIND_PACKAGE(Pnetcdf REQUIRED)

ADD_SUBDIRECTORY(utils/pio)
ADD_SUBDIRECTORY(utils/timing)
if(BUILD_HOMME_SWEQX)
  MESSAGE(STATUS "Building sweqx...")
  ADD_SUBDIRECTORY(src/sweqx)
endif()
if(BUILD_HOMME_SWIM)
  MESSAGE(STATUS "Building swim...")
  FIND_PACKAGE(Trilinos REQUIRED)
  MESSAGE(STATUS "Using Trilinos: ${Trilinos_LIBRARY_DIRS}")
  ADD_SUBDIRECTORY(src/swim)
endif()
