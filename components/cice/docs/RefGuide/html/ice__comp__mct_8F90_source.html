<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CICE: ice_comp_mct.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Types&nbsp;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ice_comp_mct.F90</h1><a href="ice__comp__mct_8F90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceice__comp__mct.html">00001</a> <span class="keyword">module</span> ice_comp_mct
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">!BOP</span>
<a name="l00005"></a>00005 <span class="comment">!</span>
<a name="l00006"></a>00006 <span class="comment">! !MODULE: ice_comp_mct</span>
<a name="l00007"></a>00007 <span class="comment">!</span>
<a name="l00008"></a>00008 <span class="comment">! !DESCRIPTION:</span>
<a name="l00009"></a>00009 <span class="comment">! CICE interface routine for the ccsm cpl7 mct system</span>
<a name="l00010"></a>00010 <span class="comment">!</span>
<a name="l00011"></a>00011 <span class="comment">! !USES:</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013   use <span class="keywordflow">shr_kind_mod</span>, only : r8 =&gt; shr_kind_r8
<a name="l00014"></a>00014   use <span class="keywordflow">shr_sys_mod</span>,  only : shr_sys_abort, shr_sys_flush
<a name="l00015"></a>00015 <span class="comment">! use shr_mem_mod,  only : shr_get_memusage, shr_init_memusage</span>
<a name="l00016"></a>00016   use <span class="keywordflow">shr_file_mod</span>, only : shr_file_getlogunit, shr_file_getloglevel,  &amp;
<a name="l00017"></a>00017                            shr_file_setloglevel, shr_file_setlogunit
<a name="l00018"></a>00018   use <span class="keywordflow">mct_mod</span>
<a name="l00019"></a>00019   use <span class="keywordflow">esmf_mod</span>, only : ESMF_Clock
<a name="l00020"></a>00020 
<a name="l00021"></a>00021   use <span class="keywordflow">seq_flds_mod</span>
<a name="l00022"></a>00022   use <span class="keywordflow">seq_flds_indices</span>
<a name="l00023"></a>00023   use <span class="keywordflow">seq_cdata_mod</span>,   only : seq_cdata, seq_cdata_setptrs
<a name="l00024"></a>00024   use <span class="keywordflow">seq_infodata_mod</span>,only : seq_infodata_type, seq_infodata_getdata,       &amp;
<a name="l00025"></a>00025                               seq_infodata_putdata, seq_infodata_start_type_cont, &amp;
<a name="l00026"></a>00026                               seq_infodata_start_type_brnch, seq_infodata_start_type_start
<a name="l00027"></a>00027   use <span class="keywordflow">seq_timemgr_mod</span>, only : seq_timemgr_eclockgetdata, &amp;
<a name="l00028"></a>00028                               seq_timemgr_restartalarmison, &amp;
<a name="l00029"></a>00029                               seq_timemgr_eclockdateinsync, &amp;
<a name="l00030"></a>00030                               seq_timemgr_stopalarmison
<a name="l00031"></a>00031   use <span class="keywordflow">perf_mod</span>,        only : t_startf, t_stopf
<a name="l00032"></a>00032 
<a name="l00033"></a>00033   use <span class="keywordflow">ice_flux</span>,        only : strairxt, strairyt, strocnxt, strocnyt,    &amp;
<a name="l00034"></a>00034                               alvdr, alidr, alvdf, alidf, tref, qref, flat,    &amp;
<a name="l00035"></a>00035                               fsens, flwout, evap, fswabs, fhocn, fswthru,     &amp;
<a name="l00036"></a>00036                               fresh, fsalt, zlvl, uatm, vatm, potT, Tair, Qa,  &amp;
<a name="l00037"></a>00037                               rhoa, swvdr, swvdf, swidr, swidf, flw, frain,    &amp;
<a name="l00038"></a>00038                               fsnow, uocn, vocn, sst, ss_tltx, ss_tlty, frzmlt,&amp;
<a name="l00039"></a>00039                               sss, tf, wind, fsw, init_flux_atm, init_flux_ocn,&amp;
<a name="l00040"></a>00040                               faero
<a name="l00041"></a>00041   use <span class="keywordflow">ice_state</span>,       only : vice, aice, trcr, filename_aero, filename_iage, &amp;
<a name="l00042"></a>00042                               filename_volpn, filename_FY, &amp;
<a name="l00043"></a>00043                               tr_aero, tr_iage, tr_FY, tr_pond
<a name="l00044"></a>00044   use <span class="keywordflow">ice_domain_size</span>, only : nx_global, ny_global, block_size_x, block_size_y, max_blocks
<a name="l00045"></a>00045   use <span class="keywordflow">ice_domain</span>,      only : nblocks, blocks_ice, halo_info, distrb_info, profile_barrier
<a name="l00046"></a>00046   use <span class="keywordflow">ice_blocks</span>,      only : block, get_block, nx_block, ny_block
<a name="l00047"></a>00047   use <span class="keywordflow">ice_grid</span>,        only : tlon, tlat, tarea, tmask, anglet, hm, ocn_gridcell_frac, &amp;
<a name="l00048"></a>00048                               grid_type, t2ugrid_vector
<a name="l00049"></a>00049   use <span class="keywordflow">ice_constants</span>,   only : c0, c1, puny, tffresh, spval_dbl, rad_to_deg, radius, &amp;
<a name="l00050"></a>00050                               field_loc_center, field_type_scalar, field_type_vector, c100
<a name="l00051"></a>00051   use <span class="keywordflow">ice_communicate</span>, only : my_task, master_task, lprint_stats, MPI_COMM_ICE
<a name="l00052"></a>00052   use <span class="keywordflow">ice_calendar</span>,    only : idate, mday, time, month, daycal, secday, &amp;
<a name="l00053"></a>00053                               sec, dt, dt_dyn, xndt_dyn, calendar,      &amp;
<a name="l00054"></a>00054                               calendar_type, nextsw_cday, days_per_year,&amp;
<a name="l00055"></a>00055                               get_daycal, leap_year_count
<a name="l00056"></a>00056   use <span class="keywordflow">ice_timers</span>
<a name="l00057"></a>00057   use <span class="keywordflow">ice_probability</span>, only : init_numIceCells, print_numIceCells,  &amp;
<a name="l00058"></a>00058                               write_numIceCells, accum_numIceCells2
<a name="l00059"></a>00059 
<a name="l00060"></a>00060   use <span class="keywordflow">ice_kinds_mod</span>,   only : int_kind, dbl_kind, char_len_long, log_kind
<a name="l00061"></a>00061 <span class="comment">!  use ice_init</span>
<a name="l00062"></a>00062   use <span class="keywordflow">ice_boundary</span>,    only : ice_HaloUpdate 
<a name="l00063"></a>00063   use <span class="keywordflow">ice_scam</span>,        only : scmlat, scmlon, single_column
<a name="l00064"></a>00064   use <span class="keywordflow">ice_fileunits</span>,   only : nu_diag
<a name="l00065"></a>00065   use <span class="keywordflow">ice_dyn_evp</span>,     only:  kdyn
<a name="l00066"></a>00066   use <span class="keywordflow">ice_prescribed_mod</span>, only : prescribed_ice, ice_prescribed_run
<a name="l00067"></a>00067   use <span class="keywordflow">ice_prescaero_mod</span>
<a name="l00068"></a>00068   use <span class="keywordflow">ice_step_mod</span>
<a name="l00069"></a>00069   use <span class="keywordflow">CICE_RunMod</span>
<a name="l00070"></a>00070   use <span class="keywordflow">ice_global_reductions</span>
<a name="l00071"></a>00071   use <span class="keywordflow">ice_broadcast</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">! !PUBLIC MEMBER FUNCTIONS:</span>
<a name="l00074"></a>00074   <span class="keyword">implicit none</span>
<a name="l00075"></a>00075   <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__comp__mct.html#aea0306f80417faf23e2153503a468ed0">ice_init_mct</a>
<a name="l00076"></a>00076   <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__comp__mct.html#a7e9300fd6b2392c92d54b05f84464939">ice_run_mct</a>
<a name="l00077"></a>00077   <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__comp__mct.html#acd10abc7ef002e1d5e3223ce079bad2b">ice_final_mct</a>
<a name="l00078"></a>00078   <span class="keywordtype">SAVE</span>
<a name="l00079"></a>00079   <span class="keywordtype">private</span>                              <span class="comment">! By default make data private</span>
<a name="l00080"></a>00080 <span class="comment">!</span>
<a name="l00081"></a>00081 <span class="comment">! ! PUBLIC DATA:</span>
<a name="l00082"></a>00082 <span class="comment">!</span>
<a name="l00083"></a>00083 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00084"></a>00084 <span class="comment">! Author: Jacob Sewall, Mariana Vertenstein</span>
<a name="l00085"></a>00085 <span class="comment">!</span>
<a name="l00086"></a>00086 <span class="comment">!EOP</span>
<a name="l00087"></a>00087 <span class="comment">! !PRIVATE MEMBER FUNCTIONS:</span>
<a name="l00088"></a>00088   <span class="keywordtype">private</span> :: <a class="code" href="namespaceice__comp__mct.html#a0b623ba08317afe1cf24e68494b092da">ice_export_mct</a>
<a name="l00089"></a>00089   <span class="keywordtype">private</span> :: <a class="code" href="namespaceice__comp__mct.html#a64a861144b6d897f984676031622b7f9">ice_import_mct</a>
<a name="l00090"></a>00090   <span class="keywordtype">private</span> :: <a class="code" href="namespaceice__comp__mct.html#a44b387bdc97aa66b1bd25afd2b68ec09">ice_SetGSMap_mct</a>
<a name="l00091"></a>00091   <span class="keywordtype">private</span> :: <a class="code" href="namespaceice__comp__mct.html#a13b99c3351533da77b875c4de8cf6cf8">ice_domain_mct</a>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">!</span>
<a name="l00094"></a>00094 <span class="comment">! !PRIVATE VARIABLES</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">!=======================================================================</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="keyword">contains</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">!=======================================================================</span>
<a name="l00101"></a>00101 <span class="comment">!BOP</span>
<a name="l00102"></a>00102 <span class="comment">!</span>
<a name="l00103"></a>00103 <span class="comment">! !IROUTINE: ice_init_mct</span>
<a name="l00104"></a>00104 <span class="comment">!</span>
<a name="l00105"></a>00105 <span class="comment">! !INTERFACE:</span>
<a name="l00106"></a><a class="code" href="namespaceice__comp__mct.html#aea0306f80417faf23e2153503a468ed0">00106</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#aea0306f80417faf23e2153503a468ed0">ice_init_mct</a>( EClock, cdata_i, x2i_i, i2x_i, NLFilename )
<a name="l00107"></a>00107 <span class="comment">!</span>
<a name="l00108"></a>00108 <span class="comment">! !DESCRIPTION:</span>
<a name="l00109"></a>00109 <span class="comment">! Initialize thermodynamic ice model and obtain relevant atmospheric model</span>
<a name="l00110"></a>00110 <span class="comment">! arrays back from driver </span>
<a name="l00111"></a>00111 <span class="comment">!</span>
<a name="l00112"></a>00112 <span class="comment">! !USES:</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     use <span class="keywordflow">CICE_InitMod</span>
<a name="l00115"></a>00115     use <span class="keywordflow">ice_restart</span>, only: runid, runtype, restart_dir, restart_format
<a name="l00116"></a>00116     use <span class="keywordflow">ice_history</span>, only: history_dir, history_file
<a name="l00117"></a>00117 <span class="comment">!</span>
<a name="l00118"></a>00118 <span class="comment">! !ARGUMENTS:</span>
<a name="l00119"></a>00119     <span class="keywordtype">type(</span>ESMF_Clock<span class="keywordtype">)</span>         , <span class="keywordtype">intent(in)</span>    :: EClock
<a name="l00120"></a>00120     <span class="keywordtype">type(</span>seq_cdata<span class="keywordtype">)</span>          , <span class="keywordtype">intent(inout)</span> :: cdata_i
<a name="l00121"></a>00121     <span class="keywordtype">type(</span>mct_aVect<span class="keywordtype">)</span>          , <span class="keywordtype">intent(inout)</span> :: x2i_i, i2x_i
<a name="l00122"></a>00122     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>  , <span class="keywordtype">intent(in)</span> :: NLFilename <span class="comment">! Namelist filename</span>
<a name="l00123"></a>00123 <span class="comment">!</span>
<a name="l00124"></a>00124 <span class="comment">! !LOCAL VARIABLES:</span>
<a name="l00125"></a>00125 <span class="comment">!</span>
<a name="l00126"></a>00126     <span class="keywordtype">integer</span>                               :: ICEID      
<a name="l00127"></a>00127     <span class="keywordtype">integer</span>                               :: mpicom_ice
<a name="l00128"></a>00128     <span class="keywordtype">type(</span>mct_gsMap<span class="keywordtype">)</span>             , <span class="keywordtype">pointer</span> :: gsMap_ice
<a name="l00129"></a>00129     <span class="keywordtype">type(</span>mct_gGrid<span class="keywordtype">)</span>             , <span class="keywordtype">pointer</span> :: dom_i
<a name="l00130"></a>00130     <span class="keywordtype">type(</span>seq_infodata_type<span class="keywordtype">)</span>     , <span class="keywordtype">pointer</span> :: infodata   <span class="comment">! Input init object</span>
<a name="l00131"></a>00131     <span class="keywordtype">integer</span>                               :: lsize
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="keywordtype">character(len=256) </span>:: drvarchdir         <span class="comment">! driver archive directory</span>
<a name="l00134"></a>00134     <span class="keywordtype">character(len=32)  </span>:: starttype          <span class="comment">! infodata start type</span>
<a name="l00135"></a>00135     <span class="keywordtype">integer</span>            :: start_ymd          <span class="comment">! Start date (YYYYMMDD)</span>
<a name="l00136"></a>00136     <span class="keywordtype">integer</span>            :: start_tod          <span class="comment">! start time of day (s)</span>
<a name="l00137"></a>00137     <span class="keywordtype">integer</span>            :: ref_ymd            <span class="comment">! Reference date (YYYYMMDD)</span>
<a name="l00138"></a>00138     <span class="keywordtype">integer</span>            :: ref_tod            <span class="comment">! reference time of day (s)</span>
<a name="l00139"></a>00139     <span class="keywordtype">integer</span>            :: iyear              <span class="comment">! yyyy</span>
<a name="l00140"></a>00140     <span class="keywordtype">integer</span>            :: dtime              <span class="comment">! time step</span>
<a name="l00141"></a>00141     <span class="keywordtype">integer</span>            :: shrlogunit,shrloglev <span class="comment">! old values</span>
<a name="l00142"></a>00142     <span class="keywordtype">integer</span>            :: iam,ierr
<a name="l00143"></a>00143     <span class="keywordtype">integer</span>            :: lbnum
<a name="l00144"></a>00144     <span class="keywordtype">integer</span>            :: daycal(13)  <span class="comment">!number of cumulative days per month</span>
<a name="l00145"></a>00145     <span class="keywordtype">integer</span>            :: nleaps      <span class="comment">! number of leap days before current year</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keywordtype">real(r8) </span>:: mrss, mrss0,msize,msize0
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00150"></a>00150 <span class="comment">! Author: Jacob Sewall</span>
<a name="l00151"></a>00151 <span class="comment">!EOP</span>
<a name="l00152"></a>00152 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00155"></a>00155     <span class="comment">! Set cdata pointers</span>
<a name="l00156"></a>00156     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     call seq_cdata_setptrs(cdata_i, ID=ICEID, mpicom=mpicom_ice, &amp;
<a name="l00159"></a>00159          gsMap=gsMap_ice, dom=dom_i, infodata=infodata)
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="comment">! Determine time of next atmospheric shortwave calculation</span>
<a name="l00162"></a>00162     call seq_infodata_GetData(infodata, nextsw_cday=nextsw_cday )
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 <span class="comment">!   call shr_init_memusage()</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00167"></a>00167     <span class="comment">! use infodata to determine type of run</span>
<a name="l00168"></a>00168     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="comment">! Preset single column values</span>
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <a class="code" href="namespaceice__scam.html#a34d0d2e7da10c0e3b977aa989b318dac">single_column</a> = .false.
<a name="l00173"></a>00173     <a class="code" href="namespaceice__scam.html#a72933cc98dddc52d1f629eb311a715af">scmlat</a> = -999.
<a name="l00174"></a>00174     <a class="code" href="namespaceice__scam.html#a3064f1ae884e72d621f753a3a3363b17">scmlon</a> = -999.
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     call seq_infodata_GetData( infodata, case_name=<a class="code" href="namespaceice__restart.html#a7f22ff2f3f9c3ccf57b19309c46deb79">runid</a>   ,  &amp;  
<a name="l00177"></a>00177        <a class="code" href="namespaceice__scam.html#a34d0d2e7da10c0e3b977aa989b318dac">single_column</a>=<a class="code" href="namespaceice__scam.html#a34d0d2e7da10c0e3b977aa989b318dac">single_column</a> ,<a class="code" href="namespaceice__scam.html#a72933cc98dddc52d1f629eb311a715af">scmlat</a>=<a class="code" href="namespaceice__scam.html#a72933cc98dddc52d1f629eb311a715af">scmlat</a>,<a class="code" href="namespaceice__scam.html#a3064f1ae884e72d621f753a3a3363b17">scmlon</a>=<a class="code" href="namespaceice__scam.html#a3064f1ae884e72d621f753a3a3363b17">scmlon</a>)
<a name="l00178"></a>00178     call seq_infodata_GetData( infodata, start_type=starttype)
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keyword">if</span> (     trim(starttype) == trim(seq_infodata_start_type_start)) <span class="keyword">then</span>
<a name="l00181"></a>00181        <a class="code" href="namespaceice__restart.html#a549fe78d0644ff3e150fb73b66c04f1d">runtype</a> = <span class="stringliteral">&quot;initial&quot;</span>
<a name="l00182"></a>00182     <span class="keyword">else</span> <span class="keyword">if</span> (trim(starttype) == trim(seq_infodata_start_type_cont) ) <span class="keyword">then</span>
<a name="l00183"></a>00183        <a class="code" href="namespaceice__restart.html#a549fe78d0644ff3e150fb73b66c04f1d">runtype</a> = <span class="stringliteral">&quot;continue&quot;</span>
<a name="l00184"></a>00184     <span class="keyword">else</span> <span class="keyword">if</span> (trim(starttype) == trim(seq_infodata_start_type_brnch)) <span class="keyword">then</span>
<a name="l00185"></a>00185        <a class="code" href="namespaceice__restart.html#a549fe78d0644ff3e150fb73b66c04f1d">runtype</a> = <span class="stringliteral">&quot;branch&quot;</span>
<a name="l00186"></a>00186     <span class="keyword">else</span>
<a name="l00187"></a>00187        <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;ice_comp_mct ERROR: unknown starttype&apos;</span>
<a name="l00188"></a>00188        call shr_sys_abort()
<a name="l00189"></a>00189     <span class="keyword">end if</span>
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment">! Set nextsw_cday to -1 for continue and branch runs.</span>
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="keyword">if</span> (trim(<a class="code" href="namespaceice__restart.html#a549fe78d0644ff3e150fb73b66c04f1d">runtype</a>) /= <span class="stringliteral">&apos;initial&apos;</span>) nextsw_cday = -1
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">!=============================================================</span>
<a name="l00196"></a>00196     <span class="comment">! Set ice dtime to ice coupling frequency</span>
<a name="l00197"></a>00197     <span class="comment">!=============================================================</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     call seq_timemgr_EClockGetData(EClock, dtime=dtime, calendar=calendar_type)
<a name="l00200"></a>00200     dt = <span class="keywordtype">real</span>(dtime)
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="comment">!=============================================================</span>
<a name="l00203"></a>00203     <span class="comment">! Initialize cice because grid information is needed for</span>
<a name="l00204"></a>00204     <span class="comment">! creation of GSMap_ice.  cice_init also sets time manager info</span>
<a name="l00205"></a>00205     <span class="comment">!=============================================================</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     call t_startf (<span class="stringliteral">&apos;cice_init&apos;</span>)
<a name="l00208"></a>00208     call cice_init( mpicom_ice )
<a name="l00209"></a>00209     call t_stopf (<span class="stringliteral">&apos;cice_init&apos;</span>)
<a name="l00210"></a>00210     call <a class="code" href="namespaceice__probability.html#a4df379181c71e4ceeb1ef127de0dace0">init_numIceCells</a>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00213"></a>00213     <span class="comment">! Reset shr logging to my log file</span>
<a name="l00214"></a>00214     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     call shr_file_getLogUnit (shrlogunit)
<a name="l00217"></a>00217     call shr_file_getLogLevel(shrloglev)
<a name="l00218"></a>00218     call shr_file_setLogUnit (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>)
<a name="l00219"></a>00219    
<a name="l00220"></a>00220     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00221"></a>00221     <span class="comment">! use EClock to reset calendar information on initial start</span>
<a name="l00222"></a>00222     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">! - the following logic duplicates the logic for the concurrent system - </span>
<a name="l00225"></a>00225     <span class="comment">! cice_init is called then init_cpl is called where the start date is received</span>
<a name="l00226"></a>00226     <span class="comment">! from the flux coupler</span>
<a name="l00227"></a>00227     <span class="comment">! - in the following calculation for the variable time, iyear is used</span>
<a name="l00228"></a>00228     <span class="comment">! rather than (iyear-1) (as in init_cpl) since the sequential system permits you </span>
<a name="l00229"></a>00229     <span class="comment">! to start with year &quot;0&quot; not year &quot;1&quot;</span>
<a name="l00230"></a>00230     <span class="comment">! - on restart run </span>
<a name="l00231"></a>00231     <span class="comment">!   - istep0, time and time_forc are read from restart file</span>
<a name="l00232"></a>00232     <span class="comment">!   - istep1 is set to istep0</span>
<a name="l00233"></a>00233     <span class="comment">!   - idate is determined from time via the call to calendar (see below)</span>
<a name="l00234"></a>00234     <span class="comment">! - on initial run </span>
<a name="l00235"></a>00235     <span class="comment">!   - iyear, month and mday obtained from sync clock</span>
<a name="l00236"></a>00236     <span class="comment">!   - time determined from iyear, month and mday</span>
<a name="l00237"></a>00237     <span class="comment">!   - istep0 and istep1 are set to 0 </span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="keyword">if</span> (<a class="code" href="namespaceice__restart.html#a549fe78d0644ff3e150fb73b66c04f1d">runtype</a> == <span class="stringliteral">&apos;initial&apos;</span>) <span class="keyword">then</span>
<a name="l00240"></a>00240        call seq_timemgr_EClockGetData(EClock, &amp;
<a name="l00241"></a>00241             start_ymd=start_ymd, start_tod=start_tod,       &amp;
<a name="l00242"></a>00242             ref_ymd=ref_ymd, ref_tod=ref_tod)
<a name="l00243"></a>00243 
<a name="l00244"></a>00244        <span class="keyword">if</span> (ref_ymd /= start_ymd .or. ref_tod /= start_tod) <span class="keyword">then</span>
<a name="l00245"></a>00245           <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00246"></a>00246              <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;ice_comp_mct: ref_ymd &apos;</span>,ref_ymd, &amp;
<a name="l00247"></a>00247                   <span class="stringliteral">&apos; must equal start_ymd &apos;</span>,start_ymd
<a name="l00248"></a>00248              <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;ice_comp_mct: ref_ymd &apos;</span>,ref_tod, &amp;
<a name="l00249"></a>00249                   <span class="stringliteral">&apos; must equal start_ymd &apos;</span>,start_tod
<a name="l00250"></a>00250           <span class="keyword">end if</span>
<a name="l00251"></a>00251           call shr_sys_abort()
<a name="l00252"></a>00252        <span class="keyword">end if</span>
<a name="l00253"></a>00253 
<a name="l00254"></a>00254        <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00255"></a>00255           <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;(ice_init_mct) idate from sync clock = &apos;</span>, &amp;
<a name="l00256"></a>00256                start_ymd
<a name="l00257"></a>00257           <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;(ice_init_mct)   tod from sync clock = &apos;</span>, &amp;
<a name="l00258"></a>00258                start_tod
<a name="l00259"></a>00259           <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) &amp;
<a name="l00260"></a>00260                <span class="stringliteral">&apos;(ice_init_mct) resetting idate to match sync clock&apos;</span>
<a name="l00261"></a>00261        <span class="keyword">end if</span>
<a name="l00262"></a>00262 
<a name="l00263"></a>00263        <a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a> = start_ymd
<a name="l00264"></a>00264        iyear = (<a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a>/10000)                     <span class="comment">! integer year of basedate</span>
<a name="l00265"></a>00265        <a class="code" href="namespaceice__calendar.html#a97f8410cf5a5f94b8c2a271c080c4bd7">month</a> = (<a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a>-iyear*10000)/100           <span class="comment">! integer month of basedate</span>
<a name="l00266"></a>00266        <a class="code" href="namespaceice__calendar.html#af65b8e64abed62d107827ade781bb968">mday</a>  =  <a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a>-iyear*10000-<a class="code" href="namespaceice__calendar.html#a97f8410cf5a5f94b8c2a271c080c4bd7">month</a>*100-1    <span class="comment">! day of month of basedate</span>
<a name="l00267"></a>00267                                                  <span class="comment">! (starts at 0)</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269        call get_daycal(year=iyear,days_per_year_in=days_per_year, &amp;
<a name="l00270"></a>00270                        daycal_out=daycal)
<a name="l00271"></a>00271 
<a name="l00272"></a>00272        nleaps = leap_year_count(iyear)   <span class="comment">! this sets nleaps in ice_calendar</span>
<a name="l00273"></a>00273        <a class="code" href="namespaceice__calendar.html#a41fbc8dd30edf8e90070b7f5569fdd9b">time</a>  = (((iyear)*days_per_year  + nleaps + daycal(<a class="code" href="namespaceice__calendar.html#a97f8410cf5a5f94b8c2a271c080c4bd7">month</a>)+<a class="code" href="namespaceice__calendar.html#af65b8e64abed62d107827ade781bb968">mday</a>)*secday) &amp;
<a name="l00274"></a>00274              + start_tod    
<a name="l00275"></a>00275 
<a name="l00276"></a>00276        call shr_sys_flush(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>)
<a name="l00277"></a>00277     <span class="keyword">end if</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     call calendar(<a class="code" href="namespaceice__calendar.html#a41fbc8dd30edf8e90070b7f5569fdd9b">time</a>)     <span class="comment">! update calendar info</span>
<a name="l00280"></a>00280  
<a name="l00281"></a>00281     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00282"></a>00282     <span class="comment">! Initialize MCT attribute vectors and indices</span>
<a name="l00283"></a>00283     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     call t_startf (<span class="stringliteral">&apos;cice_mct_init&apos;</span>)
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="comment">! Initialize ice gsMap</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     call <a class="code" href="namespaceice__comp__mct.html#a44b387bdc97aa66b1bd25afd2b68ec09">ice_SetGSMap_mct</a>( mpicom_ice, ICEID, GSMap_ice )       
<a name="l00290"></a>00290     lsize = mct_gsMap_lsize(gsMap_ice, mpicom_ice)
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">! Initialize mct ice domain (needs ice initialization info)</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     call <a class="code" href="namespaceice__comp__mct.html#a13b99c3351533da77b875c4de8cf6cf8">ice_domain_mct</a>( lsize, gsMap_ice, dom_i )
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="comment">! Inialize mct attribute vectors</span>
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     call mct_aVect_init(x2i_i, rList=seq_flds_x2i_fields, lsize=lsize)
<a name="l00299"></a>00299     call mct_aVect_zero(x2i_i)
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     call mct_aVect_init(i2x_i, rList=seq_flds_i2x_fields, lsize=lsize) 
<a name="l00302"></a>00302     call mct_aVect_zero(i2x_i)
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00305"></a>00305     <span class="comment">! get ready for coupling</span>
<a name="l00306"></a>00306     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     call <a class="code" href="namespaceCICE__RunMod.html#abf11b85df210128b2304fac42127a723">coupling_prep</a>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00311"></a>00311     <span class="comment">! send initial state to driver</span>
<a name="l00312"></a>00312     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     call <a class="code" href="namespaceice__comp__mct.html#a0b623ba08317afe1cf24e68494b092da">ice_export_mct </a>(i2x_i)  <span class="comment">!Send initial state to driver</span>
<a name="l00315"></a>00315     call seq_infodata_PutData( infodata, ice_prognostic=.true., &amp;
<a name="l00316"></a>00316       ice_nx = <a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>, ice_ny = <a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a> )
<a name="l00317"></a>00317     call t_stopf (<span class="stringliteral">&apos;cice_mct_init&apos;</span>)
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00320"></a>00320     <span class="comment">! Reset shr logging to original values</span>
<a name="l00321"></a>00321     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     call shr_file_setLogUnit (shrlogunit)
<a name="l00324"></a>00324     call shr_file_setLogLevel(shrloglev)
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#af4544096584c21d56bb41d500d4a1e7b">timer_total</a>) <span class="comment">! time entire run</span>
<a name="l00327"></a>00327 <span class="comment">!   call shr_get_memusage(msize,mrss)</span>
<a name="l00328"></a>00328 <span class="comment">!   call shr_mpi_max(mrss, mrss0, mpicom_ice,&apos;ice_init_mct mrss0&apos;)</span>
<a name="l00329"></a>00329 <span class="comment">!   call shr_mpi_max(msize,msize0,mpicom_ice,&apos;ice_init_mct msize0&apos;)</span>
<a name="l00330"></a>00330 <span class="comment">!   if(my_task == 0) then</span>
<a name="l00331"></a>00331 <span class="comment">!     write(shrlogunit,105) &apos;ice_init_mct: memory_write: model date = &apos;,start_ymd,start_tod, &amp;</span>
<a name="l00332"></a>00332 <span class="comment">!           &apos; memory = &apos;,msize0,&apos; MB (highwater)    &apos;,mrss0,&apos; MB (usage)&apos;</span>
<a name="l00333"></a>00333 <span class="comment">!   endif</span>
<a name="l00334"></a>00334  
<a name="l00335"></a>00335   105  format( A, 2i8, A, f10.2, A, f10.2, A)
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="keyword">  end subroutine ice_init_mct</span>
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00340"></a>00340 <span class="comment">!BOP</span>
<a name="l00341"></a>00341 <span class="comment">!</span>
<a name="l00342"></a>00342 <span class="comment">! !IROUTINE: ice_run_mct</span>
<a name="l00343"></a>00343 <span class="comment">!</span>
<a name="l00344"></a>00344 <span class="comment">! !INTERFACE:</span>
<a name="l00345"></a><a class="code" href="namespaceice__comp__mct.html#a7e9300fd6b2392c92d54b05f84464939">00345</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#a7e9300fd6b2392c92d54b05f84464939">ice_run_mct</a>( EClock, cdata_i, x2i_i, i2x_i )
<a name="l00346"></a>00346 <span class="comment">!</span>
<a name="l00347"></a>00347 <span class="comment">! !DESCRIPTION:</span>
<a name="l00348"></a>00348 <span class="comment">! Run thermodynamic CICE</span>
<a name="l00349"></a>00349 <span class="comment">!</span>
<a name="l00350"></a>00350 <span class="comment">! !USES:</span>
<a name="l00351"></a>00351     use <span class="keywordflow">ice_history</span>
<a name="l00352"></a>00352     use <span class="keywordflow">ice_restart</span>
<a name="l00353"></a>00353     use <span class="keywordflow">ice_diagnostics</span>
<a name="l00354"></a>00354     use <span class="keywordflow">ice_aerosol</span>, only: write_restart_aero
<a name="l00355"></a>00355     use <span class="keywordflow">ice_age</span>, only: write_restart_age
<a name="l00356"></a>00356     use <span class="keywordflow">ice_meltpond</span>, only: write_restart_pond
<a name="l00357"></a>00357     use <span class="keywordflow">ice_FY</span>, only: write_restart_FY
<a name="l00358"></a>00358     use <span class="keywordflow">ice_restoring</span>, only: restore_ice, ice_HaloRestore
<a name="l00359"></a>00359     use <span class="keywordflow">ice_shortwave</span>, only: init_shortwave
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">! !ARGUMENTS:</span>
<a name="l00362"></a>00362     <span class="keywordtype">type(</span>ESMF_Clock<span class="keywordtype">)</span>,<span class="keywordtype">intent(in)</span>    :: EClock
<a name="l00363"></a>00363     <span class="keywordtype">type(</span>seq_cdata<span class="keywordtype">)</span>, <span class="keywordtype">intent(inout)</span> :: cdata_i
<a name="l00364"></a>00364     <span class="keywordtype">type(</span>mct_aVect<span class="keywordtype">)</span>, <span class="keywordtype">intent(inout)</span> :: x2i_i
<a name="l00365"></a>00365     <span class="keywordtype">type(</span>mct_aVect<span class="keywordtype">)</span>, <span class="keywordtype">intent(inout)</span> :: i2x_i
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">! !LOCAL VARIABLES:</span>
<a name="l00368"></a>00368     <span class="keywordtype">integer</span> :: k             <span class="comment">! index</span>
<a name="l00369"></a>00369     <span class="keywordtype">logical</span> :: rstwr         <span class="comment">! .true. ==&gt; write a restart file</span>
<a name="l00370"></a>00370     <span class="keywordtype">logical</span> :: stop_now      <span class="comment">! .true. ==&gt; stop at the end of this run phase</span>
<a name="l00371"></a>00371     <span class="keywordtype">integer</span> :: ymd           <span class="comment">! Current date (YYYYMMDD)</span>
<a name="l00372"></a>00372     <span class="keywordtype">integer</span> :: tod           <span class="comment">! Current time of day (sec)</span>
<a name="l00373"></a>00373     <span class="keywordtype">integer</span> :: yr_sync       <span class="comment">! Sync current year</span>
<a name="l00374"></a>00374     <span class="keywordtype">integer</span> :: mon_sync      <span class="comment">! Sync current month</span>
<a name="l00375"></a>00375     <span class="keywordtype">integer</span> :: day_sync      <span class="comment">! Sync current day</span>
<a name="l00376"></a>00376     <span class="keywordtype">integer</span> :: tod_sync      <span class="comment">! Sync current time of day (sec)</span>
<a name="l00377"></a>00377     <span class="keywordtype">integer</span> :: ymd_sync      <span class="comment">! Current year of sync clock</span>
<a name="l00378"></a>00378     <span class="keywordtype">integer</span> :: shrlogunit,shrloglev <span class="comment">! old values</span>
<a name="l00379"></a>00379     <span class="keywordtype">integer</span> :: lbnum
<a name="l00380"></a>00380     <span class="keywordtype">integer</span> :: n
<a name="l00381"></a>00381     <span class="keywordtype">type(</span>mct_gGrid<span class="keywordtype">)</span>             , <span class="keywordtype">pointer</span> :: dom_i
<a name="l00382"></a>00382     <span class="keywordtype">type(</span>seq_infodata_type<span class="keywordtype">)</span>     , <span class="keywordtype">pointer</span> :: infodata   <span class="comment">! Input init object</span>
<a name="l00383"></a>00383     <span class="keywordtype">character(len=char_len_long) </span>:: fname
<a name="l00384"></a>00384     <span class="keywordtype">character(len=char_len_long) </span>:: string1, string2
<a name="l00385"></a>00385     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span>  :: SubName = <span class="stringliteral">&quot;ice_run_mct&quot;</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <span class="keywordtype">real(r8) </span>:: mrss, mrss0,msize,msize0
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">!</span>
<a name="l00390"></a>00390 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00391"></a>00391 <span class="comment">! Author: Jacob Sewall, Mariana Vertenstein</span>
<a name="l00392"></a>00392 <span class="comment">!</span>
<a name="l00393"></a>00393 <span class="comment">!EOP</span>
<a name="l00394"></a>00394 <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#af4544096584c21d56bb41d500d4a1e7b">timer_total</a>) <span class="comment">! time entire run</span>
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00399"></a>00399     <span class="comment">! Reset shr logging to my log file</span>
<a name="l00400"></a>00400     <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     call shr_file_getLogUnit (shrlogunit)
<a name="l00403"></a>00403     call shr_file_getLogLevel(shrloglev)
<a name="l00404"></a>00404     call shr_file_setLogUnit (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>)
<a name="l00405"></a>00405    
<a name="l00406"></a>00406     <span class="comment">! Determine time of next atmospheric shortwave calculation</span>
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     call seq_cdata_setptrs(cdata_i, infodata=infodata, dom=dom_i)
<a name="l00409"></a>00409     call seq_infodata_GetData(infodata, nextsw_cday=nextsw_cday )
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l00412"></a>00412     <span class="comment">! get import state</span>
<a name="l00413"></a>00413     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l00414"></a>00414     
<a name="l00415"></a>00415     call t_startf (<span class="stringliteral">&apos;cice_import&apos;</span>)
<a name="l00416"></a>00416     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(timer_cplrecv)
<a name="l00417"></a>00417     call <a class="code" href="namespaceice__comp__mct.html#a64a861144b6d897f984676031622b7f9">ice_import_mct</a>( x2i_i )
<a name="l00418"></a>00418     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(timer_cplrecv)
<a name="l00419"></a>00419     call t_stopf (<span class="stringliteral">&apos;cice_import&apos;</span>)
<a name="l00420"></a>00420  
<a name="l00421"></a>00421     <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00422"></a>00422     <span class="comment">! timestep update</span>
<a name="l00423"></a>00423     <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#a2f62f4afeed2dc2700a9bf7c15e6d746">timer_step</a>)
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     istep  = istep  + 1    <span class="comment">! update time step counters</span>
<a name="l00428"></a>00428     istep1 = istep1 + 1
<a name="l00429"></a>00429     <a class="code" href="namespaceice__calendar.html#a41fbc8dd30edf8e90070b7f5569fdd9b">time</a> = <a class="code" href="namespaceice__calendar.html#a41fbc8dd30edf8e90070b7f5569fdd9b">time</a> + dt       <span class="comment">! determine the time and date</span>
<a name="l00430"></a>00430     call calendar(<a class="code" href="namespaceice__calendar.html#a41fbc8dd30edf8e90070b7f5569fdd9b">time</a>)    <span class="comment">! at the end of the timestep</span>
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keyword">if</span> (<a class="code" href="namespaceice__restart.html#aad4e3d73d50c4539a7b1aa3107da64d2">resttype</a> == <span class="stringliteral">&apos;old&apos;</span> .and. istep == 1) &amp;
<a name="l00433"></a>00433        call <a class="code" href="namespaceice__shortwave.html#a7fcf82fc93a6d2834b14022890d38a39">init_shortwave</a>    <span class="comment">! initialize radiative transfer using current swdn</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00436"></a>00436     <span class="comment">! restoring on grid boundaries</span>
<a name="l00437"></a>00437     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <span class="keyword">if</span> (<a class="code" href="namespaceice__restoring.html#a4c1ab4e7a35fa0a753fd36909805bfc9">restore_ice</a>) call <a class="code" href="namespaceice__restoring.html#a49df88e98add45cf36562220985fea56">ice_HaloRestore</a>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     call t_startf (<span class="stringliteral">&apos;cice_initmd&apos;</span>)
<a name="l00442"></a>00442     call <a class="code" href="namespaceice__diagnostics.html#a5bf9b233f90e5bf0702b9c358a71f42d">init_mass_diags</a>   <span class="comment">! diagnostics per timestep</span>
<a name="l00443"></a>00443     call t_stopf (<span class="stringliteral">&apos;cice_initmd&apos;</span>)
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="keyword">if</span>(<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>) <span class="keyword">then</span>  <span class="comment">! read prescribed ice</span>
<a name="l00446"></a>00446        call t_startf (<span class="stringliteral">&apos;cice_presc&apos;</span>)
<a name="l00447"></a>00447        call <a class="code" href="namespaceice__prescribed__mod.html#a73bcaa2e547c18a24eeabaa2e22e8fe9">ice_prescribed_run</a>(<a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a>, sec)
<a name="l00448"></a>00448        call t_stopf (<span class="stringliteral">&apos;cice_presc&apos;</span>)
<a name="l00449"></a>00449     <span class="keyword">endif</span>
<a name="l00450"></a>00450     
<a name="l00451"></a>00451     <span class="keyword">if</span>(<a class="code" href="namespaceice__prescaero__mod.html#a12fbaeed0ee95a72e9c96406be9d7578">prescribed_aero</a>) <span class="keyword">then</span>  <span class="comment">! read prescribed ice</span>
<a name="l00452"></a>00452        call <a class="code" href="namespaceice__prescaero__mod.html#a26d851ac89ccf10b178b800a3c9a3c68">ice_prescaero_run</a>(<a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a>, sec)
<a name="l00453"></a>00453     <span class="keyword">endif</span>
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     call init_flux_atm        <span class="comment">! initialize atmosphere fluxes sent to coupler</span>
<a name="l00456"></a>00456     call init_flux_ocn        <span class="comment">! initialize ocean fluxes sent to coupler</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00459"></a>00459     <span class="comment">! Scale radiation fields</span>
<a name="l00460"></a>00460     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     call t_startf (<span class="stringliteral">&apos;cice_prep_radiation&apos;</span>)
<a name="l00463"></a>00463     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#a6fd87221d7d148cbbd9b6c885a235034">timer_sw</a>)
<a name="l00464"></a>00464     call <a class="code" href="namespaceice__step__mod.html#a0b4e1b00567ef101191e7c8c27b21829">prep_radiation</a>(dt)
<a name="l00465"></a>00465     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#a6fd87221d7d148cbbd9b6c885a235034">timer_sw</a>)
<a name="l00466"></a>00466     call t_stopf (<span class="stringliteral">&apos;cice_prep_radiation&apos;</span>)
<a name="l00467"></a>00467     
<a name="l00468"></a>00468     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00469"></a>00469     <span class="comment">! thermodynamics1</span>
<a name="l00470"></a>00470     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     call t_startf (<span class="stringliteral">&apos;cice_therm1&apos;</span>)
<a name="l00473"></a>00473     call <a class="code" href="namespaceCICE__RunMod.html#a82d80aca1f05476da48020976c7c6167">step_therm1</a>(dt)
<a name="l00474"></a>00474     call t_stopf (<span class="stringliteral">&apos;cice_therm1&apos;</span>)
<a name="l00475"></a>00475     
<a name="l00476"></a>00476     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00477"></a>00477     <span class="comment">! thermodynamics2</span>
<a name="l00478"></a>00478     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keyword">if</span> (.not.<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>) <span class="keyword">then</span>
<a name="l00481"></a>00481        call t_startf (<span class="stringliteral">&apos;cice_therm2&apos;</span>)
<a name="l00482"></a>00482        call <a class="code" href="namespaceice__step__mod.html#a4f84e9d5e596f23acbbe44ac3b9fdf25">step_therm2 </a>(dt)  <span class="comment">! post-coupler thermodynamics</span>
<a name="l00483"></a>00483        call t_stopf (<span class="stringliteral">&apos;cice_therm2&apos;</span>)
<a name="l00484"></a>00484     <span class="keyword">end if</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00487"></a>00487    <span class="comment">! dynamics, transport, ridging</span>
<a name="l00488"></a>00488    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <span class="keyword">if</span> (.not.<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a> .and. <a class="code" href="namespaceice__dyn__evp.html#a53c5f7c9741c708ff3519f05aed59469">kdyn</a>&gt;0) <span class="keyword">then</span>
<a name="l00491"></a>00491        <span class="keyword">if</span> (xndt_dyn &gt; <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>) <span class="keyword">then</span>
<a name="l00492"></a>00492           call t_startf (<span class="stringliteral">&apos;cice_dyn&apos;</span>)
<a name="l00493"></a>00493           <span class="keyword">do</span> k = 1, nint(xndt_dyn)
<a name="l00494"></a>00494              call <a class="code" href="namespaceice__step__mod.html#a9b4ebd333313b56f42a75e8456969dd9">step_dynamics</a>(dt_dyn,dt) <span class="comment">! dynamics, transport, ridging</span>
<a name="l00495"></a>00495           <span class="keyword">enddo</span>
<a name="l00496"></a>00496           call t_stopf (<span class="stringliteral">&apos;cice_dyn&apos;</span>)
<a name="l00497"></a>00497        <span class="keyword">else</span>
<a name="l00498"></a>00498           <span class="keyword">if</span> (mod(<a class="code" href="namespaceice__calendar.html#a41fbc8dd30edf8e90070b7f5569fdd9b">time</a>, dt_dyn) == <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l00499"></a>00499              call t_startf (<span class="stringliteral">&apos;cice_dyn&apos;</span>)
<a name="l00500"></a>00500              call <a class="code" href="namespaceice__step__mod.html#a9b4ebd333313b56f42a75e8456969dd9">step_dynamics</a>(dt_dyn,dt) <span class="comment">! dynamics, transport, ridging</span>
<a name="l00501"></a>00501              call t_stopf (<span class="stringliteral">&apos;cice_dyn&apos;</span>)
<a name="l00502"></a>00502           <span class="keyword">endif</span>
<a name="l00503"></a>00503        <span class="keyword">endif</span>
<a name="l00504"></a>00504     <span class="keyword">endif</span> <span class="comment">! not prescribed_ice</span>
<a name="l00505"></a>00505     
<a name="l00506"></a>00506     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00507"></a>00507     <span class="comment">! radiation</span>
<a name="l00508"></a>00508     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     call t_startf (<span class="stringliteral">&apos;cice_radiation&apos;</span>)
<a name="l00511"></a>00511     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#a6fd87221d7d148cbbd9b6c885a235034">timer_sw</a>)
<a name="l00512"></a>00512     call <a class="code" href="namespaceice__step__mod.html#a9e4459b869b4b233da16c02d6b92e975">step_radiation</a>(dt)
<a name="l00513"></a>00513     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#a6fd87221d7d148cbbd9b6c885a235034">timer_sw</a>)
<a name="l00514"></a>00514     call t_stopf (<span class="stringliteral">&apos;cice_radiation&apos;</span>)
<a name="l00515"></a>00515     
<a name="l00516"></a>00516     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00517"></a>00517     <span class="comment">! get ready for coupling</span>
<a name="l00518"></a>00518     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     call <a class="code" href="namespaceCICE__RunMod.html#abf11b85df210128b2304fac42127a723">coupling_prep</a>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#a2f62f4afeed2dc2700a9bf7c15e6d746">timer_step</a>)
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00525"></a>00525     <span class="comment">! write data</span>
<a name="l00526"></a>00526     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00527"></a>00527     
<a name="l00528"></a>00528     call t_startf (<span class="stringliteral">&apos;cice_diag&apos;</span>)
<a name="l00529"></a>00529     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#a6b3fa397674377c5596ab9a0a4e1beb2">timer_diags</a>)
<a name="l00530"></a>00530     <span class="keyword">if</span> (mod(istep,diagfreq) == 0) call <a class="code" href="namespaceice__diagnostics.html#a29d618a92dc5fe3345aad30da147f0b1">runtime_diags</a>(dt) <span class="comment">! log file</span>
<a name="l00531"></a>00531     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#a6b3fa397674377c5596ab9a0a4e1beb2">timer_diags</a>)
<a name="l00532"></a>00532     call t_stopf (<span class="stringliteral">&apos;cice_diag&apos;</span>)
<a name="l00533"></a>00533     
<a name="l00534"></a>00534     call t_startf (<span class="stringliteral">&apos;cice_hist&apos;</span>)
<a name="l00535"></a>00535     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#a97b81f9ad9a98de0710a2f1859113352">timer_hist</a>)
<a name="l00536"></a>00536 <span class="preprocessor">#if (defined _NOIO)</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span><span class="comment">!  Not enought memory on BGL to write a history file yet! </span>
<a name="l00538"></a>00538 <span class="comment">!    call ice_write_hist (dt)    ! history file</span>
<a name="l00539"></a>00539 <span class="preprocessor">#else</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>    call <a class="code" href="namespaceice__history.html#a09981e8df56a439fdddc4fcbb1066ecd">ice_write_hist </a>(dt)    <span class="comment">! history file</span>
<a name="l00541"></a>00541 <span class="preprocessor">#endif</span>
<a name="l00542"></a>00542 <span class="preprocessor"></span>    call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#a97b81f9ad9a98de0710a2f1859113352">timer_hist</a>)
<a name="l00543"></a>00543     call t_stopf (<span class="stringliteral">&apos;cice_hist&apos;</span>)
<a name="l00544"></a>00544  
<a name="l00545"></a>00545     <span class="comment">!--------------------------------------------</span>
<a name="l00546"></a>00546     <span class="comment">! Accumualate the number of active ice cells</span>
<a name="l00547"></a>00547     <span class="comment">!--------------------------------------------</span>
<a name="l00548"></a>00548     call accum_numIceCells2(<a class="code" href="namespaceice__state.html#a91eaa8dd8287c9640310a0aec0a85df8">aice</a>)
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     rstwr = seq_timemgr_RestartAlarmIsOn(EClock)
<a name="l00551"></a>00551     <span class="keyword">if</span> (rstwr) <span class="keyword">then</span>
<a name="l00552"></a>00552        call seq_timemgr_EClockGetData(EClock, curr_ymd=ymd_sync, curr_tod=tod_sync, &amp;
<a name="l00553"></a>00553           curr_yr=yr_sync,curr_mon=mon_sync,curr_day=day_sync)
<a name="l00554"></a>00554        fname = <a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a>(yr_sync, mon_sync, day_sync, tod_sync)
<a name="l00555"></a>00555 
<a name="l00556"></a>00556        <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00557"></a>00557           <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) &amp;
<a name="l00558"></a>00558             <span class="stringliteral">&apos;ice_comp_mct: calling dumpfile for restart filename= &apos;</span>, fname
<a name="l00559"></a>00559        <span class="keyword">endif</span>
<a name="l00560"></a>00560 
<a name="l00561"></a>00561        <span class="keyword">if</span> (<a class="code" href="namespaceice__restart.html#a959bc8a517154ec9d4ab801d5bb2c55f">restart_format</a> /= <span class="stringliteral">&apos;nc&apos;</span>) <span class="keyword">then</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563           <span class="keyword">if</span> (tr_pond) <span class="keyword">then</span>
<a name="l00564"></a>00564                n = index(fname,<span class="stringliteral">&apos;cice.r&apos;</span>) + 6
<a name="l00565"></a>00565                string1 = trim(fname(1:n-1))
<a name="l00566"></a>00566                string2 = trim(fname(n:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(fname)))
<a name="l00567"></a>00567                <span class="keyword">write</span>(filename_volpn,<span class="stringliteral">&apos;(a,a,a,a)&apos;</span>) &amp;
<a name="l00568"></a>00568                   string1(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string1)),<span class="stringliteral">&apos;.volpn&apos;</span>, &amp;
<a name="l00569"></a>00569                   string2(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string2))
<a name="l00570"></a>00570           <span class="keyword">endif</span>
<a name="l00571"></a>00571           <span class="keyword">if</span> (tr_aero) <span class="keyword">then</span>
<a name="l00572"></a>00572                n = index(fname,<span class="stringliteral">&apos;cice.r&apos;</span>) + 6
<a name="l00573"></a>00573                string1 = trim(fname(1:n-1))
<a name="l00574"></a>00574                string2 = trim(fname(n:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(fname)))
<a name="l00575"></a>00575                <span class="keyword">write</span>(<a class="code" href="namespaceice__state.html#ab5f78ad535732539802475cc958d8bc0">filename_aero</a>,<span class="stringliteral">&apos;(a,a,a,a)&apos;</span>) &amp;
<a name="l00576"></a>00576                   string1(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string1)),<span class="stringliteral">&apos;.aero&apos;</span>, &amp;
<a name="l00577"></a>00577                   string2(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string2))
<a name="l00578"></a>00578           <span class="keyword">endif</span>
<a name="l00579"></a>00579           <span class="keyword">if</span> (tr_iage) <span class="keyword">then</span>
<a name="l00580"></a>00580                n = index(fname,<span class="stringliteral">&apos;cice.r&apos;</span>) + 6
<a name="l00581"></a>00581                string1 = trim(fname(1:n-1))
<a name="l00582"></a>00582                string2 = trim(fname(n:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(fname)))
<a name="l00583"></a>00583                <span class="keyword">write</span>(<a class="code" href="namespaceice__state.html#ab39a4eb6530af3e7ded38f9876ddea95">filename_iage</a>,<span class="stringliteral">&apos;(a,a,a,a)&apos;</span>) &amp;
<a name="l00584"></a>00584                   string1(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string1)),<span class="stringliteral">&apos;.age&apos;</span>, &amp;
<a name="l00585"></a>00585                   string2(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string2))
<a name="l00586"></a>00586           <span class="keyword">endif</span>
<a name="l00587"></a>00587           <span class="keyword">if</span> (tr_FY) <span class="keyword">then</span>
<a name="l00588"></a>00588                n = index(fname,<span class="stringliteral">&apos;cice.r&apos;</span>) + 6
<a name="l00589"></a>00589                string1 = trim(fname(1:n-1))
<a name="l00590"></a>00590                string2 = trim(fname(n:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(fname)))
<a name="l00591"></a>00591                <span class="keyword">write</span>(filename_FY,<span class="stringliteral">&apos;(a,a,a,a)&apos;</span>) &amp;
<a name="l00592"></a>00592                   string1(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string1)),<span class="stringliteral">&apos;.FY&apos;</span>, &amp;
<a name="l00593"></a>00593                   string2(1:<a class="code" href="namespaceice__restart.html#affff786ae56a7f09bc01c31d71a1333c">lenstr</a>(string2))
<a name="l00594"></a>00594           <span class="keyword">endif</span>
<a name="l00595"></a>00595 
<a name="l00596"></a>00596        <span class="keyword">endif</span> <span class="comment">! restart_format</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 <span class="preprocessor">#if (defined _NOIO)</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span><span class="comment">!  Not enought memory on BGL to call dumpfile  file yet! </span>
<a name="l00600"></a>00600 <span class="comment">!       call dumpfile(fname)</span>
<a name="l00601"></a>00601 <span class="preprocessor">#else</span>
<a name="l00602"></a>00602 <span class="preprocessor"></span>       call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(<a class="code" href="namespaceice__timers.html#af250a2fa78a031dcb6f923aa2afb2813">timer_readwrite</a>)
<a name="l00603"></a>00603        call <a class="code" href="interfaceice__restart_1_1dumpfile.html">dumpfile</a>(fname)
<a name="l00604"></a>00604        <span class="keyword">if</span> (<a class="code" href="namespaceice__restart.html#a959bc8a517154ec9d4ab801d5bb2c55f">restart_format</a> /= <span class="stringliteral">&apos;nc&apos;</span>) <span class="keyword">then</span>
<a name="l00605"></a>00605           <span class="keyword">if</span> (tr_aero) call <a class="code" href="namespaceice__aerosol.html#a1e014a016b35aba5d5f31a829ffa909f">write_restart_aero</a>(<a class="code" href="namespaceice__state.html#ab5f78ad535732539802475cc958d8bc0">filename_aero</a>)
<a name="l00606"></a>00606           <span class="keyword">if</span> (tr_iage) call <a class="code" href="namespaceice__age.html#a6eb51bd21cc52fcd8d1985badbfca036">write_restart_age</a>(<a class="code" href="namespaceice__state.html#ab39a4eb6530af3e7ded38f9876ddea95">filename_iage</a>)
<a name="l00607"></a>00607           <span class="keyword">if</span> (tr_pond) call <a class="code" href="namespaceice__meltpond.html#a18dd3b2ba6582ac028a021de32f0e014">write_restart_pond</a>(filename_volpn)
<a name="l00608"></a>00608           <span class="keyword">if</span> (tr_FY)   call <a class="code" href="namespaceice__FY.html#af12be2c743dc7e04389c68e276903b94">write_restart_FY</a>(filename_FY)
<a name="l00609"></a>00609        <span class="keyword">endif</span>
<a name="l00610"></a>00610        call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#af250a2fa78a031dcb6f923aa2afb2813">timer_readwrite</a>)
<a name="l00611"></a>00611 <span class="preprocessor">#endif</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span>    <span class="keyword">end if</span>
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00615"></a>00615     <span class="comment">! send export state to driver </span>
<a name="l00616"></a>00616     <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00617"></a>00617     
<a name="l00618"></a>00618     call t_startf (<span class="stringliteral">&apos;cice_export&apos;</span>)
<a name="l00619"></a>00619     call <a class="code" href="namespaceice__timers.html#a308c3af934358cb1f050df7cce19ce79">ice_timer_start</a>(timer_cplsend)
<a name="l00620"></a>00620     call <a class="code" href="namespaceice__comp__mct.html#a0b623ba08317afe1cf24e68494b092da">ice_export_mct </a>( i2x_i )
<a name="l00621"></a>00621     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(timer_cplsend)
<a name="l00622"></a>00622     call t_stopf (<span class="stringliteral">&apos;cice_export&apos;</span>)
<a name="l00623"></a>00623     
<a name="l00624"></a>00624     <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00625"></a>00625     <span class="comment">! check that internal clock is in sync with master clock</span>
<a name="l00626"></a>00626     <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     tod = sec
<a name="l00629"></a>00629     ymd = <a class="code" href="namespaceice__calendar.html#aefc3f061e0c4d064b85e0fa84f0c92af">idate</a>
<a name="l00630"></a>00630     <span class="keyword">if</span> (.not. seq_timemgr_EClockDateInSync( EClock, ymd, tod )) <span class="keyword">then</span>
<a name="l00631"></a>00631        call seq_timemgr_EClockGetData( EClock, curr_ymd=ymd_sync, &amp;
<a name="l00632"></a>00632           curr_tod=tod_sync )
<a name="l00633"></a>00633        <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*)<span class="stringliteral">&apos; cice ymd=&apos;</span>,ymd     ,<span class="stringliteral">&apos;  cice tod= &apos;</span>,tod
<a name="l00634"></a>00634        <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*)<span class="stringliteral">&apos; sync ymd=&apos;</span>,ymd_sync,<span class="stringliteral">&apos;  sync tod= &apos;</span>,tod_sync
<a name="l00635"></a>00635        call shr_sys_abort( SubName// &amp;
<a name="l00636"></a>00636           <span class="stringliteral">&quot;:: Internal sea-ice clock not in sync with Sync Clock&quot;</span>)
<a name="l00637"></a>00637     <span class="keyword">end if</span>
<a name="l00638"></a>00638    
<a name="l00639"></a>00639     <span class="comment">! reset shr logging to my original values</span>
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     call shr_file_setLogUnit (shrlogunit)
<a name="l00642"></a>00642     call shr_file_setLogLevel(shrloglev)
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l00645"></a>00645     <span class="comment">! stop timers and print timer info</span>
<a name="l00646"></a>00646     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l00647"></a>00647     <span class="comment">! Need to have this logic here instead of in ice_final_mct since </span>
<a name="l00648"></a>00648     <span class="comment">! the ice_final_mct.F90 will still be called even in aqua-planet mode</span>
<a name="l00649"></a>00649     <span class="comment">! Could put this logic in the driver - but it seems easier here </span>
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="comment">! Need to stop this at the end of every run phase in a coupled run.</span>
<a name="l00652"></a>00652     call <a class="code" href="namespaceice__timers.html#ab483bb3b29e1839baf5a6bc2ad720ca8">ice_timer_stop</a>(<a class="code" href="namespaceice__timers.html#af4544096584c21d56bb41d500d4a1e7b">timer_total</a>)        <span class="comment">! stop timing</span>
<a name="l00653"></a>00653 
<a name="l00654"></a>00654     stop_now = seq_timemgr_StopAlarmIsOn( EClock )
<a name="l00655"></a>00655     <span class="keyword">if</span> (stop_now) <span class="keyword">then</span>
<a name="l00656"></a>00656        call <a class="code" href="namespaceice__timers.html#ace88d185debbc44901eff5a1d54d7fde">ice_timer_print_all</a>(stats=.true.) <span class="comment">! print timing information</span>
<a name="l00657"></a>00657        <span class="keyword">if</span>(<a class="code" href="namespaceice__communicate.html#a6dd078fb822abac232bfb22bab20ec64">lprint_stats</a>) <span class="keyword">then</span> 
<a name="l00658"></a>00658           call write_numIceCells()
<a name="l00659"></a>00659        <span class="keyword">endif</span>
<a name="l00660"></a>00660        call release_all_fileunits
<a name="l00661"></a>00661     <span class="keyword">end if</span>
<a name="l00662"></a>00662     
<a name="l00663"></a>00663 <span class="comment">!   if(tod == 0) then</span>
<a name="l00664"></a>00664 <span class="comment">!      call shr_get_memusage(msize,mrss)</span>
<a name="l00665"></a>00665 <span class="comment">!      call shr_mpi_max(mrss, mrss0, MPI_COMM_ICE,&apos;ice_run_mct mrss0&apos;)</span>
<a name="l00666"></a>00666 <span class="comment">!      call shr_mpi_max(msize,msize0,MPI_COMM_ICE,&apos;ice_run_mct msize0&apos;)</span>
<a name="l00667"></a>00667 <span class="comment">!      if(my_task == 0 ) then</span>
<a name="l00668"></a>00668 <span class="comment">!          write(shrlogunit,105) &apos;ice_run_mct: memory_write: model date = &apos;,ymd,tod, &amp;</span>
<a name="l00669"></a>00669 <span class="comment">!               &apos; memory = &apos;,msize0,&apos; MB (highwater)    &apos;,mrss0,&apos; MB (usage)&apos;</span>
<a name="l00670"></a>00670 <span class="comment">!      endif</span>
<a name="l00671"></a>00671 <span class="comment">!   endif</span>
<a name="l00672"></a>00672  
<a name="l00673"></a>00673   105  format( A, 2i8, A, f10.2, A, f10.2, A)
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 <span class="keyword">  end subroutine ice_run_mct</span>
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00678"></a>00678 <span class="comment">!BOP</span>
<a name="l00679"></a>00679 <span class="comment">!</span>
<a name="l00680"></a>00680 <span class="comment">! !IROUTINE: ice_final_mct</span>
<a name="l00681"></a>00681 <span class="comment">!</span>
<a name="l00682"></a>00682 <span class="comment">! !INTERFACE:</span>
<a name="l00683"></a><a class="code" href="namespaceice__comp__mct.html#acd10abc7ef002e1d5e3223ce079bad2b">00683</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#acd10abc7ef002e1d5e3223ce079bad2b">ice_final_mct</a>( )
<a name="l00684"></a>00684 <span class="comment">!</span>
<a name="l00685"></a>00685 <span class="comment">! !DESCRIPTION:</span>
<a name="l00686"></a>00686 <span class="comment">! Finalize CICE</span>
<a name="l00687"></a>00687 <span class="comment">!</span>
<a name="l00688"></a>00688 <span class="comment">! !USES:</span>
<a name="l00689"></a>00689 <span class="comment">!</span>
<a name="l00690"></a>00690 <span class="comment">!------------------------------------------------------------------------------</span>
<a name="l00691"></a>00691 <span class="comment">!BOP</span>
<a name="l00692"></a>00692 <span class="comment">!</span>
<a name="l00693"></a>00693 <span class="comment">! !ARGUMENTS:</span>
<a name="l00694"></a>00694 <span class="comment">!</span>
<a name="l00695"></a>00695 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00696"></a>00696 <span class="comment">!</span>
<a name="l00697"></a>00697 <span class="comment">!EOP</span>
<a name="l00698"></a>00698 <span class="comment">!---------------------------------------------------------------------------</span>
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="keyword">  end subroutine ice_final_mct</span>
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 <span class="comment">!===============================================================================</span>
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="namespaceice__comp__mct.html#a44b387bdc97aa66b1bd25afd2b68ec09">00704</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#a44b387bdc97aa66b1bd25afd2b68ec09">ice_SetGSMap_mct</a>( mpicom_ice, ICEID, gsMap_ice )
<a name="l00705"></a>00705 
<a name="l00706"></a>00706     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l00707"></a>00707     <span class="comment">!</span>
<a name="l00708"></a>00708     <span class="comment">! Arguments</span>
<a name="l00709"></a>00709     <span class="comment">!</span>
<a name="l00710"></a>00710     <span class="keyword">implicit none</span>
<a name="l00711"></a>00711     <span class="keywordtype">integer</span>        , <span class="keywordtype">intent(in)</span>    :: mpicom_ice
<a name="l00712"></a>00712     <span class="keywordtype">integer</span>        , <span class="keywordtype">intent(in)</span>    :: ICEID
<a name="l00713"></a>00713     <span class="keywordtype">type(</span>mct_gsMap<span class="keywordtype">)</span>, <span class="keywordtype">intent(inout)</span> :: gsMap_ice
<a name="l00714"></a>00714     <span class="comment">!</span>
<a name="l00715"></a>00715     <span class="comment">! Local variables</span>
<a name="l00716"></a>00716     <span class="comment">!</span>
<a name="l00717"></a>00717     <span class="keywordtype">integer</span>,<span class="keywordtype">allocatable</span> :: gindex(:)
<a name="l00718"></a>00718     <span class="keywordtype">integer</span>     :: lat
<a name="l00719"></a>00719     <span class="keywordtype">integer</span>     :: lon
<a name="l00720"></a>00720     <span class="keywordtype">integer</span>     :: i, j, iblk, n, gi
<a name="l00721"></a>00721     <span class="keywordtype">integer</span>     :: lsize,gsize
<a name="l00722"></a>00722     <span class="keywordtype">integer</span>     :: ier
<a name="l00723"></a>00723     <span class="keywordtype">integer</span>     :: ilo, ihi, jlo, jhi <span class="comment">! beginning and end of physical domain</span>
<a name="l00724"></a>00724     <span class="keywordtype">type(</span><a class="code" href="typeice__blocks_1_1block.html">block</a><span class="keywordtype">)</span> :: this_block         <span class="comment">! block information for current block</span>
<a name="l00725"></a>00725     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l00726"></a>00726 
<a name="l00727"></a>00727     <span class="comment">! Build the CICE grid numbering for MCT</span>
<a name="l00728"></a>00728     <span class="comment">! NOTE:  Numbering scheme is: West to East and South to North</span>
<a name="l00729"></a>00729     <span class="comment">! starting at south pole.  Should be the same as what&apos;s used</span>
<a name="l00730"></a>00730     <span class="comment">! in SCRIP</span>
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="comment">! number the local grid</span>
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     n=0
<a name="l00735"></a>00735     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00736"></a>00736        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l00737"></a>00737        ilo = this_block%ilo
<a name="l00738"></a>00738        ihi = this_block%ihi
<a name="l00739"></a>00739        jlo = this_block%jlo
<a name="l00740"></a>00740        jhi = this_block%jhi
<a name="l00741"></a>00741        
<a name="l00742"></a>00742        <span class="keyword">do</span> j = jlo, jhi
<a name="l00743"></a>00743           <span class="keyword">do</span> i = ilo, ihi
<a name="l00744"></a>00744              n = n+1
<a name="l00745"></a>00745           <span class="keyword">enddo</span> <span class="comment">!i</span>
<a name="l00746"></a>00746        <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l00747"></a>00747     <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l00748"></a>00748     lsize = n
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="comment">! not valid for padded decomps</span>
<a name="l00751"></a>00751 <span class="comment">!    lsize = block_size_x*block_size_y*nblocks</span>
<a name="l00752"></a>00752     gsize = <a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>*<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     <span class="keyword">allocate</span>(gindex(lsize),stat=ier)
<a name="l00755"></a>00755     n=0
<a name="l00756"></a>00756     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00757"></a>00757        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l00758"></a>00758        ilo = this_block%ilo
<a name="l00759"></a>00759        ihi = this_block%ihi
<a name="l00760"></a>00760        jlo = this_block%jlo
<a name="l00761"></a>00761        jhi = this_block%jhi
<a name="l00762"></a>00762        
<a name="l00763"></a>00763        <span class="keyword">do</span> j = jlo, jhi
<a name="l00764"></a>00764           <span class="keyword">do</span> i = ilo, ihi
<a name="l00765"></a>00765              n = n+1
<a name="l00766"></a>00766              lon = this_block%i_glob(i)
<a name="l00767"></a>00767              lat = this_block%j_glob(j)
<a name="l00768"></a>00768              gi = (lat-1)*<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a> + lon
<a name="l00769"></a>00769              gindex(n) = gi
<a name="l00770"></a>00770           <span class="keyword">enddo</span> <span class="comment">!i</span>
<a name="l00771"></a>00771        <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l00772"></a>00772     <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l00773"></a>00773     
<a name="l00774"></a>00774     call mct_gsMap_init( gsMap_ice, gindex, mpicom_ice, ICEID, lsize, gsize )
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="keyword">deallocate</span>(gindex)
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 <span class="keyword">  end subroutine ice_SetGSMap_mct</span>
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 <span class="comment">!===============================================================================</span>
<a name="l00782"></a>00782 
<a name="l00783"></a><a class="code" href="namespaceice__comp__mct.html#a0b623ba08317afe1cf24e68494b092da">00783</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#a0b623ba08317afe1cf24e68494b092da">ice_export_mct</a>( i2x_i )   
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     <span class="comment">!-----------------------------------------------------</span>
<a name="l00786"></a>00786     <span class="keywordtype">type(</span>mct_aVect<span class="keywordtype">)</span>   , <span class="keywordtype">intent(inout)</span> :: i2x_i
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     <span class="keywordtype">integer</span> :: i, j, iblk, n, ij 
<a name="l00789"></a>00789     <span class="keywordtype">integer</span> :: ilo, ihi, jlo, jhi <span class="comment">!beginning and end of physical domain</span>
<a name="l00790"></a>00790     <span class="keywordtype">integer (kind=int_kind)                                </span>:: icells <span class="comment">! number of ocean/ice cells</span>
<a name="l00791"></a>00791     <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block) </span>:: indxi  <span class="comment">! compressed indices in i</span>
<a name="l00792"></a>00792     <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block) </span>:: indxj  <span class="comment">! compressed indices in i</span>
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(nx_block,ny_block,max_blocks) </span>:: 
<a name="l00795"></a>00795         Tsrf        <span class="comment">! surface temperature</span>
<a name="l00796"></a>00796      ,  tauxa       <span class="comment">! atmo/ice stress</span>
<a name="l00797"></a>00797      ,  tauya 
<a name="l00798"></a>00798      ,  tauxo       <span class="comment">! ice/ocean stress</span>
<a name="l00799"></a>00799      ,  tauyo 
<a name="l00800"></a>00800      ,  sicthk      <span class="comment">! needed for cam/som only </span>
<a name="l00801"></a>00801      ,  ailohi       <span class="comment">! fractional ice area</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     <span class="keywordtype">real (kind=dbl_kind) </span>:: 
<a name="l00804"></a>00804        gsum, workx, worky           <span class="comment">! tmps for converting grid</span>
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="keywordtype">type(</span><a class="code" href="typeice__blocks_1_1block.html">block</a><span class="keywordtype">)</span>        :: this_block                           <span class="comment">! block information for current block</span>
<a name="l00807"></a>00807     <span class="keywordtype">logical</span> :: flag
<a name="l00808"></a>00808     <span class="comment">!-----------------------------------------------------</span>
<a name="l00809"></a>00809 
<a name="l00810"></a>00810     flag=.false.
<a name="l00811"></a>00811 
<a name="l00812"></a>00812     <span class="comment">!calculate ice thickness from aice and vice. Also</span>
<a name="l00813"></a>00813     <span class="comment">!create Tsrf from the first tracer (trcr) in ice_state.F</span>
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="comment">!$OMP PARALLEL DO PRIVATE(iblk,i,j,workx,worky)</span>
<a name="l00816"></a>00816     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00817"></a>00817        <span class="keyword">do</span> j = 1, <a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00818"></a>00818        <span class="keyword">do</span> i = 1, <a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00819"></a>00819              
<a name="l00820"></a>00820           <span class="comment">! sea-ice thickness needed for cam-som only</span>
<a name="l00821"></a>00821           sicthk(i,j,iblk) = <a class="code" href="namespaceice__state.html#a097435b3544c01705ca626cc43ee61b5">vice</a>(i,j,iblk)/(<a class="code" href="namespaceice__state.html#a91eaa8dd8287c9640310a0aec0a85df8">aice</a>(i,j,iblk)+<a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>)
<a name="l00822"></a>00822 
<a name="l00823"></a>00823           <span class="comment">! ice fraction</span>
<a name="l00824"></a>00824           ailohi(i,j,iblk) = min(<a class="code" href="namespaceice__state.html#a91eaa8dd8287c9640310a0aec0a85df8">aice</a>(i,j,iblk), <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>)
<a name="l00825"></a>00825 
<a name="l00826"></a>00826           <span class="comment">! surface temperature</span>
<a name="l00827"></a>00827           Tsrf(i,j,iblk)  = Tffresh + <a class="code" href="namespaceice__state.html#ad9117b5d7f02ca8a6a10db8afa75a6ef">trcr</a>(i,j,1,iblk)             <span class="comment">!Kelvin (original ???)</span>
<a name="l00828"></a>00828           
<a name="l00829"></a>00829           <span class="comment">! wind stress  (on POP T-grid:  convert to lat-lon)</span>
<a name="l00830"></a>00830           workx = strairxT(i,j,iblk)                             <span class="comment">! N/m^2</span>
<a name="l00831"></a>00831           worky = strairyT(i,j,iblk)                             <span class="comment">! N/m^2</span>
<a name="l00832"></a>00832           tauxa(i,j,iblk) = workx*cos(ANGLET(i,j,iblk)) &amp;
<a name="l00833"></a>00833                           - worky*sin(ANGLET(i,j,iblk))
<a name="l00834"></a>00834           tauya(i,j,iblk) = worky*cos(ANGLET(i,j,iblk)) &amp;
<a name="l00835"></a>00835                           + workx*sin(ANGLET(i,j,iblk))
<a name="l00836"></a>00836           
<a name="l00837"></a>00837           <span class="comment">! ice/ocean stress (on POP T-grid:  convert to lat-lon)</span>
<a name="l00838"></a>00838           workx = -strocnxT(i,j,iblk)                            <span class="comment">! N/m^2</span>
<a name="l00839"></a>00839           worky = -strocnyT(i,j,iblk)                            <span class="comment">! N/m^2</span>
<a name="l00840"></a>00840           tauxo(i,j,iblk) = workx*cos(ANGLET(i,j,iblk)) &amp;
<a name="l00841"></a>00841                           - worky*sin(ANGLET(i,j,iblk))
<a name="l00842"></a>00842           tauyo(i,j,iblk) = worky*cos(ANGLET(i,j,iblk)) &amp;
<a name="l00843"></a>00843                           + workx*sin(ANGLET(i,j,iblk))
<a name="l00844"></a>00844 
<a name="l00845"></a>00845        <span class="keyword">enddo</span>
<a name="l00846"></a>00846        <span class="keyword">enddo</span>
<a name="l00847"></a>00847     <span class="keyword">enddo</span>
<a name="l00848"></a>00848     <span class="comment">!$OMP END PARALLEL DO</span>
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00851"></a>00851        <span class="keyword">do</span> j = 1, <a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00852"></a>00852        <span class="keyword">do</span> i = 1, <a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00853"></a>00853           <span class="keyword">if</span> (<a class="code" href="namespaceice__grid.html#a5de6731a3b8601be3495a4c306832bf0">tmask</a>(i,j,iblk) .and. ailohi(i,j,iblk) &lt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a> ) <span class="keyword">then</span>
<a name="l00854"></a>00854              flag = .true.
<a name="l00855"></a>00855           <span class="keyword">endif</span>
<a name="l00856"></a>00856        <span class="keyword">end do</span>
<a name="l00857"></a>00857        <span class="keyword">end do</span>
<a name="l00858"></a>00858     <span class="keyword">end do</span>
<a name="l00859"></a>00859     <span class="keyword">if</span> (flag) <span class="keyword">then</span>
<a name="l00860"></a>00860        <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00861"></a>00861           <span class="keyword">do</span> j = 1, <a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00862"></a>00862           <span class="keyword">do</span> i = 1, <a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00863"></a>00863              <span class="keyword">if</span> (<a class="code" href="namespaceice__grid.html#a5de6731a3b8601be3495a4c306832bf0">tmask</a>(i,j,iblk) .and. ailohi(i,j,iblk) &lt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a> ) <span class="keyword">then</span>
<a name="l00864"></a>00864                 <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) &amp;
<a name="l00865"></a>00865                      <span class="stringliteral">&apos; (ice) send: ERROR ailohi &lt; 0.0 &apos;</span>,i,j,ailohi(i,j,iblk)
<a name="l00866"></a>00866                 call shr_sys_flush(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>)
<a name="l00867"></a>00867              <span class="keyword">endif</span>
<a name="l00868"></a>00868           <span class="keyword">end do</span>
<a name="l00869"></a>00869           <span class="keyword">end do</span>
<a name="l00870"></a>00870        <span class="keyword">end do</span>
<a name="l00871"></a>00871     <span class="keyword">endif</span>
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     <span class="comment">! Fill export state i2x_i</span>
<a name="l00874"></a>00874 
<a name="l00875"></a>00875      i2x_i%rAttr(:,:) = spval_dbl
<a name="l00876"></a>00876 
<a name="l00877"></a>00877      n=0
<a name="l00878"></a>00878      <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00879"></a>00879          this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l00880"></a>00880          ilo = this_block%ilo
<a name="l00881"></a>00881          ihi = this_block%ihi
<a name="l00882"></a>00882          jlo = this_block%jlo
<a name="l00883"></a>00883          jhi = this_block%jhi
<a name="l00884"></a>00884 
<a name="l00885"></a>00885          <span class="keyword">do</span> j = jlo, jhi
<a name="l00886"></a>00886          <span class="keyword">do</span> i = ilo, ihi
<a name="l00887"></a>00887 
<a name="l00888"></a>00888             n = n+1
<a name="l00889"></a>00889 
<a name="l00890"></a>00890             <span class="comment">!-------states-------------------- </span>
<a name="l00891"></a>00891             i2x_i%rAttr(index_i2x_Si_sicthk,n)    = sicthk(i,j,iblk) <span class="comment">! (needed by CAM/SOM only)</span>
<a name="l00892"></a>00892             i2x_i%rAttr(index_i2x_Si_ifrac ,n)    = ailohi(i,j,iblk)   
<a name="l00893"></a>00893 
<a name="l00894"></a>00894             <span class="keyword">if</span> ( <a class="code" href="namespaceice__grid.html#a5de6731a3b8601be3495a4c306832bf0">tmask</a>(i,j,iblk) .and. ailohi(i,j,iblk) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a> ) <span class="keyword">then</span>
<a name="l00895"></a>00895                <span class="comment">!-------states-------------------- </span>
<a name="l00896"></a>00896                i2x_i%rAttr(index_i2x_Si_t     ,n)    = Tsrf(i,j,iblk)
<a name="l00897"></a>00897                i2x_i%rAttr(index_i2x_Si_avsdr ,n)    = alvdr(i,j,iblk)
<a name="l00898"></a>00898                i2x_i%rAttr(index_i2x_Si_anidr ,n)    = alidr(i,j,iblk)
<a name="l00899"></a>00899                i2x_i%rAttr(index_i2x_Si_avsdf ,n)    = alvdf(i,j,iblk)
<a name="l00900"></a>00900                i2x_i%rAttr(index_i2x_Si_anidf ,n)    = alidf(i,j,iblk)
<a name="l00901"></a>00901                i2x_i%rAttr(index_i2x_Si_tref  ,n)    = Tref(i,j,iblk)
<a name="l00902"></a>00902                i2x_i%rAttr(index_i2x_Si_qref  ,n)    = Qref(i,j,iblk)
<a name="l00903"></a>00903 <span class="comment">!              i2x_i%rAttr(index_i2x_Si_snowh ,n)    = vsno(i,j,iblk) &amp;</span>
<a name="l00904"></a>00904 <span class="comment">!                                                    / ailohi(i,j,iblk)</span>
<a name="l00905"></a>00905             
<a name="l00906"></a>00906                <span class="comment">!--- a/i fluxes computed by ice</span>
<a name="l00907"></a>00907                i2x_i%rAttr(index_i2x_Faii_taux ,n)   = tauxa(i,j,iblk)    
<a name="l00908"></a>00908                i2x_i%rAttr(index_i2x_Faii_tauy ,n)   = tauya(i,j,iblk)    
<a name="l00909"></a>00909                i2x_i%rAttr(index_i2x_Faii_lat  ,n)   = flat(i,j,iblk)     
<a name="l00910"></a>00910                i2x_i%rAttr(index_i2x_Faii_sen  ,n)   = fsens(i,j,iblk)    
<a name="l00911"></a>00911                i2x_i%rAttr(index_i2x_Faii_lwup ,n)   = flwout(i,j,iblk)   
<a name="l00912"></a>00912                i2x_i%rAttr(index_i2x_Faii_evap ,n)   = evap(i,j,iblk)     
<a name="l00913"></a>00913                i2x_i%rAttr(index_i2x_Faii_swnet,n)   = fswabs(i,j,iblk)
<a name="l00914"></a>00914             
<a name="l00915"></a>00915                <span class="comment">!--- i/o fluxes computed by ice</span>
<a name="l00916"></a>00916                i2x_i%rAttr(index_i2x_Fioi_melth,n)   = fhocn(i,j,iblk)
<a name="l00917"></a>00917                i2x_i%rAttr(index_i2x_Fioi_swpen,n)   = fswthru(i,j,iblk) <span class="comment">! hf from melting          </span>
<a name="l00918"></a>00918                i2x_i%rAttr(index_i2x_Fioi_meltw,n)   = fresh(i,j,iblk)   <span class="comment">! h2o flux from melting    ???</span>
<a name="l00919"></a>00919                i2x_i%rAttr(index_i2x_Fioi_salt ,n)   = fsalt(i,j,iblk)   <span class="comment">! salt flux from melting   ???</span>
<a name="l00920"></a>00920                i2x_i%rAttr(index_i2x_Fioi_taux ,n)   = tauxo(i,j,iblk)   <span class="comment">! stress : i/o zonal       ???</span>
<a name="l00921"></a>00921                i2x_i%rAttr(index_i2x_Fioi_tauy ,n)   = tauyo(i,j,iblk)   <span class="comment">! stress : i/o meridional  ???</span>
<a name="l00922"></a>00922             <span class="keyword">end if</span>
<a name="l00923"></a>00923          <span class="keyword">enddo</span>    <span class="comment">!i</span>
<a name="l00924"></a>00924          <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l00925"></a>00925      <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l00926"></a>00926 
<a name="l00927"></a>00927 <span class="keyword">  end subroutine ice_export_mct</span>
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 <span class="comment">!==============================================================================</span>
<a name="l00930"></a>00930 
<a name="l00931"></a><a class="code" href="namespaceice__comp__mct.html#a64a861144b6d897f984676031622b7f9">00931</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#a64a861144b6d897f984676031622b7f9">ice_import_mct</a>( x2i_i )
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="comment">!-----------------------------------------------------</span>
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <span class="keyword">implicit none</span>
<a name="l00936"></a>00936     <span class="keywordtype">type(</span>mct_aVect<span class="keywordtype">)</span>   , <span class="keywordtype">intent(inout)</span> :: x2i_i
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     <span class="keywordtype">integer</span> :: i, j, iblk, n
<a name="l00939"></a>00939     <span class="keywordtype">integer</span> :: ilo, ihi, jlo, jhi <span class="comment">!beginning and end of physical domain</span>
<a name="l00940"></a>00940     <span class="keywordtype">type(</span><a class="code" href="typeice__blocks_1_1block.html">block</a><span class="keywordtype">)</span> :: this_block      <span class="comment">! block information for current block</span>
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <span class="keywordtype">integer</span>,<span class="keywordtype">parameter</span> :: nflds=15,nfldv=6
<a name="l00943"></a>00943     <span class="keywordtype">real (kind=dbl_kind)</span>,<span class="keywordtype">allocatable</span> :: aflds(:,:,:,:)
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="keywordtype">real (kind=dbl_kind) </span>:: 
<a name="l00946"></a>00946          gsum, workx, worky, maxwork
<a name="l00947"></a>00947     <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension (:,:,:) </span>:: 
<a name="l00948"></a>00948          work
<a name="l00949"></a>00949     <span class="keywordtype">logical (kind=log_kind) </span>:: 
<a name="l00950"></a>00950          first_call = .true.
<a name="l00951"></a>00951     <span class="keywordtype">logical (kind=log_kind) </span>:: 
<a name="l00952"></a>00952          prescribed_aero_tmp
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="comment">!-----------------------------------------------------</span>
<a name="l00955"></a>00955 
<a name="l00956"></a>00956     <span class="comment">! Note that the precipitation fluxes received  from the coupler</span>
<a name="l00957"></a>00957     <span class="comment">! are in units of kg/s/m^2 which is what CICE requires.</span>
<a name="l00958"></a>00958     <span class="comment">! Note also that the read in below includes only values needed</span>
<a name="l00959"></a>00959     <span class="comment">! by the thermodynamic component of CICE.  Variables uocn, vocn,</span>
<a name="l00960"></a>00960     <span class="comment">! ss_tltx, and ss_tlty are excluded. Also, because the SOM and</span>
<a name="l00961"></a>00961     <span class="comment">! DOM don&apos;t  compute SSS.   SSS is not read in and is left at</span>
<a name="l00962"></a>00962     <span class="comment">! the initilized value (see ice_flux.F init_coupler_flux) of</span>
<a name="l00963"></a>00963     <span class="comment">! 34 ppt</span>
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="comment">! Use aflds to gather the halo updates of multiple fields</span>
<a name="l00966"></a>00966     <span class="comment">! Need to separate the scalar from the vector halo updates</span>
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     <span class="keyword">allocate</span>(aflds(<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>,nflds,<a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>))
<a name="l00969"></a>00969     aflds = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00970"></a>00970 
<a name="l00971"></a>00971     n=0
<a name="l00972"></a>00972     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00973"></a>00973        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l00974"></a>00974        ilo = this_block%ilo
<a name="l00975"></a>00975        ihi = this_block%ihi
<a name="l00976"></a>00976        jlo = this_block%jlo
<a name="l00977"></a>00977        jhi = this_block%jhi
<a name="l00978"></a>00978 
<a name="l00979"></a>00979        <span class="keyword">do</span> j = jlo, jhi
<a name="l00980"></a>00980        <span class="keyword">do</span> i = ilo, ihi
<a name="l00981"></a>00981 
<a name="l00982"></a>00982           n = n+1
<a name="l00983"></a>00983           aflds(i,j, 1,iblk)   = x2i_i%rAttr(index_x2i_So_t,n)
<a name="l00984"></a>00984           aflds(i,j, 2,iblk)   = x2i_i%rAttr(index_x2i_So_s,n)
<a name="l00985"></a>00985           aflds(i,j, 3,iblk)   = x2i_i%rAttr(index_x2i_Sa_z,n)
<a name="l00986"></a>00986           aflds(i,j, 4,iblk)   = x2i_i%rAttr(index_x2i_Sa_ptem,n)
<a name="l00987"></a>00987           aflds(i,j, 5,iblk)   = x2i_i%rAttr(index_x2i_Sa_tbot,n)
<a name="l00988"></a>00988           aflds(i,j, 6,iblk)   = x2i_i%rAttr(index_x2i_Sa_shum,n)
<a name="l00989"></a>00989           aflds(i,j, 7,iblk)   = x2i_i%rAttr(index_x2i_Sa_dens,n)
<a name="l00990"></a>00990           aflds(i,j, 8,iblk)   = x2i_i%rAttr(index_x2i_Fioo_q,n)
<a name="l00991"></a>00991           aflds(i,j, 9,iblk)   = x2i_i%rAttr(index_x2i_Faxa_swvdr,n)
<a name="l00992"></a>00992           aflds(i,j,10,iblk)   = x2i_i%rAttr(index_x2i_Faxa_swndr,n)
<a name="l00993"></a>00993           aflds(i,j,11,iblk)   = x2i_i%rAttr(index_x2i_Faxa_swvdf,n)
<a name="l00994"></a>00994           aflds(i,j,12,iblk)   = x2i_i%rAttr(index_x2i_Faxa_swndf,n)
<a name="l00995"></a>00995           aflds(i,j,13,iblk)   = x2i_i%rAttr(index_x2i_Faxa_lwdn,n)
<a name="l00996"></a>00996           aflds(i,j,14,iblk)   = x2i_i%rAttr(index_x2i_Faxa_rain,n)
<a name="l00997"></a>00997           aflds(i,j,15,iblk)   = x2i_i%rAttr(index_x2i_Faxa_snow,n)
<a name="l00998"></a>00998 
<a name="l00999"></a>00999          <span class="keyword">enddo</span>    <span class="comment">!i</span>
<a name="l01000"></a>01000          <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l01001"></a>01001 
<a name="l01002"></a>01002      <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l01003"></a>01003 
<a name="l01004"></a>01004      <span class="keyword">if</span> (.not.<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>) <span class="keyword">then</span>
<a name="l01005"></a>01005         call t_startf (<span class="stringliteral">&apos;cice_imp_halo&apos;</span>)
<a name="l01006"></a>01006         call <a class="code" href="interfaceice__boundary_1_1ice__HaloUpdate.html">ice_HaloUpdate</a>(aflds, <a class="code" href="namespaceice__domain.html#a06df1ee3a618bfdd4e7f6445a5376604">halo_info</a>, field_loc_center, &amp;
<a name="l01007"></a>01007                                               field_type_scalar)
<a name="l01008"></a>01008         call t_stopf (<span class="stringliteral">&apos;cice_imp_halo&apos;</span>)
<a name="l01009"></a>01009      <span class="keyword">endif</span>
<a name="l01010"></a>01010  
<a name="l01011"></a>01011      <span class="comment">!$OMP PARALLEL DO PRIVATE(iblk,i,j)</span>
<a name="l01012"></a>01012      <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01013"></a>01013         <span class="keyword">do</span> j = 1,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l01014"></a>01014         <span class="keyword">do</span> i = 1,<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l01015"></a>01015            sst  (i,j,iblk)   = aflds(i,j, 1,iblk)
<a name="l01016"></a>01016            sss  (i,j,iblk)   = aflds(i,j, 2,iblk)
<a name="l01017"></a>01017            zlvl (i,j,iblk)   = aflds(i,j, 3,iblk)
<a name="l01018"></a>01018            potT (i,j,iblk)   = aflds(i,j, 4,iblk)
<a name="l01019"></a>01019            Tair (i,j,iblk)   = aflds(i,j, 5,iblk)
<a name="l01020"></a>01020            Qa   (i,j,iblk)   = aflds(i,j, 6,iblk)
<a name="l01021"></a>01021            rhoa (i,j,iblk)   = aflds(i,j, 7,iblk)
<a name="l01022"></a>01022            frzmlt (i,j,iblk) = aflds(i,j, 8,iblk)
<a name="l01023"></a>01023            swvdr(i,j,iblk)   = aflds(i,j, 9,iblk)
<a name="l01024"></a>01024            swidr(i,j,iblk)   = aflds(i,j,10,iblk)
<a name="l01025"></a>01025            swvdf(i,j,iblk)   = aflds(i,j,11,iblk)
<a name="l01026"></a>01026            swidf(i,j,iblk)   = aflds(i,j,12,iblk)
<a name="l01027"></a>01027            flw  (i,j,iblk)   = aflds(i,j,13,iblk)
<a name="l01028"></a>01028            frain(i,j,iblk)   = aflds(i,j,14,iblk)
<a name="l01029"></a>01029            fsnow(i,j,iblk)   = aflds(i,j,15,iblk)
<a name="l01030"></a>01030         <span class="keyword">enddo</span>    <span class="comment">!i</span>
<a name="l01031"></a>01031         <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l01032"></a>01032      <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l01033"></a>01033      <span class="comment">!$OMP END PARALLEL DO</span>
<a name="l01034"></a>01034  
<a name="l01035"></a>01035      <span class="keyword">deallocate</span>(aflds)
<a name="l01036"></a>01036      <span class="keyword">allocate</span>(aflds(<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>,nfldv,<a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>))
<a name="l01037"></a>01037      aflds = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01038"></a>01038 
<a name="l01039"></a>01039      n=0
<a name="l01040"></a>01040      <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01041"></a>01041         this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)
<a name="l01042"></a>01042         ilo = this_block%ilo
<a name="l01043"></a>01043         ihi = this_block%ihi
<a name="l01044"></a>01044         jlo = this_block%jlo
<a name="l01045"></a>01045         jhi = this_block%jhi
<a name="l01046"></a>01046  
<a name="l01047"></a>01047         <span class="keyword">do</span> j = jlo, jhi
<a name="l01048"></a>01048         <span class="keyword">do</span> i = ilo, ihi
<a name="l01049"></a>01049            n = n+1
<a name="l01050"></a>01050            aflds(i,j, 1,iblk)   = x2i_i%rAttr(index_x2i_So_u,n)
<a name="l01051"></a>01051            aflds(i,j, 2,iblk)   = x2i_i%rAttr(index_x2i_So_v,n)
<a name="l01052"></a>01052            aflds(i,j, 3,iblk)   = x2i_i%rAttr(index_x2i_Sa_u,n)
<a name="l01053"></a>01053            aflds(i,j, 4,iblk)   = x2i_i%rAttr(index_x2i_Sa_v,n)
<a name="l01054"></a>01054            aflds(i,j, 5,iblk)   = x2i_i%rAttr(index_x2i_So_dhdx,n)
<a name="l01055"></a>01055            aflds(i,j, 6,iblk)   = x2i_i%rAttr(index_x2i_So_dhdy,n)
<a name="l01056"></a>01056         <span class="keyword">enddo</span>
<a name="l01057"></a>01057         <span class="keyword">enddo</span>
<a name="l01058"></a>01058      <span class="keyword">enddo</span>
<a name="l01059"></a>01059 
<a name="l01060"></a>01060      <span class="keyword">if</span> (.not.<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>) <span class="keyword">then</span>
<a name="l01061"></a>01061         call t_startf (<span class="stringliteral">&apos;cice_imp_halo&apos;</span>)
<a name="l01062"></a>01062         call <a class="code" href="interfaceice__boundary_1_1ice__HaloUpdate.html">ice_HaloUpdate</a>(aflds, <a class="code" href="namespaceice__domain.html#a06df1ee3a618bfdd4e7f6445a5376604">halo_info</a>, field_loc_center, &amp;
<a name="l01063"></a>01063                                              field_type_vector)
<a name="l01064"></a>01064         call t_stopf (<span class="stringliteral">&apos;cice_imp_halo&apos;</span>)
<a name="l01065"></a>01065      <span class="keyword">endif</span>
<a name="l01066"></a>01066 
<a name="l01067"></a>01067      <span class="comment">!$OMP PARALLEL DO PRIVATE(iblk,i,j)</span>
<a name="l01068"></a>01068      <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01069"></a>01069         <span class="keyword">do</span> j = 1,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l01070"></a>01070         <span class="keyword">do</span> i = 1,<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l01071"></a>01071            uocn (i,j,iblk)   = aflds(i,j, 1,iblk)
<a name="l01072"></a>01072            vocn (i,j,iblk)   = aflds(i,j, 2,iblk)
<a name="l01073"></a>01073            uatm (i,j,iblk)   = aflds(i,j, 3,iblk)
<a name="l01074"></a>01074            vatm (i,j,iblk)   = aflds(i,j, 4,iblk)
<a name="l01075"></a>01075            ss_tltx(i,j,iblk) = aflds(i,j, 5,iblk)
<a name="l01076"></a>01076            ss_tlty(i,j,iblk) = aflds(i,j, 6,iblk)
<a name="l01077"></a>01077         <span class="keyword">enddo</span>    <span class="comment">!i</span>
<a name="l01078"></a>01078         <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l01079"></a>01079      <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l01080"></a>01080      <span class="comment">!$OMP END PARALLEL DO</span>
<a name="l01081"></a>01081 
<a name="l01082"></a>01082      <span class="keyword">deallocate</span>(aflds)
<a name="l01083"></a>01083 
<a name="l01084"></a>01084      <span class="comment">!-------------------------------------------------------</span>
<a name="l01085"></a>01085      <span class="comment">! Accept aerosols from coupler when not prescribed.</span>
<a name="l01086"></a>01086      <span class="comment">!-------------------------------------------------------</span>
<a name="l01087"></a>01087      
<a name="l01088"></a>01088      <span class="comment">! Check for special values in coupler input.</span>
<a name="l01089"></a>01089 
<a name="l01090"></a>01090      <span class="keyword">if</span> (tr_aero .and. first_call) <span class="keyword">then</span>
<a name="l01091"></a>01091         <span class="keyword">allocate</span>(work(<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>,<a class="code" href="namespaceice__domain__size.html#abb7c0f274dd4e8ef1b66bc8785478941">max_blocks</a>))
<a name="l01092"></a>01092         n=0
<a name="l01093"></a>01093         <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01094"></a>01094            this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)
<a name="l01095"></a>01095            ilo = this_block%ilo
<a name="l01096"></a>01096            ihi = this_block%ihi
<a name="l01097"></a>01097            jlo = this_block%jlo
<a name="l01098"></a>01098            jhi = this_block%jhi
<a name="l01099"></a>01099            <span class="keyword">do</span> j = jlo, jhi
<a name="l01100"></a>01100               <span class="keyword">do</span> i = ilo, ihi
<a name="l01101"></a>01101                  n = n+1
<a name="l01102"></a>01102                  work(i,j,iblk) = x2i_i%rAttr(index_x2i_Faxa_bcphodry,n)
<a name="l01103"></a>01103               <span class="keyword">end do</span>
<a name="l01104"></a>01104            <span class="keyword">end do</span>
<a name="l01105"></a>01105         <span class="keyword">end do</span>
<a name="l01106"></a>01106         maxwork = <a class="code" href="interfaceice__global__reductions_1_1global__maxval.html">global_maxval</a>(work,<a class="code" href="namespaceice__domain.html#af84e6e4ee8c3c2d04326e26048f003b1">distrb_info</a>)
<a name="l01107"></a>01107         call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(maxwork, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l01108"></a>01108         <span class="keyword">if</span> (abs(maxwork) &lt; c100) <span class="keyword">then</span>
<a name="l01109"></a>01109            <a class="code" href="namespaceice__prescaero__mod.html#a12fbaeed0ee95a72e9c96406be9d7578">prescribed_aero</a> = .false.
<a name="l01110"></a>01110         <span class="keyword">else</span>
<a name="l01111"></a>01111            prescribed_aero_tmp = .true.
<a name="l01112"></a>01112            call <a class="code" href="namespaceice__prescaero__mod.html#a49687e63d926d56d80c47d29f3348bf3">ice_prescaero_init</a>(prescribed_aero_tmp)
<a name="l01113"></a>01113         <span class="keyword">end if</span>
<a name="l01114"></a>01114         <span class="keyword">deallocate</span>(work)
<a name="l01115"></a>01115         first_call = .false.
<a name="l01116"></a>01116      <span class="keyword">endif</span>
<a name="l01117"></a>01117 
<a name="l01118"></a>01118       <span class="keyword">if</span> (tr_aero .and. .not. <a class="code" href="namespaceice__prescaero__mod.html#a12fbaeed0ee95a72e9c96406be9d7578">prescribed_aero</a>) <span class="keyword">then</span>
<a name="l01119"></a>01119 
<a name="l01120"></a>01120       n=0
<a name="l01121"></a>01121       <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01122"></a>01122          this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l01123"></a>01123          ilo = this_block%ilo
<a name="l01124"></a>01124          ihi = this_block%ihi
<a name="l01125"></a>01125          jlo = this_block%jlo
<a name="l01126"></a>01126          jhi = this_block%jhi
<a name="l01127"></a>01127 
<a name="l01128"></a>01128          <span class="keyword">do</span> j = jlo, jhi
<a name="l01129"></a>01129          <span class="keyword">do</span> i = ilo, ihi
<a name="l01130"></a>01130 
<a name="l01131"></a>01131             n = n+1
<a name="l01132"></a>01132             faero(i,j,1,iblk) = x2i_i%rAttr(index_x2i_Faxa_bcphodry,n)
<a name="l01133"></a>01133 
<a name="l01134"></a>01134             faero(i,j,2,iblk) = x2i_i%rAttr(index_x2i_Faxa_bcphidry,n) &amp;
<a name="l01135"></a>01135                               + x2i_i%rAttr(index_x2i_Faxa_bcphiwet,n)
<a name="l01136"></a>01136          <span class="comment">! Combine all of the dust into one category</span>
<a name="l01137"></a>01137             faero(i,j,3,iblk) = x2i_i%rAttr(index_x2i_Faxa_dstwet1,n) &amp;
<a name="l01138"></a>01138                               + x2i_i%rAttr(index_x2i_Faxa_dstdry1,n) &amp;
<a name="l01139"></a>01139                               + x2i_i%rAttr(index_x2i_Faxa_dstwet2,n) &amp;
<a name="l01140"></a>01140                               + x2i_i%rAttr(index_x2i_Faxa_dstdry2,n) &amp;
<a name="l01141"></a>01141                               + x2i_i%rAttr(index_x2i_Faxa_dstwet3,n) &amp;
<a name="l01142"></a>01142                               + x2i_i%rAttr(index_x2i_Faxa_dstdry3,n) &amp;
<a name="l01143"></a>01143                               + x2i_i%rAttr(index_x2i_Faxa_dstwet4,n) &amp;
<a name="l01144"></a>01144                               + x2i_i%rAttr(index_x2i_Faxa_dstdry4,n)
<a name="l01145"></a>01145 
<a name="l01146"></a>01146          <span class="keyword">enddo</span>    <span class="comment">!i</span>
<a name="l01147"></a>01147          <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l01148"></a>01148 
<a name="l01149"></a>01149       <span class="keyword">enddo</span>        <span class="comment">!iblk</span>
<a name="l01150"></a>01150 
<a name="l01151"></a>01151      <span class="keyword">endif</span>
<a name="l01152"></a>01152 
<a name="l01153"></a>01153      <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01154"></a>01154      <span class="comment">! rotate zonal/meridional vectors to local coordinates</span>
<a name="l01155"></a>01155      <span class="comment">! compute data derived quantities</span>
<a name="l01156"></a>01156      <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01157"></a>01157      
<a name="l01158"></a>01158      <span class="comment">! Vector fields come in on T grid, but are oriented geographically</span>
<a name="l01159"></a>01159      <span class="comment">! need to rotate to pop-grid FIRST using ANGLET</span>
<a name="l01160"></a>01160      <span class="comment">! then interpolate to the U-cell centers  (otherwise we</span>
<a name="l01161"></a>01161      <span class="comment">! interpolate across the pole)</span>
<a name="l01162"></a>01162      <span class="comment">! use ANGLET which is on the T grid !</span>
<a name="l01163"></a>01163      
<a name="l01164"></a>01164      call t_startf (<span class="stringliteral">&apos;cice_imp_ocn&apos;</span>)
<a name="l01165"></a>01165      <span class="comment">!$OMP PARALLEL DO PRIVATE(iblk,i,j,workx,worky)</span>
<a name="l01166"></a>01166      <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01167"></a>01167 
<a name="l01168"></a>01168        <span class="keyword">do</span> j = 1,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l01169"></a>01169        <span class="keyword">do</span> i = 1,<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l01170"></a>01170 
<a name="l01171"></a>01171           <span class="comment">! ocean</span>
<a name="l01172"></a>01172           workx      = uocn  (i,j,iblk) <span class="comment">! currents, m/s </span>
<a name="l01173"></a>01173           worky      = vocn  (i,j,iblk)
<a name="l01174"></a>01174           uocn(i,j,iblk) = workx*cos(ANGLET(i,j,iblk)) &amp; <span class="comment">! convert to POP grid </span>
<a name="l01175"></a>01175                          + worky*sin(ANGLET(i,j,iblk))
<a name="l01176"></a>01176           vocn(i,j,iblk) = worky*cos(ANGLET(i,j,iblk)) &amp;
<a name="l01177"></a>01177                          - workx*sin(ANGLET(i,j,iblk))
<a name="l01178"></a>01178 
<a name="l01179"></a>01179           workx      = ss_tltx  (i,j,iblk)           <span class="comment">! sea sfc tilt, m/m</span>
<a name="l01180"></a>01180           worky      = ss_tlty  (i,j,iblk)
<a name="l01181"></a>01181           ss_tltx(i,j,iblk) = workx*cos(ANGLET(i,j,iblk)) &amp; <span class="comment">! convert to POP grid </span>
<a name="l01182"></a>01182                             + worky*sin(ANGLET(i,j,iblk))
<a name="l01183"></a>01183           ss_tlty(i,j,iblk) = worky*cos(ANGLET(i,j,iblk)) &amp;
<a name="l01184"></a>01184                             - workx*sin(ANGLET(i,j,iblk))
<a name="l01185"></a>01185 
<a name="l01186"></a>01186           sst(i,j,iblk) = sst(i,j,iblk) - Tffresh       <span class="comment">! sea sfc temp (C)</span>
<a name="l01187"></a>01187           Tf (i,j,iblk) = -1.8_dbl_kind                 <span class="comment">! hardwired for NCOM</span>
<a name="l01188"></a>01188 <span class="comment">!         Tf (i,j,iblk) = -depressT*sss(i,j,iblk)       ! freezing temp (C)</span>
<a name="l01189"></a>01189 <span class="comment">!         Tf (i,j,iblk) = -depressT*max(sss(i,j,iblk),ice_ref_salinity)</span>
<a name="l01190"></a>01190 
<a name="l01191"></a>01191        <span class="keyword">enddo</span>
<a name="l01192"></a>01192        <span class="keyword">enddo</span>
<a name="l01193"></a>01193       <span class="keyword">enddo</span>
<a name="l01194"></a>01194       <span class="comment">!$OMP END PARALLEL DO</span>
<a name="l01195"></a>01195       call t_stopf (<span class="stringliteral">&apos;cice_imp_ocn&apos;</span>)
<a name="l01196"></a>01196 
<a name="l01197"></a>01197       <span class="comment">! Interpolate ocean dynamics variables from T-cell centers to </span>
<a name="l01198"></a>01198       <span class="comment">! U-cell centers.</span>
<a name="l01199"></a>01199 
<a name="l01200"></a>01200       <span class="keyword">if</span> (.not.<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>) <span class="keyword">then</span>
<a name="l01201"></a>01201          call t_startf (<span class="stringliteral">&apos;cice_imp_t2u&apos;</span>)
<a name="l01202"></a>01202          call t2ugrid_vector(uocn)
<a name="l01203"></a>01203          call t2ugrid_vector(vocn)
<a name="l01204"></a>01204          call t2ugrid_vector(ss_tltx)
<a name="l01205"></a>01205          call t2ugrid_vector(ss_tlty)
<a name="l01206"></a>01206          call t_stopf (<span class="stringliteral">&apos;cice_imp_t2u&apos;</span>)
<a name="l01207"></a>01207       <span class="keyword">end if</span>
<a name="l01208"></a>01208 
<a name="l01209"></a>01209       <span class="comment">! Atmosphere variables are needed in T cell centers in</span>
<a name="l01210"></a>01210       <span class="comment">! subroutine stability and are interpolated to the U grid</span>
<a name="l01211"></a>01211       <span class="comment">! later as necessary.</span>
<a name="l01212"></a>01212 
<a name="l01213"></a>01213       call t_startf (<span class="stringliteral">&apos;cice_imp_atm&apos;</span>)
<a name="l01214"></a>01214       <span class="comment">!$OMP PARALLEL DO PRIVATE(iblk,i,j,workx,worky)</span>
<a name="l01215"></a>01215       <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01216"></a>01216          <span class="keyword">do</span> j = 1, <a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l01217"></a>01217          <span class="keyword">do</span> i = 1, <a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l01218"></a>01218   
<a name="l01219"></a>01219          <span class="comment">! atmosphere</span>
<a name="l01220"></a>01220          workx      = uatm(i,j,iblk) <span class="comment">! wind velocity, m/s</span>
<a name="l01221"></a>01221          worky      = vatm(i,j,iblk) 
<a name="l01222"></a>01222          uatm (i,j,iblk) = workx*cos(ANGLET(i,j,iblk)) &amp; <span class="comment">! convert to POP grid</span>
<a name="l01223"></a>01223                          + worky*sin(ANGLET(i,j,iblk))   <span class="comment">! note uatm, vatm, wind</span>
<a name="l01224"></a>01224          vatm (i,j,iblk) = worky*cos(ANGLET(i,j,iblk)) &amp; <span class="comment">! are on the T-grid here</span>
<a name="l01225"></a>01225                          - workx*sin(ANGLET(i,j,iblk))
<a name="l01226"></a>01226 
<a name="l01227"></a>01227          wind (i,j,iblk) = sqrt(uatm(i,j,iblk)**2 + vatm(i,j,iblk)**2)
<a name="l01228"></a>01228          fsw  (i,j,iblk) = swvdr(i,j,iblk) + swvdf(i,j,iblk) &amp;
<a name="l01229"></a>01229                          + swidr(i,j,iblk) + swidf(i,j,iblk)
<a name="l01230"></a>01230          <span class="keyword">enddo</span>
<a name="l01231"></a>01231          <span class="keyword">enddo</span>
<a name="l01232"></a>01232       <span class="keyword">enddo</span>
<a name="l01233"></a>01233       <span class="comment">!$OMP END PARALLEL DO</span>
<a name="l01234"></a>01234       call t_stopf (<span class="stringliteral">&apos;cice_imp_atm&apos;</span>)
<a name="l01235"></a>01235 
<a name="l01236"></a>01236 <span class="keyword">   end subroutine ice_import_mct</span>
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 <span class="comment">!=======================================================================</span>
<a name="l01239"></a>01239 
<a name="l01240"></a><a class="code" href="namespaceice__comp__mct.html#a13b99c3351533da77b875c4de8cf6cf8">01240</a>   <span class="keyword">subroutine </span><a class="code" href="namespaceice__comp__mct.html#a13b99c3351533da77b875c4de8cf6cf8">ice_domain_mct</a>( lsize, gsMap_i, dom_i )
<a name="l01241"></a>01241 
<a name="l01242"></a>01242     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l01243"></a>01243     <span class="comment">!</span>
<a name="l01244"></a>01244     <span class="comment">! Arguments</span>
<a name="l01245"></a>01245     <span class="comment">!</span>
<a name="l01246"></a>01246     <span class="keywordtype">integer</span>        , <span class="keywordtype">intent(in)</span>    :: lsize
<a name="l01247"></a>01247     <span class="keywordtype">type(</span>mct_gsMap<span class="keywordtype">)</span>, <span class="keywordtype">intent(in)</span>    :: gsMap_i
<a name="l01248"></a>01248     <span class="keywordtype">type(</span>mct_ggrid<span class="keywordtype">)</span>, <span class="keywordtype">intent(inout)</span> :: dom_i     
<a name="l01249"></a>01249     <span class="comment">!</span>
<a name="l01250"></a>01250     <span class="comment">! Local Variables</span>
<a name="l01251"></a>01251     <span class="comment">!</span>
<a name="l01252"></a>01252     <span class="keywordtype">integer</span> :: i, j, iblk, n, gi           <span class="comment">! indices</span>
<a name="l01253"></a>01253     <span class="keywordtype">integer</span> :: ilo, ihi, jlo, jhi          <span class="comment">! beginning and end of physical domain</span>
<a name="l01254"></a>01254     <span class="keywordtype">real(dbl_kind)</span>, <span class="keywordtype">pointer</span> :: work_dom(:) <span class="comment">! temporary</span>
<a name="l01255"></a>01255     <span class="keywordtype">real(dbl_kind)</span>, <span class="keywordtype">pointer</span> :: data(:)     <span class="comment">! temporary</span>
<a name="l01256"></a>01256     <span class="keywordtype">integer</span>       , <span class="keywordtype">pointer</span> :: idata(:)    <span class="comment">! temporary</span>
<a name="l01257"></a>01257     <span class="keywordtype">type(</span><a class="code" href="typeice__blocks_1_1block.html">block</a><span class="keywordtype">)</span>             :: this_block  <span class="comment">! block information for current block</span>
<a name="l01258"></a>01258     <span class="comment">!-------------------------------------------------------------------</span>
<a name="l01259"></a>01259     <span class="comment">!</span>
<a name="l01260"></a>01260     <span class="comment">! Initialize mct domain type</span>
<a name="l01261"></a>01261     <span class="comment">! lat/lon in degrees,  area in radians^2, mask is 1 (ocean), 0 (non-ocean)</span>
<a name="l01262"></a>01262     <span class="comment">!</span>
<a name="l01263"></a>01263     call mct_gGrid_init( GGrid=dom_i, CoordChars=trim(seq_flds_dom_coord), &amp;
<a name="l01264"></a>01264        OtherChars=trim(seq_flds_dom_other), lsize=lsize )
<a name="l01265"></a>01265     call mct_aVect_zero(dom_i%data)
<a name="l01266"></a>01266     <span class="comment">!  </span>
<a name="l01267"></a>01267     <span class="keyword">allocate</span>(<span class="keyword">data</span>(lsize))
<a name="l01268"></a>01268     <span class="comment">!</span>
<a name="l01269"></a>01269     <span class="comment">! Determine global gridpoint number attribute, GlobGridNum, which is set automatically by MCT</span>
<a name="l01270"></a>01270     <span class="comment">!</span>
<a name="l01271"></a>01271     call mct_gsMap_orderedPoints(gsMap_i, <a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a>, idata)
<a name="l01272"></a>01272     call mct_gGrid_importIAttr(dom_i,<span class="stringliteral">&apos;GlobGridNum&apos;</span>,idata,lsize)
<a name="l01273"></a>01273     <span class="comment">!</span>
<a name="l01274"></a>01274     <span class="comment">! Determine domain (numbering scheme is: West to East and South to North to South pole)</span>
<a name="l01275"></a>01275     <span class="comment">! Initialize attribute vector with special value</span>
<a name="l01276"></a>01276     <span class="comment">!</span>
<a name="l01277"></a>01277     <span class="keyword">data</span>(:) = -9999.0_R8 
<a name="l01278"></a>01278     call mct_gGrid_importRAttr(dom_i,<span class="stringliteral">&quot;lat&quot;</span>  ,<span class="keyword">data</span>,lsize) 
<a name="l01279"></a>01279     call mct_gGrid_importRAttr(dom_i,<span class="stringliteral">&quot;lon&quot;</span>  ,<span class="keyword">data</span>,lsize) 
<a name="l01280"></a>01280     call mct_gGrid_importRAttr(dom_i,<span class="stringliteral">&quot;area&quot;</span> ,<span class="keyword">data</span>,lsize) 
<a name="l01281"></a>01281     call mct_gGrid_importRAttr(dom_i,<span class="stringliteral">&quot;aream&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01282"></a>01282     <span class="keyword">data</span>(:) = 0.0_R8     
<a name="l01283"></a>01283     call mct_gGrid_importRAttr(dom_i,<span class="stringliteral">&quot;mask&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01284"></a>01284     call mct_gGrid_importRAttr(dom_i,<span class="stringliteral">&quot;frac&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01285"></a>01285     <span class="comment">!</span>
<a name="l01286"></a>01286     <span class="comment">! Fill in correct values for domain components</span>
<a name="l01287"></a>01287     <span class="comment">!</span>
<a name="l01288"></a>01288     <span class="keyword">allocate</span>(work_dom(lsize)) 
<a name="l01289"></a>01289     work_dom(:) = 0.0_dbl_kind
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     n=0
<a name="l01292"></a>01292     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01293"></a>01293        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l01294"></a>01294        ilo = this_block%ilo
<a name="l01295"></a>01295        ihi = this_block%ihi
<a name="l01296"></a>01296        jlo = this_block%jlo
<a name="l01297"></a>01297        jhi = this_block%jhi
<a name="l01298"></a>01298        
<a name="l01299"></a>01299        <span class="keyword">do</span> j = jlo, jhi
<a name="l01300"></a>01300        <span class="keyword">do</span> i = ilo, ihi
<a name="l01301"></a>01301           n = n+1
<a name="l01302"></a>01302           <span class="keyword">data</span>(n) = TLON(i,j,iblk)*<a class="code" href="namespaceice__constants.html#a499282766889f13defe6ffd6c7aa1216">rad_to_deg</a> 
<a name="l01303"></a>01303        <span class="keyword">enddo</span>    <span class="comment">!i</span>
<a name="l01304"></a>01304        <span class="keyword">enddo</span>    <span class="comment">!j</span>
<a name="l01305"></a>01305     <span class="keyword">enddo</span>       <span class="comment">!iblk</span>
<a name="l01306"></a>01306     call mct_gGrid_importRattr(dom_i,<span class="stringliteral">&quot;lon&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01307"></a>01307 
<a name="l01308"></a>01308     n=0
<a name="l01309"></a>01309     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01310"></a>01310        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l01311"></a>01311        ilo = this_block%ilo
<a name="l01312"></a>01312        ihi = this_block%ihi
<a name="l01313"></a>01313        jlo = this_block%jlo
<a name="l01314"></a>01314        jhi = this_block%jhi
<a name="l01315"></a>01315        
<a name="l01316"></a>01316        <span class="keyword">do</span> j = jlo, jhi
<a name="l01317"></a>01317        <span class="keyword">do</span> i = ilo, ihi
<a name="l01318"></a>01318           n = n+1
<a name="l01319"></a>01319           <span class="keyword">data</span>(n) = TLAT(i,j,iblk)*<a class="code" href="namespaceice__constants.html#a499282766889f13defe6ffd6c7aa1216">rad_to_deg</a> 
<a name="l01320"></a>01320        <span class="keyword">enddo</span>   <span class="comment">!i</span>
<a name="l01321"></a>01321        <span class="keyword">enddo</span>   <span class="comment">!j</span>
<a name="l01322"></a>01322     <span class="keyword">enddo</span>      <span class="comment">!iblk</span>
<a name="l01323"></a>01323     call mct_gGrid_importRattr(dom_i,<span class="stringliteral">&quot;lat&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     n=0
<a name="l01326"></a>01326     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01327"></a>01327        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l01328"></a>01328        ilo = this_block%ilo
<a name="l01329"></a>01329        ihi = this_block%ihi
<a name="l01330"></a>01330        jlo = this_block%jlo
<a name="l01331"></a>01331        jhi = this_block%jhi
<a name="l01332"></a>01332        
<a name="l01333"></a>01333        <span class="keyword">do</span> j = jlo, jhi
<a name="l01334"></a>01334        <span class="keyword">do</span> i = ilo, ihi
<a name="l01335"></a>01335           n = n+1
<a name="l01336"></a>01336           <span class="keyword">data</span>(n) = <a class="code" href="namespaceice__grid.html#af9d3e2476e44dd679c4062b370f21ffa">tarea</a>(i,j,iblk)/(<a class="code" href="namespaceice__constants.html#a7ec9d7c0e7bcd12bc711119922edce91">radius</a>*<a class="code" href="namespaceice__constants.html#a7ec9d7c0e7bcd12bc711119922edce91">radius</a>)
<a name="l01337"></a>01337        <span class="keyword">enddo</span>   <span class="comment">!i</span>
<a name="l01338"></a>01338        <span class="keyword">enddo</span>   <span class="comment">!j</span>
<a name="l01339"></a>01339     <span class="keyword">enddo</span>      <span class="comment">!iblk</span>
<a name="l01340"></a>01340     call mct_gGrid_importRattr(dom_i,<span class="stringliteral">&quot;area&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     n=0
<a name="l01343"></a>01343     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01344"></a>01344        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l01345"></a>01345        ilo = this_block%ilo
<a name="l01346"></a>01346        ihi = this_block%ihi
<a name="l01347"></a>01347        jlo = this_block%jlo
<a name="l01348"></a>01348        jhi = this_block%jhi
<a name="l01349"></a>01349        
<a name="l01350"></a>01350        <span class="keyword">do</span> j = jlo, jhi
<a name="l01351"></a>01351        <span class="keyword">do</span> i = ilo, ihi
<a name="l01352"></a>01352           n = n+1
<a name="l01353"></a>01353           <span class="keyword">data</span>(n) = <span class="keywordtype">real</span>(nint(hm(i,j,iblk)),kind=dbl_kind)
<a name="l01354"></a>01354        <span class="keyword">enddo</span>   <span class="comment">!i</span>
<a name="l01355"></a>01355        <span class="keyword">enddo</span>   <span class="comment">!j</span>
<a name="l01356"></a>01356     <span class="keyword">enddo</span>      <span class="comment">!iblk</span>
<a name="l01357"></a>01357     call mct_gGrid_importRattr(dom_i,<span class="stringliteral">&quot;mask&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01358"></a>01358 
<a name="l01359"></a>01359     n=0
<a name="l01360"></a>01360     <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l01361"></a>01361        this_block = <a class="code" href="namespaceice__blocks.html#aa79bfef5022683234ed1b332af17f1de">get_block</a>(<a class="code" href="namespaceice__domain.html#a152cf5087ce1dccce8f5e147306320ae">blocks_ice</a>(iblk),iblk)         
<a name="l01362"></a>01362        ilo = this_block%ilo
<a name="l01363"></a>01363        ihi = this_block%ihi
<a name="l01364"></a>01364        jlo = this_block%jlo
<a name="l01365"></a>01365        jhi = this_block%jhi
<a name="l01366"></a>01366        
<a name="l01367"></a>01367        <span class="keyword">do</span> j = jlo, jhi
<a name="l01368"></a>01368        <span class="keyword">do</span> i = ilo, ihi
<a name="l01369"></a>01369           n = n+1
<a name="l01370"></a>01370           <span class="keyword">if</span> (trim(grid_type) == <span class="stringliteral">&apos;latlon&apos;</span>) <span class="keyword">then</span>
<a name="l01371"></a>01371              <span class="keyword">data</span>(n) = <a class="code" href="namespaceice__grid.html#a5241715733bdedb6dc95cff6f23292de">ocn_gridcell_frac</a>(i,j,iblk)
<a name="l01372"></a>01372           <span class="keyword">else</span>
<a name="l01373"></a>01373              <span class="keyword">data</span>(n) = <span class="keywordtype">real</span>(nint(hm(i,j,iblk)),kind=dbl_kind)
<a name="l01374"></a>01374           <span class="keyword">end if</span>
<a name="l01375"></a>01375        <span class="keyword">enddo</span>   <span class="comment">!i</span>
<a name="l01376"></a>01376        <span class="keyword">enddo</span>   <span class="comment">!j</span>
<a name="l01377"></a>01377     <span class="keyword">enddo</span>      <span class="comment">!iblk</span>
<a name="l01378"></a>01378     call mct_gGrid_importRattr(dom_i,<span class="stringliteral">&quot;frac&quot;</span>,<span class="keyword">data</span>,lsize) 
<a name="l01379"></a>01379 
<a name="l01380"></a>01380     <span class="keyword">deallocate</span>(data)
<a name="l01381"></a>01381     <span class="keyword">deallocate</span>(idata)
<a name="l01382"></a>01382     <span class="keyword">deallocate</span>(work_dom)
<a name="l01383"></a>01383 
<a name="l01384"></a>01384 <span class="keyword">  end subroutine ice_domain_mct</span>
<a name="l01385"></a>01385 
<a name="l01386"></a>01386 <span class="comment">!=======================================================================</span>
<a name="l01387"></a>01387 <span class="comment">! BOP</span>
<a name="l01388"></a>01388 <span class="comment">!</span>
<a name="l01389"></a>01389 <span class="comment">! !ROUTINE: restart_filename</span>
<a name="l01390"></a>01390 <span class="comment">!</span>
<a name="l01391"></a>01391 <span class="comment">! !INTERFACE:</span>
<a name="l01392"></a><a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">01392</a>   <span class="keyword">character(len=char_len_long) </span><span class="keyword">function </span><a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a>( yr_spec, mon_spec, day_spec, sec_spec )
<a name="l01393"></a>01393 <span class="comment">!</span>
<a name="l01394"></a>01394 <span class="comment">! !DESCRIPTION: Create a filename from a filename specifyer. Interpret filename specifyer </span>
<a name="l01395"></a>01395 <span class="comment">! string with: </span>
<a name="l01396"></a>01396 <span class="comment">! %c for case, </span>
<a name="l01397"></a>01397 <span class="comment">! %t for optional number argument sent into function</span>
<a name="l01398"></a>01398 <span class="comment">! %y for year</span>
<a name="l01399"></a>01399 <span class="comment">! %m for month</span>
<a name="l01400"></a>01400 <span class="comment">! %d for day</span>
<a name="l01401"></a>01401 <span class="comment">! %s for second</span>
<a name="l01402"></a>01402 <span class="comment">! %% for the &quot;%&quot; character</span>
<a name="l01403"></a>01403 <span class="comment">! If the filename specifyer has spaces &quot; &quot;, they will be trimmed out</span>
<a name="l01404"></a>01404 <span class="comment">! of the resulting filename.</span>
<a name="l01405"></a>01405 <span class="comment">!</span>
<a name="l01406"></a>01406 <span class="comment">! !USES:</span>
<a name="l01407"></a>01407     use <span class="keywordflow">ice_restart</span>, only: runid
<a name="l01408"></a>01408 <span class="comment">!</span>
<a name="l01409"></a>01409 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l01410"></a>01410   <span class="keywordtype">integer</span>         , <span class="keywordtype">intent(in)</span>  :: yr_spec         <span class="comment">! Simulation year</span>
<a name="l01411"></a>01411   <span class="keywordtype">integer</span>         , <span class="keywordtype">intent(in)</span>  :: mon_spec        <span class="comment">! Simulation month</span>
<a name="l01412"></a>01412   <span class="keywordtype">integer</span>         , <span class="keywordtype">intent(in)</span>  :: day_spec        <span class="comment">! Simulation day</span>
<a name="l01413"></a>01413   <span class="keywordtype">integer</span>         , <span class="keywordtype">intent(in)</span>  :: sec_spec        <span class="comment">! Seconds into current simulation day</span>
<a name="l01414"></a>01414 <span class="comment">!</span>
<a name="l01415"></a>01415 <span class="comment">! EOP</span>
<a name="l01416"></a>01416 <span class="comment">!</span>
<a name="l01417"></a>01417   <span class="keywordtype">integer</span>             :: i, n      <span class="comment">! Loop variables</span>
<a name="l01418"></a>01418   <span class="keywordtype">integer</span>             :: year      <span class="comment">! Simulation year</span>
<a name="l01419"></a>01419   <span class="keywordtype">integer</span>             :: month     <span class="comment">! Simulation month</span>
<a name="l01420"></a>01420   <span class="keywordtype">integer</span>             :: day       <span class="comment">! Simulation day</span>
<a name="l01421"></a>01421   <span class="keywordtype">integer</span>             :: ncsec     <span class="comment">! Seconds into current simulation day</span>
<a name="l01422"></a>01422   <span class="keywordtype">character(len=char_len_long) </span>:: string    <span class="comment">! Temporary character string </span>
<a name="l01423"></a>01423   <span class="keywordtype">character(len=char_len_long) </span>:: format    <span class="comment">! Format character string </span>
<a name="l01424"></a>01424   <span class="keywordtype">character(len=char_len_long) </span>:: filename_spec = <span class="stringliteral">&apos;%c.cice.r.%y-%m-%d-%s&apos;</span> <span class="comment">! ice restarts</span>
<a name="l01425"></a>01425 
<a name="l01426"></a>01426   <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01427"></a>01427   <span class="comment">! Determine year, month, day and sec to put in filename</span>
<a name="l01428"></a>01428   <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01429"></a>01429 
<a name="l01430"></a>01430   <span class="keyword">if</span> ( len_trim(filename_spec) == 0 )<span class="keyword">then</span>
<a name="l01431"></a>01431      call shr_sys_abort (<span class="stringliteral">&apos;restart_filename: filename specifier is empty&apos;</span>)
<a name="l01432"></a>01432   <span class="keyword">end if</span>
<a name="l01433"></a>01433   <span class="keyword">if</span> ( index(trim(filename_spec),<span class="stringliteral">&quot; &quot;</span>) /= 0 )<span class="keyword">then</span>
<a name="l01434"></a>01434      call shr_sys_abort (<span class="stringliteral">&apos;restart_filename: filename specifier can not contain a space:&apos;</span>//trim(filename_spec))
<a name="l01435"></a>01435   <span class="keyword">end if</span>
<a name="l01436"></a>01436 
<a name="l01437"></a>01437   year  = yr_spec
<a name="l01438"></a>01438   month = mon_spec
<a name="l01439"></a>01439   day   = day_spec
<a name="l01440"></a>01440   ncsec = sec_spec
<a name="l01441"></a>01441 
<a name="l01442"></a>01442   <span class="comment">! Go through each character in the filename specifyer and interpret if special string</span>
<a name="l01443"></a>01443 
<a name="l01444"></a>01444   i = 1
<a name="l01445"></a>01445   <a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a> = <span class="stringliteral">&apos;&apos;</span>
<a name="l01446"></a>01446   <span class="keyword">do</span> <span class="keyword">while</span> ( i &lt;= len_trim(filename_spec) )
<a name="l01447"></a>01447      <span class="keyword">if</span> ( filename_spec(i:i) == <span class="stringliteral">&quot;%&quot;</span> )<span class="keyword">then</span>
<a name="l01448"></a>01448         i = i + 1
<a name="l01449"></a>01449         <span class="keyword">select</span> <span class="keyword">case</span>( filename_spec(i:i) )
<a name="l01450"></a>01450         <span class="keyword">case</span>( <span class="stringliteral">&apos;c&apos;</span> )   <span class="comment">! runid</span>
<a name="l01451"></a>01451            string = trim(<a class="code" href="namespaceice__restart.html#a7f22ff2f3f9c3ccf57b19309c46deb79">runid</a>)
<a name="l01452"></a>01452         <span class="keyword">case</span>( <span class="stringliteral">&apos;y&apos;</span> )   <span class="comment">! year</span>
<a name="l01453"></a>01453            <span class="keyword">if</span> ( year &gt; 99999   ) <span class="keyword">then</span>
<a name="l01454"></a>01454               format = <span class="stringliteral">&apos;(i6.6)&apos;</span>
<a name="l01455"></a>01455            <span class="keyword">else</span> <span class="keyword">if</span> ( year &gt; 9999    ) <span class="keyword">then</span>
<a name="l01456"></a>01456               format = <span class="stringliteral">&apos;(i5.5)&apos;</span>
<a name="l01457"></a>01457            <span class="keyword">else</span>
<a name="l01458"></a>01458               format = <span class="stringliteral">&apos;(i4.4)&apos;</span>
<a name="l01459"></a>01459            <span class="keyword">end if</span>
<a name="l01460"></a>01460            <span class="keyword">write</span>(string,format) year
<a name="l01461"></a>01461         <span class="keyword">case</span>( <span class="stringliteral">&apos;m&apos;</span> )   <span class="comment">! month</span>
<a name="l01462"></a>01462            <span class="keyword">write</span>(string,<span class="stringliteral">&apos;(i2.2)&apos;</span>) month
<a name="l01463"></a>01463         <span class="keyword">case</span>( <span class="stringliteral">&apos;d&apos;</span> )   <span class="comment">! day</span>
<a name="l01464"></a>01464            <span class="keyword">write</span>(string,<span class="stringliteral">&apos;(i2.2)&apos;</span>) day
<a name="l01465"></a>01465         <span class="keyword">case</span>( <span class="stringliteral">&apos;s&apos;</span> )   <span class="comment">! second</span>
<a name="l01466"></a>01466            <span class="keyword">write</span>(string,<span class="stringliteral">&apos;(i5.5)&apos;</span>) ncsec
<a name="l01467"></a>01467         <span class="keyword">case</span>( <span class="stringliteral">&apos;%&apos;</span> )   <span class="comment">! percent character</span>
<a name="l01468"></a>01468            string = <span class="stringliteral">&quot;%&quot;</span>
<a name="l01469"></a>01469         <span class="keyword">case</span> default
<a name="l01470"></a>01470            call shr_sys_abort (<span class="stringliteral">&apos;restart_filename: Invalid expansion character: &apos;</span>//filename_spec(i:i))
<a name="l01471"></a>01471         <span class="keyword">end select</span>
<a name="l01472"></a>01472      <span class="keyword">else</span>
<a name="l01473"></a>01473         n = index( filename_spec(i:), <span class="stringliteral">&quot;%&quot;</span> )
<a name="l01474"></a>01474         <span class="keyword">if</span> ( n == 0 ) n = len_trim( filename_spec(i:) ) + 1
<a name="l01475"></a>01475         <span class="keyword">if</span> ( n == 0 ) exit 
<a name="l01476"></a>01476         string = filename_spec(i:n+i-2)
<a name="l01477"></a>01477         i = n + i - 2
<a name="l01478"></a>01478      <span class="keyword">end if</span>
<a name="l01479"></a>01479      <span class="keyword">if</span> ( len_trim(<a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a>) == 0 )<span class="keyword">then</span>
<a name="l01480"></a>01480         <a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a> = trim(string)
<a name="l01481"></a>01481      <span class="keyword">else</span>
<a name="l01482"></a>01482         <span class="keyword">if</span> ( (len_trim(<a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a>)+len_trim(string)) &gt;= <a class="code" href="namespaceice__kinds__mod.html#ac0e6e7d330377449d5a1ad6fa9fc6a31">char_len_long</a> )<span class="keyword">then</span>
<a name="l01483"></a>01483            call shr_sys_abort (<span class="stringliteral">&apos;restart_filename Resultant filename too long&apos;</span>)
<a name="l01484"></a>01484         <span class="keyword">end if</span>
<a name="l01485"></a>01485         <a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a> = trim(<a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a>) // trim(string)
<a name="l01486"></a>01486      <span class="keyword">end if</span>
<a name="l01487"></a>01487      i = i + 1
<a name="l01488"></a>01488   <span class="keyword">end do</span>
<a name="l01489"></a>01489   <span class="keyword">if</span> ( len_trim(<a class="code" href="namespaceice__comp__mct.html#a06dea082678c790cef2bcb75c338b6d2">restart_filename</a>) == 0 )<span class="keyword">then</span>
<a name="l01490"></a>01490      call shr_sys_abort (<span class="stringliteral">&apos;restart_filename: Resulting filename is empty&apos;</span>)
<a name="l01491"></a>01491   <span class="keyword">end if</span>
<a name="l01492"></a>01492 
<a name="l01493"></a>01493 <span class="keyword">end function restart_filename</span>
<a name="l01494"></a>01494 
<a name="l01495"></a>01495 <span class="keyword">end module ice_comp_mct</span>
<a name="l01496"></a>01496 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Oct 6 14:02:23 2009 for CICE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
