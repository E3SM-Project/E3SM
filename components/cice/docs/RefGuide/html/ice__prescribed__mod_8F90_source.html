<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CICE: ice_prescribed_mod.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Types&nbsp;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ice_prescribed_mod.F90</h1><a href="ice__prescribed__mod_8F90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!===================================================================</span>
<a name="l00002"></a>00002 <span class="comment">!BOP </span>
<a name="l00003"></a>00003 <span class="comment">!</span>
<a name="l00004"></a>00004 <span class="comment">! !MODULE: ice_prescribed_mod - Prescribed Ice Model</span>
<a name="l00005"></a>00005 <span class="comment">!</span>
<a name="l00006"></a>00006 <span class="comment">! !DESCRIPTION:</span>
<a name="l00007"></a>00007 <span class="comment">!</span>
<a name="l00008"></a>00008 <span class="comment">! The prescribed ice model reads in ice concentration data from a netCDF</span>
<a name="l00009"></a>00009 <span class="comment">! file.  Ice thickness, temperature, the ice temperature profile are</span>
<a name="l00010"></a>00010 <span class="comment">! prescribed.  Air/ice fluxes are computed to get surface temperature,</span>
<a name="l00011"></a>00011 <span class="comment">! Ice/ocean fluxes are set to zero, and ice dynamics are not calculated.</span>
<a name="l00012"></a>00012 <span class="comment">! Regridding and data cycling capabilities are included.</span>
<a name="l00013"></a>00013 <span class="comment">!</span>
<a name="l00014"></a>00014 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00015"></a>00015 <span class="comment">!  SVN:$Id: ice_prescribed_mod.F90 40 2006-12-01 19:09:30Z eclare $</span>
<a name="l00016"></a>00016 <span class="comment">!</span>
<a name="l00017"></a>00017 <span class="comment">! 2006-Aug-22 - D. Bailey, E. Hunke, modified to fit with CICE</span>
<a name="l00018"></a>00018 <span class="comment">! 2005-May-19 - J. Schramm - first version</span>
<a name="l00019"></a>00019 <span class="comment">! 2005-Apr-19 - B. Kauffman, J. Schramm, M. Vertenstein, NCAR - design</span>
<a name="l00020"></a>00020 <span class="comment">!</span>
<a name="l00021"></a>00021 <span class="comment">! !INTERFACE: ----------------------------------------------------------</span>
<a name="l00022"></a>00022  
<a name="l00023"></a><a class="code" href="namespaceice__prescribed__mod.html">00023</a> <span class="keyword">module</span> ice_prescribed_mod
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">! !USES:</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027    use <span class="keywordflow">shr_stream_mod</span>
<a name="l00028"></a>00028    use <span class="keywordflow">shr_map_mod</span>
<a name="l00029"></a>00029    use <span class="keywordflow">shr_ncread_mod</span>
<a name="l00030"></a>00030    use <span class="keywordflow">shr_sys_mod</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032    use <span class="keywordflow">ice_broadcast</span>
<a name="l00033"></a>00033    use <span class="keywordflow">ice_communicate</span>, only : my_task, master_task
<a name="l00034"></a>00034    use <span class="keywordflow">ice_kinds_mod</span>
<a name="l00035"></a>00035    use <span class="keywordflow">ice_fileunits</span>
<a name="l00036"></a>00036    use <span class="keywordflow">ice_exit</span>,       only : abort_ice
<a name="l00037"></a>00037    use <span class="keywordflow">ice_domain_size</span>, only : nx_global, ny_global, ncat, nilyr, nslyr, &amp;
<a name="l00038"></a>00038                                max_blocks
<a name="l00039"></a>00039    use <span class="keywordflow">ice_constants</span>
<a name="l00040"></a>00040    use <span class="keywordflow">ice_blocks</span>,     only : nx_block, ny_block
<a name="l00041"></a>00041    use <span class="keywordflow">ice_domain</span>,     only : nblocks, distrb_info
<a name="l00042"></a>00042    use <span class="keywordflow">ice_grid</span>,       only : TLAT,TLON,hm,tmask
<a name="l00043"></a>00043    use <span class="keywordflow">ice_calendar</span>,   only : idate, sec
<a name="l00044"></a>00044    use <span class="keywordflow">ice_itd</span>,        only : ilyr1, slyr1, hin_max
<a name="l00045"></a>00045    use <span class="keywordflow">ice_work</span>,       only : work_g1, work_g2
<a name="l00046"></a>00046    use <span class="keywordflow">shr_scam_mod</span>,   only : shr_scam_getCloseLatLon
<a name="l00047"></a>00047    use <span class="keywordflow">ice_scam</span>,       only : scmlat, scmlon, single_column
<a name="l00048"></a>00048    use <span class="keywordflow">ice_read_write</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050    <span class="keyword">implicit none</span>
<a name="l00051"></a>00051    <span class="keywordtype">save</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053    <span class="keywordtype">private</span> <span class="comment">! except</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">! !PUBLIC TYPES:</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">! !PUBLIC MEMBER FUNCTIONS:</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060    <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__prescribed__mod.html#a653502aece9eed08846385d30fec703b">ice_prescribed_init</a>      <span class="comment">! initialize input data stream</span>
<a name="l00061"></a>00061    <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__prescribed__mod.html#a73bcaa2e547c18a24eeabaa2e22e8fe9">ice_prescribed_run</a>       <span class="comment">! get time slices and time interp</span>
<a name="l00062"></a>00062    <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__prescribed__mod.html#aa67a3710c35bda9e15dedf703582f149">ice_prescribed_readField</a> <span class="comment">! reads field from input data file</span>
<a name="l00063"></a>00063    <span class="keywordtype">public</span> :: <a class="code" href="namespaceice__prescribed__mod.html#a9e6ac38b742040541c97492d74282b7a">ice_prescribed_phys</a>      <span class="comment">! set prescribed ice state and fluxes</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="comment">! !PUBLIC DATA MEMBERS:</span>
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">00067</a>    <span class="keywordtype">logical(kind=log_kind)      </span>, <span class="keywordtype">public</span> :: prescribed_ice      <span class="comment">! true if prescribed ice</span>
<a name="l00068"></a><a class="code" href="namespaceice__prescribed__mod.html#a8ffe8edc2e99d865aa09b7c7f7801c37">00068</a>    <span class="keywordtype">integer(kind=int_kind)      </span>, <span class="keywordtype">public</span> :: stream_year_first   <span class="comment">! first year in stream to use</span>
<a name="l00069"></a><a class="code" href="namespaceice__prescribed__mod.html#ade5d68f1b7b652dcacb5263e02aaa099">00069</a>    <span class="keywordtype">integer(kind=int_kind)      </span>, <span class="keywordtype">public</span> :: stream_year_last    <span class="comment">! last year in stream to use</span>
<a name="l00070"></a><a class="code" href="namespaceice__prescribed__mod.html#a1710ba150bcf274f07add3f2a05b49e7">00070</a>    <span class="keywordtype">integer(kind=int_kind)      </span>, <span class="keywordtype">public</span> :: model_year_align    <span class="comment">! align stream_year_first </span>
<a name="l00071"></a>00071                                                                <span class="comment">! with this model year</span>
<a name="l00072"></a><a class="code" href="namespaceice__prescribed__mod.html#a345c4a3ce0fa3d2ebe4468d03a9fe51a">00072</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_fldVarName
<a name="l00073"></a><a class="code" href="namespaceice__prescribed__mod.html#a6f95de7f96b71c33ef261199631ddf80">00073</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_fldFileName
<a name="l00074"></a><a class="code" href="namespaceice__prescribed__mod.html#abae176465bd6efc8cb114772aa63b145">00074</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_domTvarName
<a name="l00075"></a><a class="code" href="namespaceice__prescribed__mod.html#ae6a726ada1e1e93644fa269052a767e4">00075</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_domXvarName
<a name="l00076"></a><a class="code" href="namespaceice__prescribed__mod.html#a38e084e4885a0dcfa51a63fbccbe05b0">00076</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_domYvarName
<a name="l00077"></a><a class="code" href="namespaceice__prescribed__mod.html#a4c5e8c8c8c573e69e00039703e28a83f">00077</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_domAreaName
<a name="l00078"></a><a class="code" href="namespaceice__prescribed__mod.html#afe7ec341a14bd719d0759586a729e76d">00078</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_domMaskName
<a name="l00079"></a><a class="code" href="namespaceice__prescribed__mod.html#a54b8dea8c8a1cdca57b336d8dedeb51c">00079</a>    <span class="keywordtype">character(len=char_len_long)</span>, <span class="keywordtype">public</span> :: stream_domFileName
<a name="l00080"></a><a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">00080</a>    <span class="keywordtype">logical(kind=log_kind)      </span>, <span class="keywordtype">public</span> :: prescribed_ice_fill <span class="comment">! true if data fill required</span>
<a name="l00081"></a><a class="code" href="namespaceice__prescribed__mod.html#a0a932ccb360a743d8d05b685438cce6f">00081</a>    <span class="keywordtype">real(kind=dbl_kind)    </span>:: closelat,closelon <span class="comment">! closest lat/lon in dataset to scmlat</span>
<a name="l00082"></a><a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">00082</a>    <span class="keywordtype">integer(kind=int_kind) </span>:: latidx,lonidx     <span class="comment">! index of closest lat/lon in dataset to scmlat</span>
<a name="l00083"></a><a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">00083</a>    <span class="keywordtype">integer(kind=int_kind) </span>:: ncid              <span class="comment">! netcdf file index</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">!EOP</span>
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">00087</a>    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">allocatable</span> :: dataXCoord(:,:)  <span class="comment">! input data longitudes </span>
<a name="l00088"></a><a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">00088</a>    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">allocatable</span> :: dataYCoord(:,:)  <span class="comment">! input data latitudes</span>
<a name="l00089"></a><a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">00089</a>    <span class="keywordtype">integer(kind=int_kind)</span>, <span class="keywordtype">allocatable</span> :: dataMask(:,:)    <span class="comment">! input data mask</span>
<a name="l00090"></a><a class="code" href="namespaceice__prescribed__mod.html#a6cbaf1dd947b14ebfe7fee398952dd6b">00090</a>    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">allocatable</span> :: dataUB(:,:)      <span class="comment">! upper bound on model domain</span>
<a name="l00091"></a><a class="code" href="namespaceice__prescribed__mod.html#a74430be62d3958af3edd6b7254027d08">00091</a>    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">allocatable</span> :: dataLB(:,:)      <span class="comment">! lower bound on model domain</span>
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">00093</a>    <span class="keywordtype">type(</span>shr_stream_streamType<span class="keywordtype">)</span>, <span class="keywordtype">save</span>  :: csim_stream        <span class="comment">! csim data stream</span>
<a name="l00094"></a><a class="code" href="namespaceice__prescribed__mod.html#ada89f7f5c26e2923f8fab5f837979bd9">00094</a>    <span class="keywordtype">type(</span>shr_map_mapType<span class="keywordtype">)</span>        :: csim_map           <span class="comment">! used by shr_map_mapSet </span>
<a name="l00095"></a><a class="code" href="namespaceice__prescribed__mod.html#a9cc059c1adaefc7ef43aa8ccf9f774ea">00095</a>    <span class="keywordtype">type(</span>shr_map_mapType<span class="keywordtype">)</span>        :: csim_fill          <span class="comment">! used by shr_map_mapSet</span>
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">00097</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataInLB(:,:,:)  <span class="comment">! input data LB</span>
<a name="l00098"></a><a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">00098</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataInUB(:,:,:)  <span class="comment">! input data UB</span>
<a name="l00099"></a><a class="code" href="namespaceice__prescribed__mod.html#a14513a8e50e8321ddac9e3f9d091cd12">00099</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataSrcLB(:,:)   <span class="comment">! reformed data for mapping</span>
<a name="l00100"></a><a class="code" href="namespaceice__prescribed__mod.html#a59169c4d93914baf69c59b8d5f2fb1ab">00100</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataSrcUB(:,:)   <span class="comment">! reformed data for mapping</span>
<a name="l00101"></a><a class="code" href="namespaceice__prescribed__mod.html#a69b2adaed2ac02b269e8c3c1d6b44178">00101</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataDstLB(:,:)   <span class="comment">! output from mapping</span>
<a name="l00102"></a><a class="code" href="namespaceice__prescribed__mod.html#a07af024321e34db28532c6834a352da3">00102</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataDstUB(:,:)   <span class="comment">! output from mapping</span>
<a name="l00103"></a><a class="code" href="namespaceice__prescribed__mod.html#a88edf4fbb0dc86b082ddf6a6c48d393a">00103</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataOutLB(:,:,:) <span class="comment">! output for model use</span>
<a name="l00104"></a><a class="code" href="namespaceice__prescribed__mod.html#a0c216149ad3a2a7bd66c3bdb274c77e7">00104</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: dataOutUB(:,:,:) <span class="comment">! output for model use</span>
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">00106</a>    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: ice_cov_global(:,:)      <span class="comment">! ice cover for model</span>
<a name="l00107"></a><a class="code" href="namespaceice__prescribed__mod.html#a2f6a0d3d485195c75861395c78cc22aa">00107</a>    <span class="keywordtype">real(kind=dbl_kind)              </span>:: ice_cov_lb(nx_block,ny_block,max_blocks) <span class="comment">! scattered ice cover </span>
<a name="l00108"></a><a class="code" href="namespaceice__prescribed__mod.html#a9c50464ba0a337c6fd03cec3a7338897">00108</a>    <span class="keywordtype">real(kind=dbl_kind)              </span>:: ice_cov_ub(nx_block,ny_block,max_blocks) <span class="comment">! scattered ice cover </span>
<a name="l00109"></a><a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">00109</a>    <span class="keywordtype">real(kind=dbl_kind)              </span>:: ice_cov(nx_block,ny_block,max_blocks)    <span class="comment">! scattered ice cover </span>
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="namespaceice__prescribed__mod.html#a794e5c02618e82554dc2cec6c635b8f1">00111</a>    <span class="keywordtype">logical(kind=log_kind) </span>:: regrid                      <span class="comment">! true if remapping required</span>
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="namespaceice__prescribed__mod.html#a23c0dbac49b47681dc4939a3f8fd4100">00113</a>    <span class="keywordtype">integer(kind=int_kind) </span>:: dateUB, dateLB, secUB, secLB
<a name="l00114"></a><a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">00114</a>    <span class="keywordtype">integer(kind=int_kind) </span>:: nlon           <span class="comment">! longitudes in netCDF data file</span>
<a name="l00115"></a><a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">00115</a>    <span class="keywordtype">integer(kind=int_kind) </span>:: nlat           <span class="comment">! latitudes  in netCDF data file</span>
<a name="l00116"></a><a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">00116</a>    <span class="keywordtype">integer(kind=int_kind) </span>:: nflds          <span class="comment">! number of fields in list</span>
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="namespaceice__prescribed__mod.html#a5bdbd6cc049323f35a5c8f6e4613c369">00118</a>    <span class="keywordtype">character(len=char_len_long) </span>:: fldList      <span class="comment">! list of fields in data stream</span>
<a name="l00119"></a><a class="code" href="namespaceice__prescribed__mod.html#a47d61c09a57e43eefae7895db766851a">00119</a>    <span class="keywordtype">character(len=char_len)      </span>:: fldName      <span class="comment">! name of field in stream</span>
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="namespaceice__prescribed__mod.html#a07b5b645c36b9f4e6ffecb44561d737e">00121</a>    <span class="keywordtype">logical</span> :: read_data     <span class="comment">! must read in new ice coverage data slice</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">! ech moved from ice_constants.F</span>
<a name="l00124"></a><a class="code" href="namespaceice__prescribed__mod.html#a4dfc1b519ac719ccd1df0821e2ee9d05">00124</a>     <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> :: 
<a name="l00125"></a>00125        cp_sno = 0.0_dbl_kind  <span class="comment">! specific heat of snow               (J/kg/K)</span>
<a name="l00126"></a>00126     ,  rLfi = Lfresh*rhoi  <span class="comment">! latent heat of fusion ice               (J/m^3)</span>
<a name="l00127"></a>00127     ,  rLfs = Lfresh*rhos  <span class="comment">! latent heat of fusion snow              (J/m^3)</span>
<a name="l00128"></a>00128     ,  rLvi = Lvap*rhoi    <span class="comment">! latent heat of vapor*rhoice             (J/m^3)</span>
<a name="l00129"></a>00129     ,  rLvs = Lvap*rhos    <span class="comment">! latent heat of vapor*rhosno             (J/m^3)</span>
<a name="l00130"></a>00130     ,  rcpi = cp_ice*rhoi  <span class="comment">! heat capacity of fresh ice              (J/m^3)</span>
<a name="l00131"></a>00131     ,  rcps = cp_sno*rhos  <span class="comment">! heat capacity of snow                   (J/m^3)</span>
<a name="l00132"></a>00132     ,  rcpidepressT = rcpi*depressT  <span class="comment">! param for finding T(z) from q (J/m^3)</span>
<a name="l00133"></a>00133     ,  rLfidepressT = rLfi*depressT <span class="comment">! param for heat capacity   (J deg/m^3)</span>
<a name="l00134"></a>00134          <span class="comment">! heat capacity of sea ice, rhoi*C=rcpi+rLfidepressT*salinity/T^2</span>
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">!=======================================================================</span>
<a name="l00137"></a>00137 <span class="keyword">contains</span>
<a name="l00138"></a>00138 <span class="comment">!=======================================================================</span>
<a name="l00139"></a>00139 <span class="comment">!BOP ===================================================================</span>
<a name="l00140"></a>00140 <span class="comment">!</span>
<a name="l00141"></a>00141 <span class="comment">! !IROUTINE: ice_prescribed_init --  initialize data stream information</span>
<a name="l00142"></a>00142 <span class="comment">!</span>
<a name="l00143"></a>00143 <span class="comment">! !DESCRIPTION:</span>
<a name="l00144"></a>00144 <span class="comment">! (1) Initialize data stream information.  </span>
<a name="l00145"></a>00145 <span class="comment">! (2) Check input data domain - currently supports a regular lat-lon grid</span>
<a name="l00146"></a>00146 <span class="comment">!     or cpl6 history output.   If input data domain does not match ice</span>
<a name="l00147"></a>00147 <span class="comment">!     model domain, initialize mapping weights and set &apos;regrid&apos; to true.</span>
<a name="l00148"></a>00148 <span class="comment">!</span>
<a name="l00149"></a>00149 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00150"></a>00150 <span class="comment">!     2005-May-19 - J. Schramm - first version</span>
<a name="l00151"></a>00151 <span class="comment">!</span>
<a name="l00152"></a>00152 <span class="comment">! !INTERFACE: -----------------------------------------------------------</span>
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="namespaceice__prescribed__mod.html#a653502aece9eed08846385d30fec703b">00154</a> <span class="keyword">subroutine </span><a class="code" href="namespaceice__prescribed__mod.html#a653502aece9eed08846385d30fec703b">ice_prescribed_init</a>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">! !USES:</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158    use <span class="keywordflow">shr_string_mod</span>
<a name="l00159"></a>00159    use <span class="keywordflow">ice_gather_scatter</span>, only : gather_global
<a name="l00160"></a>00160 
<a name="l00161"></a>00161    <span class="keyword">implicit none</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">!EOP</span>
<a name="l00166"></a>00166    <span class="comment">!----- Local ------</span>
<a name="l00167"></a>00167    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: work4d(:,:,:,:) <span class="comment">! 4D work array</span>
<a name="l00168"></a>00168    <span class="keywordtype">integer(kind=int_kind)</span>, <span class="keywordtype">allocatable</span> :: csim_mask_g(:,:) <span class="comment">! global csim land mask</span>
<a name="l00169"></a>00169    <span class="keywordtype">real(kind=dbl_kind)     </span>:: aice_max                 <span class="comment">! maximun ice concentration</span>
<a name="l00170"></a>00170    <span class="keywordtype">character(len=char_len_long) </span>:: first_data_file     <span class="comment">! first data file in stream</span>
<a name="l00171"></a>00171    <span class="keywordtype">character(len=char_len_long) </span>:: domain_info_fn      <span class="comment">! file with domain info</span>
<a name="l00172"></a>00172    <span class="keywordtype">character(len=char_len_long) </span>:: data_path           <span class="comment">! path/location of stream data files</span>
<a name="l00173"></a>00173    <span class="keywordtype">integer(kind=int_kind)  </span>:: ndims                    <span class="comment">! # dimensions in domain info</span>
<a name="l00174"></a>00174    <span class="keywordtype">character(len=char_len) </span>:: timeName                 <span class="comment">! domain time var name</span>
<a name="l00175"></a>00175    <span class="keywordtype">character(len=char_len) </span>:: latName                  <span class="comment">! domain latitude var name</span>
<a name="l00176"></a>00176    <span class="keywordtype">character(len=char_len) </span>:: lonName                  <span class="comment">! domain longitude var name</span>
<a name="l00177"></a>00177    <span class="keywordtype">character(len=char_len) </span>:: maskName                 <span class="comment">! domain mask var name</span>
<a name="l00178"></a>00178    <span class="keywordtype">character(len=char_len) </span>:: areaName                 <span class="comment">! domain area var name</span>
<a name="l00179"></a>00179    <span class="keywordtype">logical(kind=log_kind)  </span>:: check                    <span class="comment">! true if field is found</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181    <span class="keywordtype">integer(kind=int_kind)  </span>:: nml_error <span class="comment">! namelist i/o error flag</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183    <span class="comment">!----- formats -----</span>
<a name="l00184"></a>00184    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: subName = <span class="stringliteral">&quot;(&apos;ice_prescribed_init&apos;)&quot;</span>
<a name="l00185"></a>00185    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: F00 = <span class="stringliteral">&quot;(&apos;(ice_prescribed_init) &apos;,4a)&quot;</span>
<a name="l00186"></a>00186    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: F01 = <span class="stringliteral">&quot;(&apos;(ice_prescribed_init) &apos;,a,2i6)&quot;</span>
<a name="l00187"></a>00187    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: F02 = <span class="stringliteral">&quot;(&apos;(ice_prescribed_init) &apos;,a,2g20.13)&quot;</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">! ech moved from ice_init.F</span>
<a name="l00190"></a>00190    namelist /ice_prescribed_nml/  <a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>, <a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">prescribed_ice_fill</a>, &amp;
<a name="l00191"></a>00191         <a class="code" href="namespaceice__prescribed__mod.html#a8ffe8edc2e99d865aa09b7c7f7801c37">stream_year_first</a> , <a class="code" href="namespaceice__prescribed__mod.html#ade5d68f1b7b652dcacb5263e02aaa099">stream_year_last</a>  , <a class="code" href="namespaceice__prescribed__mod.html#a1710ba150bcf274f07add3f2a05b49e7">model_year_align</a>, &amp;
<a name="l00192"></a>00192         <a class="code" href="namespaceice__prescribed__mod.html#a345c4a3ce0fa3d2ebe4468d03a9fe51a">stream_fldVarName</a> , <a class="code" href="namespaceice__prescribed__mod.html#a6f95de7f96b71c33ef261199631ddf80">stream_fldFileName</a>,  &amp;
<a name="l00193"></a>00193         <a class="code" href="namespaceice__prescribed__mod.html#abae176465bd6efc8cb114772aa63b145">stream_domTvarName</a>, <a class="code" href="namespaceice__prescribed__mod.html#ae6a726ada1e1e93644fa269052a767e4">stream_domXvarName</a>, <a class="code" href="namespaceice__prescribed__mod.html#a38e084e4885a0dcfa51a63fbccbe05b0">stream_domYvarName</a>, &amp;
<a name="l00194"></a>00194         <a class="code" href="namespaceice__prescribed__mod.html#a4c5e8c8c8c573e69e00039703e28a83f">stream_domAreaName</a>, <a class="code" href="namespaceice__prescribed__mod.html#afe7ec341a14bd719d0759586a729e76d">stream_domMaskName</a>, <a class="code" href="namespaceice__prescribed__mod.html#a54b8dea8c8a1cdca57b336d8dedeb51c">stream_domFileName</a>
<a name="l00195"></a>00195         
<a name="l00196"></a>00196 
<a name="l00197"></a>00197    <span class="comment">! default values for namelist</span>
<a name="l00198"></a>00198    <a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>         = .false.          <span class="comment">! if true, prescribe ice</span>
<a name="l00199"></a>00199    <a class="code" href="namespaceice__prescribed__mod.html#a8ffe8edc2e99d865aa09b7c7f7801c37">stream_year_first</a>      = 1                <span class="comment">! first year in  pice stream to use</span>
<a name="l00200"></a>00200    <a class="code" href="namespaceice__prescribed__mod.html#ade5d68f1b7b652dcacb5263e02aaa099">stream_year_last</a>       = 1                <span class="comment">! last  year in  pice stream to use</span>
<a name="l00201"></a>00201    <a class="code" href="namespaceice__prescribed__mod.html#a1710ba150bcf274f07add3f2a05b49e7">model_year_align</a>       = 1                <span class="comment">! align stream_year_first with this model year</span>
<a name="l00202"></a>00202    <a class="code" href="namespaceice__prescribed__mod.html#a345c4a3ce0fa3d2ebe4468d03a9fe51a">stream_fldVarName</a>      = <span class="stringliteral">&apos;ice_cov&apos;</span>
<a name="l00203"></a>00203    <a class="code" href="namespaceice__prescribed__mod.html#a6f95de7f96b71c33ef261199631ddf80">stream_fldFileName</a>     = <span class="stringliteral">&apos; &apos;</span>
<a name="l00204"></a>00204    <a class="code" href="namespaceice__prescribed__mod.html#abae176465bd6efc8cb114772aa63b145">stream_domTvarName</a>     = <span class="stringliteral">&apos;time&apos;</span>
<a name="l00205"></a>00205    <a class="code" href="namespaceice__prescribed__mod.html#ae6a726ada1e1e93644fa269052a767e4">stream_domXvarName</a>     = <span class="stringliteral">&apos;lon&apos;</span>
<a name="l00206"></a>00206    <a class="code" href="namespaceice__prescribed__mod.html#a38e084e4885a0dcfa51a63fbccbe05b0">stream_domYvarName</a>     = <span class="stringliteral">&apos;lat&apos;</span>
<a name="l00207"></a>00207    <a class="code" href="namespaceice__prescribed__mod.html#a4c5e8c8c8c573e69e00039703e28a83f">stream_domAreaName</a>     = <span class="stringliteral">&apos;area&apos;</span>
<a name="l00208"></a>00208    <a class="code" href="namespaceice__prescribed__mod.html#afe7ec341a14bd719d0759586a729e76d">stream_domMaskName</a>     = <span class="stringliteral">&apos;mask&apos;</span>
<a name="l00209"></a>00209    <a class="code" href="namespaceice__prescribed__mod.html#a54b8dea8c8a1cdca57b336d8dedeb51c">stream_domFileName</a>     =  <span class="stringliteral">&apos; &apos;</span>
<a name="l00210"></a>00210    <a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">prescribed_ice_fill</a>    = .false.           <span class="comment">! true if pice data fill required</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212    <span class="comment">! read from input file</span>
<a name="l00213"></a>00213    call <a class="code" href="namespaceice__fileunits.html#ad6283e44cc881fd1d0d6250cbb83a2e2">get_fileunit</a>(<a class="code" href="namespaceice__fileunits.html#a1c0f914707e7a61a579be21df178f061">nu_nml</a>)
<a name="l00214"></a>00214    <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00215"></a>00215       <span class="keyword">open</span> (<a class="code" href="namespaceice__fileunits.html#a1c0f914707e7a61a579be21df178f061">nu_nml</a>, file=<a class="code" href="namespaceice__fileunits.html#aec528ed6b00fd0cb2d1e2c5892835bd1">nml_filename</a>, status=<span class="stringliteral">&apos;old&apos;</span>,iostat=nml_error)
<a name="l00216"></a>00216       <span class="keyword">if</span> (nml_error /= 0) <span class="keyword">then</span>
<a name="l00217"></a>00217          nml_error = -1
<a name="l00218"></a>00218       <span class="keyword">else</span>
<a name="l00219"></a>00219          nml_error =  1
<a name="l00220"></a>00220       <span class="keyword">endif</span>
<a name="l00221"></a>00221       <span class="keyword">do</span> <span class="keyword">while</span> (nml_error &gt; 0)
<a name="l00222"></a>00222          <span class="keyword">read</span>(<a class="code" href="namespaceice__fileunits.html#a1c0f914707e7a61a579be21df178f061">nu_nml</a>, nml=ice_prescribed_nml,iostat=nml_error)
<a name="l00223"></a>00223          <span class="keyword">if</span> (nml_error &gt; 0) <span class="keyword">read</span>(<a class="code" href="namespaceice__fileunits.html#a1c0f914707e7a61a579be21df178f061">nu_nml</a>,*)  <span class="comment">! for Nagware compiler</span>
<a name="l00224"></a>00224       <span class="keyword">end do</span>
<a name="l00225"></a>00225       <span class="keyword">if</span> (nml_error == 0) <span class="keyword">close</span>(<a class="code" href="namespaceice__fileunits.html#a1c0f914707e7a61a579be21df178f061">nu_nml</a>)
<a name="l00226"></a>00226    <span class="keyword">endif</span>
<a name="l00227"></a>00227    call <a class="code" href="namespaceice__fileunits.html#a6edc4f5f2fe087f5651f7d4b7f595eeb">release_fileunit</a>(<a class="code" href="namespaceice__fileunits.html#a1c0f914707e7a61a579be21df178f061">nu_nml</a>)
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(nml_error,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00230"></a>00230 
<a name="l00231"></a>00231    <span class="keyword">if</span> (nml_error /= 0) <span class="keyword">then</span>
<a name="l00232"></a>00232       call <a class="code" href="namespaceice__exit.html#a3fcf77109320e75f1268f41fe212d789">abort_ice </a>(<span class="stringliteral">&apos;ice: Namelist read error in ice_prescribed_mod&apos;</span>)
<a name="l00233"></a>00233    <span class="keyword">endif</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00236"></a>00236    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a8ffe8edc2e99d865aa09b7c7f7801c37">stream_year_first</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00237"></a>00237    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#ade5d68f1b7b652dcacb5263e02aaa099">stream_year_last</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00238"></a>00238    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a1710ba150bcf274f07add3f2a05b49e7">model_year_align</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00239"></a>00239    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a345c4a3ce0fa3d2ebe4468d03a9fe51a">stream_fldVarName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00240"></a>00240    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a6f95de7f96b71c33ef261199631ddf80">stream_fldFileName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00241"></a>00241    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#abae176465bd6efc8cb114772aa63b145">stream_domTvarName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00242"></a>00242    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#ae6a726ada1e1e93644fa269052a767e4">stream_domXvarName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00243"></a>00243    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a38e084e4885a0dcfa51a63fbccbe05b0">stream_domYvarName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00244"></a>00244    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a4c5e8c8c8c573e69e00039703e28a83f">stream_domAreaName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00245"></a>00245    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#afe7ec341a14bd719d0759586a729e76d">stream_domMaskName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00246"></a>00246    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a54b8dea8c8a1cdca57b336d8dedeb51c">stream_domFileName</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00247"></a>00247    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">prescribed_ice_fill</a>,<a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00248"></a>00248 
<a name="l00249"></a>00249    <span class="keyword">if</span> (.not.<a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>) return
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00252"></a>00252       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; prescribed_ice            = &apos;</span>, <a class="code" href="namespaceice__prescribed__mod.html#a1b42a8c2b0357eb657332946d2b6c78a">prescribed_ice</a>
<a name="l00253"></a>00253       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; stream_year_first         = &apos;</span>, <a class="code" href="namespaceice__prescribed__mod.html#a8ffe8edc2e99d865aa09b7c7f7801c37">stream_year_first</a>
<a name="l00254"></a>00254       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; stream_year_last          = &apos;</span>, <a class="code" href="namespaceice__prescribed__mod.html#ade5d68f1b7b652dcacb5263e02aaa099">stream_year_last</a>
<a name="l00255"></a>00255       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; model_year_align          = &apos;</span>, <a class="code" href="namespaceice__prescribed__mod.html#a1710ba150bcf274f07add3f2a05b49e7">model_year_align</a>
<a name="l00256"></a>00256       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; prescribed_ice_fill       = &apos;</span>, <a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">prescribed_ice_fill</a>
<a name="l00257"></a>00257       <span class="comment">!TODO: add above variables</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="comment">! ech moved from ice_diagnostics.F</span>
<a name="l00260"></a>00260 <span class="comment">! set print_global to .false. in ice_in to prevent global diagnostics</span>
<a name="l00261"></a>00261       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*)   <span class="stringliteral">&apos;This is the prescribed ice option.&apos;</span>
<a name="l00262"></a>00262       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*)   <span class="stringliteral">&apos;Heat and water will not be conserved.&apos;</span>   
<a name="l00263"></a>00263    <span class="keyword">endif</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">! end ech changes</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="comment">!------------------------------------------------------------------</span>
<a name="l00268"></a>00268    <span class="comment">! Create integer CSIM mask with global dimensions</span>
<a name="l00269"></a>00269    <span class="comment">!------------------------------------------------------------------</span>
<a name="l00270"></a>00270    <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <span class="keyword">allocate</span> (<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>(<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>),<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>(<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>),&amp;
<a name="l00273"></a>00273       &amp;  csim_mask_g(<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>))
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <span class="keyword">else</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       <span class="keyword">allocate</span> (<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>(1,1),<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>(1,1),&amp;
<a name="l00278"></a>00278       &amp;  csim_mask_g(1,1))
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keyword">end if</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    call <a class="code" href="interfaceice__gather__scatter_1_1gather__global.html">gather_global</a>(<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>, <a class="code" href="namespaceice__grid.html#a7ecb27b1b130ed860c56ab81f4a9373e">hm</a>, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>, <a class="code" href="namespaceice__domain.html#af84e6e4ee8c3c2d04326e26048f003b1">distrb_info</a>)
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286       csim_mask_g = <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>     <span class="comment">! Convert to integer array</span>
<a name="l00287"></a>00287 
<a name="l00288"></a>00288    <span class="keyword">endif</span>
<a name="l00289"></a>00289 
<a name="l00290"></a>00290    call <a class="code" href="interfaceice__gather__scatter_1_1gather__global.html">gather_global</a>(<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>, <a class="code" href="namespaceice__grid.html#a76fff4cfe2a27c44abe9fd445f806f25">TLAT</a>, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>, <a class="code" href="namespaceice__domain.html#af84e6e4ee8c3c2d04326e26048f003b1">distrb_info</a>)
<a name="l00291"></a>00291    call <a class="code" href="interfaceice__gather__scatter_1_1gather__global.html">gather_global</a>(<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>, <a class="code" href="namespaceice__grid.html#a2b90fd0fa35a54c0313dac995f929ee7">TLON</a>, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>, <a class="code" href="namespaceice__domain.html#af84e6e4ee8c3c2d04326e26048f003b1">distrb_info</a>)
<a name="l00292"></a>00292 
<a name="l00293"></a>00293    <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> == <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295       <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>(:,:) = <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>(:,:)*<a class="code" href="namespaceice__constants.html#a499282766889f13defe6ffd6c7aa1216">rad_to_deg</a>
<a name="l00296"></a>00296       <a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>(:,:) = <a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>(:,:)*<a class="code" href="namespaceice__constants.html#a499282766889f13defe6ffd6c7aa1216">rad_to_deg</a>
<a name="l00297"></a>00297 
<a name="l00298"></a>00298       <span class="comment">!---------------------------------------------------------------------</span>
<a name="l00299"></a>00299       <span class="comment">! Parse info file, initialize csim_stream datatype and load with info</span>
<a name="l00300"></a>00300       <span class="comment">!---------------------------------------------------------------------</span>
<a name="l00301"></a>00301       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%nFiles           = 0  
<a name="l00302"></a>00302       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%file(:)%name     = <span class="stringliteral">&apos;not_set&apos;</span> 
<a name="l00303"></a>00303       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%file(:)%nt       = 0
<a name="l00304"></a>00304       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%file(:)%haveData = .false.
<a name="l00305"></a>00305       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%yearFirst        = <a class="code" href="namespaceice__prescribed__mod.html#a8ffe8edc2e99d865aa09b7c7f7801c37">stream_year_first</a>
<a name="l00306"></a>00306       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%yearLast         = <a class="code" href="namespaceice__prescribed__mod.html#ade5d68f1b7b652dcacb5263e02aaa099">stream_year_last</a>
<a name="l00307"></a>00307       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%yearAlign        = <a class="code" href="namespaceice__prescribed__mod.html#a1710ba150bcf274f07add3f2a05b49e7">model_year_align</a>
<a name="l00308"></a>00308       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%fldListFile      = <span class="stringliteral">&apos; &apos;</span>
<a name="l00309"></a>00309       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%fldListModel     = <span class="stringliteral">&apos; &apos;</span>
<a name="l00310"></a>00310       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%FilePath         = <span class="stringliteral">&apos; &apos;</span>
<a name="l00311"></a>00311       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domFilePath      = <span class="stringliteral">&apos; &apos;</span>
<a name="l00312"></a>00312       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%k_lvd            = -1 
<a name="l00313"></a>00313       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%n_lvd            = -1 
<a name="l00314"></a>00314       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%found_lvd        = .false.
<a name="l00315"></a>00315       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%k_gvd            = -1 
<a name="l00316"></a>00316       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%n_gvd            = -1 
<a name="l00317"></a>00317       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%found_gvd        = .false.
<a name="l00318"></a>00318       
<a name="l00319"></a>00319       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%dataSource   = <span class="stringliteral">&apos;cice ifrac/sst file&apos;</span>
<a name="l00320"></a>00320       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%fldListFile  =  <a class="code" href="namespaceice__prescribed__mod.html#a345c4a3ce0fa3d2ebe4468d03a9fe51a">stream_fldVarName</a>
<a name="l00321"></a>00321       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%fldListModel = <span class="stringliteral">&apos;ice_cov&apos;</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323       <span class="comment">!build logic hear to determine how many names are on the input file</span>
<a name="l00324"></a>00324       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%File(1)%name =  <a class="code" href="namespaceice__prescribed__mod.html#a6f95de7f96b71c33ef261199631ddf80">stream_fldFileName</a>
<a name="l00325"></a>00325       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%nFiles       =  1 
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domTvarName  =  <a class="code" href="namespaceice__prescribed__mod.html#abae176465bd6efc8cb114772aa63b145">stream_domTvarName</a>
<a name="l00328"></a>00328       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domXvarName  =  <a class="code" href="namespaceice__prescribed__mod.html#ae6a726ada1e1e93644fa269052a767e4">stream_domXvarName</a>
<a name="l00329"></a>00329       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domYvarName  =  <a class="code" href="namespaceice__prescribed__mod.html#a38e084e4885a0dcfa51a63fbccbe05b0">stream_domYvarName</a>
<a name="l00330"></a>00330       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domAreaName  =  <a class="code" href="namespaceice__prescribed__mod.html#a4c5e8c8c8c573e69e00039703e28a83f">stream_domAreaName</a>
<a name="l00331"></a>00331       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domMaskName  =  <a class="code" href="namespaceice__prescribed__mod.html#afe7ec341a14bd719d0759586a729e76d">stream_domMaskName</a>
<a name="l00332"></a>00332       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%domFileName  =  <a class="code" href="namespaceice__prescribed__mod.html#a54b8dea8c8a1cdca57b336d8dedeb51c">stream_domFileName</a>
<a name="l00333"></a>00333       <a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>%init         =  .true.
<a name="l00334"></a>00334 
<a name="l00335"></a>00335       <span class="comment">!---------------------------------------------------------------------</span>
<a name="l00336"></a>00336       <span class="comment">! Check that ice cover data exists</span>
<a name="l00337"></a>00337       <span class="comment">! Assumes that stream has one field, ice fraction</span>
<a name="l00338"></a>00338       <span class="comment">!---------------------------------------------------------------------</span>
<a name="l00339"></a>00339       call shr_stream_getFileFieldList(<a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>,<a class="code" href="namespaceice__prescribed__mod.html#a5bdbd6cc049323f35a5c8f6e4613c369">fldList</a>)
<a name="l00340"></a>00340       <a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a> = shr_string_listGetNum(<a class="code" href="namespaceice__prescribed__mod.html#a5bdbd6cc049323f35a5c8f6e4613c369">fldList</a>)                <span class="comment">! How many fields?</span>
<a name="l00341"></a>00341 
<a name="l00342"></a>00342       <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a> == 1) <span class="keyword">then</span>
<a name="l00343"></a>00343          call shr_string_listGetName(<a class="code" href="namespaceice__prescribed__mod.html#a5bdbd6cc049323f35a5c8f6e4613c369">fldList</a>,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>,<a class="code" href="namespaceice__prescribed__mod.html#a47d61c09a57e43eefae7895db766851a">fldName</a>) <span class="comment">! Get name of 1st field</span>
<a name="l00344"></a>00344       <span class="keyword">else</span>
<a name="l00345"></a>00345          <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F00) <span class="stringliteral">&quot;ERROR: Only one field can exist in stream&quot;</span>
<a name="l00346"></a>00346          <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F01)  trim(<a class="code" href="namespaceice__prescribed__mod.html#a5bdbd6cc049323f35a5c8f6e4613c369">fldList</a>)//<span class="stringliteral">&apos; has &apos;</span>,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>
<a name="l00347"></a>00347          call <a class="code" href="namespaceice__exit.html#a3fcf77109320e75f1268f41fe212d789">abort_ice</a>(subName)
<a name="l00348"></a>00348       <span class="keyword">end if</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350       call shr_stream_getFirstFileName(<a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>,first_data_file,data_path)
<a name="l00351"></a>00351       call shr_stream_getFile         (data_path,first_data_file)
<a name="l00352"></a>00352       check = shr_ncread_varExists(first_data_file,<a class="code" href="namespaceice__prescribed__mod.html#a47d61c09a57e43eefae7895db766851a">fldName</a>) 
<a name="l00353"></a>00353 
<a name="l00354"></a>00354       <span class="keyword">if</span> (.not.check) <span class="keyword">then</span>
<a name="l00355"></a>00355          <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F00) <span class="stringliteral">&quot;ERROR: ice concentration field does not exist&quot;</span>
<a name="l00356"></a>00356          call <a class="code" href="namespaceice__exit.html#a3fcf77109320e75f1268f41fe212d789">abort_ice</a>(subName)
<a name="l00357"></a>00357       <span class="keyword">end if</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359       <span class="comment">!---------------------------------------------------------------------</span>
<a name="l00360"></a>00360       <span class="comment">! Get size of the input data domain and allocate arrays</span>
<a name="l00361"></a>00361       <span class="comment">!---------------------------------------------------------------------</span>
<a name="l00362"></a>00362       call shr_stream_getDomainInfo(<a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>,data_path,domain_info_fn, timeName, &amp;
<a name="l00363"></a>00363       &amp;                             lonName, latName, maskName, areaName)
<a name="l00364"></a>00364 
<a name="l00365"></a>00365       call shr_ncread_varDimSizes(domain_info_fn,lonName,<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>)
<a name="l00366"></a>00366       call shr_ncread_varDimSizes(domain_info_fn,latName,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>)
<a name="l00367"></a>00367       call shr_stream_getFile(data_path,domain_info_fn)
<a name="l00368"></a>00368       call shr_sys_flush(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>)
<a name="l00369"></a>00369 
<a name="l00370"></a>00370       <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>(<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>)) 
<a name="l00371"></a>00371       <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>(<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>))
<a name="l00372"></a>00372 
<a name="l00373"></a>00373       <span class="comment">!------------------------------------------------------------------</span>
<a name="l00374"></a>00374       <span class="comment">! Read in lat-lon grid info from input data file, ALL output is 2D</span>
<a name="l00375"></a>00375       <span class="comment">!------------------------------------------------------------------</span>
<a name="l00376"></a>00376       call shr_ncread_domain(domain_info_fn, lonName, <a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>, latName, <a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>)
<a name="l00377"></a>00377 
<a name="l00378"></a>00378       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&apos;min/max dataXCoord  = &apos;</span>,minval(<a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>) ,maxval(<a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>)
<a name="l00379"></a>00379       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&apos;min/max dataYCoord  = &apos;</span>,minval(<a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>) ,maxval(<a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>)
<a name="l00380"></a>00380       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&apos;min/max TLON        = &apos;</span>,minval(<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>)    ,maxval(<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>)
<a name="l00381"></a>00381       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&apos;min/max TLAT        = &apos;</span>,minval(<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>)    ,maxval(<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>)
<a name="l00382"></a>00382       <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F01) <span class="stringliteral">&apos;min/max csim_mask_g = &apos;</span>,minval(csim_mask_g),maxval(csim_mask_g)
<a name="l00383"></a>00383 
<a name="l00384"></a>00384       <span class="comment">!------------------------------------------------------------------</span>
<a name="l00385"></a>00385       <span class="comment">! Determine if need to regrid</span>
<a name="l00386"></a>00386       <span class="comment">!------------------------------------------------------------------</span>
<a name="l00387"></a>00387       <span class="keyword">if</span> (<a class="code" href="namespaceice__scam.html#a34d0d2e7da10c0e3b977aa989b318dac">single_column</a>) <span class="keyword">then</span> 
<a name="l00388"></a>00388          call <a class="code" href="namespaceice__read__write.html#ab2f5aad237f6bdcee1e5e90537050822">ice_open_nc </a>(domain_info_fn, <a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>)
<a name="l00389"></a>00389          call shr_scam_GetCloseLatLon(<a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>,<a class="code" href="namespaceice__scam.html#a72933cc98dddc52d1f629eb311a715af">scmlat</a>,<a class="code" href="namespaceice__scam.html#a3064f1ae884e72d621f753a3a3363b17">scmlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#ab6b945488fb9a21b8c0abf9c5c9f13d3">closelat</a>,<a class="code" href="namespaceice__prescribed__mod.html#a0a932ccb360a743d8d05b685438cce6f">closelon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>)
<a name="l00390"></a>00390          call <a class="code" href="namespaceice__read__write.html#ae296957254d38ce1229d08bd1ded45a6">ice_close_nc </a>(<a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>)
<a name="l00391"></a>00391          <a class="code" href="namespaceice__prescribed__mod.html#a794e5c02618e82554dc2cec6c635b8f1">regrid</a>=( abs(<a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>(<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>) - <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>(1,1))&gt;1.e-12 .or. abs(<a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>(<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>)- <a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>(1,1))&gt;1.0e-12)
<a name="l00392"></a>00392       <span class="keyword">else</span>
<a name="l00393"></a>00393          call <a class="code" href="namespaceice__prescribed__mod.html#acc7d1e7dfe5627bee722781e039280c9">ice_prescribed_checkDomain</a>(<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>, <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>, <a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>, <a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>, <a class="code" href="namespaceice__prescribed__mod.html#a794e5c02618e82554dc2cec6c635b8f1">regrid</a>)
<a name="l00394"></a>00394 
<a name="l00395"></a>00395       <span class="keyword">end if</span>
<a name="l00396"></a>00396 
<a name="l00397"></a>00397       <span class="comment">!------------------------------------------------------------------</span>
<a name="l00398"></a>00398       <span class="comment">! If regrid, read in domain again, obtain mask array and initialize mapping</span>
<a name="l00399"></a>00399       <span class="comment">!------------------------------------------------------------------</span>
<a name="l00400"></a>00400       <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#a794e5c02618e82554dc2cec6c635b8f1">regrid</a>) <span class="keyword">then</span>
<a name="l00401"></a>00401          <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">dataMask</a>(<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>))
<a name="l00402"></a>00402          call shr_ncread_domain(domain_info_fn, lonName, <a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>, &amp;
<a name="l00403"></a>00403       &amp;                         latName, <a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>, maskName, <a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">dataMask</a>)
<a name="l00404"></a>00404          <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F01) <span class="stringliteral">&apos;min/max dataMask = &apos;</span>,minval(<a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">dataMask</a>), maxval(<a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">dataMask</a>)
<a name="l00405"></a>00405 
<a name="l00406"></a>00406          <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">prescribed_ice_fill</a>) <span class="keyword">then</span>
<a name="l00407"></a>00407             call shr_map_mapSet(<a class="code" href="namespaceice__prescribed__mod.html#a9cc059c1adaefc7ef43aa8ccf9f774ea">csim_fill</a>, <a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>, <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>, csim_mask_g, &amp;
<a name="l00408"></a>00408             &amp;                              <a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>, <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>, csim_mask_g, &amp;
<a name="l00409"></a>00409             &amp;                   name=<span class="stringliteral">&apos;csim_map&apos;</span>,type=<span class="stringliteral">&apos;fill&apos;</span>,algo=<span class="stringliteral">&apos;nnoni&apos;</span>, &amp;
<a name="l00410"></a>00410             &amp;                   mask=<span class="stringliteral">&apos;nomask&apos;</span>)
<a name="l00411"></a>00411          <span class="keyword">end if</span>
<a name="l00412"></a>00412 
<a name="l00413"></a>00413          <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F00) <span class="stringliteral">&apos;Computing mapping weights&apos;</span>
<a name="l00414"></a>00414 
<a name="l00415"></a>00415          call shr_map_mapSet(<a class="code" href="namespaceice__prescribed__mod.html#ada89f7f5c26e2923f8fab5f837979bd9">csim_map</a>, <a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>, <a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>, <a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">dataMask</a>, &amp;
<a name="l00416"></a>00416          &amp;                             <a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>,   <a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>,  csim_mask_g, &amp;
<a name="l00417"></a>00417          &amp;                   name=<span class="stringliteral">&apos;csim_map&apos;</span>,type=<span class="stringliteral">&apos;remap&apos;</span>,algo=<span class="stringliteral">&apos;bilinear&apos;</span>, &amp;
<a name="l00418"></a>00418          &amp;                   mask=<span class="stringliteral">&apos;dstmask&apos;</span>,vect=<span class="stringliteral">&apos;scalar&apos;</span>)
<a name="l00419"></a>00419          <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a4d4897310d6673a94b06d49fd6adfbcc">dataMask</a>)
<a name="l00420"></a>00420 
<a name="l00421"></a>00421       <span class="keyword">end if</span>
<a name="l00422"></a>00422 
<a name="l00423"></a>00423       <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a88edf4fbb0dc86b082ddf6a6c48d393a">dataOutLB</a>(<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>))  <span class="comment">! output for model use</span>
<a name="l00424"></a>00424       <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a0c216149ad3a2a7bd66c3bdb274c77e7">dataOutUB</a>(<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>))
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00427"></a>00427       <span class="comment">! Check to see that ice concentration is in fraction, not percent</span>
<a name="l00428"></a>00428       <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00429"></a>00429       <span class="keyword">allocate</span>(work4d(<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>,1,1))
<a name="l00430"></a>00430       call shr_ncread_field4dG(first_data_file, <a class="code" href="namespaceice__prescribed__mod.html#a47d61c09a57e43eefae7895db766851a">fldName</a>, rfld=work4d, dim3i=1)
<a name="l00431"></a>00431       aice_max = maxval(work4d)
<a name="l00432"></a>00432       <span class="keyword">deallocate</span>(work4d)
<a name="l00433"></a>00433 
<a name="l00434"></a>00434       <span class="keyword">if</span> (aice_max &gt; <a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>) <span class="keyword">then</span>
<a name="l00435"></a>00435          <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&quot;ERROR: Ice conc data must be in fraction, aice_max= &quot;</span>,aice_max
<a name="l00436"></a>00436          call <a class="code" href="namespaceice__exit.html#a3fcf77109320e75f1268f41fe212d789">abort_ice</a>(subName)
<a name="l00437"></a>00437       <span class="keyword">end if</span>
<a name="l00438"></a>00438 
<a name="l00439"></a>00439       <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a05759838d18f2fbc703a6ff43bdc217b">dataXCoord</a>,<a class="code" href="namespaceice__prescribed__mod.html#abf3b4ab489983d1531847794139e9397">dataYCoord</a>)
<a name="l00440"></a>00440       <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>,<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>)
<a name="l00441"></a>00441       <span class="keyword">deallocate</span>(csim_mask_g)
<a name="l00442"></a>00442 
<a name="l00443"></a>00443    <span class="keyword">else</span>
<a name="l00444"></a>00444 
<a name="l00445"></a>00445       <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__work.html#a6feb68d353a0240588d528748fecab4c">work_g1</a>,<a class="code" href="namespaceice__work.html#abfbbe39f5e047d0db457513d4f779e15">work_g2</a>)
<a name="l00446"></a>00446       <span class="keyword">deallocate</span>(csim_mask_g)
<a name="l00447"></a>00447 
<a name="l00448"></a>00448    <span class="keyword">end if</span>           <span class="comment">! master_task</span>
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00451"></a>00451    <span class="comment">! For one ice category, set hin_max(1) to something big</span>
<a name="l00452"></a>00452    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00453"></a>00453    <span class="keyword">if</span> (<a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a> == 1) <span class="keyword">then</span>
<a name="l00454"></a>00454       <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(1) = 999._dbl_kind
<a name="l00455"></a>00455    <span class="keyword">end if</span>
<a name="l00456"></a>00456     
<a name="l00457"></a>00457 <span class="keyword">end subroutine ice_prescribed_init</span>
<a name="l00458"></a>00458   
<a name="l00459"></a>00459 <span class="comment">!=======================================================================</span>
<a name="l00460"></a>00460 <span class="comment">!BOP ===================================================================</span>
<a name="l00461"></a>00461 <span class="comment">!</span>
<a name="l00462"></a>00462 <span class="comment">! !IROUTINE: ice_prescribed_run -- Obtain two time slices of data for </span>
<a name="l00463"></a>00463 <span class="comment">!                                  current time</span>
<a name="l00464"></a>00464 <span class="comment">!</span>
<a name="l00465"></a>00465 <span class="comment">! !DESCRIPTION:</span>
<a name="l00466"></a>00466 <span class="comment">! </span>
<a name="l00467"></a>00467 <span class="comment">!  Finds two time slices bounding current model time, remaps if necessary</span>
<a name="l00468"></a>00468 <span class="comment">!</span>
<a name="l00469"></a>00469 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00470"></a>00470 <span class="comment">!     2005-May-19 - J. Schramm - first version</span>
<a name="l00471"></a>00471 <span class="comment">!</span>
<a name="l00472"></a>00472 <span class="comment">! !INTERFACE: -----------------------------------------------------------</span>
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="namespaceice__prescribed__mod.html#a73bcaa2e547c18a24eeabaa2e22e8fe9">00474</a> <span class="keyword">subroutine </span><a class="code" href="namespaceice__prescribed__mod.html#a73bcaa2e547c18a24eeabaa2e22e8fe9">ice_prescribed_run</a>(mDateIn, secIn)
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="comment">! !USES:</span>
<a name="l00477"></a>00477 
<a name="l00478"></a>00478    use <span class="keywordflow">shr_tInterp_mod</span>
<a name="l00479"></a>00479    use <span class="keywordflow">ice_constants</span>, only: field_loc_center, field_type_scalar
<a name="l00480"></a>00480    use <span class="keywordflow">ice_gather_scatter</span>, only : scatter_global
<a name="l00481"></a>00481 
<a name="l00482"></a>00482    <span class="keyword">implicit none</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486    <span class="keywordtype">integer(kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: mDateIn  <span class="comment">! Current model date (yyyymmdd)</span>
<a name="l00487"></a>00487    <span class="keywordtype">integer(kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: secIn    <span class="comment">! Elapsed seconds on model date</span>
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="comment">!EOP</span>
<a name="l00490"></a>00490 
<a name="l00491"></a>00491    <span class="keywordtype">real(kind=dbl_kind)    </span>:: fLB         <span class="comment">! weight for lower bound</span>
<a name="l00492"></a>00492    <span class="keywordtype">real(kind=dbl_kind)    </span>:: fUB         <span class="comment">! weight for upper bound</span>
<a name="l00493"></a>00493    <span class="keywordtype">integer(kind=int_kind) </span>:: mDateLB     <span class="comment">! model date    of lower bound</span>
<a name="l00494"></a>00494    <span class="keywordtype">integer(kind=int_kind) </span>:: mDateUB     <span class="comment">! model date    of upper bound</span>
<a name="l00495"></a>00495    <span class="keywordtype">integer(kind=int_kind) </span>:: dDateLB     <span class="comment">! data  date    of lower bound</span>
<a name="l00496"></a>00496    <span class="keywordtype">integer(kind=int_kind) </span>:: dDateUB     <span class="comment">! data  date    of upper bound</span>
<a name="l00497"></a>00497    <span class="keywordtype">integer(kind=int_kind) </span>::   secUB     <span class="comment">! elap sec      of upper bound</span>
<a name="l00498"></a>00498    <span class="keywordtype">integer(kind=int_kind) </span>::   secLB     <span class="comment">! elap sec      of lower bound</span>
<a name="l00499"></a>00499    <span class="keywordtype">integer(kind=int_kind) </span>::    n_lb     <span class="comment">! t-coord index of lower bound</span>
<a name="l00500"></a>00500    <span class="keywordtype">integer(kind=int_kind) </span>::    n_ub     <span class="comment">! t-coord index of upper bound</span>
<a name="l00501"></a>00501    <span class="keywordtype">character(len=char_len_long) </span>::  fileLB     <span class="comment">! file containing  lower bound</span>
<a name="l00502"></a>00502    <span class="keywordtype">character(len=char_len_long) </span>::  fileUB     <span class="comment">! file containing  upper bound</span>
<a name="l00503"></a>00503 
<a name="l00504"></a>00504    <span class="keywordtype">integer(kind=int_kind) </span>:: mDateLB_old = -999
<a name="l00505"></a>00505    <span class="keywordtype">integer(kind=int_kind) </span>:: secLB_old = -999
<a name="l00506"></a>00506    <span class="keywordtype">integer(kind=int_kind) </span>:: i,j,n,icnt,iblk  <span class="comment">! loop indices and counter</span>
<a name="l00507"></a>00507 
<a name="l00508"></a>00508    <span class="comment">!------------------------------------------------------------------------</span>
<a name="l00509"></a>00509    <span class="comment">! get two time slices of monthly ice coverage data</span>
<a name="l00510"></a>00510    <span class="comment">! check that upper and lower time bounds have not changed</span>
<a name="l00511"></a>00511    <span class="comment">!------------------------------------------------------------------------</span>
<a name="l00512"></a>00512 
<a name="l00513"></a>00513    <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> ==  <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515       call shr_stream_findBounds(<a class="code" href="namespaceice__prescribed__mod.html#ae8eb8307f8c4017094a64d99000f458d">csim_stream</a>, mDateIn,secIn,             &amp;
<a name="l00516"></a>00516       &amp;                          mDateLB, dDateLB, secLB, n_lb, fileLB, &amp;
<a name="l00517"></a>00517       &amp;                          mDateUB, dDateUB, secUB, n_ub, fileUB)
<a name="l00518"></a>00518 
<a name="l00519"></a>00519       <a class="code" href="namespaceice__prescribed__mod.html#a07b5b645c36b9f4e6ffecb44561d737e">read_data</a> = .false.
<a name="l00520"></a>00520       <span class="keyword">if</span> (mDateLB_old /= mDateLB .or. secLB_old /= secLB) <span class="keyword">then</span>
<a name="l00521"></a>00521          <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">dataInLB</a>(<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>))      <span class="comment">! netCDF input data size</span>
<a name="l00522"></a>00522          <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">dataInUB</a>(<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>))
<a name="l00523"></a>00523          <a class="code" href="namespaceice__prescribed__mod.html#a07b5b645c36b9f4e6ffecb44561d737e">read_data</a> = .true.
<a name="l00524"></a>00524          call <a class="code" href="namespaceice__prescribed__mod.html#aa67a3710c35bda9e15dedf703582f149">ice_prescribed_readField</a>(fileLB, <a class="code" href="namespaceice__prescribed__mod.html#a47d61c09a57e43eefae7895db766851a">fldName</a>, n_lb, <a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">dataInLB</a>)
<a name="l00525"></a>00525          call <a class="code" href="namespaceice__prescribed__mod.html#aa67a3710c35bda9e15dedf703582f149">ice_prescribed_readField</a>(fileUB, <a class="code" href="namespaceice__prescribed__mod.html#a47d61c09a57e43eefae7895db766851a">fldName</a>, n_ub, <a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">dataInUB</a>)
<a name="l00526"></a>00526 
<a name="l00527"></a>00527          <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#a794e5c02618e82554dc2cec6c635b8f1">regrid</a>) <span class="keyword">then</span>
<a name="l00528"></a>00528 
<a name="l00529"></a>00529             <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a14513a8e50e8321ddac9e3f9d091cd12">dataSrcLB</a>(<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>,<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>*<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>))     <span class="comment">! reformed data for mapping</span>
<a name="l00530"></a>00530             <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a59169c4d93914baf69c59b8d5f2fb1ab">dataSrcUB</a>(<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>,<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>*<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>))
<a name="l00531"></a>00531             <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a69b2adaed2ac02b269e8c3c1d6b44178">dataDstLB</a>(<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>,<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>*<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>)) <span class="comment">! output from mapping</span>
<a name="l00532"></a>00532             <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a07af024321e34db28532c6834a352da3">dataDstUB</a>(<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>,<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>*<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>))
<a name="l00533"></a>00533 
<a name="l00534"></a>00534             <span class="comment">!-------------------------------------------------</span>
<a name="l00535"></a>00535             <span class="comment">! copy input data to arrays ordered for mapping</span>
<a name="l00536"></a>00536             <span class="comment">!-------------------------------------------------</span>
<a name="l00537"></a>00537             <span class="keyword">do</span> n=1,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>
<a name="l00538"></a>00538               icnt = 0
<a name="l00539"></a>00539               <span class="keyword">do</span> j=1,<a class="code" href="namespaceice__prescribed__mod.html#a553da06a37ff08c4047eaf0e66d4ec53">nlat</a>
<a name="l00540"></a>00540               <span class="keyword">do</span> i=1,<a class="code" href="namespaceice__prescribed__mod.html#a7af5d49e5ab6fd7900aeb659387719a3">nlon</a>
<a name="l00541"></a>00541                  icnt = icnt + 1
<a name="l00542"></a>00542                  <a class="code" href="namespaceice__prescribed__mod.html#a14513a8e50e8321ddac9e3f9d091cd12">dataSrcLB</a>(n,icnt) = <a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">dataInLB</a>(i,j,n)
<a name="l00543"></a>00543                  <a class="code" href="namespaceice__prescribed__mod.html#a59169c4d93914baf69c59b8d5f2fb1ab">dataSrcUB</a>(n,icnt) = <a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">dataInUB</a>(i,j,n)
<a name="l00544"></a>00544               <span class="keyword">enddo</span>
<a name="l00545"></a>00545               <span class="keyword">enddo</span>
<a name="l00546"></a>00546             <span class="keyword">enddo</span>
<a name="l00547"></a>00547 
<a name="l00548"></a>00548             <span class="comment">!-------------------------------------------------</span>
<a name="l00549"></a>00549             <span class="comment">! map the ordered arrays</span>
<a name="l00550"></a>00550             <span class="comment">!-------------------------------------------------</span>
<a name="l00551"></a>00551             <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#aa4a8e7410405429c0277535dff2ec7ea">prescribed_ice_fill</a>) <span class="keyword">then</span>
<a name="l00552"></a>00552                call shr_map_mapData(<a class="code" href="namespaceice__prescribed__mod.html#a14513a8e50e8321ddac9e3f9d091cd12">dataSrcLB</a>, <a class="code" href="namespaceice__prescribed__mod.html#a69b2adaed2ac02b269e8c3c1d6b44178">dataDstLB</a>, <a class="code" href="namespaceice__prescribed__mod.html#a9cc059c1adaefc7ef43aa8ccf9f774ea">csim_fill</a>)
<a name="l00553"></a>00553                call shr_map_mapData(<a class="code" href="namespaceice__prescribed__mod.html#a59169c4d93914baf69c59b8d5f2fb1ab">dataSrcUB</a>, <a class="code" href="namespaceice__prescribed__mod.html#a07af024321e34db28532c6834a352da3">dataDstUB</a>, <a class="code" href="namespaceice__prescribed__mod.html#a9cc059c1adaefc7ef43aa8ccf9f774ea">csim_fill</a>)
<a name="l00554"></a>00554             <span class="keyword">end if</span>
<a name="l00555"></a>00555             call shr_map_mapData(<a class="code" href="namespaceice__prescribed__mod.html#a14513a8e50e8321ddac9e3f9d091cd12">dataSrcLB</a>, <a class="code" href="namespaceice__prescribed__mod.html#a69b2adaed2ac02b269e8c3c1d6b44178">dataDstLB</a>, <a class="code" href="namespaceice__prescribed__mod.html#ada89f7f5c26e2923f8fab5f837979bd9">csim_map</a>)
<a name="l00556"></a>00556             call shr_map_mapData(<a class="code" href="namespaceice__prescribed__mod.html#a59169c4d93914baf69c59b8d5f2fb1ab">dataSrcUB</a>, <a class="code" href="namespaceice__prescribed__mod.html#a07af024321e34db28532c6834a352da3">dataDstUB</a>, <a class="code" href="namespaceice__prescribed__mod.html#ada89f7f5c26e2923f8fab5f837979bd9">csim_map</a>)
<a name="l00557"></a>00557 
<a name="l00558"></a>00558             <span class="comment">!-------------------------------------------------</span>
<a name="l00559"></a>00559             <span class="comment">! copy mapped fields back to general 3d arrays</span>
<a name="l00560"></a>00560             <span class="comment">!-------------------------------------------------</span>
<a name="l00561"></a>00561             <span class="keyword">do</span> n=1,<a class="code" href="namespaceice__prescribed__mod.html#aeeaddf3904b52191dfe9e843ae36bcd0">nflds</a>
<a name="l00562"></a>00562                icnt = 0
<a name="l00563"></a>00563                <span class="keyword">do</span> j=1,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>
<a name="l00564"></a>00564                <span class="keyword">do</span> i=1,<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>
<a name="l00565"></a>00565                   icnt = icnt + 1
<a name="l00566"></a>00566                   <a class="code" href="namespaceice__prescribed__mod.html#a88edf4fbb0dc86b082ddf6a6c48d393a">dataOutLB</a>(i,j,n) = <a class="code" href="namespaceice__prescribed__mod.html#a69b2adaed2ac02b269e8c3c1d6b44178">dataDstLB</a>(n,icnt)
<a name="l00567"></a>00567                   <a class="code" href="namespaceice__prescribed__mod.html#a0c216149ad3a2a7bd66c3bdb274c77e7">dataOutUB</a>(i,j,n) = <a class="code" href="namespaceice__prescribed__mod.html#a07af024321e34db28532c6834a352da3">dataDstUB</a>(n,icnt)
<a name="l00568"></a>00568                <span class="keyword">enddo</span>
<a name="l00569"></a>00569                <span class="keyword">enddo</span>
<a name="l00570"></a>00570             <span class="keyword">enddo</span>
<a name="l00571"></a>00571             <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a14513a8e50e8321ddac9e3f9d091cd12">dataSrcLB</a>)
<a name="l00572"></a>00572             <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a59169c4d93914baf69c59b8d5f2fb1ab">dataSrcUB</a>)
<a name="l00573"></a>00573             <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a69b2adaed2ac02b269e8c3c1d6b44178">dataDstLB</a>)
<a name="l00574"></a>00574             <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a07af024321e34db28532c6834a352da3">dataDstUB</a>)
<a name="l00575"></a>00575          <span class="keyword">else</span>       <span class="comment">! no regrid</span>
<a name="l00576"></a>00576             <span class="keyword">if</span> (<a class="code" href="namespaceice__scam.html#a34d0d2e7da10c0e3b977aa989b318dac">single_column</a>) <span class="keyword">then</span> 
<a name="l00577"></a>00577                call <a class="code" href="namespaceice__read__write.html#ab2f5aad237f6bdcee1e5e90537050822">ice_open_nc </a>(fileLB, <a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>)
<a name="l00578"></a>00578                call shr_scam_GetCloseLatLon(<a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>,<a class="code" href="namespaceice__scam.html#a72933cc98dddc52d1f629eb311a715af">scmlat</a>,<a class="code" href="namespaceice__scam.html#a3064f1ae884e72d621f753a3a3363b17">scmlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#ab6b945488fb9a21b8c0abf9c5c9f13d3">closelat</a>,<a class="code" href="namespaceice__prescribed__mod.html#a0a932ccb360a743d8d05b685438cce6f">closelon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>)
<a name="l00579"></a>00579                call <a class="code" href="namespaceice__read__write.html#ae296957254d38ce1229d08bd1ded45a6">ice_close_nc </a>(<a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>)
<a name="l00580"></a>00580                <a class="code" href="namespaceice__prescribed__mod.html#a88edf4fbb0dc86b082ddf6a6c48d393a">dataOutLB</a>(1,1,:) = <a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">dataInLB</a>(<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>,:)
<a name="l00581"></a>00581                call <a class="code" href="namespaceice__read__write.html#ab2f5aad237f6bdcee1e5e90537050822">ice_open_nc </a>(fileUB, <a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>)
<a name="l00582"></a>00582                call shr_scam_GetCloseLatLon(<a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>,<a class="code" href="namespaceice__scam.html#a72933cc98dddc52d1f629eb311a715af">scmlat</a>,<a class="code" href="namespaceice__scam.html#a3064f1ae884e72d621f753a3a3363b17">scmlon</a>,<a class="code" href="namespaceice__prescribed__mod.html#ab6b945488fb9a21b8c0abf9c5c9f13d3">closelat</a>,<a class="code" href="namespaceice__prescribed__mod.html#a0a932ccb360a743d8d05b685438cce6f">closelon</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>)
<a name="l00583"></a>00583                call <a class="code" href="namespaceice__read__write.html#ae296957254d38ce1229d08bd1ded45a6">ice_close_nc </a>(<a class="code" href="namespaceice__prescribed__mod.html#a2f99c0b35d65529144252c26d4762bc7">ncid</a>)
<a name="l00584"></a>00584                <a class="code" href="namespaceice__prescribed__mod.html#a0c216149ad3a2a7bd66c3bdb274c77e7">dataOutUB</a>(1,1,:) = <a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">dataInUB</a>(<a class="code" href="namespaceice__prescribed__mod.html#a21240c657fdbc312b6cdd4c31395ede0">lonidx</a>,<a class="code" href="namespaceice__prescribed__mod.html#a406e46eaa55988c516d70a9e9ed1fb2a">latidx</a>,:)
<a name="l00585"></a>00585             <span class="keyword">else</span>
<a name="l00586"></a>00586                <a class="code" href="namespaceice__prescribed__mod.html#a88edf4fbb0dc86b082ddf6a6c48d393a">dataOutLB</a> = <a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">dataInLB</a>
<a name="l00587"></a>00587                <a class="code" href="namespaceice__prescribed__mod.html#a0c216149ad3a2a7bd66c3bdb274c77e7">dataOutUB</a> = <a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">dataInUB</a>
<a name="l00588"></a>00588             <span class="keyword">end if</span>    <span class="comment">! single_column</span>
<a name="l00589"></a>00589          <span class="keyword">end if</span>    <span class="comment">! regrid</span>
<a name="l00590"></a>00590 
<a name="l00591"></a>00591          mDateLB_old = mDateLB
<a name="l00592"></a>00592          secLB_old = secLB
<a name="l00593"></a>00593 
<a name="l00594"></a>00594          <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a07649c4c91bccc292f9aa60851ab2a14">dataInUB</a>)
<a name="l00595"></a>00595          <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a7b605d560be8c1903b0df4b66076f31a">dataInLB</a>)
<a name="l00596"></a>00596       <span class="keyword">end if</span>       <span class="comment">! mDate</span>
<a name="l00597"></a>00597     
<a name="l00598"></a>00598       call shr_tInterp_getFactors(mDateLB, secLB, mDateUB, secUB, &amp;
<a name="l00599"></a>00599       &amp;                           mDateIn, secIN, fLB, fUB)
<a name="l00600"></a>00600 
<a name="l00601"></a>00601    <span class="keyword">end if</span>    <span class="comment">! master_task</span>
<a name="l00602"></a>00602    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(fLB, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00603"></a>00603    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(fUB, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00604"></a>00604 
<a name="l00605"></a>00605    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00606"></a>00606    <span class="comment">! Scatter ice concentration to all processors if read data</span>
<a name="l00607"></a>00607    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00608"></a>00608 
<a name="l00609"></a>00609    call <a class="code" href="interfaceice__broadcast_1_1broadcast__scalar.html">broadcast_scalar</a>(<a class="code" href="namespaceice__prescribed__mod.html#a07b5b645c36b9f4e6ffecb44561d737e">read_data</a>, <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>)
<a name="l00610"></a>00610    <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#a07b5b645c36b9f4e6ffecb44561d737e">read_data</a>) <span class="keyword">then</span>
<a name="l00611"></a>00611       <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> ==  <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00612"></a>00612          <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>(<a class="code" href="namespaceice__domain__size.html#aefcbe884e789decfd40a43558e59ce6f">nx_global</a>,<a class="code" href="namespaceice__domain__size.html#ae668c8c91f91c2a63ce14581f198e1af">ny_global</a>))   <span class="comment">! Assumes 1 field</span>
<a name="l00613"></a>00613          <a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>(:,:) = <a class="code" href="namespaceice__prescribed__mod.html#a88edf4fbb0dc86b082ddf6a6c48d393a">dataOutLB</a>(:,:,1) 
<a name="l00614"></a>00614       <span class="keyword">else</span>
<a name="l00615"></a>00615          <span class="keyword">allocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>(1,1))
<a name="l00616"></a>00616       <span class="keyword">end if</span>
<a name="l00617"></a>00617       call <a class="code" href="interfaceice__gather__scatter_1_1scatter__global.html">scatter_global</a>(<a class="code" href="namespaceice__prescribed__mod.html#a2f6a0d3d485195c75861395c78cc22aa">ice_cov_lb</a>,   <a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>, &amp;
<a name="l00618"></a>00618            &amp;              <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>,  <a class="code" href="namespaceice__domain.html#af84e6e4ee8c3c2d04326e26048f003b1">distrb_info</a>, &amp; 
<a name="l00619"></a>00619            &amp;              <a class="code" href="namespaceice__constants.html#a4c526a105da0fa08ad1877e55f6d60fc">field_loc_center</a>, <a class="code" href="namespaceice__constants.html#a98992b4bfb499ea1f7a0f6037c17a100">field_type_scalar</a>)
<a name="l00620"></a>00620 
<a name="l00621"></a>00621       <span class="keyword">if</span> (<a class="code" href="namespaceice__communicate.html#a70e729e746e2e5ec592ccba505136002">my_task</a> ==  <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>) <span class="keyword">then</span>
<a name="l00622"></a>00622          <a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>(:,:) = <a class="code" href="namespaceice__prescribed__mod.html#a0c216149ad3a2a7bd66c3bdb274c77e7">dataOutUB</a>(:,:,1)
<a name="l00623"></a>00623       <span class="keyword">end if</span>
<a name="l00624"></a>00624       call <a class="code" href="interfaceice__gather__scatter_1_1scatter__global.html">scatter_global</a>(<a class="code" href="namespaceice__prescribed__mod.html#a9c50464ba0a337c6fd03cec3a7338897">ice_cov_ub</a>,   <a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>, &amp;
<a name="l00625"></a>00625            &amp;              <a class="code" href="namespaceice__communicate.html#a769a45947743f12c592e4cef37a18b6c">master_task</a>,  <a class="code" href="namespaceice__domain.html#af84e6e4ee8c3c2d04326e26048f003b1">distrb_info</a>, &amp; 
<a name="l00626"></a>00626            &amp;              <a class="code" href="namespaceice__constants.html#a4c526a105da0fa08ad1877e55f6d60fc">field_loc_center</a>, <a class="code" href="namespaceice__constants.html#a98992b4bfb499ea1f7a0f6037c17a100">field_type_scalar</a>)
<a name="l00627"></a>00627 
<a name="l00628"></a>00628       <span class="keyword">deallocate</span>(<a class="code" href="namespaceice__prescribed__mod.html#a2bc0b66d04bc6ff5ed1c325ee6292eff">ice_cov_global</a>)
<a name="l00629"></a>00629    <span class="keyword">end if</span>
<a name="l00630"></a>00630 
<a name="l00631"></a>00631    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00632"></a>00632    <span class="comment">! Time interpolate ice concentration data</span>
<a name="l00633"></a>00633    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00634"></a>00634 
<a name="l00635"></a>00635    <span class="keyword">do</span> iblk = 1,<a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00636"></a>00636    <span class="keyword">do</span> j = 1,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00637"></a>00637    <span class="keyword">do</span> i = 1,<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00638"></a>00638       <a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) = fLB*<a class="code" href="namespaceice__prescribed__mod.html#a2f6a0d3d485195c75861395c78cc22aa">ice_cov_lb</a>(i,j,iblk) + fUB*<a class="code" href="namespaceice__prescribed__mod.html#a9c50464ba0a337c6fd03cec3a7338897">ice_cov_ub</a>(i,j,iblk)
<a name="l00639"></a>00639    <span class="keyword">enddo</span>
<a name="l00640"></a>00640    <span class="keyword">enddo</span>
<a name="l00641"></a>00641    <span class="keyword">enddo</span>
<a name="l00642"></a>00642 
<a name="l00643"></a>00643    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00644"></a>00644    <span class="comment">! Set prescribed ice state and fluxes</span>
<a name="l00645"></a>00645    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00646"></a>00646 
<a name="l00647"></a>00647    call <a class="code" href="namespaceice__prescribed__mod.html#a9e6ac38b742040541c97492d74282b7a">ice_prescribed_phys</a>()
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 <span class="keyword">end subroutine ice_prescribed_run</span>
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="comment">!===============================================================================</span>
<a name="l00652"></a>00652 <span class="comment">!BOP ===========================================================================</span>
<a name="l00653"></a>00653 <span class="comment">!</span>
<a name="l00654"></a>00654 <span class="comment">! !IROUTINE: ice_prescribed_readField -- Read a field from input data</span>
<a name="l00655"></a>00655 <span class="comment">!</span>
<a name="l00656"></a>00656 <span class="comment">! !DESCRIPTION:</span>
<a name="l00657"></a>00657 <span class="comment">!     Read a field from input data, assumes prescribed ice uses only one field</span>
<a name="l00658"></a>00658 <span class="comment">!</span>
<a name="l00659"></a>00659 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00660"></a>00660 <span class="comment">!     2005-May-23 - J. Schramm - first version</span>
<a name="l00661"></a>00661 <span class="comment">!</span>
<a name="l00662"></a>00662 <span class="comment">! !INTERFACE: ------------------------------------------------------------------</span>
<a name="l00663"></a>00663 
<a name="l00664"></a><a class="code" href="namespaceice__prescribed__mod.html#aa67a3710c35bda9e15dedf703582f149">00664</a> <span class="keyword">subroutine </span><a class="code" href="namespaceice__prescribed__mod.html#aa67a3710c35bda9e15dedf703582f149">ice_prescribed_readField</a>(fileName, fldName, nTime, fldRead)
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 <span class="comment">! !USES:</span>
<a name="l00667"></a>00667 
<a name="l00668"></a>00668    <span class="keyword">implicit none</span>
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00671"></a>00671 
<a name="l00672"></a>00672    <span class="keywordtype">character(*)</span>, <span class="keywordtype">intent(in)</span>  :: fileName     <span class="comment">! netCDF input file</span>
<a name="l00673"></a>00673    <span class="keywordtype">character(*)</span>, <span class="keywordtype">intent(in)</span>  :: fldName      <span class="comment">! name of field in stream</span>
<a name="l00674"></a>00674    <span class="keywordtype">integer(kind=int_kind)</span>, <span class="keywordtype">intent(in)</span>  :: nTime          <span class="comment">! index of time slice to read</span>
<a name="l00675"></a>00675    <span class="keywordtype">real   (kind=dbl_kind)</span>, <span class="keywordtype">intent(out)</span> :: fldRead(:,:,:) <span class="comment">! field read in</span>
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 <span class="comment">!EOP</span>
<a name="l00678"></a>00678 
<a name="l00679"></a>00679    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: A4d(:,:,:,:)    <span class="comment">! 4D field array</span>
<a name="l00680"></a>00680    <span class="keywordtype">integer(kind=int_kind)           </span>:: ni, nj          <span class="comment">! size of field to read</span>
<a name="l00681"></a>00681 
<a name="l00682"></a>00682    ni = <span class="keyword">size</span>(fldRead,1)
<a name="l00683"></a>00683    nj = <span class="keyword">size</span>(fldRead,2)
<a name="l00684"></a>00684 
<a name="l00685"></a>00685    <span class="keyword">allocate</span>(A4d(ni,nj,1,1))
<a name="l00686"></a>00686 
<a name="l00687"></a>00687    call shr_ncread_field4dG(fileName, fldName, rfld=A4d, dim3i=nTime)
<a name="l00688"></a>00688    fldRead(:,:,1) = A4d(:,:,1,1)
<a name="l00689"></a>00689 
<a name="l00690"></a>00690    <span class="keyword">deallocate</span>(A4d)
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="keyword">end subroutine ice_prescribed_readField</span>
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="comment">!===============================================================================</span>
<a name="l00695"></a>00695 <span class="comment">!BOP ===========================================================================</span>
<a name="l00696"></a>00696 <span class="comment">!</span>
<a name="l00697"></a>00697 <span class="comment">! !IROUTINE: ice_prescribed_checkDomain -- Compare input data domain and ice domain </span>
<a name="l00698"></a>00698 <span class="comment">!</span>
<a name="l00699"></a>00699 <span class="comment">! !DESCRIPTION:</span>
<a name="l00700"></a>00700 <span class="comment">!     Check that input data domain matches that of ice model domain</span>
<a name="l00701"></a>00701 <span class="comment">!</span>
<a name="l00702"></a>00702 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00703"></a>00703 <span class="comment">!     2005-May-16 - J. Schramm - first version</span>
<a name="l00704"></a>00704 <span class="comment">!</span>
<a name="l00705"></a>00705 <span class="comment">! !INTERFACE: ------------------------------------------------------------------</span>
<a name="l00706"></a>00706 
<a name="l00707"></a><a class="code" href="namespaceice__prescribed__mod.html#acc7d1e7dfe5627bee722781e039280c9">00707</a> <span class="keyword">subroutine </span><a class="code" href="namespaceice__prescribed__mod.html#acc7d1e7dfe5627bee722781e039280c9">ice_prescribed_checkDomain</a>(csimXCoord, csimYCoord, dataXCoord, dataYCoord, regrid)
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">! !USES:</span>
<a name="l00710"></a>00710 
<a name="l00711"></a>00711    <span class="keyword">implicit none</span>
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00714"></a>00714 
<a name="l00715"></a>00715    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">intent(in)</span> :: csimXCoord(:,:) <span class="comment">! csim longitudes (degrees)</span>
<a name="l00716"></a>00716    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">intent(in)</span> :: csimYCoord(:,:) <span class="comment">! csim latitudes  (degrees)</span>
<a name="l00717"></a>00717    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">intent(in)</span> :: dataXCoord(:,:) <span class="comment">! data longitudes (degrees)</span>
<a name="l00718"></a>00718    <span class="keywordtype">real(kind=dbl_kind)</span>,    <span class="keywordtype">intent(in)</span> :: dataYCoord(:,:) <span class="comment">! data latitudes  (degrees)</span>
<a name="l00719"></a>00719    <span class="keywordtype">logical(kind=log_kind)</span>, <span class="keywordtype">intent(out)</span>:: regrid          <span class="comment">! true if remapping required</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 <span class="comment">!EOP</span>
<a name="l00722"></a>00722 
<a name="l00723"></a>00723    <span class="keywordtype">integer(kind=int_kind)           </span>:: ni_csim, nj_csim     <span class="comment">! size of csim domain</span>
<a name="l00724"></a>00724    <span class="keywordtype">integer(kind=int_kind)           </span>:: ni_data, nj_data     <span class="comment">! size of data domain</span>
<a name="l00725"></a>00725    <span class="keywordtype">real(kind=dbl_kind)              </span>:: max_XDiff, max_YDiff <span class="comment">! max x,y grid diffs</span>
<a name="l00726"></a>00726    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">allocatable</span> :: csimXTemp(:,:)       <span class="comment">! csim grid 0 to 360</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <span class="comment">!----- formats -----</span>
<a name="l00729"></a>00729    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: F00 = <span class="stringliteral">&quot;(&apos;(ice_prescribed_checkDomain) &apos;,a)&quot;</span>
<a name="l00730"></a>00730    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: F01 = <span class="stringliteral">&quot;(&apos;(ice_prescribed_checkDomain) &apos;,a,2i6)&quot;</span>
<a name="l00731"></a>00731    <span class="keywordtype">character(*)</span>,<span class="keywordtype">parameter</span> :: F02 = <span class="stringliteral">&quot;(&apos;(ice_prescribed_checkDomain) &apos;,a,g20.13)&quot;</span>
<a name="l00732"></a>00732 
<a name="l00733"></a>00733    regrid = .false.
<a name="l00734"></a>00734    <span class="comment">!------------------------------------------------------------------------</span>
<a name="l00735"></a>00735    <span class="comment">! Check domain size</span>
<a name="l00736"></a>00736    <span class="comment">!------------------------------------------------------------------------</span>
<a name="l00737"></a>00737    ni_csim = <span class="keyword">size</span>(csimXCoord,1)
<a name="l00738"></a>00738    nj_csim = <span class="keyword">size</span>(csimXCoord,2)
<a name="l00739"></a>00739    ni_data = <span class="keyword">size</span>(dataXCoord,1)
<a name="l00740"></a>00740    nj_data = <span class="keyword">size</span>(dataXCoord,2)
<a name="l00741"></a>00741 
<a name="l00742"></a>00742    <span class="comment">!------------------------------------------------------------------------</span>
<a name="l00743"></a>00743    <span class="comment">! Convert T grid longitude from -180 -&gt; 180 to 0 to 360</span>
<a name="l00744"></a>00744    <span class="comment">!------------------------------------------------------------------------</span>
<a name="l00745"></a>00745    <span class="keyword">allocate</span>(csimXTemp(ni_csim,nj_csim)) 
<a name="l00746"></a>00746    csimXTemp = csimXCoord
<a name="l00747"></a>00747    <span class="keyword">where</span> (csimXTemp &gt;= <a class="code" href="namespaceice__constants.html#a36d55ec278e51e0964603b90df1aa54c">c360</a>) csimXTemp = csimXTemp - <a class="code" href="namespaceice__constants.html#a36d55ec278e51e0964603b90df1aa54c">c360</a>
<a name="l00748"></a>00748    <span class="keyword">where</span> (csimXTemp &lt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a> )   csimXTemp = csimXTemp + <a class="code" href="namespaceice__constants.html#a36d55ec278e51e0964603b90df1aa54c">c360</a>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750    <span class="keyword">if</span> (ni_data == ni_csim .and. nj_data == nj_csim) <span class="keyword">then</span>
<a name="l00751"></a>00751       max_XDiff = maxval(abs(csimXTemp  - dataXCoord))
<a name="l00752"></a>00752       max_YDiff = maxval(abs(csimYCoord - dataYCoord))
<a name="l00753"></a>00753       <span class="keyword">if</span> (max_XDiff &gt; <a class="code" href="namespaceice__constants.html#a05332a868b891940e57c06ddeab5963a">eps04</a>) regrid = .true.
<a name="l00754"></a>00754       <span class="keyword">if</span> (max_YDiff &gt; <a class="code" href="namespaceice__constants.html#a05332a868b891940e57c06ddeab5963a">eps04</a>) regrid = .true.
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&apos;Maximum X difference = &apos;</span>, max_XDiff
<a name="l00757"></a>00757       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F02) <span class="stringliteral">&apos;Maximum Y difference = &apos;</span>, max_YDiff
<a name="l00758"></a>00758       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F00) <span class="stringliteral">&apos;CSIM and input data domain sizes match&apos;</span>
<a name="l00759"></a>00759       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F01) <span class="stringliteral">&apos;CSIM and data grids are&apos;</span>, ni_csim,nj_csim
<a name="l00760"></a>00760    <span class="keyword">else</span>
<a name="l00761"></a>00761       regrid = .true.
<a name="l00762"></a>00762    <span class="keyword">end if</span>
<a name="l00763"></a>00763    <span class="keyword">deallocate</span>(csimXTemp) 
<a name="l00764"></a>00764 
<a name="l00765"></a>00765    <span class="keyword">if</span> (regrid) <span class="keyword">then</span>
<a name="l00766"></a>00766       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F00) <span class="stringliteral">&apos;Ice concentration will be interpolated to CSIM grid&apos;</span>
<a name="l00767"></a>00767    <span class="keyword">else</span>
<a name="l00768"></a>00768       <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,F00) <span class="stringliteral">&apos;Ice concentration grid and CSIM grid the same&apos;</span>
<a name="l00769"></a>00769    <span class="keyword">end if</span>
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="keyword">end subroutine ice_prescribed_checkDomain</span>
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 <span class="comment">!===============================================================================</span>
<a name="l00774"></a>00774 <span class="comment">!BOP ===========================================================================</span>
<a name="l00775"></a>00775 <span class="comment">!</span>
<a name="l00776"></a>00776 <span class="comment">! !IROUTINE: ice_prescribed_phys -- set prescribed ice state and fluxes</span>
<a name="l00777"></a>00777 <span class="comment">!</span>
<a name="l00778"></a>00778 <span class="comment">! !DESCRIPTION:</span>
<a name="l00779"></a>00779 <span class="comment">!</span>
<a name="l00780"></a>00780 <span class="comment">! Set prescribed ice state using input ice concentration;</span>
<a name="l00781"></a>00781 <span class="comment">! set surface ice temperature to atmospheric value; use</span>
<a name="l00782"></a>00782 <span class="comment">! linear temperature gradient in ice to ocean temperature.</span>
<a name="l00783"></a>00783 <span class="comment">!</span>
<a name="l00784"></a>00784 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00785"></a>00785 <span class="comment">!     2005-May-23 - J. Schramm - Updated with data models</span>
<a name="l00786"></a>00786 <span class="comment">!     2004-July   - J. Schramm - Modified to allow variable snow cover</span>
<a name="l00787"></a>00787 <span class="comment">!     2001-May    - B. P. Briegleb - Original version</span>
<a name="l00788"></a>00788 <span class="comment">!</span>
<a name="l00789"></a>00789 <span class="comment">! !INTERFACE: ------------------------------------------------------------------</span>
<a name="l00790"></a>00790  
<a name="l00791"></a><a class="code" href="namespaceice__prescribed__mod.html#a9e6ac38b742040541c97492d74282b7a">00791</a> <span class="keyword">subroutine </span><a class="code" href="namespaceice__prescribed__mod.html#a9e6ac38b742040541c97492d74282b7a">ice_prescribed_phys</a>
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 <span class="comment">! !USES:</span>
<a name="l00794"></a>00794  
<a name="l00795"></a>00795    use <span class="keywordflow">ice_flux</span>
<a name="l00796"></a>00796 <span class="comment">!  use ice_grid, only : bound</span>
<a name="l00797"></a>00797    use <span class="keywordflow">ice_state</span>
<a name="l00798"></a>00798    use <span class="keywordflow">ice_itd</span>, only  : aggregate
<a name="l00799"></a>00799    use <span class="keywordflow">ice_dyn_evp</span>
<a name="l00800"></a>00800 
<a name="l00801"></a>00801    <span class="keyword">implicit none</span>
<a name="l00802"></a>00802  
<a name="l00803"></a>00803 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00804"></a>00804  
<a name="l00805"></a>00805 <span class="comment">!EOP</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807    <span class="comment">!----- Local ------</span>
<a name="l00808"></a>00808    <span class="keywordtype">integer(kind=int_kind) </span>:: layer    <span class="comment">! level index</span>
<a name="l00809"></a>00809    <span class="keywordtype">integer(kind=int_kind) </span>:: nc       <span class="comment">! ice category index</span>
<a name="l00810"></a>00810    <span class="keywordtype">integer(kind=int_kind) </span>:: i,j,k    <span class="comment">! longitude, latitude and level indices</span>
<a name="l00811"></a>00811    <span class="keywordtype">integer(kind=int_kind) </span>:: iblk
<a name="l00812"></a>00812 
<a name="l00813"></a>00813    <span class="keywordtype">real(kind=dbl_kind) </span>:: slope     <span class="comment">! diff in underlying ocean tmp and ice surface tmp</span>
<a name="l00814"></a>00814    <span class="keywordtype">real(kind=dbl_kind) </span>:: Ti        <span class="comment">! ice level temperature</span>
<a name="l00815"></a>00815    <span class="keywordtype">real(kind=dbl_kind) </span>:: Tmlt      <span class="comment">! ice level melt temperature</span>
<a name="l00816"></a>00816    <span class="keywordtype">real(kind=dbl_kind) </span>:: qin_save(nilyr) 
<a name="l00817"></a>00817    <span class="keywordtype">real(kind=dbl_kind) </span>:: qsn_save(nslyr)
<a name="l00818"></a>00818    <span class="keywordtype">real(kind=dbl_kind) </span>:: hi        <span class="comment">! ice prescribed (hemispheric) ice thickness</span>
<a name="l00819"></a>00819    <span class="keywordtype">real(kind=dbl_kind) </span>:: hs        <span class="comment">! snow thickness</span>
<a name="l00820"></a>00820    <span class="keywordtype">real(kind=dbl_kind) </span>:: zn        <span class="comment">! normalized ice thickness</span>
<a name="l00821"></a>00821    <span class="keywordtype">real(kind=dbl_kind) </span>:: salin(nilyr)  <span class="comment">! salinity (ppt) </span>
<a name="l00822"></a>00822 
<a name="l00823"></a>00823    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> :: nsal    = 0.407_dbl_kind
<a name="l00824"></a>00824    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> :: msal    = 0.573_dbl_kind
<a name="l00825"></a>00825    <span class="keywordtype">real(kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> :: saltmax = 3.2_dbl_kind   <span class="comment">! max salinity at ice base (ppm)</span>
<a name="l00826"></a>00826 
<a name="l00827"></a>00827    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00828"></a>00828    <span class="comment">! Initialize ice state</span>
<a name="l00829"></a>00829    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00830"></a>00830 
<a name="l00831"></a>00831 <span class="comment">!  aicen(:,:,:,:) = c0</span>
<a name="l00832"></a>00832 <span class="comment">!  vicen(:,:,:,:) = c0</span>
<a name="l00833"></a>00833 <span class="comment">!  eicen(:,:,:,:) = c0</span>
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 <span class="comment">!  do nc=1,ncat</span>
<a name="l00836"></a>00836 <span class="comment">!     trcrn(:,:,nt_Tsfc,nc,:) = Tf(:,:,:)</span>
<a name="l00837"></a>00837 <span class="comment">!  enddo</span>
<a name="l00838"></a>00838 
<a name="l00839"></a>00839    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00840"></a>00840    <span class="comment">! Set ice cover over land to zero, not sure if this should be</span>
<a name="l00841"></a>00841    <span class="comment">! be done earier, before time/spatial interp??????</span>
<a name="l00842"></a>00842    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00843"></a>00843    <span class="keyword">do</span> iblk = 1,<a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00844"></a>00844    <span class="keyword">do</span> j = 1,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00845"></a>00845    <span class="keyword">do</span> i = 1,<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00846"></a>00846       <span class="keyword">if</span> (<a class="code" href="namespaceice__grid.html#a5de6731a3b8601be3495a4c306832bf0">tmask</a>(i,j,iblk)) <span class="keyword">then</span>
<a name="l00847"></a>00847          <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) .lt. <a class="code" href="namespaceice__constants.html#a05332a868b891940e57c06ddeab5963a">eps04</a>) <a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00848"></a>00848          <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) .gt. <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>)    <a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) = <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>
<a name="l00849"></a>00849       <span class="keyword">else</span>
<a name="l00850"></a>00850          <a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00851"></a>00851       <span class="keyword">end if</span>
<a name="l00852"></a>00852    <span class="keyword">enddo</span>
<a name="l00853"></a>00853    <span class="keyword">enddo</span>
<a name="l00854"></a>00854    <span class="keyword">enddo</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856    <span class="keyword">do</span> iblk = 1,<a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00857"></a>00857    <span class="keyword">do</span> j = 1,<a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00858"></a>00858    <span class="keyword">do</span> i = 1,<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00859"></a>00859 
<a name="l00860"></a>00860       <span class="keyword">if</span> (<a class="code" href="namespaceice__grid.html#a5de6731a3b8601be3495a4c306832bf0">tmask</a>(i,j,iblk)) <span class="keyword">then</span>   <span class="comment">! Over ocean points</span>
<a name="l00861"></a>00861 
<a name="l00862"></a>00862          <span class="comment">!--------------------------------------------------------------</span>
<a name="l00863"></a>00863          <span class="comment">! Place ice where ice concentration &gt; .0001</span>
<a name="l00864"></a>00864          <span class="comment">!--------------------------------------------------------------</span>
<a name="l00865"></a>00865          <span class="keyword">if</span> (<a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk) &gt;= <a class="code" href="namespaceice__constants.html#a05332a868b891940e57c06ddeab5963a">eps04</a>) <span class="keyword">then</span>
<a name="l00866"></a>00866 
<a name="l00867"></a>00867             hi = 0.0_dbl_kind
<a name="l00868"></a>00868             <span class="comment">!----------------------------------------------------------</span>
<a name="l00869"></a>00869             <span class="comment">! Set ice thickness in each hemisphere</span>
<a name="l00870"></a>00870             <span class="comment">!----------------------------------------------------------</span>
<a name="l00871"></a>00871             <span class="keyword">if</span>(<a class="code" href="namespaceice__grid.html#a76fff4cfe2a27c44abe9fd445f806f25">TLAT</a>(i,j,iblk)*<a class="code" href="namespaceice__constants.html#a499282766889f13defe6ffd6c7aa1216">rad_to_deg</a> &gt; 40.0_dbl_kind) <span class="keyword">then</span>
<a name="l00872"></a>00872               hi  = 2.0_dbl_kind
<a name="l00873"></a>00873             <span class="keyword">else</span> <span class="keyword">if</span>(<a class="code" href="namespaceice__grid.html#a76fff4cfe2a27c44abe9fd445f806f25">TLAT</a>(i,j,iblk)*<a class="code" href="namespaceice__constants.html#a499282766889f13defe6ffd6c7aa1216">rad_to_deg</a> &lt; -40.0_dbl_kind) <span class="keyword">then</span>
<a name="l00874"></a>00874               hi  = 1.0_dbl_kind
<a name="l00875"></a>00875             <span class="keyword">end if</span>
<a name="l00876"></a>00876 
<a name="l00877"></a>00877             <span class="comment">!----------------------------------------------------------</span>
<a name="l00878"></a>00878             <span class="comment">! All ice in appropriate thickness category</span>
<a name="l00879"></a>00879             <span class="comment">!----------------------------------------------------------</span>
<a name="l00880"></a>00880             <span class="keyword">do</span> nc = 1,<a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00881"></a>00881 
<a name="l00882"></a>00882               <span class="keyword">if</span>(hin_max(nc-1) &lt; hi .and. hi &lt; hin_max(nc)) <span class="keyword">then</span>
<a name="l00883"></a>00883 
<a name="l00884"></a>00884                   <span class="keyword">if</span> (<a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(i,j,nc,iblk) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l00885"></a>00885                      hs = <a class="code" href="namespaceice__state.html#acd313a058964928092cbc75f7689cef5">vsnon</a>(i,j,nc,iblk) / <a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(i,j,nc,iblk)
<a name="l00886"></a>00886                   <span class="keyword">else</span>
<a name="l00887"></a>00887                      hs = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00888"></a>00888                   <span class="keyword">endif</span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890                   qin_save(:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00891"></a>00891                   qsn_save(:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00892"></a>00892 
<a name="l00893"></a>00893                   <span class="keyword">if</span> (<a class="code" href="namespaceice__state.html#aa85616e03769af4afb0166070aa7cc8f">vicen</a>(i,j,nc,iblk) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l00894"></a>00894                      <span class="keyword">do</span> k=1,nilyr
<a name="l00895"></a>00895                         qin_save(k) = <a class="code" href="namespaceice__state.html#ae98b075caabb73fcd86ce51eb76849b4">eicen</a>(i,j,ilyr1(nc)+k-1,iblk)         &amp;
<a name="l00896"></a>00896                                     * <span class="keywordtype">real(nilyr,kind=dbl_kind)            </span> 
<a name="l00897"></a>00897                                     / vicen(i,j,nc,iblk)
<a name="l00898"></a>00898                      <span class="keyword">enddo</span>
<a name="l00899"></a>00899                   <span class="keyword">endif</span>
<a name="l00900"></a>00900 
<a name="l00901"></a>00901                   <span class="keyword">if</span> (<a class="code" href="namespaceice__state.html#acd313a058964928092cbc75f7689cef5">vsnon</a>(i,j,nc,iblk) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l00902"></a>00902                      <span class="keyword">do</span> k=1,nslyr
<a name="l00903"></a>00903                         qsn_save(k) = <a class="code" href="namespaceice__state.html#aeb23ce1b6f981d016e447371d318a10c">esnon</a>(i,j,slyr1(nc)+k-1,iblk)         &amp;
<a name="l00904"></a>00904                                     * <span class="keywordtype">real(nslyr,kind=dbl_kind)            </span> 
<a name="l00905"></a>00905                                     / vsnon(i,j,nc,iblk)
<a name="l00906"></a>00906                      <span class="keyword">enddo</span>
<a name="l00907"></a>00907                   <span class="keyword">endif</span>
<a name="l00908"></a>00908 
<a name="l00909"></a>00909                   <a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(i,j,nc,iblk) = <a class="code" href="namespaceice__prescribed__mod.html#ad870001a33c2597b961fde76bceca0b6">ice_cov</a>(i,j,iblk)
<a name="l00910"></a>00910                   vicen(i,j,nc,iblk) = hi*<a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(i,j,nc,iblk) 
<a name="l00911"></a>00911                   vsnon(i,j,nc,iblk) = hs*<a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(i,j,nc,iblk) 
<a name="l00912"></a>00912 
<a name="l00913"></a>00913                   <span class="comment">! remember enthalpy profile to compute energy</span>
<a name="l00914"></a>00914                   <span class="keyword">do</span> k=1,nilyr
<a name="l00915"></a>00915                      <a class="code" href="namespaceice__state.html#ae98b075caabb73fcd86ce51eb76849b4">eicen</a>(i,j,ilyr1(nc)+k-1,iblk)                          &amp;
<a name="l00916"></a>00916                         = qin_save(k) * vicen(i,j,nc,iblk)                  &amp;
<a name="l00917"></a>00917                         / <span class="keywordtype">real</span>(nilyr,kind=dbl_kind)
<a name="l00918"></a>00918                   <span class="keyword">enddo</span>
<a name="l00919"></a>00919 
<a name="l00920"></a>00920                   <span class="keyword">do</span> k=1,nslyr
<a name="l00921"></a>00921                      <a class="code" href="namespaceice__state.html#aeb23ce1b6f981d016e447371d318a10c">esnon</a>(i,j,slyr1(nc)+k-1,iblk)                          &amp;
<a name="l00922"></a>00922                         = qsn_save(k) * vsnon(i,j,nc,iblk)                  &amp;
<a name="l00923"></a>00923                         / <span class="keywordtype">real</span>(nslyr,kind=dbl_kind)
<a name="l00924"></a>00924                   <span class="keyword">enddo</span>
<a name="l00925"></a>00925 
<a name="l00926"></a>00926                   <span class="comment">!---------------------------------------------------------</span>
<a name="l00927"></a>00927                   <span class="comment">! make linear temp profile and compute enthalpy</span>
<a name="l00928"></a>00928                   <span class="comment">!---------------------------------------------------------</span>
<a name="l00929"></a>00929 
<a name="l00930"></a>00930                   <span class="keyword">if</span> (abs(<a class="code" href="namespaceice__state.html#ae98b075caabb73fcd86ce51eb76849b4">eicen</a>(i,j,ilyr1(nc),iblk)) &lt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932                   <span class="keyword">if</span> (<a class="code" href="namespaceice__state.html#a91eaa8dd8287c9640310a0aec0a85df8">aice</a>(i,j,iblk) &lt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) &amp;
<a name="l00933"></a>00933                      <a class="code" href="namespaceice__state.html#a52d1c7e6719d1a295a7e5fab8b867dd1">trcrn</a>(i,j,<a class="code" href="namespaceice__state.html#a40b462400c0ddbc648e6aa0dd6a417b7">nt_Tsfc</a>,nc,iblk) = <a class="code" href="namespaceice__flux.html#a3facf6772fad8bd7af98c69cd56db10c">Tf</a>(i,j,iblk)
<a name="l00934"></a>00934 
<a name="l00935"></a>00935                   slope = <a class="code" href="namespaceice__flux.html#a3facf6772fad8bd7af98c69cd56db10c">Tf</a>(i,j,iblk) - <a class="code" href="namespaceice__state.html#a52d1c7e6719d1a295a7e5fab8b867dd1">trcrn</a>(i,j,<a class="code" href="namespaceice__state.html#a40b462400c0ddbc648e6aa0dd6a417b7">nt_Tsfc</a>,nc,iblk)
<a name="l00936"></a>00936                   <span class="keyword">do</span> k = 1, nilyr
<a name="l00937"></a>00937                      zn = (<span class="keywordtype">real</span>(k,kind=dbl_kind)-p5) / <span class="keywordtype">real</span>(nilyr,kind=dbl_kind)
<a name="l00938"></a>00938                      Ti = <a class="code" href="namespaceice__state.html#a52d1c7e6719d1a295a7e5fab8b867dd1">trcrn</a>(i,j,<a class="code" href="namespaceice__state.html#a40b462400c0ddbc648e6aa0dd6a417b7">nt_Tsfc</a>,nc,iblk) + slope*zn
<a name="l00939"></a>00939                      salin(k) = (saltmax/<a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>)*(<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-cos(<a class="code" href="namespaceice__constants.html#ab88fe0d16ebc9529ef11d6fe4343c387">pi</a>*zn**(nsal/(msal+zn))))
<a name="l00940"></a>00940                      Tmlt = -salin(k)*depressT
<a name="l00941"></a>00941                      <a class="code" href="namespaceice__state.html#ae98b075caabb73fcd86ce51eb76849b4">eicen</a>(i,j,ilyr1(nc)+k-1,iblk) =                        &amp;
<a name="l00942"></a>00942                        -(<a class="code" href="namespaceice__constants.html#ab8aa44724cb8c314b55a09244600f68d">rhoi</a> * (cp_ice*(Tmlt-Ti) &amp;
<a name="l00943"></a>00943                        + Lfresh*(<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-Tmlt/Ti) - cp_ocn*Tmlt)) &amp;
<a name="l00944"></a>00944                        * vicen(i,j,nc,iblk)/<span class="keywordtype">real</span>(nilyr,kind=dbl_kind)
<a name="l00945"></a>00945                   <span class="keyword">enddo</span>
<a name="l00946"></a>00946 
<a name="l00947"></a>00947                   <span class="keyword">do</span> k=1,nslyr
<a name="l00948"></a>00948                      <a class="code" href="namespaceice__state.html#aeb23ce1b6f981d016e447371d318a10c">esnon</a>(i,j,slyr1(nc)+k-1,iblk) =                       &amp;
<a name="l00949"></a>00949                         -<a class="code" href="namespaceice__constants.html#ae2404a45dc46ecdb371055dd52dcfe1f">rhos</a>*(Lfresh - cp_ice*<a class="code" href="namespaceice__state.html#a52d1c7e6719d1a295a7e5fab8b867dd1">trcrn</a>(i,j,<a class="code" href="namespaceice__state.html#a40b462400c0ddbc648e6aa0dd6a417b7">nt_Tsfc</a>,nc,iblk)) &amp;
<a name="l00950"></a>00950                          *vsnon(i,j,nc,iblk)
<a name="l00951"></a>00951                   <span class="keyword">enddo</span>
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                   <span class="keyword">endif</span>  <span class="comment">! aice &lt; puny</span>
<a name="l00954"></a>00954                <span class="keyword">end if</span>    <span class="comment">! hin_max</span>
<a name="l00955"></a>00955             <span class="keyword">enddo</span>        <span class="comment">! ncat</span>
<a name="l00956"></a>00956          <span class="keyword">else</span>
<a name="l00957"></a>00957             <a class="code" href="namespaceice__state.html#a52d1c7e6719d1a295a7e5fab8b867dd1">trcrn</a>(i,j,<a class="code" href="namespaceice__state.html#a40b462400c0ddbc648e6aa0dd6a417b7">nt_Tsfc</a>,:,iblk) = <a class="code" href="namespaceice__flux.html#a3facf6772fad8bd7af98c69cd56db10c">Tf</a>(i,j,iblk)
<a name="l00958"></a>00958             <a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(i,j,:,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00959"></a>00959             vicen(i,j,:,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00960"></a>00960             vsnon(i,j,:,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00961"></a>00961             <a class="code" href="namespaceice__state.html#aeb23ce1b6f981d016e447371d318a10c">esnon</a>(i,j,:,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00962"></a>00962             <a class="code" href="namespaceice__state.html#ae98b075caabb73fcd86ce51eb76849b4">eicen</a>(i,j,:,iblk) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00963"></a>00963          <span class="keyword">end if</span>          <span class="comment">! ice_cov &gt;= eps04</span>
<a name="l00964"></a>00964       <span class="keyword">end if</span>             <span class="comment">! tmask</span>
<a name="l00965"></a>00965    <span class="keyword">enddo</span>                 <span class="comment">! i</span>
<a name="l00966"></a>00966    <span class="keyword">enddo</span>                 <span class="comment">! j</span>
<a name="l00967"></a>00967 
<a name="l00968"></a>00968    <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00969"></a>00969    <span class="comment">! compute aggregate ice state and open water area</span>
<a name="l00970"></a>00970    <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00971"></a>00971    call <a class="code" href="namespaceice__itd.html#a8360ff94dd398d403890bfe9e8030b51">aggregate </a>(<a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>, <a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>, &amp;
<a name="l00972"></a>00972       &amp;            <a class="code" href="namespaceice__state.html#a38df7a3870d9a3a425b31808503ba98e">aicen</a>(:,:,:,iblk),  <a class="code" href="namespaceice__state.html#a52d1c7e6719d1a295a7e5fab8b867dd1">trcrn</a>(:,:,:,:,iblk), &amp;
<a name="l00973"></a>00973       &amp;            vicen(:,:,:,iblk),  vsnon(:,:,:,iblk), &amp;
<a name="l00974"></a>00974       &amp;            <a class="code" href="namespaceice__state.html#ae98b075caabb73fcd86ce51eb76849b4">eicen</a>(:,:,:,iblk),  <a class="code" href="namespaceice__state.html#aeb23ce1b6f981d016e447371d318a10c">esnon</a>(:,:,:,iblk), &amp;
<a name="l00975"></a>00975       &amp;            <a class="code" href="namespaceice__state.html#a91eaa8dd8287c9640310a0aec0a85df8">aice</a>(:,:,iblk),     <a class="code" href="namespaceice__state.html#ad9117b5d7f02ca8a6a10db8afa75a6ef">trcr</a>(:,:,:,iblk), &amp;
<a name="l00976"></a>00976       &amp;            <a class="code" href="namespaceice__state.html#a097435b3544c01705ca626cc43ee61b5">vice</a>(:,:,iblk),     <a class="code" href="namespaceice__state.html#ac2427022070069eb40ad5d21ad7a684e">vsno</a>(:,:,iblk), &amp;
<a name="l00977"></a>00977       &amp;            <a class="code" href="namespaceice__state.html#aa30edd78b7a6855c7bfabf428b93f355">eice</a>(:,:,iblk),     <a class="code" href="namespaceice__state.html#af4c38f6f98fdc5516cde3066120a0074">esno</a>(:,:,iblk), &amp;
<a name="l00978"></a>00978       &amp;            <a class="code" href="namespaceice__state.html#aabb208bcf122d73e3975ab376d190703">aice0</a>(:,:,iblk), &amp;
<a name="l00979"></a>00979       &amp;            <a class="code" href="namespaceice__grid.html#a5de6731a3b8601be3495a4c306832bf0">tmask</a>(:,:,iblk),    <a class="code" href="namespaceice__state.html#a1690af0ac3de6ba93723f9eeab0dfe3f">trcr_depend</a>) 
<a name="l00980"></a>00980 
<a name="l00981"></a>00981    <span class="keyword">enddo</span>                 <span class="comment">! iblk</span>
<a name="l00982"></a>00982 
<a name="l00983"></a>00983    <span class="keyword">do</span> iblk = 1, <a class="code" href="namespaceice__domain.html#aae3d2de717ee7a743c9635b3a9e35a95">nblocks</a>
<a name="l00984"></a>00984    <span class="keyword">do</span> j = 1, <a class="code" href="namespaceice__blocks.html#a9ad40e7eeb19aeb81a3010e0dd997c43">ny_block</a>
<a name="l00985"></a>00985      <span class="keyword">do</span> i = 1, <a class="code" href="namespaceice__blocks.html#a130f3f9b102e86de209ee25eb36e44ba">nx_block</a>
<a name="l00986"></a>00986        <a class="code" href="namespaceice__state.html#a02c92db0074e9bcdb95221ca85472f20">aice_init</a>(i,j,iblk) = <a class="code" href="namespaceice__state.html#a91eaa8dd8287c9640310a0aec0a85df8">aice</a>(i,j,iblk)
<a name="l00987"></a>00987      <span class="keyword">enddo</span>
<a name="l00988"></a>00988    <span class="keyword">enddo</span>
<a name="l00989"></a>00989    <span class="keyword">enddo</span>
<a name="l00990"></a>00990 
<a name="l00991"></a>00991    <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00992"></a>00992    <span class="comment">! set non-computed fluxes, ice velocities, ice-ocn stresses to zero</span>
<a name="l00993"></a>00993    <span class="comment">!--------------------------------------------------------------------</span>
<a name="l00994"></a>00994 
<a name="l00995"></a>00995    <a class="code" href="namespaceice__flux.html#af09eb2a499606f27cd8ba847a999df71">frzmlt    </a>(:,:,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00996"></a>00996    <a class="code" href="namespaceice__state.html#a74f862ad20a4ee9051006a6db77c4bc5">uvel      </a>(:,:,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00997"></a>00997    <a class="code" href="namespaceice__state.html#ae19e42c4089f6a3a8426fb5847cf748e">vvel      </a>(:,:,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00998"></a>00998    strocnxT  (:,:,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00999"></a>00999    strocnyT  (:,:,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01000"></a>01000 
<a name="l01001"></a>01001    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01002"></a>01002    <span class="comment">! other atm and ocn fluxes</span>
<a name="l01003"></a>01003    <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01004"></a>01004    call <a class="code" href="namespaceice__flux.html#aa03a1e25e4227bda9639c5a178891acd">init_flux_atm</a>
<a name="l01005"></a>01005    call <a class="code" href="namespaceice__flux.html#a985af4afe9ebb697857f3f5eaf714545">init_flux_ocn</a>
<a name="l01006"></a>01006 
<a name="l01007"></a>01007 <span class="keyword">end subroutine ice_prescribed_phys</span>
<a name="l01008"></a>01008 
<a name="l01009"></a>01009 <span class="comment">!==============================================================================</span>
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 <span class="keyword">end module ice_prescribed_mod</span>
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 <span class="comment">!==============================================================================</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Oct 6 14:02:24 2009 for CICE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
