<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CICE: ice_mechred.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Types&nbsp;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>ice_mechred.F90</h1><a href="ice__mechred_8F90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!=======================================================================</span>
<a name="l00002"></a>00002 <span class="comment">!BOP</span>
<a name="l00003"></a>00003 <span class="comment">!</span>
<a name="l00004"></a>00004 <span class="comment">! !MODULE: ice_mechred - driver for mechanical redestribution</span>
<a name="l00005"></a>00005 <span class="comment">!</span>
<a name="l00006"></a>00006 <span class="comment">! !DESCRIPTION:</span>
<a name="l00007"></a>00007 <span class="comment">!</span>
<a name="l00008"></a>00008 <span class="comment">! Driver for ice mechanical redistribution (ridging)</span>
<a name="l00009"></a>00009 <span class="comment">!</span>
<a name="l00010"></a>00010 <span class="comment">! See these references:</span>
<a name="l00011"></a>00011 <span class="comment">!</span>
<a name="l00012"></a>00012 <span class="comment">! Flato, G. M., and W. D. Hibler III, 1995: Ridging and strength</span>
<a name="l00013"></a>00013 <span class="comment">!  in modeling the thickness distribution of Arctic sea ice,</span>
<a name="l00014"></a>00014 <span class="comment">!  J. Geophys. Res., 100, 18,611-18,626.</span>
<a name="l00015"></a>00015 <span class="comment">!</span>
<a name="l00016"></a>00016 <span class="comment">! Hibler, W. D. III, 1980: Modeling a variable thickness sea ice</span>
<a name="l00017"></a>00017 <span class="comment">!  cover, Mon. Wea. Rev., 108, 1943-1973, 1980.</span>
<a name="l00018"></a>00018 <span class="comment">!</span>
<a name="l00019"></a>00019 <span class="comment">! Lipscomb, W. H., E. C. Hunke, W. Maslowski, and J. Jakacki, 2006: </span>
<a name="l00020"></a>00020 <span class="comment">!  Ridging, strength, and stability in sea ice models, submitted </span>
<a name="l00021"></a>00021 <span class="comment">!  to J. Geophys. Res. </span>
<a name="l00022"></a>00022 <span class="comment">! </span>
<a name="l00023"></a>00023 <span class="comment">! Rothrock, D. A., 1975: The energetics of the plastic deformation of</span>
<a name="l00024"></a>00024 <span class="comment">!  pack ice by ridging, J. Geophys. Res., 80, 4514-4519.</span>
<a name="l00025"></a>00025 <span class="comment">!</span>
<a name="l00026"></a>00026 <span class="comment">! Thorndike, A. S., D. A. Rothrock, G. A. Maykut, and R. Colony, </span>
<a name="l00027"></a>00027 <span class="comment">!  1975: The thickness distribution of sea ice, J. Geophys. Res., </span>
<a name="l00028"></a>00028 <span class="comment">!  80, 4501-4513. </span>
<a name="l00029"></a>00029 <span class="comment">!</span>
<a name="l00030"></a>00030 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00031"></a>00031 <span class="comment">!  SVN:$Id: ice_mechred.F90 53 2007-02-08 00:02:16Z dbailey $</span>
<a name="l00032"></a>00032 <span class="comment">!</span>
<a name="l00033"></a>00033 <span class="comment">! authors: William H. Lipscomb, LANL</span>
<a name="l00034"></a>00034 <span class="comment">!          Elizabeth C. Hunke, LANL</span>
<a name="l00035"></a>00035 <span class="comment">!</span>
<a name="l00036"></a>00036 <span class="comment">! 2003: Vectorized by Clifford Chen (Fujitsu) and William Lipscomb</span>
<a name="l00037"></a>00037 <span class="comment">! 2004: Block structure added by William Lipscomb</span>
<a name="l00038"></a>00038 <span class="comment">! 2006: New options for participation and redistribution (WHL)</span>
<a name="l00039"></a>00039 <span class="comment">! 2006: Streamlined for efficiency by Elizabeth Hunke</span>
<a name="l00040"></a>00040 <span class="comment">!       Converted to free source form (F90)</span>
<a name="l00041"></a>00041 <span class="comment">!</span>
<a name="l00042"></a>00042 <span class="comment">! !INTERFACE:</span>
<a name="l00043"></a>00043 <span class="comment">!</span>
<a name="l00044"></a><a class="code" href="namespaceice__mechred.html">00044</a>       <span class="keyword">module</span> ice_mechred
<a name="l00045"></a>00045 <span class="comment">!</span>
<a name="l00046"></a>00046 <span class="comment">! !USES:</span>
<a name="l00047"></a>00047 <span class="comment">!</span>
<a name="l00048"></a>00048       use <span class="keywordflow">ice_kinds_mod</span>
<a name="l00049"></a>00049       use <span class="keywordflow">ice_domain_size</span>
<a name="l00050"></a>00050       use <span class="keywordflow">ice_constants</span>
<a name="l00051"></a>00051       use <span class="keywordflow">ice_fileunits</span>
<a name="l00052"></a>00052       use <span class="keywordflow">ice_itd</span>, only: hin_max, ilyr1, slyr1, column_sum, &amp;
<a name="l00053"></a>00053                          column_conservation_check, compute_tracers
<a name="l00054"></a>00054 <span class="comment">!</span>
<a name="l00055"></a>00055 <span class="comment">!EOP</span>
<a name="l00056"></a>00056 <span class="comment">!</span>
<a name="l00057"></a>00057       <span class="keyword">implicit none</span>
<a name="l00058"></a>00058       <span class="keywordtype">save</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00061"></a>00061 <span class="comment">! Ridging parameters</span>
<a name="l00062"></a>00062 <span class="comment">!-----------------------------------------------------------------------</span>
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="namespaceice__mechred.html#a2272185e4ee38f92dbb9908fca1dac0a">00064</a>       <span class="keywordtype">integer (kind=int_kind) </span>::  <span class="comment">! defined in namelist </span>
<a name="l00065"></a>00065          kstrength    ,  <span class="comment">! 0 for simple Hibler (1979) formulation </span>
<a name="l00066"></a>00066                           <span class="comment">! 1 for Rothrock (1975) pressure formulation </span>
<a name="l00067"></a>00067          krdg_partic  , &amp; <span class="comment">! 0 for Thorndike et al. (1975) formulation </span>
<a name="l00068"></a>00068                           <span class="comment">! 1 for exponential participation function </span>
<a name="l00069"></a>00069          krdg_redist      <span class="comment">! 0 for Hibler (1980) formulation </span>
<a name="l00070"></a>00070                           <span class="comment">! 1 for exponential redistribution function </span>
<a name="l00071"></a>00071  
<a name="l00072"></a><a class="code" href="namespaceice__mechred.html#a85e0edec0423e8de65aaa8ddfa61d02e">00072</a>       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> ::  
<a name="l00073"></a>00073          Cf = 17._dbl_kind   ,  <span class="comment">! ratio of ridging work to PE change in ridging </span>
<a name="l00074"></a>00074          Cs = p25            ,  <span class="comment">! fraction of shear energy contrbtng to ridging </span>
<a name="l00075"></a>00075          Cp = p5*gravit*(rhow-rhoi)*rhoi/rhow,  <span class="comment">! proport const for PE </span>
<a name="l00076"></a>00076          fsnowrdg = p5       ,  <span class="comment">! snow fraction that survives in ridging </span>
<a name="l00077"></a>00077          Gstar  = p15        ,  <span class="comment">! max value of G(h) that participates </span>
<a name="l00078"></a>00078                                  <span class="comment">! (krdg_partic = 0) </span>
<a name="l00079"></a>00079          astar  = <a class="code" href="namespaceice__constants.html#aec49f3df6ec3235c6304038e8fddbe00">p05</a>        , &amp; <span class="comment">! e-folding scale for G(h) participation </span>
<a name="l00080"></a>00080                                  <span class="comment">! (krdg_partic = 1) </span>
<a name="l00081"></a>00081          maxraft= <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>         , &amp; <span class="comment">! max value of hrmin - hi = max thickness </span>
<a name="l00082"></a>00082                                  <span class="comment">! of ice that rafts (m) </span>
<a name="l00083"></a>00083          Hstar  = <a class="code" href="namespaceice__constants.html#a5db59b63c17c3ed647e3cdd61b04793c">c25</a>        , &amp; <span class="comment">! determines mean thickness of ridged ice (m) </span>
<a name="l00084"></a>00084                                  <span class="comment">! (krdg_redist = 0) </span>
<a name="l00085"></a>00085                                  <span class="comment">! Flato &amp; Hibler (1995) have Hstar = 100 </span>
<a name="l00086"></a>00086          mu_rdg = <a class="code" href="namespaceice__constants.html#a6f2f40b7da63dfa1a4f38dd0126cd848">c4</a>         , &amp; <span class="comment">! gives e-folding scale of ridged ice (m^.5) </span>
<a name="l00087"></a>00087                                  <span class="comment">! (krdg_redist = 1) </span>
<a name="l00088"></a>00088          Pstar = 2.75e4_dbl_kind, &amp; <span class="comment">! constant in Hibler strength formula </span>
<a name="l00089"></a>00089                                  <span class="comment">! (kstrength = 0) </span>
<a name="l00090"></a>00090          Cstar = <a class="code" href="namespaceice__constants.html#a19a6a387f7968c6067c1ff9c1d5f0b45">c20</a>             <span class="comment">! constant in Hibler strength formula </span>
<a name="l00091"></a>00091                                  <span class="comment">! (kstrength = 0) </span>
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="namespaceice__mechred.html#a28f8598357ef3851a6288dfdd581732d">00093</a>       <span class="keywordtype">logical (kind=log_kind)</span>, <span class="keywordtype">parameter</span> :: 
<a name="l00094"></a>00094          l_conservation_check = .true.  <span class="comment">! if true, check conservation</span>
<a name="l00095"></a>00095 <span class="comment">!         l_conservation_check = .false.  ! if true, check conservation</span>
<a name="l00096"></a>00096                                         <span class="comment">! (useful for debugging)</span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">!=======================================================================</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100       <span class="keyword">contains</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">!=======================================================================</span>
<a name="l00103"></a>00103 <span class="comment">!BOP</span>
<a name="l00104"></a>00104 <span class="comment">!</span>
<a name="l00105"></a>00105 <span class="comment">! !ROUTINE: ridge_ice - driver for mechanical redistribution</span>
<a name="l00106"></a>00106 <span class="comment">!</span>
<a name="l00107"></a>00107 <span class="comment">! !DESCRIPTION:</span>
<a name="l00108"></a>00108 <span class="comment">!</span>
<a name="l00109"></a>00109 <span class="comment">! Compute changes in the ice thickness distribution due to divergence</span>
<a name="l00110"></a>00110 <span class="comment">! and shear.</span>
<a name="l00111"></a>00111 <span class="comment">! NOTE: This subroutine operates over a single block.</span>
<a name="l00112"></a>00112 <span class="comment">!</span>
<a name="l00113"></a>00113 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00114"></a>00114 <span class="comment">!</span>
<a name="l00115"></a>00115 <span class="comment">! author: William H. Lipscomb, LANL</span>
<a name="l00116"></a>00116 <span class="comment">!</span>
<a name="l00117"></a>00117 <span class="comment">! !INTERFACE:</span>
<a name="l00118"></a>00118 <span class="comment">!</span>
<a name="l00119"></a><a class="code" href="namespaceice__mechred.html#a22ae992e7f20fe021992af92a29f81e1">00119</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#a22ae992e7f20fe021992af92a29f81e1">ridge_ice</a> (nx_block,    ny_block,   &amp;
<a name="l00120"></a>00120                             dt_dyn, dt_thm, icells,  &amp;
<a name="l00121"></a>00121                             indxi,       indxj,      &amp;
<a name="l00122"></a>00122                             rdg_conv,    rdg_shear,  &amp;
<a name="l00123"></a>00123                             aicen,       trcrn,      &amp;
<a name="l00124"></a>00124                             vicen,       vsnon,      &amp;
<a name="l00125"></a>00125                             eicen,       esnon,      &amp;
<a name="l00126"></a>00126                             aice0,                   &amp;
<a name="l00127"></a>00127                             trcr_depend, l_stop,     &amp;
<a name="l00128"></a>00128                             istop,       jstop,      &amp;
<a name="l00129"></a>00129                             dardg1dt,    dardg2dt,   &amp;
<a name="l00130"></a>00130                             dvirdgdt,    opening,    &amp;
<a name="l00131"></a>00131                             fresh,       fhocn,      &amp;
<a name="l00132"></a>00132                             fsoot)
<a name="l00133"></a>00133 <span class="comment">!</span>
<a name="l00134"></a>00134 <span class="comment">! !USES:</span>
<a name="l00135"></a>00135 <span class="comment">!</span>
<a name="l00136"></a>00136 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00137"></a>00137 <span class="comment">!</span>
<a name="l00138"></a>00138       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00139"></a>00139          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l00140"></a>00140          icells                <span class="comment">! number of cells with ice present</span>
<a name="l00141"></a>00141 
<a name="l00142"></a>00142       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l00143"></a>00143          <span class="keywordtype">intent(in)</span> :: 
<a name="l00144"></a>00144          indxi, indxj     <span class="comment">! compressed indices for cells with ice</span>
<a name="l00145"></a>00145 
<a name="l00146"></a>00146       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00147"></a>00147          dt_dyn  ,  <span class="comment">! dynamic time step</span>
<a name="l00148"></a>00148          dt_thm      <span class="comment">! thermodynamic time step for diagnostics</span>
<a name="l00149"></a>00149 
<a name="l00150"></a>00150       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(nx_block,ny_block)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00151"></a>00151          rdg_conv,  <span class="comment">! normalized energy dissipation due to convergence (1/s)</span>
<a name="l00152"></a>00152          rdg_shear   <span class="comment">! normalized energy dissipation due to shear (1/s)</span>
<a name="l00153"></a>00153  
<a name="l00154"></a>00154       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ncat)</span>, 
<a name="l00155"></a>00155          <span class="keywordtype">intent(inout)</span> :: 
<a name="l00156"></a>00156          aicen ,  <span class="comment">! concentration of ice</span>
<a name="l00157"></a>00157          vicen ,  <span class="comment">! volume per unit area of ice          (m)</span>
<a name="l00158"></a>00158          vsnon     <span class="comment">! volume per unit area of snow         (m)</span>
<a name="l00159"></a>00159  
<a name="l00160"></a>00160       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ntrcr,ncat)</span>, 
<a name="l00161"></a>00161          <span class="keywordtype">intent(inout)</span> ::  
<a name="l00162"></a>00162          trcrn     <span class="comment">! ice tracers </span>
<a name="l00163"></a>00163  
<a name="l00164"></a>00164       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ntilyr)</span>, 
<a name="l00165"></a>00165          <span class="keywordtype">intent(inout)</span> ::  
<a name="l00166"></a>00166          eicen     <span class="comment">! energy of melting for each ice layer (J/m^2)</span>
<a name="l00167"></a>00167  
<a name="l00168"></a>00168       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ntslyr)</span>, 
<a name="l00169"></a>00169          <span class="keywordtype">intent(inout)</span> ::  
<a name="l00170"></a>00170          esnon     <span class="comment">! energy of melting for each snow layer (J/m^2)</span>
<a name="l00171"></a>00171 
<a name="l00172"></a>00172       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block)</span>, 
<a name="l00173"></a>00173          <span class="keywordtype">intent(inout)</span> ::  
<a name="l00174"></a>00174          aice0     <span class="comment">! concentration of open water</span>
<a name="l00175"></a>00175 
<a name="l00176"></a>00176       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension(ntrcr)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00177"></a>00177          trcr_depend
<a name="l00178"></a>00178 
<a name="l00179"></a>00179       <span class="keywordtype">logical (kind=log_kind)</span>, <span class="keywordtype">intent(out)</span> :: 
<a name="l00180"></a>00180          l_stop   <span class="comment">! if true, abort on return</span>
<a name="l00181"></a>00181 
<a name="l00182"></a>00182       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(out)</span> :: 
<a name="l00183"></a>00183          istop, jstop <span class="comment">! indices of grid cell where model aborts</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185       <span class="comment">! optional history fields</span>
<a name="l00186"></a>00186       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(nx_block,ny_block)</span>, 
<a name="l00187"></a>00187          <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: 
<a name="l00188"></a>00188          dardg1dt  ,  <span class="comment">! rate of fractional area loss by ridging ice (1/s)</span>
<a name="l00189"></a>00189          dardg2dt  ,  <span class="comment">! rate of fractional area gain by new ridges (1/s)</span>
<a name="l00190"></a>00190          dvirdgdt  ,  <span class="comment">! rate of ice volume ridged (m/s)</span>
<a name="l00191"></a>00191          opening   ,  <span class="comment">! rate of opening due to divergence/shear (1/s)</span>
<a name="l00192"></a>00192          fresh     ,  <span class="comment">! fresh water flux to ocean (kg/m^2/s)</span>
<a name="l00193"></a>00193          fhocn         <span class="comment">! net heat flux to ocean (W/m^2)</span>
<a name="l00194"></a>00194 
<a name="l00195"></a>00195       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(nx_block,ny_block,n_aeromx)</span>, 
<a name="l00196"></a>00196          <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: 
<a name="l00197"></a>00197          fsoot      <span class="comment">! </span>
<a name="l00198"></a>00198 <span class="comment">!</span>
<a name="l00199"></a>00199 <span class="comment">!EOP</span>
<a name="l00200"></a>00200 <span class="comment">!</span>
<a name="l00201"></a>00201       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells) </span>:: 
<a name="l00202"></a>00202          asum       ,  <span class="comment">! sum of ice and open water area</span>
<a name="l00203"></a>00203          aksum      ,  <span class="comment">! ratio of area removed to area ridged</span>
<a name="l00204"></a>00204          msnow_mlt  ,  <span class="comment">! mass of snow added to ocean (kg m-2)</span>
<a name="l00205"></a>00205          esnow_mlt  ,  <span class="comment">! energy needed to melt snow in ocean (J m-2)</span>
<a name="l00206"></a>00206          closing_net,  <span class="comment">! net rate at which area is removed    (1/s)</span>
<a name="l00207"></a>00207                         <span class="comment">! (ridging ice area - area of new ridges) / dt_dyn</span>
<a name="l00208"></a>00208          divu_adv   , &amp; <span class="comment">! divu as implied by transport scheme  (1/s)</span>
<a name="l00209"></a>00209          opning     , &amp; <span class="comment">! rate of opening due to divergence/shear</span>
<a name="l00210"></a>00210                         <span class="comment">! opning is a local variable;</span>
<a name="l00211"></a>00211                         <span class="comment">! opening is the history diagnostic variable</span>
<a name="l00212"></a>00212          ardg1      , &amp; <span class="comment">! fractional area loss by ridging ice</span>
<a name="l00213"></a>00213          ardg2      , &amp; <span class="comment">! fractional area gain by new ridges</span>
<a name="l00214"></a>00214          virdg      , &amp; <span class="comment">! ice volume ridged</span>
<a name="l00215"></a>00215          aopen          <span class="comment">! area opening due to divergence/shear</span>
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,n_aeromx) </span>:: 
<a name="l00218"></a>00218          msoot       <span class="comment">! mass of soot added to ocean (kg m-2)</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,0:ncat) </span>:: 
<a name="l00221"></a>00221          apartic          <span class="comment">! participation function; fraction of ridging</span>
<a name="l00222"></a>00222                           <span class="comment">! and closing associated w/ category n</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ncat) </span>:: 
<a name="l00225"></a>00225          hrmin        ,  <span class="comment">! minimum ridge thickness</span>
<a name="l00226"></a>00226          hrmax        ,  <span class="comment">! maximum ridge thickness (krdg_redist = 0)</span>
<a name="l00227"></a>00227          hrexp        ,  <span class="comment">! ridge e-folding thickness (krdg_redist = 1) </span>
<a name="l00228"></a>00228          krdg             <span class="comment">! mean ridge thickness/thickness of ridging ice</span>
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells) </span>:: 
<a name="l00231"></a>00231          vice_init, vice_final,  <span class="comment">! ice volume summed over categories</span>
<a name="l00232"></a>00232          vsno_init, vsno_final,  <span class="comment">! snow volume summed over categories</span>
<a name="l00233"></a>00233          eice_init, eice_final,  <span class="comment">! ice energy summed over layers</span>
<a name="l00234"></a>00234          esno_init, esno_final    <span class="comment">! snow energy summed over layers</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">parameter</span> :: 
<a name="l00237"></a>00237          nitermax = 20    <span class="comment">! max number of ridging iterations</span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l00240"></a>00240          i,j          ,  <span class="comment">! horizontal indices</span>
<a name="l00241"></a>00241          n            ,  <span class="comment">! thickness category index</span>
<a name="l00242"></a>00242          niter        ,  <span class="comment">! iteration counter</span>
<a name="l00243"></a>00243          ij               <span class="comment">! horizontal index, combines i and j loops</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245       <span class="keywordtype">real (kind=dbl_kind) </span>:: 
<a name="l00246"></a>00246          dti              <span class="comment">! 1 / dt_dyn or 1 / dt_thm</span>
<a name="l00247"></a>00247 
<a name="l00248"></a>00248       <span class="keywordtype">logical (kind=log_kind) </span>:: 
<a name="l00249"></a>00249          iterate_ridging,  <span class="comment">! if true, repeat the ridging</span>
<a name="l00250"></a>00250          asum_error         <span class="comment">! flag for asum .ne. 1</span>
<a name="l00251"></a>00251 
<a name="l00252"></a>00252       <span class="keywordtype">character (len=char_len) </span>:: 
<a name="l00253"></a>00253          fieldid            <span class="comment">! field identifier</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00256"></a>00256       <span class="comment">! Initialize</span>
<a name="l00257"></a>00257       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259       l_stop = .false.
<a name="l00260"></a>00260       istop = 0
<a name="l00261"></a>00261       jstop = 0
<a name="l00262"></a>00262 
<a name="l00263"></a>00263       <span class="keyword">do</span> ij = 1, icells
<a name="l00264"></a>00264          msnow_mlt(ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00265"></a>00265          esnow_mlt(ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00266"></a>00266          msoot    (ij,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00267"></a>00267          ardg1    (ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00268"></a>00268          ardg2    (ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00269"></a>00269          virdg    (ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00270"></a>00270 <span class="comment">!         aopen    (ij) = c0</span>
<a name="l00271"></a>00271       <span class="keyword">enddo</span>
<a name="l00272"></a>00272 
<a name="l00273"></a>00273       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00274"></a>00274       <span class="comment">! Compute area of ice plus open water before ridging.</span>
<a name="l00275"></a>00275       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00276"></a>00276       call <a class="code" href="namespaceice__mechred.html#a0b56099ad3d0f301b3dfaab8aba87ef4">asum_ridging </a>(nx_block, ny_block,        &amp;
<a name="l00277"></a>00277                          icells,   indxi,    indxj, &amp;
<a name="l00278"></a>00278                          aicen,    aice0,           &amp;
<a name="l00279"></a>00279                          asum)
<a name="l00280"></a>00280 
<a name="l00281"></a>00281       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00282"></a>00282       <span class="comment">! Compute the area opening and closing.</span>
<a name="l00283"></a>00283       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00284"></a>00284       call <a class="code" href="namespaceice__mechred.html#a387bb4361bc395e2cc8d9ab50ef03728">ridge_prep </a>(nx_block, ny_block,      &amp;
<a name="l00285"></a>00285                        icells,   indxi,  indxj, &amp;
<a name="l00286"></a>00286                        dt_dyn,                  &amp;
<a name="l00287"></a>00287                        rdg_conv,  rdg_shear,    &amp;
<a name="l00288"></a>00288                        asum,      closing_net,  &amp;
<a name="l00289"></a>00289                        divu_adv,  opning)
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00292"></a>00292       <span class="comment">! Compute initial values of conserved quantities. </span>
<a name="l00293"></a>00293       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295       <span class="keyword">if</span> (<a class="code" href="namespaceice__mechred.html#a28f8598357ef3851a6288dfdd581732d">l_conservation_check</a>) <span class="keyword">then</span>
<a name="l00296"></a>00296 
<a name="l00297"></a>00297          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00298"></a>00298                           icells,   indxi,   indxj, &amp;
<a name="l00299"></a>00299                           <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>,                     &amp;
<a name="l00300"></a>00300                           vicen,      vice_init)
<a name="l00301"></a>00301 
<a name="l00302"></a>00302          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00303"></a>00303                           icells,   indxi,   indxj, &amp;
<a name="l00304"></a>00304                           <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>,                     &amp;
<a name="l00305"></a>00305                           vsnon,      vsno_init)
<a name="l00306"></a>00306 
<a name="l00307"></a>00307          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00308"></a>00308                           icells,   indxi,   indxj, &amp;
<a name="l00309"></a>00309                           <a class="code" href="namespaceice__domain__size.html#a46a923e86a6a0f553260f445f9faf5c9">ntilyr</a>,                   &amp;
<a name="l00310"></a>00310                           eicen,      eice_init)
<a name="l00311"></a>00311 
<a name="l00312"></a>00312          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00313"></a>00313                           icells,   indxi,   indxj, &amp;
<a name="l00314"></a>00314                           <a class="code" href="namespaceice__domain__size.html#a2b95950726524c87034f6468ba946b2a">ntslyr</a>,                   &amp;
<a name="l00315"></a>00315                           esnon,      esno_init)
<a name="l00316"></a>00316 
<a name="l00317"></a>00317       <span class="keyword">endif</span>            
<a name="l00318"></a>00318 
<a name="l00319"></a>00319       <span class="keyword">do</span> niter = 1, nitermax
<a name="l00320"></a>00320 
<a name="l00321"></a>00321       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00322"></a>00322       <span class="comment">! Compute the thickness distribution of ridging ice</span>
<a name="l00323"></a>00323       <span class="comment">! and various quantities associated with the new ridged ice.</span>
<a name="l00324"></a>00324       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326          call <a class="code" href="namespaceice__mechred.html#aa337d7f3df7eb6c6f9e3724e2d350e0c">ridge_itd </a>(nx_block,  ny_block,        &amp;
<a name="l00327"></a>00327                          icells,    indxi,    indxj, &amp;
<a name="l00328"></a>00328                          aicen,     vicen,           &amp;
<a name="l00329"></a>00329                          aice0,                      &amp;
<a name="l00330"></a>00330                          aksum,     apartic,         &amp;
<a name="l00331"></a>00331                          hrmin,     hrmax,           &amp;
<a name="l00332"></a>00332                          hrexp,     krdg)
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00335"></a>00335       <span class="comment">! Redistribute area, volume, and energy.</span>
<a name="l00336"></a>00336       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338          call <a class="code" href="namespaceice__mechred.html#ad5b2abaa36fa52ab9a96420dbf8d48cc">ridge_shift </a>(nx_block,  ny_block,        &amp;
<a name="l00339"></a>00339                            icells,    indxi,    indxj, &amp;
<a name="l00340"></a>00340                            dt_dyn,                     &amp;
<a name="l00341"></a>00341                            aicen,     trcrn,           &amp;
<a name="l00342"></a>00342                            vicen,     vsnon,           &amp;
<a name="l00343"></a>00343                            eicen,     esnon,           &amp;
<a name="l00344"></a>00344                            aice0,     trcr_depend,     &amp;
<a name="l00345"></a>00345                            aksum,     apartic,         &amp;
<a name="l00346"></a>00346                            hrmin,     hrmax,           &amp;
<a name="l00347"></a>00347                            hrexp,     krdg,            &amp;
<a name="l00348"></a>00348                            closing_net, opning,        &amp;
<a name="l00349"></a>00349                            ardg1,     ardg2,           &amp;
<a name="l00350"></a>00350                            virdg,     aopen,           &amp;
<a name="l00351"></a>00351                            msnow_mlt, esnow_mlt,       &amp;
<a name="l00352"></a>00352                            msoot,                      &amp;
<a name="l00353"></a>00353                            l_stop,                     &amp;
<a name="l00354"></a>00354                            istop,     jstop)
<a name="l00355"></a>00355 
<a name="l00356"></a>00356          <span class="keyword">if</span> (l_stop) return
<a name="l00357"></a>00357 
<a name="l00358"></a>00358       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00359"></a>00359       <span class="comment">! Make sure the new area = 1.  If not (because the closing</span>
<a name="l00360"></a>00360       <span class="comment">! and opening rates were reduced above), prepare to ridge again</span>
<a name="l00361"></a>00361       <span class="comment">! with new rates.</span>
<a name="l00362"></a>00362       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364          call <a class="code" href="namespaceice__mechred.html#a0b56099ad3d0f301b3dfaab8aba87ef4">asum_ridging </a>(nx_block,  ny_block,      &amp;
<a name="l00365"></a>00365                             icells,    indxi,  indxj, &amp;
<a name="l00366"></a>00366                             aicen,     aice0,         &amp;
<a name="l00367"></a>00367                             asum)
<a name="l00368"></a>00368 
<a name="l00369"></a>00369          call <a class="code" href="namespaceice__mechred.html#af7cf08ba4d3da94152517c6058b2f219">ridge_check </a>(nx_block,   ny_block,        &amp;
<a name="l00370"></a>00370                            icells,     indxi,    indxj, &amp;
<a name="l00371"></a>00371                            dt_dyn,                      &amp;
<a name="l00372"></a>00372                            asum,       closing_net,     &amp;
<a name="l00373"></a>00373                            divu_adv,   opning,          &amp;
<a name="l00374"></a>00374                            iterate_ridging)
<a name="l00375"></a>00375 
<a name="l00376"></a>00376       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00377"></a>00377       <span class="comment">! If done, exit.  If not, prepare to ridge again.</span>
<a name="l00378"></a>00378       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380          <span class="keyword">if</span> (iterate_ridging) <span class="keyword">then</span>
<a name="l00381"></a>00381             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;Repeat ridging, niter =&apos;</span>, niter
<a name="l00382"></a>00382          <span class="keyword">else</span>
<a name="l00383"></a>00383             exit
<a name="l00384"></a>00384          <span class="keyword">endif</span>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386          <span class="keyword">if</span> (niter == nitermax) <span class="keyword">then</span>
<a name="l00387"></a>00387             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; &apos;</span>
<a name="l00388"></a>00388             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;Exceeded max number of ridging iterations&apos;</span>
<a name="l00389"></a>00389             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;max =&apos;</span>,nitermax
<a name="l00390"></a>00390             l_stop = .true.
<a name="l00391"></a>00391             return
<a name="l00392"></a>00392          <span class="keyword">endif</span>
<a name="l00393"></a>00393             
<a name="l00394"></a>00394       <span class="keyword">enddo</span>                     <span class="comment">! niter</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00397"></a>00397       <span class="comment">! Compute final values of conserved quantities. </span>
<a name="l00398"></a>00398       <span class="comment">! Check for conservation (allowing for snow thrown into ocean).</span>
<a name="l00399"></a>00399       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00400"></a>00400 
<a name="l00401"></a>00401       <span class="keyword">if</span> (<a class="code" href="namespaceice__mechred.html#a28f8598357ef3851a6288dfdd581732d">l_conservation_check</a>) <span class="keyword">then</span>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00404"></a>00404                           icells,   indxi,   indxj, &amp;
<a name="l00405"></a>00405                           <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>,                     &amp;
<a name="l00406"></a>00406                           vicen,      vice_final)
<a name="l00407"></a>00407 
<a name="l00408"></a>00408          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00409"></a>00409                           icells,   indxi,   indxj, &amp;
<a name="l00410"></a>00410                           <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>,                     &amp;
<a name="l00411"></a>00411                           vsnon,      vsno_final)
<a name="l00412"></a>00412 
<a name="l00413"></a>00413          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00414"></a>00414                           icells,   indxi,   indxj, &amp;
<a name="l00415"></a>00415                           <a class="code" href="namespaceice__domain__size.html#a46a923e86a6a0f553260f445f9faf5c9">ntilyr</a>,                   &amp;
<a name="l00416"></a>00416                           eicen,      eice_final)
<a name="l00417"></a>00417 
<a name="l00418"></a>00418          call <a class="code" href="namespaceice__itd.html#acc3eccaeb97f8a721fd0b9127b1fa183">column_sum </a>(nx_block,   ny_block,     &amp;
<a name="l00419"></a>00419                           icells,   indxi,   indxj, &amp;
<a name="l00420"></a>00420                           <a class="code" href="namespaceice__domain__size.html#a2b95950726524c87034f6468ba946b2a">ntslyr</a>,                   &amp;
<a name="l00421"></a>00421                           esnon,      esno_final)
<a name="l00422"></a>00422 
<a name="l00423"></a>00423          <span class="keyword">do</span> ij = 1, icells
<a name="l00424"></a>00424             vsno_final(ij) = vsno_final(ij) + msnow_mlt(ij)/<a class="code" href="namespaceice__constants.html#ae2404a45dc46ecdb371055dd52dcfe1f">rhos</a>
<a name="l00425"></a>00425             esno_final(ij) = esno_final(ij) + esnow_mlt(ij)
<a name="l00426"></a>00426          <span class="keyword">enddo</span>
<a name="l00427"></a>00427 
<a name="l00428"></a>00428          fieldid = <span class="stringliteral">&apos;vice, ridging&apos;</span>
<a name="l00429"></a>00429          call column_conservation_check (nx_block,  ny_block,       &amp;
<a name="l00430"></a>00430                                          icells,    indxi,   indxj, &amp;
<a name="l00431"></a>00431                                          fieldid,                   &amp;
<a name="l00432"></a>00432                                          vice_init, vice_final,     &amp;
<a name="l00433"></a>00433                                          <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>,      l_stop,         &amp;
<a name="l00434"></a>00434                                          istop,     jstop)
<a name="l00435"></a>00435          <span class="keyword">if</span> (l_stop) return
<a name="l00436"></a>00436 
<a name="l00437"></a>00437          fieldid = <span class="stringliteral">&apos;vsno, ridging&apos;</span>
<a name="l00438"></a>00438          call column_conservation_check (nx_block,  ny_block,       &amp;
<a name="l00439"></a>00439                                          icells,    indxi,   indxj, &amp;
<a name="l00440"></a>00440                                          fieldid,                   &amp;
<a name="l00441"></a>00441                                          vsno_init, vsno_final,     &amp;
<a name="l00442"></a>00442                                          <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>,      l_stop,         &amp;
<a name="l00443"></a>00443                                          istop,     jstop)
<a name="l00444"></a>00444          <span class="keyword">if</span> (l_stop) return
<a name="l00445"></a>00445 
<a name="l00446"></a>00446          fieldid = <span class="stringliteral">&apos;eice, ridging&apos;</span>
<a name="l00447"></a>00447          call column_conservation_check (nx_block,  ny_block,       &amp;
<a name="l00448"></a>00448                                          icells,    indxi,   indxj, &amp;
<a name="l00449"></a>00449                                          fieldid,                   &amp;
<a name="l00450"></a>00450                                          eice_init, eice_final,     &amp;
<a name="l00451"></a>00451                                          <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>*Lfresh*<a class="code" href="namespaceice__constants.html#ab8aa44724cb8c314b55a09244600f68d">rhoi</a>,          &amp;
<a name="l00452"></a>00452                                          l_stop,                    &amp;
<a name="l00453"></a>00453                                          istop,     jstop)
<a name="l00454"></a>00454          <span class="keyword">if</span> (l_stop) return
<a name="l00455"></a>00455 
<a name="l00456"></a>00456          fieldid = <span class="stringliteral">&apos;esno, ridging&apos;</span>
<a name="l00457"></a>00457          call column_conservation_check (nx_block,  ny_block,       &amp;
<a name="l00458"></a>00458                                          icells,    indxi,   indxj, &amp;
<a name="l00459"></a>00459                                          fieldid,                   &amp;
<a name="l00460"></a>00460                                          esno_init, esno_final,     &amp;
<a name="l00461"></a>00461                                          <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>*Lfresh*<a class="code" href="namespaceice__constants.html#ae2404a45dc46ecdb371055dd52dcfe1f">rhos</a>,          &amp;
<a name="l00462"></a>00462                                          l_stop,                    &amp;
<a name="l00463"></a>00463                                          istop,     jstop)
<a name="l00464"></a>00464          <span class="keyword">if</span> (l_stop) return
<a name="l00465"></a>00465          
<a name="l00466"></a>00466       <span class="keyword">endif</span>                     <span class="comment">! l_conservation_check            </span>
<a name="l00467"></a>00467 
<a name="l00468"></a>00468       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00469"></a>00469       <span class="comment">! Compute ridging diagnostics.</span>
<a name="l00470"></a>00470       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00471"></a>00471 
<a name="l00472"></a>00472       dti = <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>/dt_dyn
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       <span class="keyword">if</span> (present(dardg1dt)) <span class="keyword">then</span>
<a name="l00475"></a>00475          <span class="keyword">do</span> ij = 1, icells
<a name="l00476"></a>00476             i = indxi(ij)
<a name="l00477"></a>00477             j = indxj(ij)
<a name="l00478"></a>00478             dardg1dt(i,j) = ardg1(ij)*dti
<a name="l00479"></a>00479          <span class="keyword">enddo</span>
<a name="l00480"></a>00480       <span class="keyword">endif</span>
<a name="l00481"></a>00481       <span class="keyword">if</span> (present(dardg2dt)) <span class="keyword">then</span>
<a name="l00482"></a>00482          <span class="keyword">do</span> ij = 1, icells
<a name="l00483"></a>00483             i = indxi(ij)
<a name="l00484"></a>00484             j = indxj(ij)
<a name="l00485"></a>00485             dardg2dt(i,j) = ardg2(ij)*dti
<a name="l00486"></a>00486          <span class="keyword">enddo</span>
<a name="l00487"></a>00487       <span class="keyword">endif</span>
<a name="l00488"></a>00488       <span class="keyword">if</span> (present(dvirdgdt)) <span class="keyword">then</span>
<a name="l00489"></a>00489          <span class="keyword">do</span> ij = 1, icells
<a name="l00490"></a>00490             i = indxi(ij)
<a name="l00491"></a>00491             j = indxj(ij)
<a name="l00492"></a>00492             dvirdgdt(i,j) = virdg(ij)*dti
<a name="l00493"></a>00493          <span class="keyword">enddo</span>
<a name="l00494"></a>00494       <span class="keyword">endif</span>
<a name="l00495"></a>00495       <span class="keyword">if</span> (present(opening)) <span class="keyword">then</span>
<a name="l00496"></a>00496          <span class="keyword">do</span> ij = 1, icells
<a name="l00497"></a>00497             i = indxi(ij)
<a name="l00498"></a>00498             j = indxj(ij)
<a name="l00499"></a>00499             opening(i,j) = aopen(ij)*dti
<a name="l00500"></a>00500          <span class="keyword">enddo</span>
<a name="l00501"></a>00501       <span class="keyword">endif</span>
<a name="l00502"></a>00502 
<a name="l00503"></a>00503       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00504"></a>00504       <span class="comment">! Update fresh water and heat fluxes due to snow melt.</span>
<a name="l00505"></a>00505       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       dti = <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>/dt_thm
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       <span class="keyword">if</span> (present(fsoot)) <span class="keyword">then</span>
<a name="l00510"></a>00510          <span class="keyword">do</span> ij = 1, icells
<a name="l00511"></a>00511             i = indxi(ij)
<a name="l00512"></a>00512             j = indxj(ij)
<a name="l00513"></a>00513             fsoot(i,j,:) = fsoot(i,j,:) + msoot(ij,:)*dti
<a name="l00514"></a>00514          <span class="keyword">enddo</span>
<a name="l00515"></a>00515       <span class="keyword">endif</span>
<a name="l00516"></a>00516       <span class="keyword">if</span> (present(fresh)) <span class="keyword">then</span>
<a name="l00517"></a>00517          <span class="keyword">do</span> ij = 1, icells
<a name="l00518"></a>00518             i = indxi(ij)
<a name="l00519"></a>00519             j = indxj(ij)
<a name="l00520"></a>00520             fresh(i,j) = fresh(i,j) + msnow_mlt(ij)*dti
<a name="l00521"></a>00521          <span class="keyword">enddo</span>
<a name="l00522"></a>00522       <span class="keyword">endif</span>
<a name="l00523"></a>00523       <span class="keyword">if</span> (present(fhocn)) <span class="keyword">then</span>
<a name="l00524"></a>00524          <span class="keyword">do</span> ij = 1, icells
<a name="l00525"></a>00525             i = indxi(ij)
<a name="l00526"></a>00526             j = indxj(ij)
<a name="l00527"></a>00527             fhocn(i,j) = fhocn(i,j) + esnow_mlt(ij)*dti
<a name="l00528"></a>00528          <span class="keyword">enddo</span>
<a name="l00529"></a>00529       <span class="keyword">endif</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00532"></a>00532       <span class="comment">! Check for fractional ice area &gt; 1.</span>
<a name="l00533"></a>00533       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <span class="keyword">do</span> ij = 1, icells
<a name="l00536"></a>00536          i = indxi(ij)
<a name="l00537"></a>00537          j = indxj(ij)
<a name="l00538"></a>00538          <span class="keyword">if</span> (abs(asum(ij) - <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l00539"></a>00539             l_stop = .true.
<a name="l00540"></a>00540             istop = i
<a name="l00541"></a>00541             jstop = j
<a name="l00542"></a>00542 
<a name="l00543"></a>00543             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; &apos;</span>
<a name="l00544"></a>00544             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;Ridging error: total area &gt; 1&apos;</span>
<a name="l00545"></a>00545             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;i, j, area:&apos;</span>, i, j, asum(ij)
<a name="l00546"></a>00546             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;n, aicen:&apos;</span>
<a name="l00547"></a>00547             <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*)  0, aice0(i,j)
<a name="l00548"></a>00548             <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00549"></a>00549                <span class="keyword">write</span>(<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) n, aicen(i,j,n)
<a name="l00550"></a>00550             <span class="keyword">enddo</span>
<a name="l00551"></a>00551             return
<a name="l00552"></a>00552          <span class="keyword">endif</span>
<a name="l00553"></a>00553       <span class="keyword">enddo</span>
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="keyword">      end subroutine ridge_ice</span>
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="comment">!=======================================================================</span>
<a name="l00558"></a>00558 <span class="comment">!BOP</span>
<a name="l00559"></a>00559 <span class="comment">!</span>
<a name="l00560"></a>00560 <span class="comment">! !ROUTINE: asum_ridging - find total fractional area</span>
<a name="l00561"></a>00561 <span class="comment">!</span>
<a name="l00562"></a>00562 <span class="comment">! !DESCRIPTION:</span>
<a name="l00563"></a>00563 <span class="comment">!</span>
<a name="l00564"></a>00564 <span class="comment">! Find the total area of ice plus open water in each grid cell.</span>
<a name="l00565"></a>00565 <span class="comment">!</span>
<a name="l00566"></a>00566 <span class="comment">! This is similar to the aggregate_area subroutine except that the</span>
<a name="l00567"></a>00567 <span class="comment">! total area can be greater than 1, so the open water area is</span>
<a name="l00568"></a>00568 <span class="comment">! included in the sum instead of being computed as a residual.</span>
<a name="l00569"></a>00569 <span class="comment">!</span>
<a name="l00570"></a>00570 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00571"></a>00571 <span class="comment">!</span>
<a name="l00572"></a>00572 <span class="comment">! author: William H. Lipscomb, LANL</span>
<a name="l00573"></a>00573 <span class="comment">!</span>
<a name="l00574"></a>00574 <span class="comment">! !INTERFACE:</span>
<a name="l00575"></a>00575 <span class="comment">!</span>
<a name="l00576"></a><a class="code" href="namespaceice__mechred.html#a0b56099ad3d0f301b3dfaab8aba87ef4">00576</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#a0b56099ad3d0f301b3dfaab8aba87ef4">asum_ridging</a> (nx_block, ny_block,        &amp;
<a name="l00577"></a>00577                                icells,   indxi,    indxj, &amp;
<a name="l00578"></a>00578                                aicen,    aice0,           &amp;
<a name="l00579"></a>00579                                asum)
<a name="l00580"></a>00580 <span class="comment">!</span>
<a name="l00581"></a>00581 <span class="comment">! !USES:</span>
<a name="l00582"></a>00582 <span class="comment">!</span>
<a name="l00583"></a>00583 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00584"></a>00584 <span class="comment">!</span>
<a name="l00585"></a>00585       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00586"></a>00586          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l00587"></a>00587          icells                <span class="comment">! number of cells with ice present</span>
<a name="l00588"></a>00588 
<a name="l00589"></a>00589       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l00590"></a>00590          <span class="keywordtype">intent(in)</span> :: 
<a name="l00591"></a>00591          indxi, indxj     <span class="comment">! compressed indices for cells with ice</span>
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 
<a name="l00594"></a>00594       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ncat)</span>, 
<a name="l00595"></a>00595          <span class="keywordtype">intent(in)</span> :: 
<a name="l00596"></a>00596          aicen          <span class="comment">! concentration of ice in each category</span>
<a name="l00597"></a>00597 
<a name="l00598"></a>00598       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00599"></a>00599          aice0          <span class="comment">! concentration of open water</span>
<a name="l00600"></a>00600 
<a name="l00601"></a>00601       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells)</span>, <span class="keywordtype">intent(out)</span>:: 
<a name="l00602"></a>00602          asum           <span class="comment">! sum of ice and open water area</span>
<a name="l00603"></a>00603 <span class="comment">!</span>
<a name="l00604"></a>00604 <span class="comment">!EOP</span>
<a name="l00605"></a>00605 <span class="comment">!</span>
<a name="l00606"></a>00606       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l00607"></a>00607          i, j, n, 
<a name="l00608"></a>00608          ij               <span class="comment">! horizontal index, combines i and j loops</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00611"></a>00611       <span class="comment">! open water</span>
<a name="l00612"></a>00612       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00613"></a>00613       <span class="keyword">do</span> ij = 1, icells
<a name="l00614"></a>00614          i = indxi(ij)
<a name="l00615"></a>00615          j = indxj(ij)
<a name="l00616"></a>00616          asum(ij) = aice0(i,j)
<a name="l00617"></a>00617       <span class="keyword">enddo</span>
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00620"></a>00620       <span class="comment">! ice categories</span>
<a name="l00621"></a>00621       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00624"></a>00624 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l00625"></a>00625 <span class="comment">!cdir nodep      !NEC</span>
<a name="l00626"></a>00626 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l00627"></a>00627          <span class="keyword">do</span> ij = 1, icells
<a name="l00628"></a>00628             i = indxi(ij)
<a name="l00629"></a>00629             j = indxj(ij)
<a name="l00630"></a>00630             asum(ij) = asum(ij) + aicen(i,j,n)
<a name="l00631"></a>00631          <span class="keyword">enddo</span>
<a name="l00632"></a>00632       <span class="keyword">enddo</span>
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 <span class="keyword">      end subroutine asum_ridging</span>
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 <span class="comment">!=======================================================================</span>
<a name="l00637"></a>00637 <span class="comment">!BOP</span>
<a name="l00638"></a>00638 <span class="comment">!</span>
<a name="l00639"></a>00639 <span class="comment">! !ROUTINE: ridge_prep - preparation for ridging</span>
<a name="l00640"></a>00640 <span class="comment">!</span>
<a name="l00641"></a>00641 <span class="comment">! !DESCRIPTION: Initialize arrays, compute area of closing and opening</span>
<a name="l00642"></a>00642 <span class="comment">!</span>
<a name="l00643"></a>00643 <span class="comment">!</span>
<a name="l00644"></a>00644 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00645"></a>00645 <span class="comment">!</span>
<a name="l00646"></a>00646 <span class="comment">! author: William H. Lipscomb, LANL</span>
<a name="l00647"></a>00647 <span class="comment">!</span>
<a name="l00648"></a>00648 <span class="comment">! !INTERFACE:</span>
<a name="l00649"></a>00649 <span class="comment">!</span>
<a name="l00650"></a><a class="code" href="namespaceice__mechred.html#a387bb4361bc395e2cc8d9ab50ef03728">00650</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#a387bb4361bc395e2cc8d9ab50ef03728">ridge_prep</a> (nx_block,   ny_block,        &amp;
<a name="l00651"></a>00651                              icells,     indxi,    indxj, &amp;
<a name="l00652"></a>00652                              dt,                          &amp;
<a name="l00653"></a>00653                              rdg_conv,   rdg_shear,       &amp;
<a name="l00654"></a>00654                              asum,       closing_net,     &amp;
<a name="l00655"></a>00655                              divu_adv,   opning)
<a name="l00656"></a>00656 <span class="comment">!</span>
<a name="l00657"></a>00657 <span class="comment">! !USES:</span>
<a name="l00658"></a>00658 <span class="comment">!</span>
<a name="l00659"></a>00659 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00660"></a>00660 <span class="comment">!</span>
<a name="l00661"></a>00661       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00662"></a>00662          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l00663"></a>00663          icells                <span class="comment">! number of cells with ice present</span>
<a name="l00664"></a>00664 
<a name="l00665"></a>00665       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l00666"></a>00666          <span class="keywordtype">intent(in)</span> :: 
<a name="l00667"></a>00667          indxi, indxj     <span class="comment">! compressed indices for cells with ice</span>
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 
<a name="l00670"></a>00670       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00671"></a>00671          dt                  <span class="comment">! time step (s)</span>
<a name="l00672"></a>00672 
<a name="l00673"></a>00673       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(nx_block,ny_block)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00674"></a>00674          rdg_conv,  <span class="comment">! normalized energy dissipation due to convergence (1/s)</span>
<a name="l00675"></a>00675          rdg_shear   <span class="comment">! normalized energy dissipation due to shear (1/s)</span>
<a name="l00676"></a>00676 
<a name="l00677"></a>00677       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells)</span>, 
<a name="l00678"></a>00678          <span class="keywordtype">intent(inout)</span>:: 
<a name="l00679"></a>00679          asum      <span class="comment">! sum of ice and open water area</span>
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells)</span>, 
<a name="l00682"></a>00682          <span class="keywordtype">intent(out)</span>:: 
<a name="l00683"></a>00683          closing_net,  <span class="comment">! net rate at which area is removed    (1/s)</span>
<a name="l00684"></a>00684          divu_adv   ,  <span class="comment">! divu as implied by transport scheme  (1/s)</span>
<a name="l00685"></a>00685          opning         <span class="comment">! rate of opening due to divergence/shear</span>
<a name="l00686"></a>00686 <span class="comment">!</span>
<a name="l00687"></a>00687 <span class="comment">!EOP</span>
<a name="l00688"></a>00688 <span class="comment">!</span>
<a name="l00689"></a>00689       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> :: 
<a name="l00690"></a>00690          big = 1.0e+8_dbl_kind
<a name="l00691"></a>00691 
<a name="l00692"></a>00692       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l00693"></a>00693          i,j,          <span class="comment">! horizontal indices</span>
<a name="l00694"></a>00694          ij             <span class="comment">! horizontal index, combines i and j loops</span>
<a name="l00695"></a>00695 
<a name="l00696"></a>00696       <span class="comment">! Set hin_max(ncat) to a big value to ensure that all ridged ice</span>
<a name="l00697"></a>00697       <span class="comment">! is thinner than hin_max(ncat).</span>
<a name="l00698"></a>00698       <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(<a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>) = big
<a name="l00699"></a>00699 
<a name="l00700"></a>00700       <span class="keyword">do</span> ij = 1, icells
<a name="l00701"></a>00701          i = indxi(ij)
<a name="l00702"></a>00702          j = indxj(ij)
<a name="l00703"></a>00703 
<a name="l00704"></a>00704       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00705"></a>00705       <span class="comment">! Compute the net rate of closing due to convergence</span>
<a name="l00706"></a>00706       <span class="comment">! and shear, based on Flato and Hibler (1995).</span>
<a name="l00707"></a>00707       <span class="comment">!</span>
<a name="l00708"></a>00708       <span class="comment">! For the elliptical yield curve:</span>
<a name="l00709"></a>00709       <span class="comment">!    rdg_conv  = -min (divu, 0)</span>
<a name="l00710"></a>00710       <span class="comment">!    rdg_shear = (1/2) * (Delta - abs(divu))</span>
<a name="l00711"></a>00711       <span class="comment">! Note that the shear term also accounts for divergence.</span>
<a name="l00712"></a>00712       <span class="comment">!</span>
<a name="l00713"></a>00713       <span class="comment">! The energy dissipation rate is equal to the net closing rate</span>
<a name="l00714"></a>00714       <span class="comment">! times the ice strength.</span>
<a name="l00715"></a>00715       <span class="comment">!</span>
<a name="l00716"></a>00716       <span class="comment">! NOTE: The NET closing rate is equal to the rate that open water</span>
<a name="l00717"></a>00717       <span class="comment">!  area is removed, plus the rate at which ice area is removed by</span>
<a name="l00718"></a>00718       <span class="comment">!  ridging, minus the rate at which area is added in new ridges.</span>
<a name="l00719"></a>00719       <span class="comment">!  The GROSS closing rate is equal to the first two terms (open</span>
<a name="l00720"></a>00720       <span class="comment">!  water closing and thin ice ridging) without the third term</span>
<a name="l00721"></a>00721       <span class="comment">!  (thick, newly ridged ice).</span>
<a name="l00722"></a>00722       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724          closing_net(ij) = <a class="code" href="namespaceice__mechred.html#a0cca318f045e71a7ff69619f4186399c">Cs</a>*rdg_shear(i,j) + rdg_conv(i,j)
<a name="l00725"></a>00725 
<a name="l00726"></a>00726       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00727"></a>00727       <span class="comment">! Compute divu_adv, the divergence rate given by the transport/</span>
<a name="l00728"></a>00728       <span class="comment">! advection scheme, which may not be equal to divu as computed</span>
<a name="l00729"></a>00729       <span class="comment">! from the velocity field.</span>
<a name="l00730"></a>00730       <span class="comment">!</span>
<a name="l00731"></a>00731       <span class="comment">! If divu_adv &lt; 0, make sure the closing rate is large enough</span>
<a name="l00732"></a>00732       <span class="comment">! to give asum = 1.0 after ridging.</span>
<a name="l00733"></a>00733       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00734"></a>00734 
<a name="l00735"></a>00735          divu_adv(ij) = (<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-asum(ij)) / dt
<a name="l00736"></a>00736 
<a name="l00737"></a>00737          <span class="keyword">if</span> (divu_adv(ij) &lt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) &amp;
<a name="l00738"></a>00738               closing_net(ij) = max(closing_net(ij), -divu_adv(ij))
<a name="l00739"></a>00739 
<a name="l00740"></a>00740       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00741"></a>00741       <span class="comment">! Compute the (non-negative) opening rate that will give</span>
<a name="l00742"></a>00742       <span class="comment">! asum = 1.0 after ridging.</span>
<a name="l00743"></a>00743       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00744"></a>00744          opning(ij) = closing_net(ij) + divu_adv(ij)
<a name="l00745"></a>00745 
<a name="l00746"></a>00746       <span class="keyword">enddo</span>
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="keyword">      end subroutine ridge_prep</span>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="comment">!=======================================================================</span>
<a name="l00751"></a>00751 <span class="comment">!BOP</span>
<a name="l00752"></a>00752 <span class="comment">!</span>
<a name="l00753"></a>00753 <span class="comment">! !ROUTINE: ridge_itd - thickness distribution of ridging and ridged ice</span>
<a name="l00754"></a>00754 <span class="comment">!</span>
<a name="l00755"></a>00755 <span class="comment">! !DESCRIPTION:</span>
<a name="l00756"></a>00756 <span class="comment">!</span>
<a name="l00757"></a>00757 <span class="comment">! Compute the thickness distribution of the ice and open water</span>
<a name="l00758"></a>00758 <span class="comment">! participating in ridging and of the resulting ridges.</span>
<a name="l00759"></a>00759 <span class="comment">!</span>
<a name="l00760"></a>00760 <span class="comment">! This version includes new options for ridging participation and</span>
<a name="l00761"></a>00761 <span class="comment">!  redistribution.</span>
<a name="l00762"></a>00762 <span class="comment">! The new participation scheme (krdg_partic = 1) improves stability</span>
<a name="l00763"></a>00763 <span class="comment">!  by increasing the time scale for large changes in ice strength.</span>
<a name="l00764"></a>00764 <span class="comment">! The new exponential redistribution function (krdg_redist = 1) improves </span>
<a name="l00765"></a>00765 <span class="comment">!  agreement between ITDs of modeled and observed ridges.   </span>
<a name="l00766"></a>00766 <span class="comment">!</span>
<a name="l00767"></a>00767 <span class="comment">! !REVISION HISTORY:</span>
<a name="l00768"></a>00768 <span class="comment">!</span>
<a name="l00769"></a>00769 <span class="comment">! author: William H. Lipscomb, LANL</span>
<a name="l00770"></a>00770 <span class="comment">!</span>
<a name="l00771"></a>00771 <span class="comment">! 2006: Changed subroutine name to ridge_itd</span>
<a name="l00772"></a>00772 <span class="comment">!       Added new options for ridging participation and redistribution.  </span>
<a name="l00773"></a>00773 <span class="comment">!</span>
<a name="l00774"></a>00774 <span class="comment">! !INTERFACE:</span>
<a name="l00775"></a>00775 <span class="comment">!</span>
<a name="l00776"></a><a class="code" href="namespaceice__mechred.html#aa337d7f3df7eb6c6f9e3724e2d350e0c">00776</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#aa337d7f3df7eb6c6f9e3724e2d350e0c">ridge_itd</a> (nx_block,    ny_block,        &amp;
<a name="l00777"></a>00777                             icells,      indxi,    indxj, &amp;
<a name="l00778"></a>00778                             aicen,       vicen,           &amp;
<a name="l00779"></a>00779                             aice0,                        &amp;
<a name="l00780"></a>00780                             aksum,       apartic,         &amp;
<a name="l00781"></a>00781                             hrmin,       hrmax,           &amp;
<a name="l00782"></a>00782                             hrexp,       krdg)
<a name="l00783"></a>00783 <span class="comment">!</span>
<a name="l00784"></a>00784 <span class="comment">! !USES:</span>
<a name="l00785"></a>00785 <span class="comment">!</span>
<a name="l00786"></a>00786 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l00787"></a>00787 <span class="comment">!</span>
<a name="l00788"></a>00788       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00789"></a>00789          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l00790"></a>00790          icells                <span class="comment">! number of cells with ice present</span>
<a name="l00791"></a>00791 
<a name="l00792"></a>00792       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l00793"></a>00793          <span class="keywordtype">intent(in)</span> :: 
<a name="l00794"></a>00794          indxi, indxj     <span class="comment">! compressed indices for cells with ice</span>
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a>00797       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ncat)</span>, 
<a name="l00798"></a>00798          <span class="keywordtype">intent(in)</span> :: 
<a name="l00799"></a>00799          aicen ,  <span class="comment">! concentration of ice</span>
<a name="l00800"></a>00800          vicen     <span class="comment">! volume per unit area of ice (m)</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l00803"></a>00803          aice0     <span class="comment">! concentration of open water</span>
<a name="l00804"></a>00804 
<a name="l00805"></a>00805       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells)</span>, <span class="keywordtype">intent(out)</span>:: 
<a name="l00806"></a>00806          aksum            <span class="comment">! ratio of area removed to area ridged</span>
<a name="l00807"></a>00807 
<a name="l00808"></a>00808       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,0:ncat)</span>, 
<a name="l00809"></a>00809          <span class="keywordtype">intent(out)</span> :: 
<a name="l00810"></a>00810          apartic          <span class="comment">! participation function; fraction of ridging</span>
<a name="l00811"></a>00811                           <span class="comment">! and closing associated w/ category n</span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ncat)</span>, 
<a name="l00814"></a>00814          <span class="keywordtype">intent(out)</span> :: 
<a name="l00815"></a>00815          hrmin        ,  <span class="comment">! minimum ridge thickness</span>
<a name="l00816"></a>00816          hrmax        ,  <span class="comment">! maximum ridge thickness (krdg_redist = 0)</span>
<a name="l00817"></a>00817          hrexp        ,  <span class="comment">! ridge e-folding thickness (krdg_redist = 1) </span>
<a name="l00818"></a>00818          krdg             <span class="comment">! mean ridge thickness/thickness of ridging ice</span>
<a name="l00819"></a>00819 <span class="comment">!</span>
<a name="l00820"></a>00820 <span class="comment">!EOP</span>
<a name="l00821"></a>00821 <span class="comment">!</span>
<a name="l00822"></a>00822       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l00823"></a>00823          i,j          ,  <span class="comment">! horizontal indices</span>
<a name="l00824"></a>00824          n            ,  <span class="comment">! thickness category index</span>
<a name="l00825"></a>00825          ij               <span class="comment">! horizontal index, combines i and j loops</span>
<a name="l00826"></a>00826 
<a name="l00827"></a>00827       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">parameter</span> :: 
<a name="l00828"></a>00828          Gstari   = c1/Gstar, 
<a name="l00829"></a>00829          astari   = c1/astar
<a name="l00830"></a>00830 
<a name="l00831"></a>00831       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells,-1:ncat) </span>:: 
<a name="l00832"></a>00832          Gsum             <span class="comment">! Gsum(n) = sum of areas in categories 0 to n</span>
<a name="l00833"></a>00833 
<a name="l00834"></a>00834       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells) </span>:: 
<a name="l00835"></a>00835          work             <span class="comment">! temporary work array</span>
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       <span class="keywordtype">real (kind=dbl_kind) </span>:: 
<a name="l00838"></a>00838          hi           ,  <span class="comment">! ice thickness for each cat (m)</span>
<a name="l00839"></a>00839          hieff        ,  <span class="comment">! effective ice thickness (m) (krdg_redist = 2)</span>
<a name="l00840"></a>00840          hrmean       ,  <span class="comment">! mean ridge thickness (m)</span>
<a name="l00841"></a>00841          xtmp             <span class="comment">! temporary variable</span>
<a name="l00842"></a>00842 
<a name="l00843"></a>00843       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00844"></a>00844       <span class="comment">! Initialize</span>
<a name="l00845"></a>00845       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847       <span class="keyword">do</span> ij = 1, icells
<a name="l00848"></a>00848          Gsum   (ij,-1) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>        <span class="comment">! by definition</span>
<a name="l00849"></a>00849          Gsum   (ij,0)  = c1         <span class="comment">! to avoid divzero below</span>
<a name="l00850"></a>00850          apartic(ij,0)  = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00851"></a>00851       <span class="keyword">enddo</span>
<a name="l00852"></a>00852 
<a name="l00853"></a>00853       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00854"></a>00854          <span class="keyword">do</span> ij = 1, icells
<a name="l00855"></a>00855             Gsum   (ij,n) = c1    <span class="comment">! to avoid divzero below</span>
<a name="l00856"></a>00856             apartic(ij,n) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00857"></a>00857             hrmin  (ij,n) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00858"></a>00858             hrmax  (ij,n) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00859"></a>00859             hrexp  (ij,n) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l00860"></a>00860             krdg   (ij,n) = c1
<a name="l00861"></a>00861          <span class="keyword">enddo</span>
<a name="l00862"></a>00862       <span class="keyword">enddo</span>
<a name="l00863"></a>00863 
<a name="l00864"></a>00864       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00865"></a>00865       <span class="comment">! Compute the thickness distribution of ice participating in ridging.</span>
<a name="l00866"></a>00866       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00869"></a>00869       <span class="comment">! First compute the cumulative thickness distribution function Gsum,</span>
<a name="l00870"></a>00870       <span class="comment">!  where Gsum(n) is the fractional area in categories 0 to n.</span>
<a name="l00871"></a>00871       <span class="comment">! Ignore categories with very small areas.</span>
<a name="l00872"></a>00872       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00873"></a>00873 
<a name="l00874"></a>00874 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l00875"></a>00875 <span class="comment">!cdir nodep      !NEC</span>
<a name="l00876"></a>00876 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l00877"></a>00877       <span class="keyword">do</span> ij = 1, icells
<a name="l00878"></a>00878          i = indxi(ij)
<a name="l00879"></a>00879          j = indxj(ij)
<a name="l00880"></a>00880          <span class="keyword">if</span> (aice0(i,j) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l00881"></a>00881             Gsum(ij,0) = aice0(i,j)
<a name="l00882"></a>00882          <span class="keyword">else</span>
<a name="l00883"></a>00883             Gsum(ij,0) = Gsum(ij,-1)
<a name="l00884"></a>00884          <span class="keyword">endif</span>
<a name="l00885"></a>00885       <span class="keyword">enddo</span>
<a name="l00886"></a>00886 
<a name="l00887"></a>00887       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00888"></a>00888 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l00889"></a>00889 <span class="comment">!cdir nodep      !NEC</span>
<a name="l00890"></a>00890 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l00891"></a>00891          <span class="keyword">do</span> ij = 1, icells
<a name="l00892"></a>00892             i = indxi(ij)
<a name="l00893"></a>00893             j = indxj(ij)
<a name="l00894"></a>00894             <span class="keyword">if</span> (aicen(i,j,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l00895"></a>00895                Gsum(ij,n) = Gsum(ij,n-1) + aicen(i,j,n)
<a name="l00896"></a>00896             <span class="keyword">else</span>
<a name="l00897"></a>00897                Gsum(ij,n) = Gsum(ij,n-1)
<a name="l00898"></a>00898             <span class="keyword">endif</span>
<a name="l00899"></a>00899          <span class="keyword">enddo</span>
<a name="l00900"></a>00900       <span class="keyword">enddo</span>
<a name="l00901"></a>00901 
<a name="l00902"></a>00902       <span class="comment">! normalize</span>
<a name="l00903"></a>00903 
<a name="l00904"></a>00904       <span class="keyword">do</span> ij = 1, icells
<a name="l00905"></a>00905          work(ij) = c1 / Gsum(ij,<a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>)
<a name="l00906"></a>00906       <span class="keyword">enddo</span>
<a name="l00907"></a>00907       <span class="keyword">do</span> n = 0, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00908"></a>00908 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l00909"></a>00909 <span class="comment">!cdir nodep      !NEC</span>
<a name="l00910"></a>00910 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l00911"></a>00911          <span class="keyword">do</span> ij = 1, icells
<a name="l00912"></a>00912             Gsum(ij,n) = Gsum(ij,n) * work(ij)
<a name="l00913"></a>00913          <span class="keyword">enddo</span>
<a name="l00914"></a>00914       <span class="keyword">enddo</span>
<a name="l00915"></a>00915 
<a name="l00916"></a>00916       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00917"></a>00917       <span class="comment">! Compute the participation function apartic; this is analogous to</span>
<a name="l00918"></a>00918       <span class="comment">! a(h) = b(h)g(h) as defined in Thorndike et al. (1975).</span>
<a name="l00919"></a>00919       <span class="comment">!</span>
<a name="l00920"></a>00920       <span class="comment">!                area lost from category n due to ridging/closing</span>
<a name="l00921"></a>00921       <span class="comment">!  apartic(n) = --------------------------------------------------</span>
<a name="l00922"></a>00922       <span class="comment">!                  total area lost due to ridging/closing</span>
<a name="l00923"></a>00923       <span class="comment">!</span>
<a name="l00924"></a>00924       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00925"></a>00925 
<a name="l00926"></a>00926       <span class="keyword">if</span> (krdg_partic == 0) <span class="keyword">then</span>  <span class="comment">! Thornike et al. 1975 formulation</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00929"></a>00929       <span class="comment">! Assume b(h) = (2/Gstar) * (1 - G(h)/Gstar).</span>
<a name="l00930"></a>00930       <span class="comment">! The expressions for apartic are found by integrating b(h)g(h) between</span>
<a name="l00931"></a>00931       <span class="comment">! the category boundaries.</span>
<a name="l00932"></a>00932       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00933"></a>00933 
<a name="l00934"></a>00934          <span class="keyword">do</span> n = 0, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00935"></a>00935             <span class="keyword">do</span> ij = 1, icells
<a name="l00936"></a>00936                <span class="keyword">if</span> (Gsum(ij,n) &lt; Gstar) <span class="keyword">then</span>
<a name="l00937"></a>00937                   apartic(ij,n) = Gstari*(Gsum(ij,n)-Gsum(ij,n-1)) * &amp;
<a name="l00938"></a>00938                        (<a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a> - (Gsum(ij,n-1)+Gsum(ij,n))*Gstari)
<a name="l00939"></a>00939                elseif (Gsum(ij,n-1) &lt; Gstar) <span class="keyword">then</span>
<a name="l00940"></a>00940                   apartic(ij,n) = Gstari * (Gstar-Gsum(ij,n-1)) * &amp;
<a name="l00941"></a>00941                        (<a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a> - (Gsum(ij,n-1)+Gstar)*Gstari)
<a name="l00942"></a>00942                <span class="keyword">endif</span>
<a name="l00943"></a>00943             <span class="keyword">enddo</span>               <span class="comment">! ij</span>
<a name="l00944"></a>00944          <span class="keyword">enddo</span>                  <span class="comment">! n</span>
<a name="l00945"></a>00945 
<a name="l00946"></a>00946       elseif (krdg_partic==1) <span class="keyword">then</span>   <span class="comment">! exponential dependence on G(h)</span>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00949"></a>00949       <span class="comment">! b(h) = exp(-G(h)/astar)</span>
<a name="l00950"></a>00950       <span class="comment">! apartic(n) = [exp(-G(n-1)/astar - exp(-G(n)/astar] / [1-exp(-1/astar)]. </span>
<a name="l00951"></a>00951       <span class="comment">! The expression for apartic is found by integrating b(h)g(h)</span>
<a name="l00952"></a>00952       <span class="comment">! between the category boundaries.</span>
<a name="l00953"></a>00953       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00954"></a>00954 
<a name="l00955"></a>00955          <span class="comment">! precompute exponential terms using Gsum as work array</span>
<a name="l00956"></a>00956 
<a name="l00957"></a>00957          xtmp = c1 / (c1 - exp(-astari))
<a name="l00958"></a>00958 
<a name="l00959"></a>00959          <span class="keyword">do</span> n = -1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00960"></a>00960 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l00961"></a>00961 <span class="comment">!cdir nodep      !NEC</span>
<a name="l00962"></a>00962 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l00963"></a>00963             <span class="keyword">do</span> ij = 1, icells
<a name="l00964"></a>00964                Gsum(ij,n) = exp(-Gsum(ij,n)*astari) * xtmp
<a name="l00965"></a>00965             <span class="keyword">enddo</span>               <span class="comment">! ij</span>
<a name="l00966"></a>00966          <span class="keyword">enddo</span>                  <span class="comment">! n</span>
<a name="l00967"></a>00967 
<a name="l00968"></a>00968          <span class="keyword">do</span> n = 0, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l00969"></a>00969             <span class="keyword">do</span> ij = 1, icells
<a name="l00970"></a>00970                apartic(ij,n) = Gsum(ij,n-1) - Gsum(ij,n)
<a name="l00971"></a>00971             <span class="keyword">enddo</span>               <span class="comment">! ij</span>
<a name="l00972"></a>00972          <span class="keyword">enddo</span>                  <span class="comment">! n</span>
<a name="l00973"></a>00973 
<a name="l00974"></a>00974       <span class="keyword">endif</span>                     <span class="comment">! krdg_partic</span>
<a name="l00975"></a>00975 
<a name="l00976"></a>00976       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00977"></a>00977       <span class="comment">! Compute variables related to ITD of ridged ice:</span>
<a name="l00978"></a>00978       <span class="comment">! </span>
<a name="l00979"></a>00979       <span class="comment">! krdg = mean ridge thickness/ thickness of ridging ice</span>
<a name="l00980"></a>00980       <span class="comment">! hrmin  = min ridge thickness</span>
<a name="l00981"></a>00981       <span class="comment">! hrmax  = max ridge thickness (krdg_redist = 0)</span>
<a name="l00982"></a>00982       <span class="comment">! hrexp  = ridge e-folding scale (krdg_redist = 1)</span>
<a name="l00983"></a>00983       <span class="comment">!----------------------------------------------------------------</span>
<a name="l00984"></a>00984 
<a name="l00985"></a>00985       <span class="keyword">if</span> (krdg_redist == 0) <span class="keyword">then</span>  <span class="comment">! Hibler 1980 formulation</span>
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00988"></a>00988       <span class="comment">! Assume ridged ice is uniformly distributed between hrmin and hrmax. </span>
<a name="l00989"></a>00989       <span class="comment">! </span>
<a name="l00990"></a>00990       <span class="comment">! This parameterization is a modified version of Hibler (1980). </span>
<a name="l00991"></a>00991       <span class="comment">! In the original paper the min ridging thickness is hrmin = 2*hi, </span>
<a name="l00992"></a>00992       <span class="comment">!  and the max thickness is hrmax = 2*sqrt(hi*Hstar). </span>
<a name="l00993"></a>00993       <span class="comment">! </span>
<a name="l00994"></a>00994       <span class="comment">! Here the min thickness is hrmin = min(2*hi, hi+maxraft), </span>
<a name="l00995"></a>00995       <span class="comment">!  so thick ridging ice is not required to raft. </span>
<a name="l00996"></a>00996       <span class="comment">!</span>
<a name="l00997"></a>00997       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l00998"></a>00998 
<a name="l00999"></a>00999          <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01000"></a>01000             <span class="keyword">do</span> ij = 1, icells
<a name="l01001"></a>01001                i = indxi(ij)
<a name="l01002"></a>01002                j = indxj(ij)
<a name="l01003"></a>01003 
<a name="l01004"></a>01004                <span class="keyword">if</span> (aicen(i,j,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span> 
<a name="l01005"></a>01005                   hi = vicen(i,j,n) / aicen(i,j,n) 
<a name="l01006"></a>01006                   hrmin(ij,n) = min(<a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>*hi, hi + maxraft) 
<a name="l01007"></a>01007                   hrmax(ij,n) = <a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>*sqrt(Hstar*hi) 
<a name="l01008"></a>01008                   hrmax(ij,n) = max(hrmax(ij,n), hrmin(ij,n)+<a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) 
<a name="l01009"></a>01009                   hrmean = <a class="code" href="namespaceice__constants.html#a26872e9df91fb7484a1a2ddefd7b71b0">p5</a> * (hrmin(ij,n) + hrmax(ij,n)) 
<a name="l01010"></a>01010                   krdg(ij,n) = hrmean / hi 
<a name="l01011"></a>01011                <span class="keyword">endif</span> 
<a name="l01012"></a>01012 
<a name="l01013"></a>01013             <span class="keyword">enddo</span>               <span class="comment">! ij</span>
<a name="l01014"></a>01014          <span class="keyword">enddo</span>                  <span class="comment">! n</span>
<a name="l01015"></a>01015 
<a name="l01016"></a>01016       <span class="keyword">else</span>               <span class="comment">! krdg_redist = 1; exponential redistribution</span>
<a name="l01017"></a>01017  
<a name="l01018"></a>01018       <span class="comment">!----------------------------------------------------------------- </span>
<a name="l01019"></a>01019       <span class="comment">! The ridge ITD is a negative exponential: </span>
<a name="l01020"></a>01020       <span class="comment">! </span>
<a name="l01021"></a>01021       <span class="comment">!  g(h) ~ exp[-(h-hrmin)/hrexp], h &gt;= hrmin </span>
<a name="l01022"></a>01022       <span class="comment">! </span>
<a name="l01023"></a>01023       <span class="comment">! where hrmin is the minimum thickness of ridging ice and </span>
<a name="l01024"></a>01024       <span class="comment">! hrexp is the e-folding thickness.</span>
<a name="l01025"></a>01025       <span class="comment">! </span>
<a name="l01026"></a>01026       <span class="comment">! Here, assume as above that hrmin = min(2*hi, hi+maxraft).</span>
<a name="l01027"></a>01027       <span class="comment">! That is, the minimum ridge thickness results from rafting,</span>
<a name="l01028"></a>01028       <span class="comment">!  unless the ice is thicker than maxraft.</span>
<a name="l01029"></a>01029       <span class="comment">!</span>
<a name="l01030"></a>01030       <span class="comment">! Also, assume that hrexp = mu_rdg*sqrt(hi).</span>
<a name="l01031"></a>01031       <span class="comment">! The parameter mu_rdg is tuned to give e-folding scales mostly</span>
<a name="l01032"></a>01032       <span class="comment">!  in the range 2-4 m as observed by upward-looking sonar.</span>
<a name="l01033"></a>01033       <span class="comment">!</span>
<a name="l01034"></a>01034       <span class="comment">! Values of mu_rdg in the right column give ice strengths</span>
<a name="l01035"></a>01035       <span class="comment">!  roughly equal to values of Hstar in the left column</span>
<a name="l01036"></a>01036       <span class="comment">!  (within ~10 kN/m for typical ITDs):</span>
<a name="l01037"></a>01037       <span class="comment">!</span>
<a name="l01038"></a>01038       <span class="comment">!   Hstar     mu_rdg</span>
<a name="l01039"></a>01039       <span class="comment">!</span>
<a name="l01040"></a>01040       <span class="comment">!     25        3.0</span>
<a name="l01041"></a>01041       <span class="comment">!     50        4.0</span>
<a name="l01042"></a>01042       <span class="comment">!     75        5.0</span>
<a name="l01043"></a>01043       <span class="comment">!    100        6.0</span>
<a name="l01044"></a>01044       <span class="comment">!----------------------------------------------------------------- </span>
<a name="l01045"></a>01045 
<a name="l01046"></a>01046          <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01047"></a>01047             <span class="keyword">do</span> ij = 1, icells
<a name="l01048"></a>01048                i = indxi(ij)
<a name="l01049"></a>01049                j = indxj(ij)
<a name="l01050"></a>01050                <span class="keyword">if</span> (aicen(i,j,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l01051"></a>01051                   hi = vicen(i,j,n) / aicen(i,j,n)
<a name="l01052"></a>01052                   hi = max(hi,<a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>)
<a name="l01053"></a>01053                   hrmin(ij,n) = min(<a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>*hi, hi + maxraft)
<a name="l01054"></a>01054                   hrexp(ij,n) = mu_rdg * sqrt(hi)
<a name="l01055"></a>01055                   krdg(ij,n) = (hrmin(ij,n) + hrexp(ij,n)) / hi
<a name="l01056"></a>01056                <span class="keyword">endif</span>
<a name="l01057"></a>01057             <span class="keyword">enddo</span>
<a name="l01058"></a>01058          <span class="keyword">enddo</span>
<a name="l01059"></a>01059 
<a name="l01060"></a>01060       <span class="keyword">endif</span>                     <span class="comment">! krdg_redist</span>
<a name="l01061"></a>01061 
<a name="l01062"></a>01062       <span class="comment">!----------------------------------------------------------------</span>
<a name="l01063"></a>01063       <span class="comment">! Compute aksum = net ice area removed / total area participating.</span>
<a name="l01064"></a>01064       <span class="comment">! For instance, if a unit area of ice with h = 1 participates in</span>
<a name="l01065"></a>01065       <span class="comment">!  ridging to form a ridge with a = 1/3 and h = 3, then</span>
<a name="l01066"></a>01066       <span class="comment">!  aksum = 1 - 1/3 = 2/3.</span>
<a name="l01067"></a>01067       <span class="comment">!---------------------------------------------------------------- </span>
<a name="l01068"></a>01068 
<a name="l01069"></a>01069       <span class="keyword">do</span> ij = 1, icells
<a name="l01070"></a>01070          aksum(ij) = apartic(ij,0) <span class="comment">! area participating = area removed</span>
<a name="l01071"></a>01071       <span class="keyword">enddo</span>
<a name="l01072"></a>01072 
<a name="l01073"></a>01073       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01074"></a>01074 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01075"></a>01075 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01076"></a>01076 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01077"></a>01077          <span class="keyword">do</span> ij = 1, icells
<a name="l01078"></a>01078             <span class="comment">! area participating &gt; area removed</span>
<a name="l01079"></a>01079             aksum(ij) = aksum(ij)  &amp;
<a name="l01080"></a>01080                        + apartic(ij,n) * (c1 - c1/krdg(ij,n)) 
<a name="l01081"></a>01081          <span class="keyword">enddo</span>
<a name="l01082"></a>01082       <span class="keyword">enddo</span>
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 <span class="keyword">      end subroutine ridge_itd</span>
<a name="l01085"></a>01085 
<a name="l01086"></a>01086 <span class="comment">!=======================================================================</span>
<a name="l01087"></a>01087 <span class="comment">!BOP</span>
<a name="l01088"></a>01088 <span class="comment">!</span>
<a name="l01089"></a>01089 <span class="comment">! !ROUTINE: ridge_shift - shift ridging ice among thickness categories</span>
<a name="l01090"></a>01090 <span class="comment">!</span>
<a name="l01091"></a>01091 <span class="comment">! !DESCRIPTION:</span>
<a name="l01092"></a>01092 <span class="comment">!</span>
<a name="l01093"></a>01093 <span class="comment">! Remove area, volume, and energy from each ridging category</span>
<a name="l01094"></a>01094 <span class="comment">! and add to thicker ice categories.</span>
<a name="l01095"></a>01095 <span class="comment">!</span>
<a name="l01096"></a>01096 <span class="comment">! !REVISION HISTORY:</span>
<a name="l01097"></a>01097 <span class="comment">!</span>
<a name="l01098"></a>01098 <span class="comment">! author: William H. Lipscomb, LANL</span>
<a name="l01099"></a>01099 <span class="comment">!</span>
<a name="l01100"></a>01100 <span class="comment">! !INTERFACE:</span>
<a name="l01101"></a>01101 <span class="comment">!</span>
<a name="l01102"></a><a class="code" href="namespaceice__mechred.html#ad5b2abaa36fa52ab9a96420dbf8d48cc">01102</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#ad5b2abaa36fa52ab9a96420dbf8d48cc">ridge_shift</a> (nx_block,    ny_block,        &amp;
<a name="l01103"></a>01103                               icells,      indxi,    indxj, &amp;
<a name="l01104"></a>01104                               dt,                           &amp;
<a name="l01105"></a>01105                               aicen,       trcrn,           &amp;
<a name="l01106"></a>01106                               vicen,       vsnon,           &amp;
<a name="l01107"></a>01107                               eicen,       esnon,           &amp;
<a name="l01108"></a>01108                               aice0,       trcr_depend,     &amp;   
<a name="l01109"></a>01109                               aksum,       apartic,         &amp;
<a name="l01110"></a>01110                               hrmin,       hrmax,           &amp;
<a name="l01111"></a>01111                               hrexp,       krdg,            &amp;
<a name="l01112"></a>01112                               closing_net, opning,          &amp;
<a name="l01113"></a>01113                               ardg1,       ardg2,           &amp;
<a name="l01114"></a>01114                               virdg,       aopen,           &amp;
<a name="l01115"></a>01115                               msnow_mlt,   esnow_mlt,       &amp;
<a name="l01116"></a>01116                               msoot,                        &amp;
<a name="l01117"></a>01117                               l_stop,                       &amp;
<a name="l01118"></a>01118                               istop,       jstop)
<a name="l01119"></a>01119 <span class="comment">!</span>
<a name="l01120"></a>01120 <span class="comment">! !USES:</span>
<a name="l01121"></a>01121 <span class="comment">!</span>
<a name="l01122"></a>01122       use <span class="keywordflow">ice_state</span>, only: nt_aero
<a name="l01123"></a>01123 <span class="comment">!</span>
<a name="l01124"></a>01124 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l01125"></a>01125 <span class="comment">!</span>
<a name="l01126"></a>01126       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01127"></a>01127          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l01128"></a>01128          icells                <span class="comment">! number of cells with ice present</span>
<a name="l01129"></a>01129 
<a name="l01130"></a>01130       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l01131"></a>01131          <span class="keywordtype">intent(in)</span> :: 
<a name="l01132"></a>01132          indxi, indxj     <span class="comment">! compressed indices for cells with ice</span>
<a name="l01133"></a>01133 
<a name="l01134"></a>01134       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01135"></a>01135          dt                  <span class="comment">! time step (s)</span>
<a name="l01136"></a>01136 
<a name="l01137"></a>01137       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (ntrcr)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01138"></a>01138          trcr_depend <span class="comment">! = 0 for aicen tracers, 1 for vicen, 2 for vsnon</span>
<a name="l01139"></a>01139 
<a name="l01140"></a>01140       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block)</span>, 
<a name="l01141"></a>01141          <span class="keywordtype">intent(inout)</span> :: 
<a name="l01142"></a>01142          aice0     <span class="comment">! concentration of open water</span>
<a name="l01143"></a>01143 
<a name="l01144"></a>01144       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ncat)</span>, 
<a name="l01145"></a>01145          <span class="keywordtype">intent(inout)</span> :: 
<a name="l01146"></a>01146          aicen ,  <span class="comment">! concentration of ice</span>
<a name="l01147"></a>01147          vicen ,  <span class="comment">! volume per unit area of ice          (m)</span>
<a name="l01148"></a>01148          vsnon     <span class="comment">! volume per unit area of snow         (m)</span>
<a name="l01149"></a>01149 
<a name="l01150"></a>01150       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ntrcr,ncat)</span>, 
<a name="l01151"></a>01151          <span class="keywordtype">intent(inout)</span> :: 
<a name="l01152"></a>01152          trcrn     <span class="comment">! ice tracers</span>
<a name="l01153"></a>01153 
<a name="l01154"></a>01154       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ntilyr)</span>, 
<a name="l01155"></a>01155          <span class="keywordtype">intent(inout)</span> :: 
<a name="l01156"></a>01156          eicen     <span class="comment">! energy of melting for each ice layer (J/m^2)</span>
<a name="l01157"></a>01157 
<a name="l01158"></a>01158       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ntslyr)</span>, 
<a name="l01159"></a>01159          <span class="keywordtype">intent(inout)</span> :: 
<a name="l01160"></a>01160          esnon     <span class="comment">! energy of melting for each snow layer (J/m^2)</span>
<a name="l01161"></a>01161 
<a name="l01162"></a>01162       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01163"></a>01163          aksum             <span class="comment">! ratio of area removed to area ridged</span>
<a name="l01164"></a>01164 
<a name="l01165"></a>01165       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,0:ncat)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01166"></a>01166          apartic          <span class="comment">! participation function; fraction of ridging</span>
<a name="l01167"></a>01167                           <span class="comment">! and closing associated w/ category n</span>
<a name="l01168"></a>01168 
<a name="l01169"></a>01169       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ncat)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01170"></a>01170          hrmin        ,  <span class="comment">! minimum ridge thickness</span>
<a name="l01171"></a>01171          hrmax        ,  <span class="comment">! maximum ridge thickness (krdg_redist = 0)</span>
<a name="l01172"></a>01172          hrexp        ,  <span class="comment">! ridge e-folding thickness (krdg_redist = 1) </span>
<a name="l01173"></a>01173          krdg             <span class="comment">! mean ridge thickness/thickness of ridging ice</span>
<a name="l01174"></a>01174 
<a name="l01175"></a>01175       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells)</span>, <span class="keywordtype">intent(inout)</span> :: 
<a name="l01176"></a>01176          closing_net,  <span class="comment">! net rate at which area is removed    (1/s)</span>
<a name="l01177"></a>01177          opning     ,  <span class="comment">! rate of opening due to divergence/shear (1/s)</span>
<a name="l01178"></a>01178          ardg1      ,  <span class="comment">! fractional area loss by ridging ice</span>
<a name="l01179"></a>01179          ardg2      ,  <span class="comment">! fractional area gain by new ridges</span>
<a name="l01180"></a>01180          virdg      ,  <span class="comment">! ice volume ridged (m)</span>
<a name="l01181"></a>01181          aopen          <span class="comment">! area opened due to divergence/shear</span>
<a name="l01182"></a>01182 
<a name="l01183"></a>01183       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells)</span>, <span class="keywordtype">intent(inout)</span> :: 
<a name="l01184"></a>01184          msnow_mlt,  <span class="comment">! mass of snow added to ocean (kg m-2)</span>
<a name="l01185"></a>01185          esnow_mlt    <span class="comment">! energy needed to melt snow in ocean (J m-2)</span>
<a name="l01186"></a>01186 
<a name="l01187"></a>01187       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells,n_aeromx)</span>, <span class="keywordtype">intent(inout)</span> :: 
<a name="l01188"></a>01188          msoot      <span class="comment">! mass of soot added to ocean (kg m-2)</span>
<a name="l01189"></a>01189 
<a name="l01190"></a>01190       <span class="keywordtype">logical (kind=log_kind)</span>, <span class="keywordtype">intent(inout)</span> :: 
<a name="l01191"></a>01191          l_stop   <span class="comment">! if true, abort on return</span>
<a name="l01192"></a>01192 
<a name="l01193"></a>01193       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(inout)</span> :: 
<a name="l01194"></a>01194          istop, jstop <span class="comment">! indices of grid cell where model aborts</span>
<a name="l01195"></a>01195 <span class="comment">!</span>
<a name="l01196"></a>01196 <span class="comment">!EOP</span>
<a name="l01197"></a>01197 <span class="comment">!</span>
<a name="l01198"></a>01198       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l01199"></a>01199          i,j           ,  <span class="comment">! horizontal indices</span>
<a name="l01200"></a>01200          n, nr         ,  <span class="comment">! thickness category indices</span>
<a name="l01201"></a>01201          k             ,  <span class="comment">! ice layer index</span>
<a name="l01202"></a>01202          it            ,  <span class="comment">! tracer index</span>
<a name="l01203"></a>01203          ij, m         ,  <span class="comment">! horizontal indices, combine i and j loops</span>
<a name="l01204"></a>01204          iridge            <span class="comment">! number of cells with nonzero ridging</span>
<a name="l01205"></a>01205       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l01206"></a>01206          iaero             <span class="comment">! index for number of aerosol tracers</span>
<a name="l01207"></a>01207 
<a name="l01208"></a>01208       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (icells) </span>:: 
<a name="l01209"></a>01209          indxii, indxjj  ,  <span class="comment">! compressed indices</span>
<a name="l01210"></a>01210          indxij              <span class="comment">! compressed indices</span>
<a name="l01211"></a>01211 
<a name="l01212"></a>01212       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ncat) </span>:: 
<a name="l01213"></a>01213          aicen_init    ,  <span class="comment">! ice area before ridging</span>
<a name="l01214"></a>01214          vicen_init    ,  <span class="comment">! ice volume before ridging</span>
<a name="l01215"></a>01215          vsnon_init        <span class="comment">! snow volume before ridging</span>
<a name="l01216"></a>01216 
<a name="l01217"></a>01217       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ntilyr) </span>:: 
<a name="l01218"></a>01218          eicen_init        <span class="comment">! ice energy before ridging</span>
<a name="l01219"></a>01219 
<a name="l01220"></a>01220       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ntslyr) </span>:: 
<a name="l01221"></a>01221          esnon_init        <span class="comment">! snow energy before ridging</span>
<a name="l01222"></a>01222 
<a name="l01223"></a>01223       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension(icells,ntrcr,ncat) </span>:: 
<a name="l01224"></a>01224          atrcrn            <span class="comment">! aicen*trcrn</span>
<a name="l01225"></a>01225 
<a name="l01226"></a>01226       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells) </span>:: 
<a name="l01227"></a>01227          closing_gross     <span class="comment">! rate at which area removed, not counting</span>
<a name="l01228"></a>01228                            <span class="comment">! area of new ridges</span>
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 <span class="comment">! ECH note:  the following arrays only need be defined on iridge cells</span>
<a name="l01231"></a>01231       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells) </span>:: 
<a name="l01232"></a>01232          afrac         ,  <span class="comment">! fraction of category area ridged</span>
<a name="l01233"></a>01233          ardg1n        ,  <span class="comment">! area of ice ridged</span>
<a name="l01234"></a>01234          ardg2n        ,  <span class="comment">! area of new ridges</span>
<a name="l01235"></a>01235          virdgn        ,  <span class="comment">! ridging ice volume</span>
<a name="l01236"></a>01236          vsrdgn        ,  <span class="comment">! ridging snow volume</span>
<a name="l01237"></a>01237          dhr           ,  <span class="comment">! hrmax - hrmin</span>
<a name="l01238"></a>01238          dhr2          ,  <span class="comment">! hrmax^2 - hrmin^2</span>
<a name="l01239"></a>01239          farea         ,  <span class="comment">! fraction of new ridge area going to nr</span>
<a name="l01240"></a>01240          fvol              <span class="comment">! fraction of new ridge volume going to nr</span>
<a name="l01241"></a>01241 
<a name="l01242"></a>01242       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,nilyr) </span>:: 
<a name="l01243"></a>01243          eirdgn            <span class="comment">! ridging ice energy</span>
<a name="l01244"></a>01244 
<a name="l01245"></a>01245       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,nslyr) </span>:: 
<a name="l01246"></a>01246          esrdgn            <span class="comment">! ridging snow energy</span>
<a name="l01247"></a>01247 
<a name="l01248"></a>01248       <span class="keywordtype">real (kind=dbl_kind) </span>:: 
<a name="l01249"></a>01249          hi1           ,  <span class="comment">! thickness of ridging ice</span>
<a name="l01250"></a>01250          hexp          ,  <span class="comment">! ridge e-folding thickness</span>
<a name="l01251"></a>01251          hL, hR        ,  <span class="comment">! left and right limits of integration</span>
<a name="l01252"></a>01252          expL, expR    ,  <span class="comment">! exponentials involving hL, hR</span>
<a name="l01253"></a>01253          tmpfac        ,  <span class="comment">! factor by which opening/closing rates are cut</span>
<a name="l01254"></a>01254          wk1               <span class="comment">! work variable</span>
<a name="l01255"></a>01255 
<a name="l01256"></a>01256       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01257"></a>01257       <span class="comment">! Define variables equal to aicen*trcrn, vicen*trcrn, vsnon*trcrn</span>
<a name="l01258"></a>01258       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01259"></a>01259 
<a name="l01260"></a>01260       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01261"></a>01261          <span class="keyword">do</span> it = 1, ntrcr
<a name="l01262"></a>01262             <span class="keyword">if</span> (trcr_depend(it) == 0) <span class="keyword">then</span> <span class="comment">! ice area tracer</span>
<a name="l01263"></a>01263                <span class="keyword">do</span> ij = 1, icells
<a name="l01264"></a>01264                   i = indxi(ij)
<a name="l01265"></a>01265                   j = indxj(ij)
<a name="l01266"></a>01266                   atrcrn(ij,it,n) = aicen(i,j,n)*trcrn(i,j,it,n)
<a name="l01267"></a>01267                <span class="keyword">enddo</span>
<a name="l01268"></a>01268             elseif (trcr_depend(it) == 1) <span class="keyword">then</span>  <span class="comment">! ice volume tracer</span>
<a name="l01269"></a>01269                <span class="keyword">do</span> ij = 1, icells
<a name="l01270"></a>01270                   i = indxi(ij)
<a name="l01271"></a>01271                   j = indxj(ij)
<a name="l01272"></a>01272                   atrcrn(ij,it,n) = vicen(i,j,n)*trcrn(i,j,it,n)
<a name="l01273"></a>01273                <span class="keyword">enddo</span>
<a name="l01274"></a>01274             elseif (trcr_depend(it) == 2) <span class="keyword">then</span>  <span class="comment">! snow volume tracer</span>
<a name="l01275"></a>01275                <span class="keyword">do</span> ij = 1, icells
<a name="l01276"></a>01276                   i = indxi(ij)
<a name="l01277"></a>01277                   j = indxj(ij)
<a name="l01278"></a>01278                   atrcrn(ij,it,n) = vsnon(i,j,n)*trcrn(i,j,it,n)
<a name="l01279"></a>01279                <span class="keyword">enddo</span> 
<a name="l01280"></a>01280             <span class="keyword">endif</span>
<a name="l01281"></a>01281          <span class="keyword">enddo</span>
<a name="l01282"></a>01282       <span class="keyword">enddo</span>
<a name="l01283"></a>01283 
<a name="l01284"></a>01284       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01285"></a>01285       <span class="comment">! Based on the ITD of ridging and ridged ice, convert the net</span>
<a name="l01286"></a>01286       <span class="comment">!  closing rate to a gross closing rate.</span>
<a name="l01287"></a>01287       <span class="comment">! NOTE: 0 &lt; aksum &lt;= 1</span>
<a name="l01288"></a>01288       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01291"></a>01291 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01292"></a>01292 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01293"></a>01293       <span class="keyword">do</span> ij = 1, icells
<a name="l01294"></a>01294          i = indxi(ij)
<a name="l01295"></a>01295          j = indxj(ij)
<a name="l01296"></a>01296 
<a name="l01297"></a>01297          closing_gross(ij) = closing_net(ij) / aksum(ij)
<a name="l01298"></a>01298 
<a name="l01299"></a>01299       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01300"></a>01300       <span class="comment">! Reduce the closing rate if more than 100% of the open water</span>
<a name="l01301"></a>01301       <span class="comment">! would be removed.  Reduce the opening rate proportionately.</span>
<a name="l01302"></a>01302       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01303"></a>01303 
<a name="l01304"></a>01304          <span class="keyword">if</span> (apartic(ij,0) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l01305"></a>01305             wk1 = apartic(ij,0) * closing_gross(ij) * dt
<a name="l01306"></a>01306             <span class="keyword">if</span> (wk1 &gt; aice0(i,j)) <span class="keyword">then</span>
<a name="l01307"></a>01307                tmpfac = aice0(i,j) / wk1
<a name="l01308"></a>01308                closing_gross(ij) = closing_gross(ij) * tmpfac
<a name="l01309"></a>01309                opning(ij) = opning(ij) * tmpfac
<a name="l01310"></a>01310             <span class="keyword">endif</span>
<a name="l01311"></a>01311          <span class="keyword">endif</span>
<a name="l01312"></a>01312 
<a name="l01313"></a>01313       <span class="keyword">enddo</span>                     <span class="comment">! ij</span>
<a name="l01314"></a>01314 
<a name="l01315"></a>01315       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01316"></a>01316       <span class="comment">! Reduce the closing rate if more than 100% of any ice category</span>
<a name="l01317"></a>01317       <span class="comment">! would be removed.  Reduce the opening rate proportionately.</span>
<a name="l01318"></a>01318       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01319"></a>01319       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01320"></a>01320 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01321"></a>01321 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01322"></a>01322 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01323"></a>01323          <span class="keyword">do</span> ij = 1, icells
<a name="l01324"></a>01324             i = indxi(ij)
<a name="l01325"></a>01325             j = indxj(ij)
<a name="l01326"></a>01326 
<a name="l01327"></a>01327             <span class="keyword">if</span> (aicen(i,j,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a> .and. apartic(ij,n) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l01328"></a>01328                wk1 = apartic(ij,n) * closing_gross(ij) * dt
<a name="l01329"></a>01329                <span class="keyword">if</span> (wk1 &gt; aicen(i,j,n)) <span class="keyword">then</span>
<a name="l01330"></a>01330                   tmpfac = aicen(i,j,n) / wk1
<a name="l01331"></a>01331                   closing_gross(ij) = closing_gross(ij) * tmpfac
<a name="l01332"></a>01332                   opning(ij) = opning(ij) * tmpfac
<a name="l01333"></a>01333                <span class="keyword">endif</span>
<a name="l01334"></a>01334             <span class="keyword">endif</span>
<a name="l01335"></a>01335 
<a name="l01336"></a>01336          <span class="keyword">enddo</span>                  <span class="comment">! ij</span>
<a name="l01337"></a>01337       <span class="keyword">enddo</span>                     <span class="comment">! n</span>
<a name="l01338"></a>01338 
<a name="l01339"></a>01339       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01340"></a>01340       <span class="comment">! Compute change in open water area due to closing and opening.</span>
<a name="l01341"></a>01341       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01342"></a>01342 
<a name="l01343"></a>01343 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01344"></a>01344 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01345"></a>01345 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01346"></a>01346       <span class="keyword">do</span> ij = 1, icells
<a name="l01347"></a>01347          i = indxi(ij)
<a name="l01348"></a>01348          j = indxj(ij)
<a name="l01349"></a>01349          aice0(i,j) = aice0(i,j) &amp;
<a name="l01350"></a>01350                     - apartic(ij,0)*closing_gross(ij)*dt &amp;
<a name="l01351"></a>01351                     + opning(ij)*dt
<a name="l01352"></a>01352          <span class="keyword">if</span> (aice0(i,j) &lt; -<a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l01353"></a>01353             l_stop = .true.
<a name="l01354"></a>01354             istop = i
<a name="l01355"></a>01355             jstop = j
<a name="l01356"></a>01356 
<a name="l01357"></a>01357             <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; &apos;</span>
<a name="l01358"></a>01358             <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;Ridging error: aice0 &lt; 0&apos;</span>
<a name="l01359"></a>01359             <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;i, j, aice0:&apos;</span>, i, j, aice0(i,j)
<a name="l01360"></a>01360             return
<a name="l01361"></a>01361 
<a name="l01362"></a>01362          elseif (aice0(i,j) &lt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>    <span class="comment">! roundoff error</span>
<a name="l01363"></a>01363             aice0(i,j) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01364"></a>01364          <span class="keyword">endif</span>
<a name="l01365"></a>01365 
<a name="l01366"></a>01366          aopen(ij) = opning(ij)*dt  <span class="comment">! optional diagnostic</span>
<a name="l01367"></a>01367 
<a name="l01368"></a>01368       <span class="keyword">enddo</span>
<a name="l01369"></a>01369 
<a name="l01370"></a>01370       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01371"></a>01371       <span class="comment">! Save initial state variables</span>
<a name="l01372"></a>01372       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01373"></a>01373 
<a name="l01374"></a>01374       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01375"></a>01375          <span class="keyword">do</span> ij = 1, icells
<a name="l01376"></a>01376             i = indxi(ij)
<a name="l01377"></a>01377             j = indxj(ij)
<a name="l01378"></a>01378             aicen_init(ij,n) = aicen(i,j,n)
<a name="l01379"></a>01379             vicen_init(ij,n) = vicen(i,j,n)
<a name="l01380"></a>01380             vsnon_init(ij,n) = vsnon(i,j,n)
<a name="l01381"></a>01381          <span class="keyword">enddo</span>
<a name="l01382"></a>01382       <span class="keyword">enddo</span>
<a name="l01383"></a>01383 
<a name="l01384"></a>01384       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#a46a923e86a6a0f553260f445f9faf5c9">ntilyr</a>
<a name="l01385"></a>01385          <span class="keyword">do</span> ij = 1, icells
<a name="l01386"></a>01386             i = indxi(ij)
<a name="l01387"></a>01387             j = indxj(ij)
<a name="l01388"></a>01388             eicen_init(ij,n) = eicen(i,j,n)
<a name="l01389"></a>01389          <span class="keyword">enddo</span>
<a name="l01390"></a>01390       <span class="keyword">enddo</span>
<a name="l01391"></a>01391 
<a name="l01392"></a>01392       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#a2b95950726524c87034f6468ba946b2a">ntslyr</a>
<a name="l01393"></a>01393          <span class="keyword">do</span> ij = 1, icells
<a name="l01394"></a>01394             i = indxi(ij)
<a name="l01395"></a>01395             j = indxj(ij)
<a name="l01396"></a>01396             esnon_init(ij,n) = esnon(i,j,n)
<a name="l01397"></a>01397          <span class="keyword">enddo</span>
<a name="l01398"></a>01398       <span class="keyword">enddo</span>
<a name="l01399"></a>01399 
<a name="l01400"></a>01400       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01401"></a>01401       <span class="comment">! Compute the area, volume, and energy of ice ridging in each</span>
<a name="l01402"></a>01402       <span class="comment">!  category, along with the area of the resulting ridge.</span>
<a name="l01403"></a>01403       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01404"></a>01404 
<a name="l01405"></a>01405       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01406"></a>01406 
<a name="l01407"></a>01407       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01408"></a>01408       <span class="comment">! Identify grid cells with nonzero ridging</span>
<a name="l01409"></a>01409       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01410"></a>01410 
<a name="l01411"></a>01411          iridge = 0
<a name="l01412"></a>01412          <span class="keyword">do</span> ij = 1, icells
<a name="l01413"></a>01413             i = indxi(ij)
<a name="l01414"></a>01414             j = indxj(ij)
<a name="l01415"></a>01415             <span class="keyword">if</span> (aicen_init(ij,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a> .and. apartic(ij,n) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a> &amp;
<a name="l01416"></a>01416                  .and. closing_gross(ij) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>) <span class="keyword">then</span>
<a name="l01417"></a>01417                iridge = iridge + 1
<a name="l01418"></a>01418                indxii(iridge) = i
<a name="l01419"></a>01419                indxjj(iridge) = j
<a name="l01420"></a>01420                indxij(iridge) = ij
<a name="l01421"></a>01421             <span class="keyword">endif</span>
<a name="l01422"></a>01422          <span class="keyword">enddo</span>                  <span class="comment">! ij</span>
<a name="l01423"></a>01423 
<a name="l01424"></a>01424 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01425"></a>01425 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01426"></a>01426 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01427"></a>01427          <span class="keyword">do</span> ij = 1, iridge
<a name="l01428"></a>01428             i = indxii(ij)
<a name="l01429"></a>01429             j = indxjj(ij)
<a name="l01430"></a>01430             m = indxij(ij)
<a name="l01431"></a>01431 
<a name="l01432"></a>01432       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01433"></a>01433       <span class="comment">! Compute area of ridging ice (ardg1n) and of new ridge (ardg2n).</span>
<a name="l01434"></a>01434       <span class="comment">! Make sure ridging fraction &lt;=1.  (Roundoff errors can give</span>
<a name="l01435"></a>01435       <span class="comment">!  ardg1 slightly greater than aicen.) </span>
<a name="l01436"></a>01436       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01437"></a>01437 
<a name="l01438"></a>01438             ardg1n(ij) = apartic(m,n)*closing_gross(m)*dt
<a name="l01439"></a>01439 
<a name="l01440"></a>01440             <span class="keyword">if</span> (ardg1n(ij) &gt; aicen_init(m,n) + <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l01441"></a>01441                l_stop = .true.
<a name="l01442"></a>01442                istop = i
<a name="l01443"></a>01443                jstop = j
<a name="l01444"></a>01444 
<a name="l01445"></a>01445                <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos; &apos;</span>
<a name="l01446"></a>01446                <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;Ridging error: ardg &gt; aicen&apos;</span>
<a name="l01447"></a>01447                <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;i, j, n:&apos;</span>, i, j, n
<a name="l01448"></a>01448                <span class="keyword">write</span> (<a class="code" href="namespaceice__fileunits.html#a5a65f292ace9ba700843f3e293922842">nu_diag</a>,*) <span class="stringliteral">&apos;ardg, aicen:&apos;</span>, &amp;
<a name="l01449"></a>01449                     ardg1n(ij), aicen_init(m,n)
<a name="l01450"></a>01450                return
<a name="l01451"></a>01451             <span class="keyword">else</span>
<a name="l01452"></a>01452                ardg1n(ij) = min(aicen_init(m,n), ardg1n(ij))
<a name="l01453"></a>01453             <span class="keyword">endif</span>
<a name="l01454"></a>01454 
<a name="l01455"></a>01455             ardg2n(ij) = ardg1n(ij) / krdg(m,n)
<a name="l01456"></a>01456             afrac(ij) = ardg1n(ij) / aicen_init(m,n)
<a name="l01457"></a>01457 
<a name="l01458"></a>01458       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01459"></a>01459       <span class="comment">! Subtract area, volume, and energy from ridging category n.</span>
<a name="l01460"></a>01460       <span class="comment">! Note: Tracer values are unchanged.</span>
<a name="l01461"></a>01461       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01462"></a>01462 
<a name="l01463"></a>01463             virdgn(ij) = vicen_init(m,n) * afrac(ij)
<a name="l01464"></a>01464             vsrdgn(ij) = vsnon_init(m,n) * afrac(ij)
<a name="l01465"></a>01465 
<a name="l01466"></a>01466             aicen(i,j,n) = aicen(i,j,n) - ardg1n(ij)
<a name="l01467"></a>01467             vicen(i,j,n) = vicen(i,j,n) - virdgn(ij)
<a name="l01468"></a>01468             vsnon(i,j,n) = vsnon(i,j,n) - vsrdgn(ij)
<a name="l01469"></a>01469 
<a name="l01470"></a>01470       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01471"></a>01471       <span class="comment">! Increment ridging diagnostics</span>
<a name="l01472"></a>01472       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01473"></a>01473 
<a name="l01474"></a>01474             ardg1(m) = ardg1(m) + ardg1n(ij)
<a name="l01475"></a>01475             ardg2(m) = ardg2(m) + ardg2n(ij)
<a name="l01476"></a>01476             virdg(m) = virdg(m) + virdgn(ij)
<a name="l01477"></a>01477 
<a name="l01478"></a>01478       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01479"></a>01479       <span class="comment">!  Place part of the snow lost by ridging into the ocean.</span>
<a name="l01480"></a>01480       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01481"></a>01481 
<a name="l01482"></a>01482             msnow_mlt(m) = msnow_mlt(m) + <a class="code" href="namespaceice__constants.html#ae2404a45dc46ecdb371055dd52dcfe1f">rhos</a>*vsrdgn(ij)*(<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-<a class="code" href="namespaceice__mechred.html#a528a8cc57e3a5cb9d679d26baa6cec27">fsnowrdg</a>)
<a name="l01483"></a>01483 
<a name="l01484"></a>01484       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01485"></a>01485       <span class="comment">!  Place part of the soot lost by ridging into the ocean.</span>
<a name="l01486"></a>01486       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01487"></a>01487 
<a name="l01488"></a>01488             <span class="keyword">if</span> (n_aero &gt;= 1) <span class="keyword">then</span>
<a name="l01489"></a>01489                <span class="keyword">do</span> iaero=1,n_aero
<a name="l01490"></a>01490                 msoot(m,iaero) = msoot(m,iaero) &amp;
<a name="l01491"></a>01491                         + vsrdgn(ij)*(<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-<a class="code" href="namespaceice__mechred.html#a528a8cc57e3a5cb9d679d26baa6cec27">fsnowrdg</a>) &amp;
<a name="l01492"></a>01492                         *(trcrn(i,j,<a class="code" href="namespaceice__state.html#a17498b6cf9c7353f2704a5cd0b579718">nt_aero</a>  +4*(iaero-1),n)   &amp;
<a name="l01493"></a>01493                         + trcrn(i,j,<a class="code" href="namespaceice__state.html#a17498b6cf9c7353f2704a5cd0b579718">nt_aero</a>+1+4*(iaero-1),n))
<a name="l01494"></a>01494                <span class="keyword">enddo</span>
<a name="l01495"></a>01495             <span class="keyword">endif</span>
<a name="l01496"></a>01496 
<a name="l01497"></a>01497       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01498"></a>01498       <span class="comment">! Compute quantities used to apportion ice among categories</span>
<a name="l01499"></a>01499       <span class="comment">! in the nr loop below</span>
<a name="l01500"></a>01500       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01501"></a>01501 
<a name="l01502"></a>01502             dhr(ij)  = hrmax(ij,n) - hrmin(m,n)
<a name="l01503"></a>01503             dhr2(ij) = hrmax(ij,n) * hrmax(ij,n) - hrmin(m,n) * hrmin(m,n)
<a name="l01504"></a>01504 
<a name="l01505"></a>01505          <span class="keyword">enddo</span>                  <span class="comment">! ij</span>
<a name="l01506"></a>01506 
<a name="l01507"></a>01507       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01508"></a>01508       <span class="comment">! Subtract ice energy from ridging category n.</span>
<a name="l01509"></a>01509       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01510"></a>01510 
<a name="l01511"></a>01511          <span class="keyword">do</span> k = 1, <a class="code" href="namespaceice__domain__size.html#a5c1a0b8bcf4dc16b485be17beea4f6bf">nilyr</a>
<a name="l01512"></a>01512 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01513"></a>01513 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01514"></a>01514 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01515"></a>01515             <span class="keyword">do</span> ij = 1, iridge
<a name="l01516"></a>01516                i = indxii(ij)
<a name="l01517"></a>01517                j = indxjj(ij)
<a name="l01518"></a>01518                m = indxij(ij)
<a name="l01519"></a>01519 
<a name="l01520"></a>01520                eirdgn(ij,k) = eicen_init(m,ilyr1(n)+k-1) * afrac(ij)
<a name="l01521"></a>01521                eicen(i,j,ilyr1(n)+k-1) = eicen (i,j,ilyr1(n)+k-1) &amp;
<a name="l01522"></a>01522                                        - eirdgn(ij,k)
<a name="l01523"></a>01523             <span class="keyword">enddo</span>
<a name="l01524"></a>01524          <span class="keyword">enddo</span>
<a name="l01525"></a>01525 
<a name="l01526"></a>01526       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01527"></a>01527       <span class="comment">! Subtract snow energy from ridging category n.</span>
<a name="l01528"></a>01528       <span class="comment">! Increment energy needed to melt snow in ocean.</span>
<a name="l01529"></a>01529       <span class="comment">! Note that esnow_mlt &lt; 0; the ocean must cool to melt snow.</span>
<a name="l01530"></a>01530       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01531"></a>01531 
<a name="l01532"></a>01532          <span class="keyword">do</span> k = 1, <a class="code" href="namespaceice__domain__size.html#aa5abf2eae8654b241bf06dac90d70c6b">nslyr</a>
<a name="l01533"></a>01533 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01534"></a>01534 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01535"></a>01535 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01536"></a>01536             <span class="keyword">do</span> ij = 1, iridge
<a name="l01537"></a>01537                i = indxii(ij)
<a name="l01538"></a>01538                j = indxjj(ij)
<a name="l01539"></a>01539                m = indxij(ij)
<a name="l01540"></a>01540 
<a name="l01541"></a>01541                esrdgn(ij,k) = esnon_init(m,slyr1(n)+k-1) * afrac(ij)
<a name="l01542"></a>01542                esnon(i,j,slyr1(n)+k-1) = esnon (i,j,slyr1(n)+k-1) &amp;
<a name="l01543"></a>01543                                        - esrdgn(ij,k)
<a name="l01544"></a>01544                esnow_mlt(m) = esnow_mlt(m) &amp;
<a name="l01545"></a>01545                               + esrdgn(ij,k)*(<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-<a class="code" href="namespaceice__mechred.html#a528a8cc57e3a5cb9d679d26baa6cec27">fsnowrdg</a>)
<a name="l01546"></a>01546            <span class="keyword">enddo</span>
<a name="l01547"></a>01547          <span class="keyword">enddo</span>
<a name="l01548"></a>01548 
<a name="l01549"></a>01549       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01550"></a>01550       <span class="comment">! Subtract area- and volume-weighted tracers from category n.</span>
<a name="l01551"></a>01551       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01552"></a>01552 
<a name="l01553"></a>01553          <span class="keyword">do</span> it = 1, ntrcr
<a name="l01554"></a>01554             <span class="keyword">if</span> (trcr_depend(it) == 0) <span class="keyword">then</span> <span class="comment">! ice area tracer</span>
<a name="l01555"></a>01555 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01556"></a>01556 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01557"></a>01557 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01558"></a>01558                <span class="keyword">do</span> ij = 1, iridge
<a name="l01559"></a>01559                   i = indxii(ij)
<a name="l01560"></a>01560                   j = indxjj(ij)
<a name="l01561"></a>01561                   m = indxij(ij)
<a name="l01562"></a>01562                   atrcrn(m,it,n) = atrcrn(m,it,n) &amp;
<a name="l01563"></a>01563                                    - ardg1n(ij)*trcrn(i,j,it,n)
<a name="l01564"></a>01564                <span class="keyword">enddo</span>
<a name="l01565"></a>01565 
<a name="l01566"></a>01566             elseif (trcr_depend(it) == 1) <span class="keyword">then</span> <span class="comment">! ice volume tracer</span>
<a name="l01567"></a>01567 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01568"></a>01568 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01569"></a>01569 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01570"></a>01570                <span class="keyword">do</span> ij = 1, iridge
<a name="l01571"></a>01571                   i = indxii(ij)
<a name="l01572"></a>01572                   j = indxjj(ij)
<a name="l01573"></a>01573                   m = indxij(ij)
<a name="l01574"></a>01574                   atrcrn(m,it,n) = atrcrn(m,it,n) &amp;
<a name="l01575"></a>01575                                    - virdgn(ij)*trcrn(i,j,it,n)
<a name="l01576"></a>01576                <span class="keyword">enddo</span>
<a name="l01577"></a>01577 
<a name="l01578"></a>01578             elseif (trcr_depend(it) == 2) <span class="keyword">then</span> <span class="comment">! snow volume tracer</span>
<a name="l01579"></a>01579 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01580"></a>01580 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01581"></a>01581 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01582"></a>01582                <span class="keyword">do</span> ij = 1, iridge
<a name="l01583"></a>01583                   i = indxii(ij)
<a name="l01584"></a>01584                   j = indxjj(ij)
<a name="l01585"></a>01585                   m = indxij(ij)
<a name="l01586"></a>01586                   atrcrn(m,it,n) = atrcrn(m,it,n) &amp;
<a name="l01587"></a>01587                                    - vsrdgn(ij)*trcrn(i,j,it,n)
<a name="l01588"></a>01588                <span class="keyword">enddo</span>
<a name="l01589"></a>01589             <span class="keyword">endif</span>               <span class="comment">! trcr_depend</span>
<a name="l01590"></a>01590          <span class="keyword">enddo</span>                  <span class="comment">! ntrcr</span>
<a name="l01591"></a>01591 
<a name="l01592"></a>01592 
<a name="l01593"></a>01593       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01594"></a>01594       <span class="comment">! Add area, volume, and energy of new ridge to each category nr.</span>
<a name="l01595"></a>01595       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01596"></a>01596 
<a name="l01597"></a>01597          <span class="keyword">do</span> nr = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01598"></a>01598 
<a name="l01599"></a>01599             <span class="keyword">if</span> (krdg_redist == 0) <span class="keyword">then</span> <span class="comment">! Hibler 1980 formulation</span>
<a name="l01600"></a>01600 
<a name="l01601"></a>01601                <span class="keyword">do</span> ij = 1, iridge
<a name="l01602"></a>01602                   m = indxij(ij)
<a name="l01603"></a>01603 
<a name="l01604"></a>01604       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01605"></a>01605       <span class="comment">! Compute the fraction of ridged ice area and volume going to</span>
<a name="l01606"></a>01606       <span class="comment">!  thickness category nr.</span>
<a name="l01607"></a>01607       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01608"></a>01608 
<a name="l01609"></a>01609                   <span class="keyword">if</span> (hrmin(m,n) &gt;= <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr) .or. &amp;
<a name="l01610"></a>01610                       hrmax(ij,n) &lt;= <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr-1)) <span class="keyword">then</span>
<a name="l01611"></a>01611                      hL = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01612"></a>01612                      hR = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01613"></a>01613                   <span class="keyword">else</span>
<a name="l01614"></a>01614                      hL = max (hrmin(m,n), <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr-1))
<a name="l01615"></a>01615                      hR = min (hrmax(ij,n), <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr))
<a name="l01616"></a>01616                   <span class="keyword">endif</span>
<a name="l01617"></a>01617 
<a name="l01618"></a>01618                   farea(ij) = (hR-hL) / dhr(ij)
<a name="l01619"></a>01619                   fvol (ij) = (hR*hR - hL*hL) / dhr2(ij)
<a name="l01620"></a>01620 
<a name="l01621"></a>01621                <span class="keyword">enddo</span>            <span class="comment">! ij</span>
<a name="l01622"></a>01622 
<a name="l01623"></a>01623             <span class="keyword">else</span>         <span class="comment">! krdg_redist = 1; 2005 exponential formulation</span>
<a name="l01624"></a>01624 
<a name="l01625"></a>01625       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01626"></a>01626       <span class="comment">! Compute the fraction of ridged ice area and volume going to</span>
<a name="l01627"></a>01627       <span class="comment">!  thickness category nr.</span>
<a name="l01628"></a>01628       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01629"></a>01629 
<a name="l01630"></a>01630                <span class="keyword">if</span> (nr &lt; <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>) <span class="keyword">then</span>
<a name="l01631"></a>01631 
<a name="l01632"></a>01632                   <span class="keyword">do</span> ij = 1, iridge
<a name="l01633"></a>01633                      m = indxij(ij)
<a name="l01634"></a>01634 
<a name="l01635"></a>01635                      hi1  = hrmin(m,n)
<a name="l01636"></a>01636                      hexp = hrexp(m,n)
<a name="l01637"></a>01637 
<a name="l01638"></a>01638                      <span class="keyword">if</span> (hi1 &gt;= <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr)) <span class="keyword">then</span>
<a name="l01639"></a>01639                         farea(ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01640"></a>01640                         fvol (ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01641"></a>01641                      <span class="keyword">else</span>
<a name="l01642"></a>01642                         hL = max (hi1, <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr-1))
<a name="l01643"></a>01643                         hR = <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr)
<a name="l01644"></a>01644                         expL = exp(-(hL-hi1)/hexp)
<a name="l01645"></a>01645                         expR = exp(-(hR-hi1)/hexp)
<a name="l01646"></a>01646                         farea(ij) = expL - expR
<a name="l01647"></a>01647                         fvol (ij) = ((hL + hexp)*expL  &amp;
<a name="l01648"></a>01648                                     - (hR + hexp)*expR) / (hi1 + hexp)
<a name="l01649"></a>01649                      <span class="keyword">endif</span>
<a name="l01650"></a>01650                   <span class="keyword">enddo</span>         <span class="comment">! ij</span>
<a name="l01651"></a>01651 
<a name="l01652"></a>01652                <span class="keyword">else</span>             <span class="comment">! nr = ncat</span>
<a name="l01653"></a>01653 
<a name="l01654"></a>01654                   <span class="keyword">do</span> ij = 1, iridge
<a name="l01655"></a>01655                      m = indxij(ij)
<a name="l01656"></a>01656 
<a name="l01657"></a>01657                      hi1  = hrmin(m,n)
<a name="l01658"></a>01658                      hexp = hrexp(m,n)
<a name="l01659"></a>01659 
<a name="l01660"></a>01660                      hL = max (hi1, <a class="code" href="namespaceice__itd.html#aa7b9ac33772390c73597dec2ed768aba">hin_max</a>(nr-1))
<a name="l01661"></a>01661                      expL = exp(-(hL-hi1)/hexp)
<a name="l01662"></a>01662                      farea(ij) = expL
<a name="l01663"></a>01663                      fvol (ij) = (hL + hexp)*expL / (hi1 + hexp)
<a name="l01664"></a>01664 
<a name="l01665"></a>01665                   <span class="keyword">enddo</span>
<a name="l01666"></a>01666 
<a name="l01667"></a>01667                <span class="keyword">endif</span>            <span class="comment">! nr &lt; ncat</span>
<a name="l01668"></a>01668 
<a name="l01669"></a>01669             <span class="keyword">endif</span>               <span class="comment">! krdg_redist</span>
<a name="l01670"></a>01670 
<a name="l01671"></a>01671       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01672"></a>01672       <span class="comment">! Transfer ice area, ice volume, and snow volume to category nr.</span>
<a name="l01673"></a>01673       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01674"></a>01674 
<a name="l01675"></a>01675 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01676"></a>01676 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01677"></a>01677 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01678"></a>01678             <span class="keyword">do</span> ij = 1, iridge
<a name="l01679"></a>01679                i = indxii(ij)
<a name="l01680"></a>01680                j = indxjj(ij)
<a name="l01681"></a>01681                aicen(i,j,nr) = aicen(i,j,nr) + farea(ij)*ardg2n(ij)
<a name="l01682"></a>01682                vicen(i,j,nr) = vicen(i,j,nr) + fvol(ij) *virdgn(ij)
<a name="l01683"></a>01683                vsnon(i,j,nr) = vsnon(i,j,nr) &amp;
<a name="l01684"></a>01684                              + fvol(ij)*vsrdgn(ij)*<a class="code" href="namespaceice__mechred.html#a528a8cc57e3a5cb9d679d26baa6cec27">fsnowrdg</a>
<a name="l01685"></a>01685             <span class="keyword">enddo</span>
<a name="l01686"></a>01686 
<a name="l01687"></a>01687       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01688"></a>01688       <span class="comment">! Transfer ice energy to category nr</span>
<a name="l01689"></a>01689       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01690"></a>01690             <span class="keyword">do</span> k = 1, <a class="code" href="namespaceice__domain__size.html#a5c1a0b8bcf4dc16b485be17beea4f6bf">nilyr</a>
<a name="l01691"></a>01691 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01692"></a>01692 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01693"></a>01693 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01694"></a>01694                <span class="keyword">do</span> ij = 1, iridge
<a name="l01695"></a>01695                   i = indxii(ij)
<a name="l01696"></a>01696                   j = indxjj(ij)
<a name="l01697"></a>01697                   eicen(i,j,ilyr1(nr)+k-1) = eicen(i,j,ilyr1(nr)+k-1) &amp;
<a name="l01698"></a>01698                                            + fvol(ij)*eirdgn(ij,k)
<a name="l01699"></a>01699                <span class="keyword">enddo</span>            <span class="comment">! ij</span>
<a name="l01700"></a>01700             <span class="keyword">enddo</span>               <span class="comment">! k</span>
<a name="l01701"></a>01701 
<a name="l01702"></a>01702       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01703"></a>01703       <span class="comment">! Transfer snow energy to category nr</span>
<a name="l01704"></a>01704       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01705"></a>01705             <span class="keyword">do</span> k = 1, <a class="code" href="namespaceice__domain__size.html#aa5abf2eae8654b241bf06dac90d70c6b">nslyr</a>
<a name="l01706"></a>01706 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01707"></a>01707 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01708"></a>01708 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01709"></a>01709                <span class="keyword">do</span> ij = 1, iridge
<a name="l01710"></a>01710                   i = indxii(ij)
<a name="l01711"></a>01711                   j = indxjj(ij)
<a name="l01712"></a>01712                   esnon(i,j,slyr1(nr)+k-1) = esnon(i,j,slyr1(nr)+k-1) &amp;
<a name="l01713"></a>01713                                     + fvol(ij)*esrdgn(ij,k)*<a class="code" href="namespaceice__mechred.html#a528a8cc57e3a5cb9d679d26baa6cec27">fsnowrdg</a>
<a name="l01714"></a>01714                <span class="keyword">enddo</span>            <span class="comment">! ij</span>
<a name="l01715"></a>01715             <span class="keyword">enddo</span>               <span class="comment">! k</span>
<a name="l01716"></a>01716 
<a name="l01717"></a>01717       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01718"></a>01718       <span class="comment">! Transfer area-weighted and volume-weighted tracers to category nr.</span>
<a name="l01719"></a>01719       <span class="comment">! Note: The global sum aicen*trcrn of ice area tracers </span>
<a name="l01720"></a>01720       <span class="comment">!       (trcr_depend = 0) is not conserved by ridging.</span>
<a name="l01721"></a>01721       <span class="comment">!       However, ridging conserves the global sum of volume</span>
<a name="l01722"></a>01722       <span class="comment">!       tracers (trcr_depend = 1 or 2).</span>
<a name="l01723"></a>01723       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01724"></a>01724 
<a name="l01725"></a>01725             <span class="keyword">do</span> it = 1, ntrcr
<a name="l01726"></a>01726                <span class="keyword">if</span> (trcr_depend(it) == 0) <span class="keyword">then</span>  <span class="comment">! ice area tracer</span>
<a name="l01727"></a>01727 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01728"></a>01728 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01729"></a>01729 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01730"></a>01730                   <span class="keyword">do</span> ij = 1, iridge
<a name="l01731"></a>01731                      i = indxii(ij)
<a name="l01732"></a>01732                      j = indxjj(ij)
<a name="l01733"></a>01733                      m = indxij(ij)
<a name="l01734"></a>01734                      atrcrn(m,it,nr) = atrcrn(m,it,nr) &amp;
<a name="l01735"></a>01735                                 + farea(ij)*ardg2n(ij)*trcrn(i,j,it,n)
<a name="l01736"></a>01736 
<a name="l01737"></a>01737                   <span class="keyword">enddo</span>
<a name="l01738"></a>01738                elseif (trcr_depend(it) == 1) <span class="keyword">then</span> <span class="comment">! ice volume tracer</span>
<a name="l01739"></a>01739 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01740"></a>01740 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01741"></a>01741 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01742"></a>01742                   <span class="keyword">do</span> ij = 1, iridge
<a name="l01743"></a>01743                      i = indxii(ij)
<a name="l01744"></a>01744                      j = indxjj(ij)
<a name="l01745"></a>01745                      m = indxij(ij)
<a name="l01746"></a>01746                      atrcrn(m,it,nr) = atrcrn(m,it,nr) &amp;
<a name="l01747"></a>01747                                  + fvol(ij)*virdgn(ij)*trcrn(i,j,it,n)
<a name="l01748"></a>01748 
<a name="l01749"></a>01749                   <span class="keyword">enddo</span>
<a name="l01750"></a>01750                elseif (trcr_depend(it) == 2) <span class="keyword">then</span> <span class="comment">! snow volume tracer</span>
<a name="l01751"></a>01751 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01752"></a>01752 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01753"></a>01753 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01754"></a>01754                   <span class="keyword">do</span> ij = 1, iridge
<a name="l01755"></a>01755                      i = indxii(ij)
<a name="l01756"></a>01756                      j = indxjj(ij)
<a name="l01757"></a>01757                      m = indxij(ij)
<a name="l01758"></a>01758                      atrcrn(m,it,nr) = atrcrn(m,it,nr) &amp;
<a name="l01759"></a>01759                         + fvol(ij)*vsrdgn(ij)*<a class="code" href="namespaceice__mechred.html#a528a8cc57e3a5cb9d679d26baa6cec27">fsnowrdg</a>*trcrn(i,j,it,n)
<a name="l01760"></a>01760 
<a name="l01761"></a>01761                   <span class="keyword">enddo</span>
<a name="l01762"></a>01762                <span class="keyword">endif</span>            <span class="comment">! trcr_depend</span>
<a name="l01763"></a>01763             <span class="keyword">enddo</span>               <span class="comment">! ntrcr</span>
<a name="l01764"></a>01764 
<a name="l01765"></a>01765          <span class="keyword">enddo</span>                  <span class="comment">! nr (new ridges)</span>
<a name="l01766"></a>01766       <span class="keyword">enddo</span>                     <span class="comment">! n (ridging categories)</span>
<a name="l01767"></a>01767 
<a name="l01768"></a>01768 
<a name="l01769"></a>01769       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01770"></a>01770       <span class="comment">! Compute new tracers</span>
<a name="l01771"></a>01771       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01772"></a>01772 
<a name="l01773"></a>01773       <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01774"></a>01774          call compute_tracers (nx_block,        ny_block,       &amp;
<a name="l01775"></a>01775                                icells,          indxi,   indxj, &amp;
<a name="l01776"></a>01776                                trcr_depend,                     &amp;
<a name="l01777"></a>01777                                atrcrn(:,:,n),   aicen(:,:,  n), &amp;
<a name="l01778"></a>01778                                vicen (:,:,  n), vsnon(:,:,  n), &amp;
<a name="l01779"></a>01779                                trcrn(:,:,:,n))
<a name="l01780"></a>01780       <span class="keyword">enddo</span>
<a name="l01781"></a>01781 
<a name="l01782"></a>01782 <span class="keyword">      end subroutine ridge_shift</span>
<a name="l01783"></a>01783 
<a name="l01784"></a>01784 <span class="comment">!=======================================================================</span>
<a name="l01785"></a>01785 <span class="comment">!BOP</span>
<a name="l01786"></a>01786 <span class="comment">!</span>
<a name="l01787"></a>01787 <span class="comment">! !ROUTINE: ridge_check - check for ice area &gt; 1</span>
<a name="l01788"></a>01788 <span class="comment">!</span>
<a name="l01789"></a>01789 <span class="comment">! !DESCRIPTION: Make sure ice area &lt;=1.  If not, prepare to repeat ridging.</span>
<a name="l01790"></a>01790 <span class="comment">!</span>
<a name="l01791"></a>01791 <span class="comment">! !REVISION HISTORY:</span>
<a name="l01792"></a>01792 <span class="comment">!</span>
<a name="l01793"></a>01793 <span class="comment">! authors William H. Lipscomb, LANL</span>
<a name="l01794"></a>01794 <span class="comment">!</span>
<a name="l01795"></a>01795 <span class="comment">! !INTERFACE:</span>
<a name="l01796"></a>01796 <span class="comment">!</span>
<a name="l01797"></a><a class="code" href="namespaceice__mechred.html#af7cf08ba4d3da94152517c6058b2f219">01797</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#af7cf08ba4d3da94152517c6058b2f219">ridge_check</a> (nx_block,  ny_block,        &amp;
<a name="l01798"></a>01798                               icells,    indxi,    indxj, &amp;
<a name="l01799"></a>01799                               dt,                         &amp;
<a name="l01800"></a>01800                               asum,      closing_net,     &amp;
<a name="l01801"></a>01801                               divu_adv,  opning,          &amp;
<a name="l01802"></a>01802                               iterate_ridging)
<a name="l01803"></a>01803 <span class="comment">!</span>
<a name="l01804"></a>01804 <span class="comment">! !USES:</span>
<a name="l01805"></a>01805 <span class="comment">!</span>
<a name="l01806"></a>01806 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l01807"></a>01807 <span class="comment">!</span>
<a name="l01808"></a>01808       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01809"></a>01809          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l01810"></a>01810          icells                <span class="comment">! number of cells with ice present</span>
<a name="l01811"></a>01811 
<a name="l01812"></a>01812       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l01813"></a>01813          <span class="keywordtype">intent(in)</span> :: 
<a name="l01814"></a>01814          indxi, indxj     <span class="comment">! compressed indices for cells with ice</span>
<a name="l01815"></a>01815 
<a name="l01816"></a>01816 
<a name="l01817"></a>01817       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01818"></a>01818          dt               <span class="comment">! time step (s)</span>
<a name="l01819"></a>01819 
<a name="l01820"></a>01820       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01821"></a>01821          asum             <span class="comment">! sum of ice and open water area</span>
<a name="l01822"></a>01822 
<a name="l01823"></a>01823       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells)</span>, 
<a name="l01824"></a>01824          <span class="keywordtype">intent(inout)</span> :: 
<a name="l01825"></a>01825          closing_net,  <span class="comment">! net rate at which area is removed    (1/s)</span>
<a name="l01826"></a>01826          divu_adv   ,  <span class="comment">! divu as implied by transport scheme  (1/s)</span>
<a name="l01827"></a>01827          opning         <span class="comment">! rate of opening due to divergence/shear</span>
<a name="l01828"></a>01828 
<a name="l01829"></a>01829       <span class="keywordtype">logical (kind=log_kind)</span>, <span class="keywordtype">intent(out)</span> :: 
<a name="l01830"></a>01830          iterate_ridging      <span class="comment">! if true, repeat the ridging</span>
<a name="l01831"></a>01831 <span class="comment">!</span>
<a name="l01832"></a>01832 <span class="comment">!EOP</span>
<a name="l01833"></a>01833 <span class="comment">!</span>
<a name="l01834"></a>01834       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l01835"></a>01835          ij               <span class="comment">! horizontal index, combines i and j loops</span>
<a name="l01836"></a>01836 
<a name="l01837"></a>01837       iterate_ridging = .false.
<a name="l01838"></a>01838 
<a name="l01839"></a>01839       <span class="keyword">do</span> ij = 1, icells
<a name="l01840"></a>01840          <span class="keyword">if</span> (abs(asum(ij) - <a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>) &lt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a>) <span class="keyword">then</span>
<a name="l01841"></a>01841             closing_net(ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01842"></a>01842             opning     (ij) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01843"></a>01843          <span class="keyword">else</span>
<a name="l01844"></a>01844             iterate_ridging = .true.
<a name="l01845"></a>01845             divu_adv(ij) = (<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a> - asum(ij)) / dt
<a name="l01846"></a>01846             closing_net(ij) = max(<a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>, -divu_adv(ij))
<a name="l01847"></a>01847             opning(ij) = max(<a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>, divu_adv(ij))
<a name="l01848"></a>01848          <span class="keyword">endif</span>
<a name="l01849"></a>01849       <span class="keyword">enddo</span>
<a name="l01850"></a>01850 
<a name="l01851"></a>01851 <span class="keyword">      end subroutine ridge_check</span>
<a name="l01852"></a>01852 
<a name="l01853"></a>01853 <span class="comment">!=======================================================================</span>
<a name="l01854"></a>01854 <span class="comment">!BOP</span>
<a name="l01855"></a>01855 <span class="comment">!</span>
<a name="l01856"></a>01856 <span class="comment">! !ROUTINE: ice_strength - compute ice strength</span>
<a name="l01857"></a>01857 <span class="comment">!</span>
<a name="l01858"></a>01858 <span class="comment">! !DESCRIPTION:</span>
<a name="l01859"></a>01859 <span class="comment">!</span>
<a name="l01860"></a>01860 <span class="comment">! Compute the strength of the ice pack, defined as the energy (J m-2)</span>
<a name="l01861"></a>01861 <span class="comment">! dissipated per unit area removed from the ice pack under compression,</span>
<a name="l01862"></a>01862 <span class="comment">! and assumed proportional to the change in potential energy caused</span>
<a name="l01863"></a>01863 <span class="comment">! by ridging.</span>
<a name="l01864"></a>01864 <span class="comment">!</span>
<a name="l01865"></a>01865 <span class="comment">! See Rothrock (1975) and Hibler (1980).</span>
<a name="l01866"></a>01866 <span class="comment">!</span>
<a name="l01867"></a>01867 <span class="comment">! For simpler strength parameterization, see this reference:</span>
<a name="l01868"></a>01868 <span class="comment">! Hibler, W. D. III, 1979: A dynamic-thermodynamic sea ice model,</span>
<a name="l01869"></a>01869 <span class="comment">!  J. Phys. Oceanog., 9, 817-846.</span>
<a name="l01870"></a>01870 <span class="comment">!</span>
<a name="l01871"></a>01871 <span class="comment">! !REVISION HISTORY:</span>
<a name="l01872"></a>01872 <span class="comment">!</span>
<a name="l01873"></a>01873 <span class="comment">! authors: William H. Lipscomb, LANL</span>
<a name="l01874"></a>01874 <span class="comment">!          Elizabeth C. Hunke, LANL</span>
<a name="l01875"></a>01875 <span class="comment">!</span>
<a name="l01876"></a>01876 <span class="comment">! !INTERFACE:</span>
<a name="l01877"></a>01877 <span class="comment">!</span>
<a name="l01878"></a><a class="code" href="namespaceice__mechred.html#a11d0a7efe6faca932079c613d5a7fdb7">01878</a>       <span class="keyword">subroutine </span><a class="code" href="namespaceice__mechred.html#a11d0a7efe6faca932079c613d5a7fdb7">ice_strength</a> (nx_block, ny_block, &amp;
<a name="l01879"></a>01879                                ilo, ihi, jlo, jhi, &amp;
<a name="l01880"></a>01880                                icells,             &amp;
<a name="l01881"></a>01881                                indxi,    indxj,    &amp;
<a name="l01882"></a>01882                                aice,     vice,     &amp;
<a name="l01883"></a>01883                                aice0,    aicen,    &amp;
<a name="l01884"></a>01884                                vicen,    strength)
<a name="l01885"></a>01885 <span class="comment">!</span>
<a name="l01886"></a>01886 <span class="comment">! !USES:</span>
<a name="l01887"></a>01887 <span class="comment">!</span>
<a name="l01888"></a>01888 <span class="comment">! !INPUT/OUTPUT PARAMETERS:</span>
<a name="l01889"></a>01889 <span class="comment">!</span>
<a name="l01890"></a>01890       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01891"></a>01891          nx_block, ny_block,  <span class="comment">! block dimensions</span>
<a name="l01892"></a>01892          ilo,ihi,jlo,jhi       <span class="comment">! beg and end of physical domain</span>
<a name="l01893"></a>01893 
<a name="l01894"></a>01894       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01895"></a>01895          icells       <span class="comment">! no. of cells where icetmask = 1</span>
<a name="l01896"></a>01896 
<a name="l01897"></a>01897       <span class="keywordtype">integer (kind=int_kind)</span>, <span class="keywordtype">dimension (nx_block*ny_block)</span>, 
<a name="l01898"></a>01898          <span class="keywordtype">intent(in)</span> :: 
<a name="l01899"></a>01899          indxi   ,  <span class="comment">! compressed index in i-direction</span>
<a name="l01900"></a>01900          indxj       <span class="comment">! compressed index in j-direction</span>
<a name="l01901"></a>01901 
<a name="l01902"></a>01902       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block)</span>, <span class="keywordtype">intent(in)</span> :: 
<a name="l01903"></a>01903          aice   ,  <span class="comment">! concentration of ice</span>
<a name="l01904"></a>01904          vice   ,  <span class="comment">! volume per unit area of ice  (m)</span>
<a name="l01905"></a>01905          aice0      <span class="comment">! concentration of open water</span>
<a name="l01906"></a>01906 
<a name="l01907"></a>01907       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block,ncat)</span>, 
<a name="l01908"></a>01908          <span class="keywordtype">intent(in)</span> :: 
<a name="l01909"></a>01909          aicen  ,  <span class="comment">! concentration of ice</span>
<a name="l01910"></a>01910          vicen      <span class="comment">! volume per unit area of ice  (m)</span>
<a name="l01911"></a>01911 
<a name="l01912"></a>01912       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (nx_block,ny_block)</span>, <span class="keywordtype">intent(out)</span> :: 
<a name="l01913"></a>01913          strength   <span class="comment">! ice strength (N/m)</span>
<a name="l01914"></a>01914 <span class="comment">!</span>
<a name="l01915"></a>01915 <span class="comment">!EOP</span>
<a name="l01916"></a>01916 <span class="comment">!</span>
<a name="l01917"></a>01917 <span class="comment">! LOCAL VARIABLES</span>
<a name="l01918"></a>01918 <span class="comment">!</span>
<a name="l01919"></a>01919       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells) </span>:: 
<a name="l01920"></a>01920          asum         ,  <span class="comment">! sum of ice and open water area</span>
<a name="l01921"></a>01921          aksum            <span class="comment">! ratio of area removed to area ridged</span>
<a name="l01922"></a>01922 
<a name="l01923"></a>01923       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,0:ncat) </span>:: 
<a name="l01924"></a>01924          apartic          <span class="comment">! participation function; fraction of ridging</span>
<a name="l01925"></a>01925                           <span class="comment">! and closing associated w/ category n</span>
<a name="l01926"></a>01926 
<a name="l01927"></a>01927       <span class="keywordtype">real (kind=dbl_kind)</span>, <span class="keywordtype">dimension (icells,ncat) </span>:: 
<a name="l01928"></a>01928          hrmin        ,  <span class="comment">! minimum ridge thickness</span>
<a name="l01929"></a>01929          hrmax        ,  <span class="comment">! maximum ridge thickness (krdg_redist = 0)</span>
<a name="l01930"></a>01930          hrexp        ,  <span class="comment">! ridge e-folding thickness (krdg_redist = 1) </span>
<a name="l01931"></a>01931          krdg             <span class="comment">! mean ridge thickness/thickness of ridging ice</span>
<a name="l01932"></a>01932 
<a name="l01933"></a>01933       <span class="keywordtype">integer (kind=int_kind) </span>:: 
<a name="l01934"></a>01934          i,j             ,  <span class="comment">! horizontal indices</span>
<a name="l01935"></a>01935          n               ,  <span class="comment">! thickness category index</span>
<a name="l01936"></a>01936          ij                  <span class="comment">! horizontal index, combines i and j loops</span>
<a name="l01937"></a>01937 
<a name="l01938"></a>01938       <span class="keywordtype">real (kind=dbl_kind) </span>:: 
<a name="l01939"></a>01939          hi              ,  <span class="comment">! ice thickness (m)</span>
<a name="l01940"></a>01940          h2rdg           ,  <span class="comment">! mean value of h^2 for new ridge</span>
<a name="l01941"></a>01941          dh2rdg              <span class="comment">! change in mean value of h^2 per unit area</span>
<a name="l01942"></a>01942                              <span class="comment">! consumed by ridging </span>
<a name="l01943"></a>01943 
<a name="l01944"></a>01944       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01945"></a>01945       <span class="comment">! Initialize</span>
<a name="l01946"></a>01946       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01947"></a>01947 
<a name="l01948"></a>01948       strength(:,:) = <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>
<a name="l01949"></a>01949 
<a name="l01950"></a>01950       <span class="keyword">if</span> (<a class="code" href="namespaceice__mechred.html#a2272185e4ee38f92dbb9908fca1dac0a">kstrength</a> == 1) <span class="keyword">then</span>  <span class="comment">! Rothrock &apos;75 formulation</span>
<a name="l01951"></a>01951 
<a name="l01952"></a>01952       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01953"></a>01953       <span class="comment">! Compute thickness distribution of ridging and ridged ice.</span>
<a name="l01954"></a>01954       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01955"></a>01955 
<a name="l01956"></a>01956          call <a class="code" href="namespaceice__mechred.html#a0b56099ad3d0f301b3dfaab8aba87ef4">asum_ridging </a>(nx_block, ny_block,      &amp;
<a name="l01957"></a>01957                             icells,   indxi,  indxj, &amp;
<a name="l01958"></a>01958                             aicen,    aice0,         &amp;
<a name="l01959"></a>01959                             asum)
<a name="l01960"></a>01960 
<a name="l01961"></a>01961          call <a class="code" href="namespaceice__mechred.html#aa337d7f3df7eb6c6f9e3724e2d350e0c">ridge_itd </a>(nx_block,    ny_block,      &amp;
<a name="l01962"></a>01962                          icells,      indxi,  indxj, &amp;
<a name="l01963"></a>01963                          aicen,       vicen,         &amp;
<a name="l01964"></a>01964                          aice0,                      &amp;
<a name="l01965"></a>01965                          aksum,       apartic,       &amp;
<a name="l01966"></a>01966                          hrmin,       hrmax,         &amp;
<a name="l01967"></a>01967                          hrexp,       krdg)
<a name="l01968"></a>01968 
<a name="l01969"></a>01969       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01970"></a>01970       <span class="comment">! Compute ice strength based on change in potential energy,</span>
<a name="l01971"></a>01971       <span class="comment">! as in Rothrock (1975)</span>
<a name="l01972"></a>01972       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l01973"></a>01973 
<a name="l01974"></a>01974          <span class="keyword">if</span> (krdg_redist==0) <span class="keyword">then</span> <span class="comment">! Hibler 1980 formulation</span>
<a name="l01975"></a>01975 
<a name="l01976"></a>01976             <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01977"></a>01977 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01978"></a>01978 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01979"></a>01979 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l01980"></a>01980                <span class="keyword">do</span> ij = 1, icells
<a name="l01981"></a>01981                   i = indxi(ij)
<a name="l01982"></a>01982                   j = indxj(ij)
<a name="l01983"></a>01983                   <span class="keyword">if</span> (aicen(i,j,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a> .and. apartic(ij,n) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>)<span class="keyword">then</span>
<a name="l01984"></a>01984                      hi = vicen(i,j,n) / aicen(i,j,n)
<a name="l01985"></a>01985                      h2rdg = <a class="code" href="namespaceice__constants.html#a9dfb9e1671683be9cb08717f174638cc">p333</a> * (hrmax(ij,n)**3 - hrmin(ij,n)**3)  &amp;
<a name="l01986"></a>01986                                   / (hrmax(ij,n) - hrmin(ij,n)) 
<a name="l01987"></a>01987                      dh2rdg = -hi*hi + h2rdg/krdg(ij,n)
<a name="l01988"></a>01988                      strength(i,j) = strength(i,j) &amp;
<a name="l01989"></a>01989                                    + apartic(ij,n) * dh2rdg
<a name="l01990"></a>01990                   <span class="keyword">endif</span>         <span class="comment">! aicen &gt; puny</span>
<a name="l01991"></a>01991                <span class="keyword">enddo</span>            <span class="comment">! ij</span>
<a name="l01992"></a>01992             <span class="keyword">enddo</span>               <span class="comment">! n</span>
<a name="l01993"></a>01993 
<a name="l01994"></a>01994          elseif (krdg_redist==1) <span class="keyword">then</span> <span class="comment">! exponential formulation</span>
<a name="l01995"></a>01995 
<a name="l01996"></a>01996             <span class="keyword">do</span> n = 1, <a class="code" href="namespaceice__domain__size.html#af6426e75baee1427e99bac2564d5afd7">ncat</a>
<a name="l01997"></a>01997 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l01998"></a>01998 <span class="comment">!cdir nodep      !NEC</span>
<a name="l01999"></a>01999 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l02000"></a>02000                <span class="keyword">do</span> ij = 1, icells
<a name="l02001"></a>02001                   i = indxi(ij)
<a name="l02002"></a>02002                   j = indxj(ij)
<a name="l02003"></a>02003                   <span class="keyword">if</span> (aicen(i,j,n) &gt; <a class="code" href="namespaceice__constants.html#af5d2a72e22e7a53706b6a41ba932a67d">puny</a> .and. apartic(ij,n) &gt; <a class="code" href="namespaceice__constants.html#a8320d3c058c4ae0e12bbf1b11305e51e">c0</a>)<span class="keyword">then</span>
<a name="l02004"></a>02004                      hi = vicen(i,j,n) / aicen(i,j,n)
<a name="l02005"></a>02005                      h2rdg =    hrmin(ij,n)*hrmin(ij,n) &amp;
<a name="l02006"></a>02006                            + <a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>*hrmin(ij,n)*hrexp(ij,n) &amp;
<a name="l02007"></a>02007                            + <a class="code" href="namespaceice__constants.html#a683e0c28523a17a5d2cd40066167570a">c2</a>*hrexp(ij,n)*hrexp(ij,n)
<a name="l02008"></a>02008                      dh2rdg = -hi*hi + h2rdg/krdg(ij,n)
<a name="l02009"></a>02009                      strength(i,j) = strength(i,j) &amp;
<a name="l02010"></a>02010                                    + apartic(ij,n) * dh2rdg
<a name="l02011"></a>02011                   <span class="keyword">endif</span>
<a name="l02012"></a>02012                <span class="keyword">enddo</span>            <span class="comment">! ij</span>
<a name="l02013"></a>02013             <span class="keyword">enddo</span>               <span class="comment">! n</span>
<a name="l02014"></a>02014 
<a name="l02015"></a>02015          <span class="keyword">endif</span>                  <span class="comment">! krdg_redist</span>
<a name="l02016"></a>02016 
<a name="l02017"></a>02017 <span class="comment">!DIR$ CONCURRENT !Cray</span>
<a name="l02018"></a>02018 <span class="comment">!cdir nodep      !NEC</span>
<a name="l02019"></a>02019 <span class="comment">!ocl novrec      !Fujitsu</span>
<a name="l02020"></a>02020          <span class="keyword">do</span> ij = 1, icells
<a name="l02021"></a>02021             i = indxi(ij)
<a name="l02022"></a>02022             j = indxj(ij)
<a name="l02023"></a>02023             strength(i,j) = <a class="code" href="namespaceice__mechred.html#ae649373b3c64951beea9cf6d3436124a">Cf</a> * <a class="code" href="namespaceice__mechred.html#ae1333fb1d2c19a54662644143d18489c">Cp</a> * strength(i,j) / aksum(ij)
<a name="l02024"></a>02024                           <span class="comment">! Cp = (g/2)*(rhow-rhoi)*(rhoi/rhow)</span>
<a name="l02025"></a>02025                           <span class="comment">! Cf accounts for frictional dissipation</span>
<a name="l02026"></a>02026          <span class="keyword">enddo</span>            <span class="comment">! ij</span>
<a name="l02027"></a>02027 
<a name="l02028"></a>02028       <span class="keyword">else</span>                      <span class="comment">! kstrength /= 1:  Hibler (1979) form</span>
<a name="l02029"></a>02029 
<a name="l02030"></a>02030       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l02031"></a>02031       <span class="comment">! Compute ice strength as in Hibler (1979)</span>
<a name="l02032"></a>02032       <span class="comment">!-----------------------------------------------------------------</span>
<a name="l02033"></a>02033 
<a name="l02034"></a>02034          <span class="keyword">do</span> j = jlo, jhi
<a name="l02035"></a>02035          <span class="keyword">do</span> i = ilo, ihi
<a name="l02036"></a>02036             strength(i,j) = Pstar*vice(i,j)*exp(-Cstar*(<a class="code" href="namespaceice__constants.html#a74c3f6d59942aec40dda487c6af99039">c1</a>-aice(i,j)))
<a name="l02037"></a>02037          <span class="keyword">enddo</span>                  <span class="comment">! j</span>
<a name="l02038"></a>02038          <span class="keyword">enddo</span>                  <span class="comment">! i</span>
<a name="l02039"></a>02039 
<a name="l02040"></a>02040       <span class="keyword">endif</span>                     <span class="comment">! kstrength</span>
<a name="l02041"></a>02041 
<a name="l02042"></a>02042 <span class="keyword">      end subroutine ice_strength</span>
<a name="l02043"></a>02043 
<a name="l02044"></a>02044 <span class="comment">!=======================================================================</span>
<a name="l02045"></a>02045 
<a name="l02046"></a>02046 <span class="keyword">      end module ice_mechred</span>
<a name="l02047"></a>02047 
<a name="l02048"></a>02048 <span class="comment">!=======================================================================</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Oct 6 14:02:24 2009 for CICE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
